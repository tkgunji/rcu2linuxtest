<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RCU linux tools and drivers for the DCS board : cmdInterpreter.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>cmdInterpreter.c</h1><a href="cmdInterpreter_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// $Id: cmdInterpreter.c,v 1.26 2007/03/17 00:01:16 richter Exp $</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/************************************************************************</span>
<a name="l00004"></a>00004 <span class="comment">**</span>
<a name="l00005"></a>00005 <span class="comment">**</span>
<a name="l00006"></a>00006 <span class="comment">** This file is property of and copyright by the Experimental Nuclear </span>
<a name="l00007"></a>00007 <span class="comment">** Physics Group, Dep. of Physics and Technology</span>
<a name="l00008"></a>00008 <span class="comment">** University of Bergen, Norway, 2004</span>
<a name="l00009"></a>00009 <span class="comment">** This file has been written by Matthias Richter,</span>
<a name="l00010"></a>00010 <span class="comment">** Matthias.Richter@ift.uib.no</span>
<a name="l00011"></a>00011 <span class="comment">**</span>
<a name="l00012"></a>00012 <span class="comment">** Permission to use, copy, modify and distribute this software and its  </span>
<a name="l00013"></a>00013 <span class="comment">** documentation strictly for non-commercial purposes is hereby granted  </span>
<a name="l00014"></a>00014 <span class="comment">** without fee, provided that the above copyright notice appears in all  </span>
<a name="l00015"></a>00015 <span class="comment">** copies and that both the copyright notice and this permission notice  </span>
<a name="l00016"></a>00016 <span class="comment">** appear in the supporting documentation. The authors make no claims    </span>
<a name="l00017"></a>00017 <span class="comment">** about the suitability of this software for any purpose. It is         </span>
<a name="l00018"></a>00018 <span class="comment">** provided "as is" without express or implied warranty.                 </span>
<a name="l00019"></a>00019 <span class="comment">**</span>
<a name="l00020"></a>00020 <span class="comment">*************************************************************************/</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include "<a class="code" href="memoryguard_8h.html">memoryguard.h</a>"</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;errno.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;time.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include "<a class="code" href="cmdInterpreter_8h.html">cmdInterpreter.h</a>"</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include "<a class="code" href="dcscMsgBufferInterface_8h.html">dcscMsgBufferInterface.h</a>"</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include "<a class="code" href="selectmapInterface_8h.html">selectmapInterface.h</a>"</span>
<a name="l00034"></a>00034 <span class="comment">//#include "rcuMemtest.h"</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include "<a class="code" href="mrtimers_8h.html">mrtimers.h</a>"</span>
<a name="l00036"></a>00036 <span class="comment">//#include "FileReader.h"</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include "<a class="code" href="mrshellprim_8h.html">mrshellprim.h</a>"</span>
<a name="l00038"></a>00038 
<a name="l00039"></a><a class="code" href="cmdInterpreter_8c.html#a2715fedb0c405a7e0062c79494b1ec0">00039</a> <span class="preprocessor">#define PRINT_COMMAND_BUFFER_CTR_STRING   "pcb (print command buffer)"</span>
<a name="l00040"></a><a class="code" href="cmdInterpreter_8c.html#982ee2112f9e2dccdaf82731415a0441">00040</a> <span class="preprocessor"></span><span class="preprocessor">#define PRINT_RESULT_BUFFER_CTR_STRING    "prb (print result buffer)"</span>
<a name="l00041"></a><a class="code" href="cmdInterpreter_8c.html#348a570c30753c168854ec146a2fb53d">00041</a> <span class="preprocessor"></span><span class="preprocessor">#define CHECK_COMMAND_BUFFER_CTR_STRING   "c   (check command buffer)"</span>
<a name="l00042"></a><a class="code" href="cmdInterpreter_8c.html#402f2e4e3254aa689123c78be75bed0a">00042</a> <span class="preprocessor"></span><span class="preprocessor">#define IGNORE_BUFFER_CHECK_CTR_STRING    "i   (ignore buffer check)"</span>
<a name="l00043"></a><a class="code" href="cmdInterpreter_8c.html#997f96a957fef1c6c614fb5cf4b4e3e2">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define PRINT_CTRL_REGISTER_CTR_STRING    "pcr (print control register)"</span>
<a name="l00044"></a><a class="code" href="cmdInterpreter_8c.html#82cf9e89b90c524882e4c7ec0826a37f">00044</a> <span class="preprocessor"></span><span class="preprocessor">#define PRINT_COMMAND_RESULT_CTR_STRING   "r   (print command result)"</span>
<a name="l00045"></a><a class="code" href="cmdInterpreter_8c.html#c880e8e94aca75337b987af06141dcaa">00045</a> <span class="preprocessor"></span><span class="preprocessor">#define CMD_STRING_PROFILE                "profile"</span>
<a name="l00046"></a><a class="code" href="cmdInterpreter_8c.html#5d86dae553f9c8b404487c4f1d3592df">00046</a> <span class="preprocessor"></span><span class="preprocessor">#define CMD_STRING_MRT_DEBUG              "timerdbg"</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>
<a name="l00048"></a>00048 <span class="comment">/*</span>
<a name="l00049"></a>00049 <span class="comment">#define CA_ADDRESS_VALID       0x01</span>
<a name="l00050"></a>00050 <span class="comment">#define CA_DATA_VALID          0x02</span>
<a name="l00051"></a>00051 <span class="comment">#define CA_FILE_NAME_VALID     0x04</span>
<a name="l00052"></a>00052 <span class="comment">#define CA_NOF_WORDS_VALID     0x08</span>
<a name="l00053"></a>00053 <span class="comment"></span>
<a name="l00054"></a>00054 <span class="comment">#define FF_BINARY_8            0x01</span>
<a name="l00055"></a>00055 <span class="comment">#define FF_BINARY_16           0x02</span>
<a name="l00056"></a>00056 <span class="comment">#define FF_BINARY_32           0x03</span>
<a name="l00057"></a>00057 <span class="comment">#define FF_CHARACTER           0x04</span>
<a name="l00058"></a>00058 <span class="comment">*/</span>
<a name="l00059"></a>00059 
<a name="l00060"></a><a class="code" href="cmdInterpreter_8c.html#b1b44b602185677d4a2a372121627437">00060</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#b1b44b602185677d4a2a372121627437">g_profiling</a>=0;
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="comment">/*</span>
<a name="l00063"></a>00063 <span class="comment">typedef struct {</span>
<a name="l00064"></a>00064 <span class="comment">  unsigned int uiAddress;</span>
<a name="l00065"></a>00065 <span class="comment">  unsigned int uiData;</span>
<a name="l00066"></a>00066 <span class="comment">  int iNofWords;</span>
<a name="l00067"></a>00067 <span class="comment">  char* pFileName;</span>
<a name="l00068"></a>00068 <span class="comment">  int iFileFormatFlags;</span>
<a name="l00069"></a>00069 <span class="comment">  unsigned int valid;</span>
<a name="l00070"></a>00070 <span class="comment">} TCommandArgs;</span>
<a name="l00071"></a>00071 <span class="comment">*/</span>
<a name="l00072"></a>00072 
<a name="l00073"></a><a class="code" href="cmdInterpreter_8c.html#ab5835ceff4b64ce6db4148256e0a0f0">00073</a> <span class="keyword">enum</span> <a class="code" href="cmdInterpreter_8c.html#ab5835ceff4b64ce6db4148256e0a0f0">ConditionTypes</a> {
<a name="l00074"></a>00074   <a class="code" href="cmdInterpreter_8c.html#ab5835ceff4b64ce6db4148256e0a0f067fd08219d48244557a06e13926853ee">e_fail</a> = 0,
<a name="l00075"></a>00075   <a class="code" href="cmdInterpreter_8c.html#ab5835ceff4b64ce6db4148256e0a0f0cb161923a23a717c2d959051d073d65c">e_continue</a>,
<a name="l00076"></a>00076 };
<a name="l00077"></a>00077 
<a name="l00078"></a><a class="code" href="structTCondition.html">00078</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00079"></a><a class="code" href="structTCondition.html#a0f092121f681df301d31ca256804d7b">00079</a>   <span class="keywordtype">int</span> type;
<a name="l00080"></a><a class="code" href="structTCondition.html#7f5e8b0c24ff4ce266435ea2e75ad741">00080</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bitMask;
<a name="l00081"></a><a class="code" href="structTCondition.html#d70dd6afa7726f401616e1dfa5132fc6">00081</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pattern;
<a name="l00082"></a>00082 } <a class="code" href="structTCondition.html">TCondition</a>;
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="cmdInterpreter_8c.html#46956baca790c8f97d618114d456b1fe">00084</a> <span class="keywordtype">void</span>* <a class="code" href="cmdInterpreter_8c.html#46956baca790c8f97d618114d456b1fe">ConvertASCII2Bin</a>(<span class="keywordtype">char</span>* pASCIIBuffer, <span class="keywordtype">int</span>* piBufferSize, <span class="keywordtype">int</span> iWordSize)
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086   <span class="keywordtype">void</span>* pResult=NULL;
<a name="l00087"></a>00087   <span class="keywordtype">int</span> iSize=0;
<a name="l00088"></a>00088   <span class="keywordtype">int</span> iNofWords=0;
<a name="l00089"></a>00089   <span class="keywordflow">if</span> (pASCIIBuffer &amp;&amp; iWordSize&gt;0 &amp;&amp; iWordSize&lt;=4) {
<a name="l00090"></a>00090     <span class="keywordtype">int</span> i=-1;
<a name="l00091"></a>00091     <span class="keywordtype">int</span> j=0;
<a name="l00092"></a>00092     __u32 data=0;
<a name="l00093"></a>00093     <span class="keywordtype">char</span> cSeparators[]={<span class="charliteral">'\n'</span>,<span class="charliteral">'\t'</span>,<span class="charliteral">' '</span>, 0}; <span class="comment">// the array has to bee 0 terminated</span>
<a name="l00094"></a>00094     <span class="keywordtype">int</span> k=0;
<a name="l00095"></a>00095     <span class="keywordflow">do</span> {
<a name="l00096"></a>00096       <span class="comment">// data words can be separated by \n, \t or SPC</span>
<a name="l00097"></a>00097       <span class="keywordflow">for</span> (k=0; cSeparators[k]!=0 &amp;&amp; cSeparators[k]!=pASCIIBuffer[j]; k++);
<a name="l00098"></a>00098       <span class="keywordflow">if</span> (cSeparators[k]!=0 || pASCIIBuffer[j]==0) {
<a name="l00099"></a>00099     <span class="keywordflow">if</span> (i&gt;=0) {
<a name="l00100"></a>00100       <span class="comment">// this is the end of an argument</span>
<a name="l00101"></a>00101       iNofWords++;
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103     i=-1;
<a name="l00104"></a>00104       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i&lt;0) {
<a name="l00105"></a>00105     <span class="comment">// this is the start of an argument</span>
<a name="l00106"></a>00106     i=j;
<a name="l00107"></a>00107       }
<a name="l00108"></a>00108       <span class="comment">//printf("%d : %d\n",j, pASCIIBuffer[j]); </span>
<a name="l00109"></a>00109     } <span class="keywordflow">while</span> (pASCIIBuffer[j++]!=0);
<a name="l00110"></a>00110     <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;<a class="code" href="group__dcsc__msg__buffer__access.html#g6fe994d64da543fe875682bb79b5d585">DBG_FILE_CONVERT</a>)
<a name="l00111"></a>00111       fprintf(stderr, <span class="stringliteral">"ConvertASCII2Bin: %d word(s)\n"</span>, iNofWords);
<a name="l00112"></a>00112     <span class="keywordflow">if</span> (iNofWords&gt;0) {
<a name="l00113"></a>00113       iSize=iNofWords*iWordSize;
<a name="l00114"></a>00114       pResult=malloc(iSize);
<a name="l00115"></a>00115       <span class="keywordflow">if</span> (pResult) {
<a name="l00116"></a>00116     iNofWords=0;
<a name="l00117"></a>00117     <span class="keywordtype">int</span> iWarning=0;
<a name="l00118"></a>00118     i=-1; j=0;
<a name="l00119"></a>00119     <span class="keywordflow">do</span> {
<a name="l00120"></a>00120       <span class="comment">// data words can be separated by \n, \t or SPC</span>
<a name="l00121"></a>00121       <span class="keywordflow">for</span> (k=0; cSeparators[k]!=0 &amp;&amp; cSeparators[k]!=pASCIIBuffer[j]; k++);
<a name="l00122"></a>00122       <span class="keywordflow">if</span> (cSeparators[k]!=0 || pASCIIBuffer[j]==0) {
<a name="l00123"></a>00123         <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;<a class="code" href="group__dcsc__msg__buffer__access.html#g6fe994d64da543fe875682bb79b5d585">DBG_FILE_CONVERT</a>)
<a name="l00124"></a>00124           fprintf(stderr, <span class="stringliteral">"i=%d, j=%d\n"</span>, i, j);
<a name="l00125"></a>00125         <span class="keywordflow">if</span> (i&gt;=0) {
<a name="l00126"></a>00126           data=0;
<a name="l00127"></a>00127           <span class="keywordflow">if</span> (sscanf(&amp;pASCIIBuffer[i], <span class="stringliteral">" 0x%x"</span>, &amp;data)==1 || sscanf(&amp;pASCIIBuffer[i], <span class="stringliteral">" %x"</span>, &amp;data)==1) {
<a name="l00128"></a>00128         <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;DBG_FILE_CONVERT)
<a name="l00129"></a>00129           fprintf(stderr, <span class="stringliteral">"%d: %#x\n"</span>,iNofWords, data);
<a name="l00130"></a>00130         __u32 mask=0xffffffff;
<a name="l00131"></a>00131         <span class="keywordflow">if</span> (iWordSize==1) mask=0x0ff;
<a name="l00132"></a>00132         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iWordSize==2) mask=0x0ffff;
<a name="l00133"></a>00133         <span class="keywordflow">if</span> (iWarning==0 &amp;&amp; (data&amp;mask)!=data) {
<a name="l00134"></a>00134           fprintf(stderr, <span class="stringliteral">"ConvertASCII2Bin: data word(s) truncated, exceed(s) bit width of %d\n"</span>, iWordSize*8);
<a name="l00135"></a>00135           iWarning++;
<a name="l00136"></a>00136         }
<a name="l00137"></a>00137         data&amp;=mask;
<a name="l00138"></a>00138         memcpy(((<span class="keywordtype">char</span>*)pResult)+iWordSize*iNofWords++, &amp;data, iWordSize);
<a name="l00139"></a>00139           }
<a name="l00140"></a>00140         }
<a name="l00141"></a>00141         i=-1;
<a name="l00142"></a>00142       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i&lt;0) {
<a name="l00143"></a>00143         i=j;
<a name="l00144"></a>00144       }
<a name="l00145"></a>00145     } <span class="keywordflow">while</span> (pASCIIBuffer[j++]!=0);
<a name="l00146"></a>00146       }
<a name="l00147"></a>00147     } <span class="keywordflow">else</span> {
<a name="l00148"></a>00148       fprintf(stderr, <span class="stringliteral">"ConvertASCII2Bin warning: file doesnt contain meaningful data \n"</span>);
<a name="l00149"></a>00149     }
<a name="l00150"></a>00150   }
<a name="l00151"></a>00151   <span class="keywordflow">if</span> (iSize&gt;0 &amp;&amp; iSize!=iNofWords*iWordSize) {
<a name="l00152"></a>00152     fprintf(stderr, <span class="stringliteral">"ConvertASCII2Bin error: parse error, fewer words than expected\n"</span>);
<a name="l00153"></a>00153     iSize=0;
<a name="l00154"></a>00154   }
<a name="l00155"></a>00155   <span class="keywordflow">if</span> (iSize==0 &amp;&amp; pResult!=NULL) {
<a name="l00156"></a>00156     free(pResult);
<a name="l00157"></a>00157     pResult=NULL;
<a name="l00158"></a>00158   }
<a name="l00159"></a>00159   <span class="keywordflow">if</span> (piBufferSize)
<a name="l00160"></a>00160     *piBufferSize=iSize;
<a name="l00161"></a>00161   <span class="keywordflow">return</span> pResult;
<a name="l00162"></a>00162 }
<a name="l00163"></a>00163 
<a name="l00164"></a><a class="code" href="cmdInterpreter_8h.html#ac3ae2fb745e63e33060d5c0b658f745">00164</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#ac3ae2fb745e63e33060d5c0b658f745">printInfo</a>()
<a name="l00165"></a>00165 {
<a name="l00166"></a>00166   printf(<span class="stringliteral">"\n**********************************\nrcu bus easy read/write access\n\n"</span>);
<a name="l00167"></a>00167   printf(<span class="stringliteral">"version %s (compiled "</span>__DATE__<span class="stringliteral">", "</span>__TIME__<span class="stringliteral">")\n"</span>, VERSION);
<a name="l00168"></a>00168   printf(<span class="stringliteral">"Matthias Richter, University of Bergen\n"</span>);
<a name="l00169"></a>00169   printf(<span class="stringliteral">"Matthias.Richter@ift.uib.no\n\n"</span>);
<a name="l00170"></a>00170   <span class="keywordflow">return</span> 0;
<a name="l00171"></a>00171 }
<a name="l00172"></a>00172 
<a name="l00173"></a><a class="code" href="cmdInterpreter_8c.html#15843554cb32ffb674f4245cfe5ee524">00173</a> <span class="keywordtype">void</span> <a class="code" href="cmdInterpreter_8c.html#15843554cb32ffb674f4245cfe5ee524">printDebugHelp</a>(<span class="keywordtype">int</span> iLevel)
<a name="l00174"></a>00174 {
<a name="l00175"></a>00175   printf(<span class="stringliteral">"  debug options: logical or of bits\n"</span>);
<a name="l00176"></a>00176   <span class="comment">/*</span>
<a name="l00177"></a>00177 <span class="comment">    printf("  &lt;+/-&gt; &lt;%s&gt;\t\t turn on/off printing of command buffer\n", PRINT_COMMAND_BUFFER_CTR_STRING);</span>
<a name="l00178"></a>00178 <span class="comment">    printf("  &lt;+/-&gt; &lt;%s&gt;\t\t turn on/off printing of result buffer\n", PRINT_RESULT_BUFFER_CTR_STRING);</span>
<a name="l00179"></a>00179 <span class="comment">    printf("  &lt;+/-&gt; &lt;%s&gt;\t\t turn on/off check (read back) of command buffer before execution\n", CHECK_COMMAND_BUFFER_CTR_STRING);</span>
<a name="l00180"></a>00180 <span class="comment">    printf("  &lt;+/-&gt; &lt;%s&gt;\t\t turn on/off ignoring the result of the test\n", IGNORE_BUFFER_CHECK_CTR_STRING);</span>
<a name="l00181"></a>00181 <span class="comment">    printf("  &lt;+/-&gt; &lt;%s&gt;\t\t turn on/off printing the status of the control register\n", PRINT_CTRL_REGISTER_CTR_STRING);</span>
<a name="l00182"></a>00182 <span class="comment">  */</span>
<a name="l00183"></a>00183   printf(<span class="stringliteral">"  &lt;+/- 0x%03x&gt;\t turn on/off printing of command buffer\n"</span>, <a class="code" href="group__dcsc__msg__buffer__access.html#gdcd41743796fdb5a280fc3914121eb05">PRINT_COMMAND_BUFFER</a>);
<a name="l00184"></a>00184   printf(<span class="stringliteral">"  &lt;+/- 0x%03x&gt;\t turn on/off printing of result buffer\n"</span>, <a class="code" href="group__dcsc__msg__buffer__access.html#gcbc0bfb0d39b96550d664a58aa705cbb">PRINT_RESULT_BUFFER</a>);
<a name="l00185"></a>00185   printf(<span class="stringliteral">"  &lt;+/- 0x%03x&gt;\t turn on/off check (read back) of cmd buffer before execution\n"</span>, <a class="code" href="group__dcsc__msg__buffer__access.html#g9eba95d21cfe8d57e7d52cadc13e1b91">CHECK_COMMAND_BUFFER</a>);
<a name="l00186"></a>00186   printf(<span class="stringliteral">"  &lt;+/- 0x%03x&gt;\t turn on/off ignoring the result of the test\n"</span>, <a class="code" href="group__dcsc__msg__buffer__access.html#g4115ae88155913f9a07bfbbd995f5e4f">IGNORE_BUFFER_CHECK</a>);
<a name="l00187"></a>00187   printf(<span class="stringliteral">"  &lt;+/- 0x%03x&gt;\t turn on/off printing of access to the control registers\n"</span>, <a class="code" href="group__dcsc__msg__buffer__access.html#gc3ceb106888209dd1796a27d49f567d8">PRINT_REGISTER_ACCESS</a>);
<a name="l00188"></a>00188   printf(<span class="stringliteral">"  &lt;+/- 0x%03x&gt;\t turn on/off print the result of the command\n"</span>, <a class="code" href="group__dcsc__msg__buffer__access.html#g2f996fd7aaf5d3df34642fc4dcd9ef66">PRINT_COMMAND_RESULT</a>);
<a name="l00189"></a>00189   <span class="keywordflow">if</span> (iLevel&gt;0) printf(<span class="stringliteral">"  &lt;+/- 0x%03x&gt;\t turn on/off print debug info on splitting in multiple operations\n"</span>, <a class="code" href="group__dcsc__msg__buffer__access.html#g36c838823c9602c6a0f6efd1fe135b18">PRINT_SPLIT_DEBUG</a>);
<a name="l00190"></a>00190   <span class="keywordflow">if</span> (iLevel&gt;0) printf(<span class="stringliteral">"  &lt;+/- 0x%03x&gt;\t turn on/off print debug info on file conversion\n"</span>, <a class="code" href="group__dcsc__msg__buffer__access.html#g6fe994d64da543fe875682bb79b5d585">DBG_FILE_CONVERT</a>);
<a name="l00191"></a>00191   printf(<span class="stringliteral">"  &lt;+/- 0x%03x&gt;\t turn on/off translate result human readable\n"</span>, <a class="code" href="group__dcsc__msg__buffer__access.html#g5d966eba98a480141a4145615ca3ea15">PRINT_RESULT_HUMAN_READABLE</a>);
<a name="l00192"></a>00192   <span class="keywordflow">if</span> (iLevel&gt;0) printf(<span class="stringliteral">"  &lt;+/- 0x%03x&gt;\t turn on/off print debug info on argument conversion\n"</span>, <a class="code" href="mrshellprim_8h.html#13095cc00efe5276cf7a1794f0f8b7e5">DBG_ARGUMENT_CONVERT</a>);
<a name="l00193"></a>00193   <span class="keywordflow">if</span> (iLevel&gt;0) printf(<span class="stringliteral">"  &lt;+/- 0x%03x&gt;\t turn on/off print debug info on the 'check' command\n"</span>, <a class="code" href="group__dcsc__msg__buffer__access.html#g7eaf88fd984d7f7c8c760dce4cb355d1">DBG_CHECK_COMMAND</a>);
<a name="l00194"></a>00194   printf(<span class="stringliteral">"  - turn off all messages\n"</span>);
<a name="l00195"></a>00195   printf(<span class="stringliteral">"  + turn on default messages (%#x)\n"</span>, <a class="code" href="group__dcsc__msg__buffer__access.html#gf34c3c30400c83a97dd0deadaead479c">DBG_DEFAULT</a>);
<a name="l00196"></a>00196 }
<a name="l00197"></a>00197 
<a name="l00198"></a><a class="code" href="cmdInterpreter_8h.html#f03f7609a66def2e7fae02a477c38d97">00198</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#f03f7609a66def2e7fae02a477c38d97">printHelp</a>()
<a name="l00199"></a>00199 {
<a name="l00200"></a>00200   printf(<span class="stringliteral">"  all parameters are hex values preceeded by a '0x' or decimal numbers\n"</span>);
<a name="l00201"></a>00201   printf(<span class="stringliteral">"  some of the commands have a short version, in most cases the first letter\n"</span>);
<a name="l00202"></a>00202   printf(<span class="stringliteral">"  quit                   : q\n"</span>);
<a name="l00203"></a>00203   printf(<span class="stringliteral">"  info                   : i\n"</span>);
<a name="l00204"></a>00204   printf(<span class="stringliteral">"  driver info            : d\n"</span>);
<a name="l00205"></a>00205   printf(<span class="stringliteral">"  repeat previous command: p\n"</span>);
<a name="l00206"></a>00206   printf(<span class="stringliteral">"  single read rcu bus memory   : r[ead] 0x&lt;address&gt; (e.g.: r 0x7000)\n"</span>);
<a name="l00207"></a>00207   printf(<span class="stringliteral">"  multiple read rcu bus memory : r[ead] 0x&lt;address&gt; &lt;dec no&gt; (e.g.: r 0x7000 16)\n"</span>);
<a name="l00208"></a>00208   printf(<span class="stringliteral">"                                 see 'hr\' for details and further options\n"</span>);
<a name="l00209"></a>00209   printf(<span class="stringliteral">"  single write rcu bus memory  : w[rite] [-s,--swap] 0x&lt;address&gt; 0x&lt;data&gt;\n"</span>);
<a name="l00210"></a>00210   printf(<span class="stringliteral">"                                 (e.g.: w 0x6800 0x34)\n"</span>);
<a name="l00211"></a>00211   printf(<span class="stringliteral">"  multiple write with const    : w[rite] [-s,--swap] 0x&lt;address&gt; &lt;dec no&gt; 0x&lt;data&gt;\n"</span>);
<a name="l00212"></a>00212   printf(<span class="stringliteral">"                                 (e.g.: w 0x6800 12 0x0a)\n"</span>);
<a name="l00213"></a>00213   printf(<span class="stringliteral">"  write file to rcu bus memory : w[rite] [-s,--swap] 0x&lt;address&gt; &lt;fspec&gt; 'filepath' &lt;count&gt; \n"</span>);
<a name="l00214"></a>00214   printf(<span class="stringliteral">"     optional format spec: -b4(default) -b2 -b1 binary 32,16,8 bit\n"</span>);
<a name="l00215"></a>00215   printf(<span class="stringliteral">"                           -b10 binary compressed 10 bit, -c ascii\n"</span>);
<a name="l00216"></a>00216   printf(<span class="stringliteral">"     optional number after the filepath specifies count for partially write\n"</span>);
<a name="l00217"></a>00217   printf(<span class="stringliteral">"     e.g.: w 0x6800 -c 'pedestal.dat' 512,  w 0x7000 'pgm.dat'\n"</span>);
<a name="l00218"></a>00218   printf(<span class="stringliteral">"  sending a single command     : c 0x&lt;address&gt; (translated to w &lt;address&gt; 0x0\n"</span>);
<a name="l00219"></a>00219   printf(<span class="stringliteral">"  check status of mem location : ? 0x&lt;address&gt; [[c,f] 0x&lt;bitmask&gt; 0x&lt;pattern&gt;]\n"</span>);
<a name="l00220"></a>00220   printf(<span class="stringliteral">"                                               [t n s(ec)/u(sec)]\n"</span>);
<a name="l00221"></a>00221   printf(<span class="stringliteral">"  batch processing             : b[atch] 'filepath' [[-l] &lt;count&gt;,-i]\n"</span>);
<a name="l00222"></a>00222   printf(<span class="stringliteral">"                                 see \'hb\' for details and further options\n"</span>);
<a name="l00223"></a>00223   printf(<span class="stringliteral">"  wait command                 : wait &lt;n&gt; s(ec)/u(sec)\n"</span>);
<a name="l00224"></a>00224   printf(<span class="stringliteral">"  log message                  : e[cho] [-o,-a &lt;filename&gt;] &lt;message&gt;\n"</span>);
<a name="l00225"></a>00225   printf(<span class="stringliteral">"     the message can contain a \'-t\' specifier to print a timestamp\n\n"</span>);
<a name="l00226"></a>00226   printf(<span class="stringliteral">"  flash memory commands        : flash &lt;cmd&gt; (try \'flash help\')\n"</span>);
<a name="l00227"></a>00227   printf(<span class="stringliteral">"  selectmap commands           : sm[selectmap] &lt;cmd&gt; (try \'sm help\')\n"</span>);
<a name="l00228"></a>00228   printf(<span class="stringliteral">"  firmware commands            : fw[firmware] &lt;cmd&gt; (try \'fw help\')\n"</span>);
<a name="l00229"></a>00229   printf(<span class="stringliteral">"  read bus control register    : rcr[read-ctrlreg]\n"</span>);
<a name="l00230"></a>00230   <span class="comment">//printf("  check rcu bus memory: m 0x&lt;address&gt; 0x&lt;size in byte&gt;\n");</span>
<a name="l00231"></a>00231   <span class="comment">//printf("  read from file\n");</span>
<a name="l00232"></a>00232   printf(<span class="stringliteral">"  -/+ profile: switch on/off profiling\n"</span>);
<a name="l00233"></a>00233   printf(<span class="stringliteral">"  - turn off all messages\n"</span>);
<a name="l00234"></a>00234   printf(<span class="stringliteral">"  + turn on default messages\n"</span>);
<a name="l00235"></a>00235   printf(<span class="stringliteral">"  hd debug message info\n"</span>);
<a name="l00236"></a>00236   printf(<span class="stringliteral">"  hr detailed help for the read-command\n"</span>);
<a name="l00237"></a>00237   <span class="keywordflow">return</span> 0;
<a name="l00238"></a>00238 }
<a name="l00239"></a>00239 
<a name="l00240"></a><a class="code" href="cmdInterpreter_8c.html#17ba9ebf0687897855a7c95f19e99c3d">00240</a> <span class="keywordtype">void</span> <a class="code" href="cmdInterpreter_8c.html#17ba9ebf0687897855a7c95f19e99c3d">printReadHelp</a>() {
<a name="l00241"></a>00241   printf(<span class="stringliteral">"  the \'read\' command:\n"</span>);
<a name="l00242"></a>00242   printf(<span class="stringliteral">"  r[ead] 0x&lt;address&gt; [number of words] [-f &lt;format&gt;] [-o,a &lt;file name&gt;]\n"</span>);
<a name="l00243"></a>00243   printf(<span class="stringliteral">"   number of words optional for multiple read\n"</span>);
<a name="l00244"></a>00244   printf(<span class="stringliteral">"   format of the output: the format string can be an arbitrary string \n"</span>);
<a name="l00245"></a>00245   printf(<span class="stringliteral">"     with specifiers similar to the \'printf\' standard\n"</span>);
<a name="l00246"></a>00246   printf(<span class="stringliteral">"     %%a - print the address\n"</span>);
<a name="l00247"></a>00247   printf(<span class="stringliteral">"     %%x - hexadecimal\n"</span>);
<a name="l00248"></a>00248   printf(<span class="stringliteral">"     %%d - decimal\n"</span>);
<a name="l00249"></a>00249   printf(<span class="stringliteral">"     %%f - float\n"</span>);
<a name="l00250"></a>00250   printf(<span class="stringliteral">"     %%b - binary (%%b1, %%b2, %%b4=%%b: one, two and four byte words)\n"</span>);
<a name="l00251"></a>00251   printf(<span class="stringliteral">"     between the \'%%\' character and the specifier similar format options\n"</span>);
<a name="l00252"></a>00252   printf(<span class="stringliteral">"     as for printf apply, \\n is interpreted as newline \n"</span>);
<a name="l00253"></a>00253   printf(<span class="stringliteral">"     important note: enclose the string into quotes, if it contains blanks\n"</span>);
<a name="l00254"></a>00254   printf(<span class="stringliteral">"       examples: \'%%a: %%#x\' (default), \'%%3.2f\', \'%%d\\n%%d\\n\'\n"</span>);
<a name="l00255"></a>00255   printf(<span class="stringliteral">"     specifiers can be followd by a bit mask and coefficients for a\n"</span>);
<a name="l00256"></a>00256   printf(<span class="stringliteral">"     linear conversion enclosed in \'[]\': [&amp;0x&lt;mask&gt;*&lt;factor&gt;+/-&lt;offset&gt;]\n"</span>);
<a name="l00257"></a>00257   printf(<span class="stringliteral">"     e.g. [&amp;0xff*8 -5] means masking of the 8 LSBs, multiplication by 8 and\n"</span>);
<a name="l00258"></a>00258   printf(<span class="stringliteral">"     subtraction by 5, other examples [*-1 +6] (multiplication by -1)\n"</span>);
<a name="l00259"></a>00259   printf(<span class="stringliteral">"   redirection of the output: -o creates a new file, -a appends to a file\n"</span>);
<a name="l00260"></a>00260 }
<a name="l00261"></a>00261 
<a name="l00262"></a><a class="code" href="cmdInterpreter_8c.html#c744cdcd05bdccf013ccbc82daa2282a">00262</a> <span class="keywordtype">void</span> <a class="code" href="cmdInterpreter_8c.html#c744cdcd05bdccf013ccbc82daa2282a">printBatchProcHelp</a>() {
<a name="l00263"></a>00263   printf(<span class="stringliteral">"  the \'batch\' command:\n"</span>);
<a name="l00264"></a>00264   printf(<span class="stringliteral">"  reads commands from a file and executes them sequencially\n"</span>);
<a name="l00265"></a>00265   printf(<span class="stringliteral">"  b[atch] 'filepath' [[-l] &lt;count&gt;,-i] [-v &lt;level&gt;,-s] [-w &lt;n&gt; s(ec)/u(sec)]\n"</span>);
<a name="l00266"></a>00266   printf(<span class="stringliteral">"   -l specifies number of loops, -i infinite (terminated by CTRL-C)\n"</span>);
<a name="l00267"></a>00267   printf(<span class="stringliteral">"   -v verbosity level (0,1,2), -s silent (-v 0)\n"</span>);
<a name="l00268"></a>00268   printf(<span class="stringliteral">"   -w wait n sec/usec between the cycles\n"</span>);
<a name="l00269"></a>00269 }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271 <span class="comment">/* reads the next two arguments and translates it into the sec/usec</span>
<a name="l00272"></a>00272 <span class="comment"> */</span>
<a name="l00273"></a><a class="code" href="cmdInterpreter_8c.html#6ead18c93a106e1f1ba5871e908d9916">00273</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#6ead18c93a106e1f1ba5871e908d9916">readTime</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg, <span class="keywordtype">int</span> iNofArgs, <span class="keywordtype">int</span> *pSec, <span class="keywordtype">int</span>* pMusec)
<a name="l00274"></a>00274 {
<a name="l00275"></a>00275   <span class="keywordtype">int</span> iResult=0;
<a name="l00276"></a>00276   <span class="keywordflow">if</span> (arrayArg!=NULL &amp;&amp; iNofArgs&gt;=2 &amp;&amp; pSec &amp;&amp; pMusec) {
<a name="l00277"></a>00277     <span class="keywordtype">int</span> iSec=0;
<a name="l00278"></a>00278     <span class="keywordtype">int</span> iMusec=0;
<a name="l00279"></a>00279     <span class="keywordtype">float</span> fVal=0;
<a name="l00280"></a>00280     <span class="keywordflow">if</span> (sscanf(arrayArg[0], <span class="stringliteral">" %f"</span>, &amp;fVal)==1) {
<a name="l00281"></a>00281       <span class="keywordflow">if</span> (*arrayArg[1]==<span class="charliteral">'s'</span> || *arrayArg[1]==<span class="charliteral">'S'</span>) {
<a name="l00282"></a>00282     iSec=fVal;
<a name="l00283"></a>00283     iMusec=(fVal-iSec)*1000000;
<a name="l00284"></a>00284       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*arrayArg[1]==<span class="charliteral">'u'</span> || *arrayArg[1]==<span class="charliteral">'U'</span>) {
<a name="l00285"></a>00285     iSec=0;
<a name="l00286"></a>00286     iMusec=fVal;
<a name="l00287"></a>00287       } <span class="keywordflow">else</span> {
<a name="l00288"></a>00288     fprintf(stderr, <span class="stringliteral">"invalid time unit (%s)\n"</span>, arrayArg[1]);
<a name="l00289"></a>00289     iResult=-EINVAL;
<a name="l00290"></a>00290       }
<a name="l00291"></a>00291       <span class="keywordflow">if</span> (iResult&gt;=0) {
<a name="l00292"></a>00292     *pSec=iSec;
<a name="l00293"></a>00293     *pMusec=iMusec;
<a name="l00294"></a>00294       }
<a name="l00295"></a>00295     } <span class="keywordflow">else</span> {
<a name="l00296"></a>00296       iResult=-EINVAL;
<a name="l00297"></a>00297     }
<a name="l00298"></a>00298   } <span class="keywordflow">else</span> {
<a name="l00299"></a>00299     iResult=-EINVAL;
<a name="l00300"></a>00300   }
<a name="l00301"></a>00301   <span class="keywordflow">return</span> iResult;
<a name="l00302"></a>00302 }
<a name="l00303"></a>00303 
<a name="l00304"></a><a class="code" href="cmdInterpreter_8c.html#a78c9a935a342b0b7b9a3c9896c5e85b">00304</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#a78c9a935a342b0b7b9a3c9896c5e85b">waitCondition</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg, <span class="keywordtype">int</span> iNofArgs)
<a name="l00305"></a>00305 {
<a name="l00306"></a>00306   <span class="keywordtype">int</span> iResult=0;
<a name="l00307"></a>00307   <span class="keywordflow">if</span> (iNofArgs&gt;=4 &amp;&amp; arrayArg) {
<a name="l00308"></a>00308     <span class="keywordtype">int</span> i=0;
<a name="l00309"></a>00309     <a class="code" href="structTCondition.html">TCondition</a>* arrayCond=NULL;
<a name="l00310"></a>00310     <span class="keywordtype">int</span> iInitialArraySize=0;
<a name="l00311"></a>00311     <span class="keywordtype">int</span> iNofConditions=0;
<a name="l00312"></a>00312     <span class="keyword">static</span> <span class="keywordtype">int</span> iDefaultTimeOut=500000;
<a name="l00313"></a>00313     <span class="keywordtype">int</span> iTimeoutMusec=iDefaultTimeOut;
<a name="l00314"></a>00314     <span class="keywordtype">int</span> iTimeoutSec=0;
<a name="l00315"></a>00315     <span class="keywordtype">int</span> iSec=0, iMusec=0;
<a name="l00316"></a>00316     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> address=0;
<a name="l00317"></a>00317     <span class="comment">// the first argument is supposed to be the address to check</span>
<a name="l00318"></a>00318     <span class="keywordflow">if</span> ((iResult=<a class="code" href="mrshellprim_8c.html#0244dae55f177bb00bfae3a0a39f6f5a">getHexNumberFromArg</a>(arrayArg[i], &amp;address, 1))&gt;=0) {
<a name="l00319"></a>00319       <a class="code" href="group__dcsc__msg__buffer__access.html#g0adb3aacb8d7ad32ceabe66a9dcbb401">startSimulation</a>();
<a name="l00320"></a>00320       i++;
<a name="l00321"></a>00321       <span class="keywordflow">for</span> (; i&lt;iNofArgs &amp;&amp; iResult&gt;=0; i++) {
<a name="l00322"></a>00322     <span class="keyword">const</span> <span class="keywordtype">char</span>* pArgSwitch=arrayArg[i];
<a name="l00323"></a>00323     <span class="keywordflow">while</span> (pArgSwitch!=NULL &amp;&amp; *pArgSwitch!=0 &amp;&amp; iResult&gt;=0) {
<a name="l00324"></a>00324       <span class="keywordtype">int</span> iType=<a class="code" href="cmdInterpreter_8c.html#ab5835ceff4b64ce6db4148256e0a0f0cb161923a23a717c2d959051d073d65c">e_continue</a>;
<a name="l00325"></a>00325       <span class="keywordflow">switch</span> (*pArgSwitch) {
<a name="l00326"></a>00326       <span class="keywordflow">case</span> <span class="charliteral">'f'</span>:
<a name="l00327"></a>00327         iType=<a class="code" href="cmdInterpreter_8c.html#ab5835ceff4b64ce6db4148256e0a0f067fd08219d48244557a06e13926853ee">e_fail</a>;
<a name="l00328"></a>00328         <span class="comment">//fall through is intended</span>
<a name="l00329"></a>00329       <span class="keywordflow">case</span> <span class="charliteral">'c'</span>:
<a name="l00330"></a>00330         <span class="comment">// read the wait condition, format: f,c 0xbitMask 0xpattern</span>
<a name="l00331"></a>00331         <span class="comment">// fails or continues if the bitMask matches the pattern</span>
<a name="l00332"></a>00332         <span class="keywordflow">if</span> (iNofArgs-i&gt;2) {
<a name="l00333"></a>00333           <span class="keywordflow">if</span> (iNofConditions&gt;=iInitialArraySize) {
<a name="l00334"></a>00334         iInitialArraySize+=5;
<a name="l00335"></a>00335         <a class="code" href="structTCondition.html">TCondition</a>* arrayNew=(<a class="code" href="structTCondition.html">TCondition</a>*)malloc(iInitialArraySize*<span class="keyword">sizeof</span>(<a class="code" href="structTCondition.html">TCondition</a>));
<a name="l00336"></a>00336         <span class="keywordflow">if</span> (arrayNew) {
<a name="l00337"></a>00337           memset(arrayNew, 0, iInitialArraySize*<span class="keyword">sizeof</span>(TCondition));
<a name="l00338"></a>00338           <span class="keywordflow">if</span> (arrayCond) {
<a name="l00339"></a>00339             memcpy(arrayNew, arrayCond, iNofConditions*<span class="keyword">sizeof</span>(TCondition));
<a name="l00340"></a>00340             free(arrayCond);
<a name="l00341"></a>00341           }
<a name="l00342"></a>00342           arrayCond=arrayNew;
<a name="l00343"></a>00343         } <span class="keywordflow">else</span> {
<a name="l00344"></a>00344           iResult=-ENOMEM;
<a name="l00345"></a>00345           fprintf(stderr, <span class="stringliteral">"waitCondition: memory allocation failed\n"</span>);
<a name="l00346"></a>00346         }
<a name="l00347"></a>00347           }
<a name="l00348"></a>00348           <span class="keywordflow">if</span> (iResult&gt;=0 &amp;&amp; arrayCond) {
<a name="l00349"></a>00349         <span class="keywordflow">if</span> ((iResult=<a class="code" href="mrshellprim_8c.html#0244dae55f177bb00bfae3a0a39f6f5a">getHexNumberFromArg</a>(arrayArg[i+1], &amp;(arrayCond[iNofConditions].bitMask), 1))&gt;=0) {
<a name="l00350"></a>00350           <span class="keywordflow">if</span> ((iResult=<a class="code" href="mrshellprim_8c.html#0244dae55f177bb00bfae3a0a39f6f5a">getHexNumberFromArg</a>(arrayArg[i+2], &amp;(arrayCond[iNofConditions].pattern), 1))&gt;=0) {
<a name="l00351"></a>00351             arrayCond[iNofConditions].<a class="code" href="structTCondition.html#a0f092121f681df301d31ca256804d7b">type</a>=iType;
<a name="l00352"></a>00352             <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;<a class="code" href="group__dcsc__msg__buffer__access.html#g7eaf88fd984d7f7c8c760dce4cb355d1">DBG_CHECK_COMMAND</a>) {
<a name="l00353"></a>00353               fprintf(stderr, <span class="stringliteral">"condition added: type=%d mask=%#x pattern=%#x\n"</span>, arrayCond[iNofConditions].type, arrayCond[iNofConditions].bitMask, arrayCond[iNofConditions].pattern); 
<a name="l00354"></a>00354             }
<a name="l00355"></a>00355             iNofConditions++;
<a name="l00356"></a>00356             i+=2; <span class="comment">// skip 2 arguments since they already has been read</span>
<a name="l00357"></a>00357           }
<a name="l00358"></a>00358         }
<a name="l00359"></a>00359           }
<a name="l00360"></a>00360         } <span class="keywordflow">else</span> {
<a name="l00361"></a>00361           fprintf(stderr, <span class="stringliteral">"waitCondition: missing parameter for condition\n"</span>);
<a name="l00362"></a>00362           iResult=-EINVAL;
<a name="l00363"></a>00363         }
<a name="l00364"></a>00364         pArgSwitch=NULL;
<a name="l00365"></a>00365         <span class="keywordflow">break</span>;
<a name="l00366"></a>00366       <span class="keywordflow">case</span> <span class="charliteral">'t'</span>:
<a name="l00367"></a>00367         <span class="comment">// read the timeout parameter</span>
<a name="l00368"></a>00368         <span class="keywordflow">if</span> (iNofArgs-i&gt;2) {
<a name="l00369"></a>00369           <span class="keywordflow">if</span> ((iResult=<a class="code" href="cmdInterpreter_8c.html#6ead18c93a106e1f1ba5871e908d9916">readTime</a>(arrayArg+i+1, 2, &amp;iTimeoutSec, &amp;iTimeoutMusec))&gt;=0) {
<a name="l00370"></a>00370         <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;<a class="code" href="group__dcsc__msg__buffer__access.html#g7eaf88fd984d7f7c8c760dce4cb355d1">DBG_CHECK_COMMAND</a>) {
<a name="l00371"></a>00371           fprintf(stderr, <span class="stringliteral">"set time out: %d sec %d usec\n"</span>, iTimeoutSec, iTimeoutMusec);
<a name="l00372"></a>00372         }
<a name="l00373"></a>00373         i+=2; <span class="comment">// skip one argument since this has already been read</span>
<a name="l00374"></a>00374           } <span class="keywordflow">else</span> {
<a name="l00375"></a>00375         iTimeoutMusec=iDefaultTimeOut;
<a name="l00376"></a>00376         iTimeoutSec=0;
<a name="l00377"></a>00377         fprintf(stderr, <span class="stringliteral">"waitCondition: wrong format for timeout\n"</span>);
<a name="l00378"></a>00378         iResult=-EINVAL;
<a name="l00379"></a>00379           }
<a name="l00380"></a>00380         } <span class="keywordflow">else</span> {
<a name="l00381"></a>00381           fprintf(stderr, <span class="stringliteral">"waitCondition: missing value for timeout\n"</span>);
<a name="l00382"></a>00382           iResult=-EINVAL;
<a name="l00383"></a>00383         }
<a name="l00384"></a>00384         pArgSwitch=NULL;
<a name="l00385"></a>00385         <span class="keywordflow">break</span>;
<a name="l00386"></a>00386       <span class="keywordflow">case</span> <span class="charliteral">'-'</span>:
<a name="l00387"></a>00387         <span class="comment">// test the next letter during the next cycle (increment below!), so both 'c' and '-c' are accepted</span>
<a name="l00388"></a>00388         <span class="keywordflow">break</span>;
<a name="l00389"></a>00389       <span class="keywordflow">default</span>:
<a name="l00390"></a>00390         <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;<a class="code" href="mrshellprim_8h.html#13095cc00efe5276cf7a1794f0f8b7e5">DBG_ARGUMENT_CONVERT</a>) {
<a name="l00391"></a>00391           fprintf(stderr, <span class="stringliteral">"waitCondition: wrong argument %s (%d)\n"</span>, arrayArg[i], i);
<a name="l00392"></a>00392         }
<a name="l00393"></a>00393         iResult=-EINVAL;
<a name="l00394"></a>00394         pArgSwitch=NULL;
<a name="l00395"></a>00395       }
<a name="l00396"></a>00396       <span class="keywordflow">if</span> (pArgSwitch) {
<a name="l00397"></a>00397         pArgSwitch++;
<a name="l00398"></a>00398       }
<a name="l00399"></a>00399     }
<a name="l00400"></a>00400       }
<a name="l00401"></a>00401 
<a name="l00402"></a>00402       <span class="comment">// check cycle</span>
<a name="l00403"></a>00403       <span class="keywordflow">if</span> (iNofConditions&gt;0) {
<a name="l00404"></a>00404     <span class="keywordtype">int</span> iCount=1;
<a name="l00405"></a>00405     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> data=0;
<a name="l00406"></a>00406     <span class="keywordtype">int</span> iTimer=<a class="code" href="mrtimers_8c.html#ccfd598b6f1a3ca5599e8bc3588d1cf7">startTimer</a>(0);
<a name="l00407"></a>00407     <span class="keywordflow">if</span> (iTimer&lt;=0) {
<a name="l00408"></a>00408       fprintf(stderr, <span class="stringliteral">"waitCondition: can not open timer\n"</span>);
<a name="l00409"></a>00409     }
<a name="l00410"></a>00410     <span class="keywordflow">while</span> (iResult==0) {
<a name="l00411"></a>00411       <span class="keywordflow">if</span> ((iResult=<a class="code" href="group__dcsc__msg__buffer__access.html#g339b5922513d0f0211d7962234faa24f">rcuSingleRead</a>(address, &amp;data))&gt;=0) {
<a name="l00412"></a>00412         iResult=0;
<a name="l00413"></a>00413         <span class="keywordflow">for</span> (i=0; i&lt;iNofConditions &amp;&amp; iResult==0; i++) {
<a name="l00414"></a>00414           <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;<a class="code" href="group__dcsc__msg__buffer__access.html#g7eaf88fd984d7f7c8c760dce4cb355d1">DBG_CHECK_COMMAND</a>)
<a name="l00415"></a>00415         fprintf(stderr, <span class="stringliteral">"checking condition #%d: type=%d, mask=%#x pattern=%#x "</span>, i, arrayCond[i].type, arrayCond[i].bitMask, arrayCond[i].pattern);
<a name="l00416"></a>00416           <span class="keywordflow">if</span> ((data&amp;arrayCond[i].bitMask)==arrayCond[i].pattern) {
<a name="l00417"></a>00417         <span class="keywordflow">if</span> (arrayCond[i].type==<a class="code" href="cmdInterpreter_8c.html#ab5835ceff4b64ce6db4148256e0a0f067fd08219d48244557a06e13926853ee">e_fail</a>) {
<a name="l00418"></a>00418           <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;DBG_CHECK_COMMAND) {
<a name="l00419"></a>00419             fprintf(stderr, <span class="stringliteral">"condition \'fail\' matched"</span>);
<a name="l00420"></a>00420           }
<a name="l00421"></a>00421           iResult=-EIO;
<a name="l00422"></a>00422         }
<a name="l00423"></a>00423         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arrayCond[i].type==<a class="code" href="cmdInterpreter_8c.html#ab5835ceff4b64ce6db4148256e0a0f0cb161923a23a717c2d959051d073d65c">e_continue</a>) {
<a name="l00424"></a>00424           <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;DBG_CHECK_COMMAND) {
<a name="l00425"></a>00425             fprintf(stderr, <span class="stringliteral">"condition \'continue\' matched"</span>);
<a name="l00426"></a>00426           }
<a name="l00427"></a>00427           iResult=1;
<a name="l00428"></a>00428         }
<a name="l00429"></a>00429         <span class="keywordflow">else</span> {
<a name="l00430"></a>00430           fprintf(stderr, <span class="stringliteral">"waitCondition internal error: invalid condition type"</span>);
<a name="l00431"></a>00431           iResult=-EBADMSG;
<a name="l00432"></a>00432         }
<a name="l00433"></a>00433           } <span class="keywordflow">else</span> {
<a name="l00434"></a>00434         iResult=0; <span class="comment">// keep the loop going</span>
<a name="l00435"></a>00435           }
<a name="l00436"></a>00436           <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;DBG_CHECK_COMMAND)
<a name="l00437"></a>00437         fprintf(stderr, <span class="stringliteral">"\n"</span>);
<a name="l00438"></a>00438         }
<a name="l00439"></a>00439       }
<a name="l00440"></a>00440       <span class="comment">// timeout condition, later a clock should be implemented</span>
<a name="l00441"></a>00441       <span class="keywordflow">if</span> (iResult==0) {
<a name="l00442"></a>00442         <span class="keywordflow">if</span> (iTimer) {
<a name="l00443"></a>00443           iResult=<a class="code" href="mrtimers_8c.html#60a100d9612c31984637866c7e975958">getTimerValue</a>(iTimer, &amp;iSec, &amp;iMusec);
<a name="l00444"></a>00444           <span class="keywordflow">if</span> (iResult&gt;0) iResult=0; <span class="comment">// getTimerValue returns time in seconds, discard</span>
<a name="l00445"></a>00445           <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;<a class="code" href="group__dcsc__msg__buffer__access.html#g7eaf88fd984d7f7c8c760dce4cb355d1">DBG_CHECK_COMMAND</a>) {
<a name="l00446"></a>00446         fprintf(stderr, <span class="stringliteral">"checking timer: curr sec %d, curr usec %d\n"</span>, iSec, iMusec);
<a name="l00447"></a>00447           }
<a name="l00448"></a>00448           <span class="keywordflow">if</span> (iResult&gt;=0 &amp;&amp; iSec&gt;=iTimeoutSec &amp;&amp; iMusec&gt;=iTimeoutMusec) {
<a name="l00449"></a>00449         iResult=-ETIMEDOUT;
<a name="l00450"></a>00450           }
<a name="l00451"></a>00451         } <span class="keywordflow">else</span> {
<a name="l00452"></a>00452           <span class="keywordflow">if</span> (++iCount&gt;=iTimeoutMusec &amp;&amp; iTimeoutMusec&gt;0) {
<a name="l00453"></a>00453         iResult=-ETIMEDOUT;
<a name="l00454"></a>00454           }
<a name="l00455"></a>00455         }
<a name="l00456"></a>00456         <span class="keywordflow">if</span> (iResult==-ETIMEDOUT &amp;&amp; <a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;<a class="code" href="group__dcsc__msg__buffer__access.html#g7eaf88fd984d7f7c8c760dce4cb355d1">DBG_CHECK_COMMAND</a>)
<a name="l00457"></a>00457           fprintf(stderr, <span class="stringliteral">"time out \n"</span>);
<a name="l00458"></a>00458       } <span class="keywordflow">else</span> {
<a name="l00459"></a>00459         <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;<a class="code" href="group__dcsc__msg__buffer__access.html#g7eaf88fd984d7f7c8c760dce4cb355d1">DBG_CHECK_COMMAND</a>)
<a name="l00460"></a>00460           fprintf(stderr, <span class="stringliteral">"terminate at iResult=%d\n"</span>, iResult);
<a name="l00461"></a>00461       }
<a name="l00462"></a>00462     }
<a name="l00463"></a>00463     <span class="keywordflow">if</span> (iTimer&gt;=0) <a class="code" href="mrtimers_8c.html#fa991349587b8e300e5363a21dcee3b7">stopTimer</a>(iTimer);
<a name="l00464"></a>00464       } <span class="keywordflow">else</span> {
<a name="l00465"></a>00465     fprintf(stderr, <span class="stringliteral">"could not find any condition to check, aborting\n"</span>);
<a name="l00466"></a>00466       }
<a name="l00467"></a>00467       <span class="keywordflow">if</span> (arrayCond) {
<a name="l00468"></a>00468     free(arrayCond);
<a name="l00469"></a>00469       }
<a name="l00470"></a>00470       <a class="code" href="group__dcsc__msg__buffer__access.html#gd871881385919aff64a8b679984cd018">stopSimulation</a>();
<a name="l00471"></a>00471     } <span class="keywordflow">else</span> {
<a name="l00472"></a>00472       fprintf(stderr, <span class="stringliteral">"waitCondition: invalid argument %p %d\n"</span>, arrayArg, iNofArgs);
<a name="l00473"></a>00473       iResult=-EINVAL;
<a name="l00474"></a>00474     }
<a name="l00475"></a>00475   } <span class="keywordflow">else</span> {
<a name="l00476"></a>00476     iResult=-EINVAL;
<a name="l00477"></a>00477   }
<a name="l00478"></a>00478   <span class="keywordflow">return</span> iResult;
<a name="l00479"></a>00479 }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481 <span class="comment">/* translate a command array and read data from file into a buffer, the buffer must be released by the caller</span>
<a name="l00482"></a>00482 <span class="comment">parameter:</span>
<a name="l00483"></a>00483 <span class="comment">  arrayArg - array of char pointers interpreted as command parameters</span>
<a name="l00484"></a>00484 <span class="comment">  nofArgs - size of the array</span>
<a name="l00485"></a>00485 <span class="comment">  ppBuffer - target to receive the data pointer</span>
<a name="l00486"></a>00486 <span class="comment">result:</span>
<a name="l00487"></a>00487 <span class="comment">  # 32 bit words in the data buffer if succeeded, data pointer in ppBuffer </span>
<a name="l00488"></a>00488 <span class="comment">  &lt;0 if failed</span>
<a name="l00489"></a>00489 <span class="comment">*/</span>
<a name="l00490"></a><a class="code" href="cmdInterpreter_8c.html#f0155066c64e72c64ab000444db4fcad">00490</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#f0155066c64e72c64ab000444db4fcad">buildDataBufferFromFile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg, <span class="keywordtype">int</span> nofArgs, __u32** ppBuffer, <span class="keywordtype">int</span>* pDataFormat, <span class="keywordtype">int</span> iMode)
<a name="l00491"></a>00491 {
<a name="l00492"></a>00492   <span class="keywordtype">int</span> iResult=0;
<a name="l00493"></a>00493   <span class="keywordflow">if</span> (arrayArg!=NULL &amp;&amp; nofArgs&gt;=1 &amp;&amp; ppBuffer!=NULL &amp;&amp; pDataFormat!=NULL) {
<a name="l00494"></a>00494     *ppBuffer=NULL;
<a name="l00495"></a>00495     <span class="keywordtype">int</span> iArg=0;
<a name="l00496"></a>00496     <span class="keywordtype">int</span> iDataFormat=4;
<a name="l00497"></a>00497     <span class="keywordtype">int</span> iNofWords=0;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     <span class="comment">// the default data format</span>
<a name="l00500"></a>00500     <span class="keywordflow">if</span> (iMode==2 || iMode==3) iDataFormat=2; <span class="comment">// flash default 16 bit</span>
<a name="l00501"></a>00501     <span class="keywordflow">else</span> iDataFormat=4; <span class="comment">// msgbuffer default default, 32 bit</span>
<a name="l00502"></a>00502 
<a name="l00503"></a>00503     <span class="comment">// search for modifiers</span>
<a name="l00504"></a>00504     <span class="keywordflow">if</span> (*(arrayArg[iArg])==<span class="charliteral">'-'</span>) {
<a name="l00505"></a>00505       <span class="comment">// interprete the file modifier</span>
<a name="l00506"></a>00506       <span class="keywordflow">if</span> (strcmp(arrayArg[iArg], <span class="stringliteral">"-c"</span>)==0) <span class="comment">// char </span>
<a name="l00507"></a>00507     iDataFormat=0;
<a name="l00508"></a>00508       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(arrayArg[iArg], <span class="stringliteral">"-b10"</span>)==0) <span class="comment">// 10 bit compressed</span>
<a name="l00509"></a>00509     iDataFormat=3;
<a name="l00510"></a>00510       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(arrayArg[iArg], <span class="stringliteral">"-b1"</span>)==0) <span class="comment">// 8 bit</span>
<a name="l00511"></a>00511     iDataFormat=1;
<a name="l00512"></a>00512       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(arrayArg[iArg], <span class="stringliteral">"-b2"</span>)==0) <span class="comment">// 16 bit</span>
<a name="l00513"></a>00513     iDataFormat=2;
<a name="l00514"></a>00514       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(arrayArg[iArg], <span class="stringliteral">"-b4"</span>)==0) <span class="comment">// 32 bit</span>
<a name="l00515"></a>00515     iDataFormat=4;
<a name="l00516"></a>00516       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(arrayArg[iArg], <span class="stringliteral">"-b"</span>)==0) {<span class="comment">// binary </span>
<a name="l00517"></a>00517     <span class="keywordflow">if</span> (iMode==2 || iMode==3)
<a name="l00518"></a>00518       iDataFormat=2; <span class="comment">// flash default 16 bit</span>
<a name="l00519"></a>00519     <span class="keywordflow">else</span>
<a name="l00520"></a>00520       iDataFormat=4; <span class="comment">// msgbuffer default default, 32 bit</span>
<a name="l00521"></a>00521       }
<a name="l00522"></a>00522       <span class="keywordflow">else</span> {
<a name="l00523"></a>00523     fprintf(stderr, <span class="stringliteral">"invalid file modifier %s\n"</span>, arrayArg[iArg]);
<a name="l00524"></a>00524     iResult=-EINVAL;
<a name="l00525"></a>00525       }
<a name="l00526"></a>00526       <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;<a class="code" href="group__dcsc__msg__buffer__access.html#g6fe994d64da543fe875682bb79b5d585">DBG_FILE_CONVERT</a>)
<a name="l00527"></a>00527     fprintf(stderr, <span class="stringliteral">"got file modifier: data format %d\n"</span>, iDataFormat);
<a name="l00528"></a>00528       iArg++;
<a name="l00529"></a>00529     }
<a name="l00530"></a>00530     <span class="keywordflow">if</span> (iResult&gt;=0 &amp;&amp; nofArgs&gt;iArg) {
<a name="l00531"></a>00531       <span class="comment">// search for the file name, try to open a file and read the data into a buffer</span>
<a name="l00532"></a>00532       <span class="keywordtype">int</span> file=open(arrayArg[iArg], O_RDONLY);
<a name="l00533"></a>00533       <span class="keywordflow">if</span> (file&gt;0) {
<a name="l00534"></a>00534     <span class="keywordtype">int</span> iFileSize=0;
<a name="l00535"></a>00535     <span class="keywordtype">int</span> iBufferSize=0;
<a name="l00536"></a>00536     __u32* pData=NULL;
<a name="l00537"></a>00537     <span class="keywordtype">char</span>* pASCIIBuffer=NULL;
<a name="l00538"></a>00538     <span class="keywordflow">if</span> ((iFileSize=lseek(file, 0, SEEK_END))&gt;=0) {
<a name="l00539"></a>00539       <span class="comment">//printf("file size %d\n", iFileSize);</span>
<a name="l00540"></a>00540       <span class="keywordtype">int</span> iFileBufferSize=iFileSize+1; <span class="comment">// the buffer must be at least one char bigger to ensure 0 termination</span>
<a name="l00541"></a>00541       pASCIIBuffer=(<span class="keywordtype">char</span>*)malloc(iFileBufferSize);
<a name="l00542"></a>00542       <span class="keywordflow">if</span> (pASCIIBuffer) {
<a name="l00543"></a>00543         memset(pASCIIBuffer, 0, iFileBufferSize);
<a name="l00544"></a>00544         <span class="keywordflow">if</span> (lseek(file, 0, SEEK_SET)==0) {
<a name="l00545"></a>00545           <span class="keywordflow">if</span> (read(file, pASCIIBuffer, iFileSize)==iFileSize) {
<a name="l00546"></a>00546         <span class="keywordflow">if</span> (iDataFormat==0) {
<a name="l00547"></a>00547           <span class="comment">// this is an ascii file</span>
<a name="l00548"></a>00548           <span class="keywordflow">if</span> ((pData=<a class="code" href="cmdInterpreter_8c.html#46956baca790c8f97d618114d456b1fe">ConvertASCII2Bin</a>(pASCIIBuffer, &amp;iBufferSize, 4))!=NULL) {
<a name="l00549"></a>00549             free(pASCIIBuffer);
<a name="l00550"></a>00550             pASCIIBuffer=NULL;
<a name="l00551"></a>00551             iDataFormat=4;
<a name="l00552"></a>00552             iNofWords=iBufferSize/iDataFormat;
<a name="l00553"></a>00553             <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;<a class="code" href="group__dcsc__msg__buffer__access.html#g6fe994d64da543fe875682bb79b5d585">DBG_FILE_CONVERT</a>)
<a name="l00554"></a>00554               printf(<span class="stringliteral">"buffer with %d byte char data converted to %d words of size %d\n"</span>, iFileSize, iNofWords, iDataFormat);
<a name="l00555"></a>00555           } <span class="keywordflow">else</span> {
<a name="l00556"></a>00556             <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;<a class="code" href="group__dcsc__msg__buffer__access.html#g6fe994d64da543fe875682bb79b5d585">DBG_FILE_CONVERT</a>)
<a name="l00557"></a>00557               printf(<span class="stringliteral">"conversion of char buffer failed\n"</span>);
<a name="l00558"></a>00558             iNofWords=0;
<a name="l00559"></a>00559           }
<a name="l00560"></a>00560         } <span class="keywordflow">else</span> {
<a name="l00561"></a>00561           <span class="comment">// this is a binary file</span>
<a name="l00562"></a>00562           pData=(__u32*)pASCIIBuffer;
<a name="l00563"></a>00563           iBufferSize=iFileSize;
<a name="l00564"></a>00564           <span class="keywordflow">if</span> (iDataFormat==3) {
<a name="l00565"></a>00565             iNofWords=(iFileSize/4)*3 + (iFileSize%4)*8/10;
<a name="l00566"></a>00566           } <span class="keywordflow">else</span> {
<a name="l00567"></a>00567             iNofWords=iFileSize/iDataFormat;
<a name="l00568"></a>00568           }
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570         <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;<a class="code" href="group__dcsc__msg__buffer__access.html#g6fe994d64da543fe875682bb79b5d585">DBG_FILE_CONVERT</a>) {
<a name="l00571"></a>00571           printf(<span class="stringliteral">"%d word(s) of size %d read from file %s\n"</span>, iNofWords, iDataFormat, arrayArg[iArg]);
<a name="l00572"></a>00572         }
<a name="l00573"></a>00573         <span class="keywordflow">if</span> (iArg+1&lt;nofArgs) {
<a name="l00574"></a>00574           <span class="keywordtype">int</span> iMaxWords=0;
<a name="l00575"></a>00575           <span class="comment">//fprintf(stderr, "scanning count\n");</span>
<a name="l00576"></a>00576           <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#fe29afcd7e0ed24611394b379523e597">getDecNumberFromArg</a>(arrayArg[iArg+1], &amp;iMaxWords, 0)&gt;=0) {
<a name="l00577"></a>00577             <span class="keywordflow">if</span> (iMaxWords&lt;iNofWords) {
<a name="l00578"></a>00578               iNofWords=iMaxWords;
<a name="l00579"></a>00579               <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;<a class="code" href="group__dcsc__msg__buffer__access.html#g6fe994d64da543fe875682bb79b5d585">DBG_FILE_CONVERT</a>) {
<a name="l00580"></a>00580             printf(<span class="stringliteral">"%d word(s) designated for writing\n"</span>, iNofWords);
<a name="l00581"></a>00581               }
<a name="l00582"></a>00582             }
<a name="l00583"></a>00583           } <span class="keywordflow">else</span> {
<a name="l00584"></a>00584             printf(<span class="stringliteral">"enter a decimal number after the file name! parameter %s ignored\n"</span>, arrayArg[iArg+1]);
<a name="l00585"></a>00585           }
<a name="l00586"></a>00586         }
<a name="l00587"></a>00587         <span class="keywordflow">if</span> (iNofWords&gt;0) {
<a name="l00588"></a>00588           iResult=iNofWords;
<a name="l00589"></a>00589           *ppBuffer=pData;
<a name="l00590"></a>00590           *pDataFormat=iDataFormat;
<a name="l00591"></a>00591         } <span class="keywordflow">else</span> {
<a name="l00592"></a>00592           free(pData);
<a name="l00593"></a>00593           pData=NULL;
<a name="l00594"></a>00594         }
<a name="l00595"></a>00595           } <span class="keywordflow">else</span> {
<a name="l00596"></a>00596         printf(<span class="stringliteral">"error reading data from file %s\n"</span>, arrayArg[iArg]);
<a name="l00597"></a>00597           }
<a name="l00598"></a>00598         } <span class="keywordflow">else</span> {
<a name="l00599"></a>00599           printf(<span class="stringliteral">"error seeking to beginning of file %s\n"</span>, arrayArg[iArg]);
<a name="l00600"></a>00600         }
<a name="l00601"></a>00601       } <span class="keywordflow">else</span> {
<a name="l00602"></a>00602         printf(<span class="stringliteral">"internal error: memory allocation failed\n"</span>);
<a name="l00603"></a>00603       }
<a name="l00604"></a>00604     } <span class="keywordflow">else</span> {
<a name="l00605"></a>00605       printf(<span class="stringliteral">"can not get size of file %s\n"</span>, arrayArg[iArg]);
<a name="l00606"></a>00606     }
<a name="l00607"></a>00607     close(file); 
<a name="l00608"></a>00608       } <span class="keywordflow">else</span> {
<a name="l00609"></a>00609     iResult=-ENOENT;
<a name="l00610"></a>00610     fprintf(stderr, <span class="stringliteral">"can not open file %s\n"</span>, arrayArg[iArg]);
<a name="l00611"></a>00611       }
<a name="l00612"></a>00612     }
<a name="l00613"></a>00613   } <span class="keywordflow">else</span> {
<a name="l00614"></a>00614     iResult=-EINVAL;
<a name="l00615"></a>00615   }
<a name="l00616"></a>00616   <span class="keywordflow">return</span> iResult;
<a name="l00617"></a>00617 }
<a name="l00618"></a>00618 
<a name="l00632"></a><a class="code" href="cmdInterpreter_8c.html#6f67c6327e24c23440e0fdf83d06e41d">00632</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#6f67c6327e24c23440e0fdf83d06e41d">execWriteCmd</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg, <span class="keywordtype">int</span> iNofArgs, <span class="keywordtype">int</span> iMode)
<a name="l00633"></a>00633 {
<a name="l00634"></a>00634   <span class="keywordtype">int</span> iResult=0;
<a name="l00635"></a>00635   <span class="keywordtype">int</span> iVerbosity=0;
<a name="l00636"></a>00636   <span class="comment">//fprintf(stderr, "write command, %d arguments, mode %d\n", iNofArgs, iMode);</span>
<a name="l00637"></a>00637 
<a name="l00638"></a>00638   <span class="comment">/* the MIB compare mode requires at least the filename and optional specifiers */</span>
<a name="l00639"></a>00639   <span class="comment">/* the MIB write and flash write modes require at least address and data */</span>
<a name="l00640"></a>00640   <span class="keywordflow">if</span> ((iMode==1 &amp;&amp; iNofArgs&gt;=1) || iNofArgs&gt;=2) { 
<a name="l00641"></a>00641     <span class="keywordtype">int</span> iTimer=0;
<a name="l00642"></a>00642     <span class="keywordflow">if</span> (<a class="code" href="cmdInterpreter_8c.html#b1b44b602185677d4a2a372121627437">g_profiling</a>&gt;0) {
<a name="l00643"></a>00643       iTimer=<a class="code" href="mrtimers_8c.html#ccfd598b6f1a3ca5599e8bc3588d1cf7">startTimer</a>(0); <span class="comment">// timer of type ITIMER_REAL</span>
<a name="l00644"></a>00644     }
<a name="l00645"></a>00645     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> address=0;
<a name="l00646"></a>00646     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> data=0;
<a name="l00647"></a>00647     __u32* pDataBuffer=NULL;
<a name="l00648"></a>00648     <span class="keywordtype">int</span> iDataFormat=0;
<a name="l00649"></a>00649     <span class="keywordtype">int</span> iNofWords=0;
<a name="l00650"></a>00650     <span class="keywordtype">int</span> iPos=0;
<a name="l00651"></a>00651   
<a name="l00652"></a>00652     <span class="keywordtype">int</span> iEndianess=1; <span class="comment">// 1 little, -1 big -&gt; bytes get swapped </span>
<a name="l00653"></a>00653     <span class="comment">/* scan for the additional swap option   */</span> 
<a name="l00654"></a>00654     <span class="keywordflow">if</span> (iMode!=1 &amp;&amp; iMode!=3 &amp;&amp; iMode!=8 &amp;&amp;
<a name="l00655"></a>00655     (strcmp(arrayArg[iPos], <span class="stringliteral">"--swap"</span>)==0 || strcmp(arrayArg[iPos], <span class="stringliteral">"-s"</span>)==0)) {
<a name="l00656"></a>00656       iPos++;
<a name="l00657"></a>00657       iEndianess=-1;
<a name="l00658"></a>00658     }
<a name="l00659"></a>00659 
<a name="l00660"></a>00660     <span class="keywordflow">if</span> (iMode==8 &amp;&amp; (iResult=<a class="code" href="mrshellprim_8c.html#fe29afcd7e0ed24611394b379523e597">getDecNumberFromArg</a>(arrayArg[iPos], &amp;address, 0))&gt;=0) {
<a name="l00661"></a>00661       iPos++;
<a name="l00662"></a>00662       <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#0244dae55f177bb00bfae3a0a39f6f5a">getHexNumberFromArg</a>(arrayArg[iPos], &amp;data, 0)&gt;=0) {
<a name="l00663"></a>00663     <span class="comment">// this is a selectmap register write operation</span>
<a name="l00664"></a>00664     <span class="comment">// format: &lt;reg no&gt; 0x&lt;data&gt;</span>
<a name="l00665"></a>00665     iPos++;
<a name="l00666"></a>00666     iNofWords=1;
<a name="l00667"></a>00667     iDataFormat=4;
<a name="l00668"></a>00668     iResult=<a class="code" href="group__selectmap__access.html#ge0d7561e2ddca5878fe0c39c948dfdd2">smRegisterWrite</a>(address, data);
<a name="l00669"></a>00669       }
<a name="l00670"></a>00670     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iMode==1 || (iResult=<a class="code" href="mrshellprim_8c.html#0244dae55f177bb00bfae3a0a39f6f5a">getHexNumberFromArg</a>(arrayArg[iPos++], &amp;address, 0))&gt;=0) {
<a name="l00671"></a>00671     <span class="comment">/* just skip the address scan for the MIB compare mode otherwize the address is always</span>
<a name="l00672"></a>00672 <span class="comment">       the first argument */</span>
<a name="l00673"></a>00673       <span class="comment">//fprintf(stderr, "address %#x\n", address);</span>
<a name="l00674"></a>00674      
<a name="l00675"></a>00675       <span class="keywordflow">if</span> (iMode!=1 &amp;&amp; <a class="code" href="mrshellprim_8c.html#0244dae55f177bb00bfae3a0a39f6f5a">getHexNumberFromArg</a>(arrayArg[iPos], &amp;data, 0)&gt;=0) {
<a name="l00676"></a>00676     <span class="comment">// this is a single write operation</span>
<a name="l00677"></a>00677     <span class="comment">// format: 0x&lt;address&gt; 0x&lt;data&gt;</span>
<a name="l00678"></a>00678     iPos++;
<a name="l00679"></a>00679     iNofWords=1;
<a name="l00680"></a>00680     iDataFormat=4;
<a name="l00681"></a>00681     <span class="comment">// only the rcu write has a dedicated function for one-word writing</span>
<a name="l00682"></a>00682     <span class="comment">// the branch where to get depends on the pDataBuffer variable</span>
<a name="l00683"></a>00683     <span class="comment">// set this to the data variable</span>
<a name="l00684"></a>00684     <span class="keywordflow">if</span> (iMode==3 || iMode==2) pDataBuffer=&amp;data; 
<a name="l00685"></a>00685       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iMode!=1 &amp;&amp; <a class="code" href="mrshellprim_8c.html#fe29afcd7e0ed24611394b379523e597">getDecNumberFromArg</a>(arrayArg[iPos], &amp;iNofWords, 0)&gt;=0) {
<a name="l00686"></a>00686     iPos++;
<a name="l00687"></a>00687     <span class="keywordflow">if</span> (iNofWords==0) {
<a name="l00688"></a>00688       <span class="comment">// this is a single write of data 0x0 abbreviated with 0</span>
<a name="l00689"></a>00689       <span class="comment">// format: 0x&lt;address&gt; 0</span>
<a name="l00690"></a>00690       data=0;
<a name="l00691"></a>00691       iNofWords=1;
<a name="l00692"></a>00692     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iNofWords&gt;0) {
<a name="l00693"></a>00693       <span class="comment">// multiple write operation, one date word to several addresses</span>
<a name="l00694"></a>00694       <span class="comment">// get the data word and fill a buffer</span>
<a name="l00695"></a>00695       <span class="comment">// format: 0x&lt;address&gt; n 0x&lt;data&gt;</span>
<a name="l00696"></a>00696       <span class="keywordflow">if</span> (iNofArgs&gt;iPos &amp;&amp; <a class="code" href="mrshellprim_8c.html#0244dae55f177bb00bfae3a0a39f6f5a">getHexNumberFromArg</a>(arrayArg[iPos], &amp;data, 0)&gt;=0) {
<a name="l00697"></a>00697         <span class="keywordtype">int</span> iBufferSize=iNofWords*<span class="keyword">sizeof</span>(__u32);
<a name="l00698"></a>00698         pDataBuffer=(__u32*)malloc(iBufferSize);
<a name="l00699"></a>00699         <span class="keywordflow">if</span> (pDataBuffer) {
<a name="l00700"></a>00700           __u32* pTemp=pDataBuffer;
<a name="l00701"></a>00701           <span class="keywordflow">while</span> (pTemp&lt;pDataBuffer+iNofWords) {
<a name="l00702"></a>00702         *pTemp=data;
<a name="l00703"></a>00703         pTemp++;
<a name="l00704"></a>00704           }
<a name="l00705"></a>00705           iDataFormat=4;
<a name="l00706"></a>00706         } <span class="keywordflow">else</span> {
<a name="l00707"></a>00707           iResult=-ENOMEM;
<a name="l00708"></a>00708           printf(<span class="stringliteral">"internal error: memory allocation failed\n"</span>);
<a name="l00709"></a>00709         }
<a name="l00710"></a>00710       } <span class="keywordflow">else</span> {
<a name="l00711"></a>00711         iResult=-EINVAL;
<a name="l00712"></a>00712       }
<a name="l00713"></a>00713     }
<a name="l00714"></a>00714       } <span class="keywordflow">else</span> {
<a name="l00715"></a>00715     <span class="comment">// writing data from file</span>
<a name="l00716"></a>00716     <span class="comment">// format: 0x&lt;address&gt; [filespecifier] &lt;filename&gt; [n]</span>
<a name="l00717"></a>00717     iResult=<a class="code" href="cmdInterpreter_8c.html#f0155066c64e72c64ab000444db4fcad">buildDataBufferFromFile</a>(arrayArg+iPos, iMode==1?1:iNofArgs-iPos, &amp;pDataBuffer, &amp;iDataFormat, iMode);
<a name="l00718"></a>00718     <span class="keywordflow">if</span> (iResult&gt;0) {
<a name="l00719"></a>00719       iNofWords=iResult;
<a name="l00720"></a>00720       <span class="keywordflow">if</span> (iMode==1 &amp;&amp; iNofArgs-iPos&gt;2) {
<a name="l00721"></a>00721         <span class="keywordflow">if</span> (strcmp(arrayArg[iPos+1], <span class="stringliteral">"-v"</span>)==0) {
<a name="l00722"></a>00722           <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#fe29afcd7e0ed24611394b379523e597">getDecNumberFromArg</a>(arrayArg[iPos+2], &amp;iVerbosity, 0)&lt;0)
<a name="l00723"></a>00723         iVerbosity=0;
<a name="l00724"></a>00724         }
<a name="l00725"></a>00725       }
<a name="l00726"></a>00726     }
<a name="l00727"></a>00727       }
<a name="l00728"></a>00728 
<a name="l00729"></a>00729       <span class="comment">// data buffers which have to be swapped are indicated with a negative value</span>
<a name="l00730"></a>00730       <span class="comment">// quick hack, integrate this to the write functions of the dcscMsgBufferInterface later</span>
<a name="l00731"></a>00731 
<a name="l00732"></a>00732 <span class="comment">/*       if (iEndianess&lt;0) { */</span>
<a name="l00733"></a>00733 <span class="comment">/*  if (pDataBuffer) { */</span>
<a name="l00734"></a>00734 <span class="comment">/*    //fprintf(stderr, "swapping ...\n"); */</span>
<a name="l00735"></a>00735 <span class="comment">/*    int iBufferSize=iNofWords*iDataFormat; */</span>
<a name="l00736"></a>00736 <span class="comment">/*    char* pTarget=(char*)malloc(iBufferSize); */</span>
<a name="l00737"></a>00737 <span class="comment">/*    if (pTarget) { */</span>
<a name="l00738"></a>00738 <span class="comment">/*      if (iDataFormat&gt;1) { */</span>
<a name="l00739"></a>00739 <span class="comment">/*        // swap the 8 bit words */</span>
<a name="l00740"></a>00740 <span class="comment">/*        swab(pDataBuffer, pTarget, iBufferSize); */</span>
<a name="l00741"></a>00741 <span class="comment">/*        if (iDataFormat&gt;2) { */</span>
<a name="l00742"></a>00742 <span class="comment">/*      // additional swap of the 16 bit words */</span>
<a name="l00743"></a>00743 <span class="comment">/*      __u16 tmp=0; */</span>
<a name="l00744"></a>00744 <span class="comment">/*      __u16* pLsb=(__u16*)pTarget; */</span>
<a name="l00745"></a>00745 <span class="comment">/*      __u16* pMsb=((__u16*)pTarget); pMsb++; */</span>
<a name="l00746"></a>00746 <span class="comment">/*      int i=0; */</span>
<a name="l00747"></a>00747 <span class="comment">/*      for (i=0; i&lt;iNofWords; i++) { */</span>
<a name="l00748"></a>00748 <span class="comment">/*        //fprintf(stderr, "%#x &lt;-&gt; %#x\n", *pLsb, *pMsb); */</span>
<a name="l00749"></a>00749 <span class="comment">/*        tmp=*pLsb; */</span>
<a name="l00750"></a>00750 <span class="comment">/*        *pLsb=*pMsb; pLsb+=2; */</span>
<a name="l00751"></a>00751 <span class="comment">/*        *pMsb=tmp; pMsb+=2; */</span>
<a name="l00752"></a>00752 <span class="comment">/*      } */</span>
<a name="l00753"></a>00753 <span class="comment">/*        } */</span>
<a name="l00754"></a>00754 <span class="comment">/*        if (pDataBuffer!=&amp;data) free(pDataBuffer); */</span>
<a name="l00755"></a>00755 <span class="comment">/*        pDataBuffer=(__u32*)pTarget; */</span>
<a name="l00756"></a>00756 <span class="comment">/*      } */</span>
<a name="l00757"></a>00757 <span class="comment">/*    } else { */</span>
<a name="l00758"></a>00758 <span class="comment">/*      iResult=-ENOMEM; */</span>
<a name="l00759"></a>00759 <span class="comment">/*    } */</span>
<a name="l00760"></a>00760 <span class="comment">/*    //fprintf(stderr, "done\n"); */</span>
<a name="l00761"></a>00761 <span class="comment">/*  } else { */</span>
<a name="l00762"></a>00762 <span class="comment">/*    // special case for swap of 32 bit single write */</span>
<a name="l00763"></a>00763 <span class="comment">/*    __u32 tmp=data; */</span>
<a name="l00764"></a>00764 <span class="comment">/*    char* pTgt=(char*)&amp;data; */</span>
<a name="l00765"></a>00765 <span class="comment">/*    char* pSrc=((char*)&amp;tmp)+3; */</span>
<a name="l00766"></a>00766 <span class="comment">/*    *pTgt++=*pSrc--; */</span>
<a name="l00767"></a>00767 <span class="comment">/*    *pTgt++=*pSrc--; */</span>
<a name="l00768"></a>00768 <span class="comment">/*    *pTgt++=*pSrc--; */</span>
<a name="l00769"></a>00769 <span class="comment">/*    *pTgt++=*pSrc--; */</span>
<a name="l00770"></a>00770 <span class="comment">/*  } */</span>
<a name="l00771"></a>00771 <span class="comment">/*       } */</span>
<a name="l00772"></a>00772     
<a name="l00773"></a>00773       <span class="keywordflow">if</span> (iResult&gt;=0) {
<a name="l00774"></a>00774     <span class="keywordflow">if</span> (pDataBuffer!=NULL) {
<a name="l00775"></a>00775       <span class="keywordflow">if</span> (iResult&gt;=0) {
<a name="l00776"></a>00776         <span class="comment">//printf("multiple write: address=%#x %d word(s), word size %d\n", address, iNofWords, iDataFormat);</span>
<a name="l00777"></a>00777         <span class="comment">//printBufferHexFormatted((unsigned char*)pDataBuffer, iNofWords*iDataFormat, iDataFormat, 4, address, NULL);</span>
<a name="l00778"></a>00778         <span class="comment">//iResult=0;</span>
<a name="l00779"></a>00779         <span class="keywordflow">if</span> (iMode==0) {
<a name="l00780"></a>00780           iResult=<a class="code" href="group__dcsc__msg__buffer__access.html#ge20afbfc92c897546e37126188804309">rcuMultipleWrite</a>(address, pDataBuffer, iNofWords, iDataFormat*iEndianess);
<a name="l00781"></a>00781         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iMode==1) {
<a name="l00782"></a>00782           <span class="keywordtype">int</span> iOffset=0;
<a name="l00783"></a>00783           <span class="keywordtype">int</span> iSize=0;
<a name="l00784"></a>00784           fprintf(stderr, <span class="stringliteral">"checking message block, %d words\n"</span>, iNofWords);
<a name="l00785"></a>00785           <span class="keywordflow">do</span> {
<a name="l00786"></a>00786         iSize=<a class="code" href="group__dcsc__msg__buffer__access.html#g8dac87332689e82a586ef04eed99d083">dcscCheckMsgBlock</a>(pDataBuffer+iOffset, iNofWords-iOffset, iVerbosity);
<a name="l00787"></a>00787         <span class="keywordflow">if</span> (iSize&gt;0)
<a name="l00788"></a>00788           fprintf(stderr, <span class="stringliteral">"correct message block at offset %d size %d\n"</span>, iOffset, iSize);
<a name="l00789"></a>00789         iOffset+=iSize;
<a name="l00790"></a>00790           } <span class="keywordflow">while</span> (iSize&gt;0 &amp;&amp; iOffset&lt;iNofWords);
<a name="l00791"></a>00791           iResult=iSize;
<a name="l00792"></a>00792           <span class="keywordflow">if</span> (iResult==0)
<a name="l00793"></a>00793         fprintf(stderr, <span class="stringliteral">"check failed, invalid format\n"</span>);
<a name="l00794"></a>00794           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iResult&lt;0)
<a name="l00795"></a>00795         fprintf(stderr, <span class="stringliteral">"check failed (%d)\n"</span>, iResult);
<a name="l00796"></a>00796         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iMode==2) {
<a name="l00797"></a>00797           <span class="comment">// flash write</span>
<a name="l00798"></a>00798           iResult=<a class="code" href="group__dcsc__msg__buffer__access.html#g88debbd24075d2031add9459e4d90e2b">rcuFlashWrite</a>(address, pDataBuffer, iNofWords, iDataFormat*iEndianess);
<a name="l00799"></a>00799         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iMode==3) {
<a name="l00800"></a>00800           <span class="comment">// flash verify</span>
<a name="l00801"></a>00801           <span class="keywordtype">int</span> iBufferSize=iNofWords*<span class="keyword">sizeof</span>(__u32);
<a name="l00802"></a>00802           __u32* pVerify=(__u32*)malloc(iBufferSize);
<a name="l00803"></a>00803           <span class="keywordflow">if</span> (pVerify) {
<a name="l00804"></a>00804         memset(pVerify, 0, iBufferSize);
<a name="l00805"></a>00805         <span class="keywordflow">if</span> ((iResult=<a class="code" href="group__dcsc__msg__buffer__access.html#g24164f14711ead31a7e542711f0a08b3">rcuFlashRead</a>(address, iNofWords, pVerify))&gt;=0) {
<a name="l00806"></a>00806           <span class="keywordtype">int</span> i=0;
<a name="l00807"></a>00807           <span class="keywordflow">for</span> (i=0; i&lt;iNofWords &amp;&amp; iResult&gt;=0; i++) {
<a name="l00808"></a>00808             <span class="keywordflow">if</span> (iDataFormat==4) {
<a name="l00809"></a>00809               <span class="keywordflow">if</span> (*(pVerify+i)!=*(pDataBuffer+i)) <span class="keywordflow">break</span>;             
<a name="l00810"></a>00810             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iDataFormat==2) {
<a name="l00811"></a>00811               <span class="keywordflow">if</span> (*((__u16*)(pVerify+i))!=*(((__u16*)pDataBuffer)+i)) <span class="keywordflow">break</span>;             
<a name="l00812"></a>00812             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iDataFormat==1) {
<a name="l00813"></a>00813               <span class="keywordflow">if</span> (*((__u8*)(pVerify+i))!=*(((__u8*)pDataBuffer)+i)) <span class="keywordflow">break</span>;           
<a name="l00814"></a>00814             }
<a name="l00815"></a>00815           }
<a name="l00816"></a>00816           <span class="keywordflow">if</span> (i&gt;=iNofWords) {
<a name="l00817"></a>00817             fprintf(stdout, <span class="stringliteral">"memory identical\n"</span>);
<a name="l00818"></a>00818           } <span class="keywordflow">else</span> {
<a name="l00819"></a>00819             fprintf(stdout, <span class="stringliteral">"first difference at %#x\n"</span>, address+i);
<a name="l00820"></a>00820             <a class="code" href="group__dcsc__msg__buffer__access.html#g1b3027d209be85e9a8fbd14864c4b442">printBufferHex</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(pVerify+i), 4, 4, <span class="stringliteral">"flash memory"</span>);
<a name="l00821"></a>00821             <a class="code" href="group__dcsc__msg__buffer__access.html#g1b3027d209be85e9a8fbd14864c4b442">printBufferHex</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(pDataBuffer)+i*iDataFormat, iDataFormat, iDataFormat, <span class="stringliteral">"test file   "</span>);
<a name="l00822"></a>00822           }
<a name="l00823"></a>00823         } <span class="keywordflow">else</span> {
<a name="l00824"></a>00824           fprintf(stderr, <span class="stringliteral">"verify failed, can not read from flash\n"</span>);
<a name="l00825"></a>00825         }
<a name="l00826"></a>00826         free(pVerify);
<a name="l00827"></a>00827           }
<a name="l00828"></a>00828         } <span class="keywordflow">else</span> {
<a name="l00829"></a>00829           fprintf(stderr, <span class="stringliteral">"internal error, wrong mode to execWriteCmd (%d)\n"</span>, iMode);
<a name="l00830"></a>00830           iResult=-EIO;
<a name="l00831"></a>00831         }
<a name="l00832"></a>00832       } <span class="keywordflow">else</span> {
<a name="l00833"></a>00833         fprintf(stderr, <span class="stringliteral">"internal error, can not proceed write command\n"</span>);
<a name="l00834"></a>00834       }
<a name="l00835"></a>00835       <span class="keywordflow">if</span> (pDataBuffer!=&amp;data) free(pDataBuffer);
<a name="l00836"></a>00836       pDataBuffer=NULL;
<a name="l00837"></a>00837     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iNofWords==1) {
<a name="l00838"></a>00838       printf(<span class="stringliteral">"single write: address=%#x data=%#x\n"</span>, address, data);
<a name="l00839"></a>00839       <span class="comment">//iResult=0;</span>
<a name="l00840"></a>00840       <span class="keywordflow">if</span> (iMode==0) {
<a name="l00841"></a>00841         iResult=<a class="code" href="group__dcsc__msg__buffer__access.html#g5b2ecab6b0a6383afebde1ea486dae43">rcuSingleWrite</a>(address, data);
<a name="l00842"></a>00842       } <span class="keywordflow">else</span> {
<a name="l00843"></a>00843         fprintf(stderr, <span class="stringliteral">"internal error, wrong mode to execWriteCmd (%d)\n"</span>, iMode);
<a name="l00844"></a>00844         iResult=-EIO;
<a name="l00845"></a>00845       }
<a name="l00846"></a>00846     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iNofWords!=0) {
<a name="l00847"></a>00847       fprintf(stderr, <span class="stringliteral">"internal state error: supposed to write %d word(s) but no data buffer available\n"</span>, iNofWords);
<a name="l00848"></a>00848     }
<a name="l00849"></a>00849       }
<a name="l00850"></a>00850     }
<a name="l00851"></a>00851     <span class="keywordflow">if</span> (iTimer&gt;0) {
<a name="l00852"></a>00852       printf(<span class="stringliteral">"time : %ssec\n"</span>, <a class="code" href="mrtimers_8c.html#eec88b57f56b75bdef646c5e44e0c2dc">getTimerValueString</a>(iTimer));
<a name="l00853"></a>00853       <a class="code" href="mrtimers_8c.html#fa991349587b8e300e5363a21dcee3b7">stopTimer</a>(iTimer);
<a name="l00854"></a>00854     }
<a name="l00855"></a>00855   } <span class="keywordflow">else</span> {
<a name="l00856"></a>00856     fprintf(stderr, <span class="stringliteral">"too few arguments for write command\n"</span>);
<a name="l00857"></a>00857     iResult=-EINVAL;
<a name="l00858"></a>00858   }
<a name="l00859"></a>00859   <span class="keywordflow">return</span> iResult;
<a name="l00860"></a>00860 }
<a name="l00861"></a>00861 
<a name="l00862"></a><a class="code" href="cmdInterpreter_8c.html#78a2282cf7d3dbf552e5f9876dba01cf">00862</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#78a2282cf7d3dbf552e5f9876dba01cf">ScanCoefficients</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* pFormat, <span class="keywordtype">float</span>* pfM, <span class="keywordtype">float</span>* pfN, __u32* pMask)
<a name="l00863"></a>00863 {
<a name="l00864"></a>00864   <span class="keywordtype">int</span> iResult=0;
<a name="l00865"></a>00865   <span class="keywordflow">if</span> (pFormat &amp;&amp; pfM &amp;&amp; pfN &amp;&amp; pMask) {
<a name="l00866"></a>00866     <span class="keywordtype">int</span> i=0;
<a name="l00867"></a>00867     <span class="keywordtype">int</span> j=-1;
<a name="l00868"></a>00868     <span class="keywordtype">int</span> iFormatSize=strlen(pFormat);
<a name="l00869"></a>00869     <span class="keywordtype">char</span>* pQuery=(<span class="keywordtype">char</span>*)malloc(iFormatSize+1);
<a name="l00870"></a>00870     <span class="keywordflow">if</span> (pQuery) {
<a name="l00871"></a>00871       strcpy(pQuery, pFormat);
<a name="l00872"></a>00872       <span class="keywordtype">int</span> iSpec=0;
<a name="l00873"></a>00873       <span class="keywordtype">int</span> iLastSpec=0;
<a name="l00874"></a>00874       <span class="keywordtype">float</span>* pfScan=NULL;
<a name="l00875"></a>00875       <span class="keywordtype">int</span> iBlanks=0;
<a name="l00876"></a>00876       <span class="keywordflow">for</span> (i=0; pFormat[i]!=0 &amp;&amp; iResult==0; i++) {
<a name="l00877"></a>00877     <span class="keywordflow">switch</span> (pFormat[i]) {
<a name="l00878"></a>00878     <span class="keywordflow">case</span> <span class="charliteral">'['</span>: 
<a name="l00879"></a>00879       j=i+1;
<a name="l00880"></a>00880       <span class="keywordflow">break</span>;
<a name="l00881"></a>00881     <span class="keywordflow">case</span> <span class="charliteral">'*'</span>:
<a name="l00882"></a>00882       iSpec++;
<a name="l00883"></a>00883       <span class="comment">// fall through intended</span>
<a name="l00884"></a>00884     <span class="keywordflow">case</span> <span class="charliteral">'+'</span>:
<a name="l00885"></a>00885       iSpec++;
<a name="l00886"></a>00886       <span class="comment">// fall through intended</span>
<a name="l00887"></a>00887     <span class="keywordflow">case</span> <span class="charliteral">'-'</span>:
<a name="l00888"></a>00888       iSpec++;
<a name="l00889"></a>00889     <span class="keywordflow">case</span> <span class="charliteral">'&amp;'</span>:
<a name="l00890"></a>00890       iSpec++;
<a name="l00891"></a>00891     <span class="keywordflow">case</span> <span class="charliteral">']'</span>:
<a name="l00892"></a>00892       <span class="keywordflow">if</span> (iLastSpec&gt;0 &amp;&amp; j&gt;0 &amp;&amp; j&lt;i) {
<a name="l00893"></a>00893         <span class="keywordflow">if</span> (j==i-1-iBlanks &amp;&amp; iLastSpec==4 &amp;&amp; iSpec==2) { <span class="comment">// handling for signed multiplicators</span>
<a name="l00894"></a>00894           iSpec=iLastSpec+1;
<a name="l00895"></a>00895         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (j&lt;i-1) {
<a name="l00896"></a>00896           <span class="comment">// read the value</span>
<a name="l00897"></a>00897           <span class="keywordflow">if</span> (iLastSpec&gt;1) {
<a name="l00898"></a>00898         <span class="comment">// these are the floats</span>
<a name="l00899"></a>00899         <span class="keywordflow">if</span> (iLastSpec&gt;=4) pfScan=pfM;
<a name="l00900"></a>00900         <span class="keywordflow">else</span> pfScan=pfN;
<a name="l00901"></a>00901         pQuery[i]=0; <span class="comment">// terminate the format string</span>
<a name="l00902"></a>00902         iResult=<a class="code" href="mrshellprim_8c.html#bd0f88fefc2b7fb8ffa459b09018c921">getFloatNumberFromArg</a>(&amp;pQuery[j+1], pfScan, 1);
<a name="l00903"></a>00903         pQuery[i]=pFormat[i]; <span class="comment">// restore the format string</span>
<a name="l00904"></a>00904         <span class="keywordflow">if</span> (iResult&gt;0) iResult=0;  <span class="comment">// just make sure to continue the for loop</span>
<a name="l00905"></a>00905         <span class="keywordflow">if</span> (iLastSpec==2 || iLastSpec==5) *pfScan*=-1; <span class="comment">// this is the minus specifier</span>
<a name="l00906"></a>00906           } <span class="keywordflow">else</span> {
<a name="l00907"></a>00907         <span class="comment">// the hexadecimal mask</span>
<a name="l00908"></a>00908         iResult=<a class="code" href="mrshellprim_8c.html#0244dae55f177bb00bfae3a0a39f6f5a">getHexNumberFromArg</a>(&amp;pQuery[j+1], pMask, 1);
<a name="l00909"></a>00909           }
<a name="l00910"></a>00910         } <span class="keywordflow">else</span> {
<a name="l00911"></a>00911           fprintf(stderr, <span class="stringliteral">"ScanCoefficients: duplicate specifiers, %c overrides %c\n"</span>, pFormat[i], pFormat[j]);
<a name="l00912"></a>00912         }
<a name="l00913"></a>00913       }
<a name="l00914"></a>00914       <span class="keywordflow">if</span> (iSpec&gt;0) { <span class="comment">// new specifier is starting</span>
<a name="l00915"></a>00915         iLastSpec=iSpec;
<a name="l00916"></a>00916         iSpec=0;
<a name="l00917"></a>00917         j=i;
<a name="l00918"></a>00918       } <span class="keywordflow">else</span> {
<a name="l00919"></a>00919         iResult=i+1; <span class="comment">// return the length</span>
<a name="l00920"></a>00920       }
<a name="l00921"></a>00921       iBlanks=0;
<a name="l00922"></a>00922       <span class="keywordflow">break</span>;
<a name="l00923"></a>00923     <span class="keywordflow">case</span> <span class="charliteral">' '</span>:
<a name="l00924"></a>00924       iBlanks++;
<a name="l00925"></a>00925       <span class="keywordflow">break</span>;
<a name="l00926"></a>00926     <span class="keywordflow">default</span>:
<a name="l00927"></a>00927       iBlanks=0;
<a name="l00928"></a>00928       <span class="keywordflow">break</span>;
<a name="l00929"></a>00929     }
<a name="l00930"></a>00930     <span class="keywordflow">if</span> (j&lt;0) {
<a name="l00931"></a>00931       fprintf(stderr, <span class="stringliteral">"ScanCoefficients: invalid format %s\n"</span>, &amp;pFormat[i]);
<a name="l00932"></a>00932       <span class="keywordflow">break</span>;
<a name="l00933"></a>00933     }
<a name="l00934"></a>00934     <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;<a class="code" href="mrshellprim_8h.html#13095cc00efe5276cf7a1794f0f8b7e5">DBG_ARGUMENT_CONVERT</a>) {
<a name="l00935"></a>00935       fprintf(stderr, <span class="stringliteral">"ScanCoefficients: m=%f n=%f %s iResult=%d\n"</span>, *pfM, *pfN, &amp;pFormat[i], iResult);
<a name="l00936"></a>00936     }
<a name="l00937"></a>00937       }
<a name="l00938"></a>00938       free(pQuery);
<a name="l00939"></a>00939     }
<a name="l00940"></a>00940   } <span class="keywordflow">else</span> {
<a name="l00941"></a>00941     iResult=-EINVAL;
<a name="l00942"></a>00942   }
<a name="l00943"></a>00943   <span class="keywordflow">return</span> iResult;
<a name="l00944"></a>00944 }
<a name="l00945"></a>00945 
<a name="l00946"></a><a class="code" href="cmdInterpreter_8c.html#e3bcc6695f3c41940a8ab1f428101f07">00946</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#e3bcc6695f3c41940a8ab1f428101f07">printReadOutputFormatted</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="dcscMsgBufferInterface_8c.html#7fe69f55846ac3a138c130665f1f1e49">pBuffer</a>, <span class="keywordtype">int</span> iBufferSize, <span class="keyword">const</span> <span class="keywordtype">char</span>* pFormat, <span class="keywordtype">int</span> iStartAddress, FILE* fp)
<a name="l00947"></a>00947 {
<a name="l00948"></a>00948   <span class="keywordtype">int</span> iResult=0;
<a name="l00949"></a>00949   <span class="keywordflow">if</span> (pBuffer &amp;&amp; iBufferSize&gt;0 &amp;&amp; pFormat &amp;&amp; fp) {
<a name="l00950"></a>00950     <span class="keywordtype">int</span> iFormatSize=strlen(pFormat);
<a name="l00951"></a>00951     <span class="keywordtype">char</span>* pWorkBuffer=(<span class="keywordtype">char</span>*)malloc(iFormatSize+1);
<a name="l00952"></a>00952     <span class="keywordflow">if</span> (pWorkBuffer) {
<a name="l00953"></a>00953       <span class="keywordtype">int</span> iOffset=0;
<a name="l00954"></a>00954       <span class="keywordtype">int</span> iNofWords=iBufferSize/<span class="keyword">sizeof</span>(__u32);
<a name="l00955"></a>00955       <span class="keywordtype">int</span> bBinary=0; <span class="comment">// used for to check if binary and character format has been mixed, 0 virgin, -1 already char, 1 binary, 2 warning has been printed</span>
<a name="l00956"></a>00956       <span class="keywordflow">while</span> (iOffset&lt;iNofWords) {
<a name="l00957"></a>00957     <span class="keywordtype">int</span> i=0;
<a name="l00958"></a>00958     <span class="keywordtype">int</span> j=-1;
<a name="l00959"></a>00959     <span class="keywordtype">int</span> k=0;
<a name="l00960"></a>00960     <span class="keywordtype">int</span> bMissingNewline=1;
<a name="l00961"></a>00961     strcpy(pWorkBuffer, pFormat);
<a name="l00962"></a>00962     <span class="keywordflow">for</span> (i=0; pFormat[i]!=0 &amp;&amp; i&lt;iFormatSize; i++) {
<a name="l00963"></a>00963       <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;<a class="code" href="mrshellprim_8h.html#13095cc00efe5276cf7a1794f0f8b7e5">DBG_ARGUMENT_CONVERT</a>) {
<a name="l00964"></a>00964         fprintf(stderr, <span class="stringliteral">"printReadOutputFormatted: work buffer[i] %s\n"</span>, &amp;pWorkBuffer[i]);
<a name="l00965"></a>00965         <span class="keywordflow">if</span> (j&gt;=0)
<a name="l00966"></a>00966           fprintf(stderr, <span class="stringliteral">"printReadOutputFormatted: work buffer[j] %s\n"</span>, &amp;pWorkBuffer[j]);
<a name="l00967"></a>00967       }
<a name="l00968"></a>00968       <span class="keywordflow">switch</span> (pFormat[i]) {
<a name="l00969"></a>00969       <span class="keywordflow">case</span> <span class="charliteral">'%'</span>:
<a name="l00970"></a>00970         <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;DBG_ARGUMENT_CONVERT) {
<a name="l00971"></a>00971           fprintf(stderr, <span class="stringliteral">"printReadOutputFormatted: i=%d j=%d %s\n"</span>, i, j, &amp;pFormat[i]);
<a name="l00972"></a>00972         }
<a name="l00973"></a>00973         <span class="keywordflow">if</span> (j&gt;=0 &amp;&amp; j&lt;i) {
<a name="l00974"></a>00974           <span class="comment">// print a warning if we are in binary mode</span>
<a name="l00975"></a>00975           <span class="keywordflow">if</span> (bBinary==1) {
<a name="l00976"></a>00976         bBinary++;
<a name="l00977"></a>00977         fprintf(stderr, <span class="stringliteral">"warning: your binary format string is mixed with other characters\n"</span>);
<a name="l00978"></a>00978           }
<a name="l00979"></a>00979           <span class="comment">// flush the output</span>
<a name="l00980"></a>00980           <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;DBG_ARGUMENT_CONVERT) {
<a name="l00981"></a>00981         fprintf(stderr, <span class="stringliteral">"printReadOutputFormatted: flush work buffer i=%d j=%d %s\n"</span>, i, j, &amp;pWorkBuffer[j]);
<a name="l00982"></a>00982           }
<a name="l00983"></a>00983           pWorkBuffer[i]=0;
<a name="l00984"></a>00984           <span class="keywordflow">if</span> (bBinary==0) bBinary--; <span class="comment">// to indicate that characters have been printed out already</span>
<a name="l00985"></a>00985           fprintf(fp, &amp;(pWorkBuffer[j]));
<a name="l00986"></a>00986           pWorkBuffer[i]=pFormat[i];
<a name="l00987"></a>00987         }
<a name="l00988"></a>00988         j=-1;
<a name="l00989"></a>00989         <span class="keywordflow">for</span> (k=i+1; k&lt;iFormatSize &amp;&amp; j&lt;0 ; k++) {
<a name="l00990"></a>00990           <span class="keywordflow">switch</span> (pFormat[k]) {
<a name="l00991"></a>00991           <span class="keywordflow">case</span> <span class="charliteral">'%'</span>: <span class="comment">// the '%' character, continue</span>
<a name="l00992"></a>00992         j=k-1;
<a name="l00993"></a>00993         <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;DBG_ARGUMENT_CONVERT) {
<a name="l00994"></a>00994           fprintf(stderr, <span class="stringliteral">"printReadOutputFormatted: special character i=%d j=%d k=%d %s\n"</span>, i, j, k, &amp;pFormat[k]);
<a name="l00995"></a>00995         }
<a name="l00996"></a>00996         <span class="keywordflow">break</span>;
<a name="l00997"></a>00997           <span class="keywordflow">case</span> <span class="charliteral">'['</span>: <span class="comment">// the '[' character, continue</span>
<a name="l00998"></a>00998           <span class="keywordflow">case</span> <span class="charliteral">']'</span>: <span class="comment">// the ']' character, continue</span>
<a name="l00999"></a>00999         j=k;
<a name="l01000"></a>01000         <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;DBG_ARGUMENT_CONVERT) {
<a name="l01001"></a>01001           fprintf(stderr, <span class="stringliteral">"printReadOutputFormatted: special character i=%d j=%d k=%d %s\n"</span>, i, j, k, &amp;pFormat[k]);
<a name="l01002"></a>01002         }
<a name="l01003"></a>01003         <span class="keywordflow">break</span>;
<a name="l01004"></a>01004           <span class="keywordflow">case</span> <span class="charliteral">'a'</span>: <span class="comment">// print the address</span>
<a name="l01005"></a>01005         <span class="keywordflow">if</span> (iStartAddress&gt;=0) {
<a name="l01006"></a>01006           fprintf(fp, <span class="stringliteral">"0x%x"</span>, iStartAddress+iOffset);
<a name="l01007"></a>01007         }
<a name="l01008"></a>01008         j=k+1; <span class="comment">// breaking condition and potential start of string</span>
<a name="l01009"></a>01009         <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;DBG_ARGUMENT_CONVERT) {
<a name="l01010"></a>01010           fprintf(stderr, <span class="stringliteral">"printReadOutputFormatted: print address i=%d j=%d k=%d %s\n"</span>, i, j, k, &amp;pFormat[k]);
<a name="l01011"></a>01011         }
<a name="l01012"></a>01012         <span class="keywordflow">break</span>;
<a name="l01013"></a>01013           <span class="keywordflow">case</span> <span class="charliteral">'x'</span>: <span class="comment">// print the value hex</span>
<a name="l01014"></a>01014           <span class="keywordflow">case</span> <span class="charliteral">'d'</span>: <span class="comment">// print the value decimal</span>
<a name="l01015"></a>01015           <span class="keywordflow">case</span> <span class="charliteral">'f'</span>: <span class="comment">// print the value float</span>
<a name="l01016"></a>01016         <span class="keywordflow">if</span> (bBinary==1) {
<a name="l01017"></a>01017           bBinary++;
<a name="l01018"></a>01018           fprintf(stderr, <span class="stringliteral">"warning: you should not mix character and binary formats\n"</span>);
<a name="l01019"></a>01019         }
<a name="l01020"></a>01020         <span class="comment">// fall through intended</span>
<a name="l01021"></a>01021           <span class="keywordflow">case</span> <span class="charliteral">'b'</span>: <span class="comment">// print the value binary</span>
<a name="l01022"></a>01022         {
<a name="l01023"></a>01023           <span class="comment">// coefficients for linear conversion</span>
<a name="l01024"></a>01024           <span class="keywordtype">float</span> fM=1; <span class="comment">// the slope</span>
<a name="l01025"></a>01025           <span class="keywordtype">float</span> fN=0; <span class="comment">// the offset</span>
<a name="l01026"></a>01026           __u32 mask=0xffffffff;
<a name="l01027"></a>01027           <span class="keywordtype">int</span> iCoeffInc=0; <span class="comment">// number of characters of the weight definition, has to be added to the index later</span>
<a name="l01028"></a>01028           <span class="keywordtype">int</span> iWordSize=4;
<a name="l01029"></a>01029           <span class="keywordflow">if</span> (pFormat[k]==<span class="charliteral">'b'</span>) {
<a name="l01030"></a>01030             <span class="keywordflow">switch</span> (pFormat[k+1]) {
<a name="l01031"></a>01031             <span class="keywordflow">case</span> <span class="charliteral">'1'</span>:
<a name="l01032"></a>01032               iWordSize/=2;
<a name="l01033"></a>01033               <span class="comment">// fall through intended</span>
<a name="l01034"></a>01034             <span class="keywordflow">case</span> <span class="charliteral">'2'</span>: 
<a name="l01035"></a>01035               iWordSize/=2;
<a name="l01036"></a>01036               <span class="comment">// fall through intended</span>
<a name="l01037"></a>01037             <span class="keywordflow">case</span> <span class="charliteral">'4'</span>:
<a name="l01038"></a>01038               iCoeffInc++;
<a name="l01039"></a>01039             }
<a name="l01040"></a>01040             <span class="keywordflow">if</span> (bBinary&lt;=0) {
<a name="l01041"></a>01041               <span class="keywordflow">if</span> (bBinary&lt;0) {
<a name="l01042"></a>01042             bBinary=2; <span class="comment">// indicate that the warning has been printed</span>
<a name="l01043"></a>01043             fprintf(stderr, <span class="stringliteral">"warning: you should not mix character and binary formats\n"</span>);
<a name="l01044"></a>01044               } <span class="keywordflow">else</span> {
<a name="l01045"></a>01045             bBinary=1; <span class="comment">// to indicate that we are now in binary mode</span>
<a name="l01046"></a>01046               }
<a name="l01047"></a>01047             }
<a name="l01048"></a>01048             <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;DBG_ARGUMENT_CONVERT)
<a name="l01049"></a>01049               fprintf(stderr, <span class="stringliteral">"printReadOutputFormatted: print binary, word size %d\n"</span>, iWordSize);
<a name="l01050"></a>01050           }
<a name="l01051"></a>01051           <span class="keywordflow">if</span> (pFormat[k+1+iCoeffInc]==<span class="charliteral">'['</span>) {
<a name="l01052"></a>01052             <span class="comment">// scan for Coefficients</span>
<a name="l01053"></a>01053             iResult=<a class="code" href="cmdInterpreter_8c.html#78a2282cf7d3dbf552e5f9876dba01cf">ScanCoefficients</a>((<span class="keyword">const</span> <span class="keywordtype">char</span>*)&amp;pFormat[k+1+iCoeffInc], &amp;fM, &amp;fN, &amp;mask); 
<a name="l01054"></a>01054             <span class="keywordflow">if</span> (iResult&lt;0) {
<a name="l01055"></a>01055               fprintf(stderr, <span class="stringliteral">"printReadOutputFormatted: error scanning coefficients %s (%d)\n"</span>, &amp;pFormat[k+1+iCoeffInc], iResult);  
<a name="l01056"></a>01056             } <span class="keywordflow">else</span> {
<a name="l01057"></a>01057               iCoeffInc+=iResult;
<a name="l01058"></a>01058               iResult=0;
<a name="l01059"></a>01059             }
<a name="l01060"></a>01060           }
<a name="l01061"></a>01061           <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;DBG_ARGUMENT_CONVERT) {
<a name="l01062"></a>01062             fprintf(stderr, <span class="stringliteral">"printReadOutputFormatted: terminate work buffer i=%d j=%d k=%d %s\n"</span>, i, j, k, &amp;pWorkBuffer[i]);
<a name="l01063"></a>01063           }
<a name="l01064"></a>01064           <span class="keywordflow">if</span> (iOffset&lt;iNofWords) {
<a name="l01065"></a>01065             <span class="comment">// terminate the format string right behind this specifier</span>
<a name="l01066"></a>01066             pWorkBuffer[k+1]=0;
<a name="l01067"></a>01067             __u32 value=*((__u32*)pBuffer+iOffset)&amp;mask;
<a name="l01068"></a>01068             <span class="keywordtype">float</span> fVal=value*fM + fN;
<a name="l01069"></a>01069             <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;DBG_ARGUMENT_CONVERT) {
<a name="l01070"></a>01070               fprintf(stderr, <span class="stringliteral">"printReadOutputFormatted: value=%u (%#x) fVal=%f fM=%f fN=%f\n"</span>, value, value, fVal, fM, fN);
<a name="l01071"></a>01071             }
<a name="l01072"></a>01072             <span class="keywordflow">if</span> (pFormat[k]==<span class="charliteral">'f'</span>) { <span class="comment">// take the float value if 'f' specified otherwize the unsigned int</span>
<a name="l01073"></a>01073               fprintf(fp, &amp;(pWorkBuffer[i]), fVal);
<a name="l01074"></a>01074             } <span class="keywordflow">else</span> {
<a name="l01075"></a>01075               <span class="keywordflow">if</span> (fVal&gt;=0 &amp;&amp; fVal&lt;=<a class="code" href="cmdInterpreter_8h.html#c998ea02fbd821fc123d60445ce76f38">UINT_MAX</a>) {
<a name="l01076"></a>01076             <span class="keywordflow">if</span> (value&gt;<a class="code" href="cmdInterpreter_8h.html#c4d12945dc541519caef4f461062a6c5">INT_RO_MAX</a> &amp;&amp; (fM!=1.0 || fN!=0.0))
<a name="l01077"></a>01077               fprintf(stderr, <span class="stringliteral">"printReadOutputFormatted: conversion factors ignored, value exceeds limit %#x\n"</span>, <a class="code" href="cmdInterpreter_8h.html#c4d12945dc541519caef4f461062a6c5">INT_RO_MAX</a>);
<a name="l01078"></a>01078             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fM!=1.0 || fN!=0.0)
<a name="l01079"></a>01079               value = (__u32)fVal;
<a name="l01080"></a>01080               } <span class="keywordflow">else</span> {
<a name="l01081"></a>01081             fprintf(stderr, <span class="stringliteral">"printReadOutputFormatted: conversion error, coefficients do not fit data limits (val=%#x, m=%f, n=%f)\n"</span>, value, fM, fN);
<a name="l01082"></a>01082               }
<a name="l01083"></a>01083               <span class="keywordflow">if</span> (pFormat[k]==<span class="charliteral">'b'</span>) {
<a name="l01084"></a>01084             fwrite((<span class="keywordtype">char</span>*)&amp;value, iWordSize, 1, fp);
<a name="l01085"></a>01085               } <span class="keywordflow">else</span> {
<a name="l01086"></a>01086             fprintf(fp, &amp;(pWorkBuffer[i]), value);
<a name="l01087"></a>01087               }
<a name="l01088"></a>01088             }
<a name="l01089"></a>01089             <span class="comment">// restore the original value of [k+1]</span>
<a name="l01090"></a>01090             pWorkBuffer[k+1]=pFormat[k+1];
<a name="l01091"></a>01091             iOffset++;
<a name="l01092"></a>01092           }
<a name="l01093"></a>01093           k+=iCoeffInc; <span class="comment">// set index behind the weight string</span>
<a name="l01094"></a>01094           j=k+1; <span class="comment">// breaking condition and potential start of string</span>
<a name="l01095"></a>01095           <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;DBG_ARGUMENT_CONVERT) {
<a name="l01096"></a>01096             fprintf(stderr, <span class="stringliteral">"printReadOutputFormatted: print data i=%d j=%d k=%d %s\n"</span>, i, j, k, &amp;pFormat[k]);
<a name="l01097"></a>01097           }
<a name="l01098"></a>01098         }
<a name="l01099"></a>01099         <span class="keywordflow">break</span>;
<a name="l01100"></a>01100           }
<a name="l01101"></a>01101         }
<a name="l01102"></a>01102         <span class="keywordflow">if</span> (j&lt;0) {
<a name="l01103"></a>01103           fprintf(stderr, <span class="stringliteral">"printReadBufferFormatted: format error, no specifier found\n"</span>);
<a name="l01104"></a>01104         }
<a name="l01105"></a>01105         i=k-1;
<a name="l01106"></a>01106         <span class="keywordflow">break</span>;
<a name="l01107"></a>01107       <span class="keywordflow">case</span> <span class="charliteral">'\\'</span>:
<a name="l01108"></a>01108         <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;DBG_ARGUMENT_CONVERT) {
<a name="l01109"></a>01109           fprintf(stderr, <span class="stringliteral">"printReadBufferFormatted: \\-character i=%d j=%d\n"</span>,i,j);
<a name="l01110"></a>01110         }
<a name="l01111"></a>01111         <span class="keywordflow">if</span> (j&gt;=0 &amp;&amp; j&lt;i) {
<a name="l01112"></a>01112           <span class="comment">// flush the buffer</span>
<a name="l01113"></a>01113           pWorkBuffer[i]=0;
<a name="l01114"></a>01114           fprintf(fp, <span class="stringliteral">"%s"</span>, &amp;pWorkBuffer[j]);
<a name="l01115"></a>01115           pWorkBuffer[i]=pFormat[i];
<a name="l01116"></a>01116         }
<a name="l01117"></a>01117         <span class="comment">// special handling for newline command</span>
<a name="l01118"></a>01118         <span class="keywordflow">if</span> (pFormat[i+1]==<span class="charliteral">'n'</span>) {
<a name="l01119"></a>01119           <span class="keywordflow">if</span> (j&lt;0) {
<a name="l01120"></a>01120         <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;DBG_ARGUMENT_CONVERT) {
<a name="l01121"></a>01121           fprintf(stderr, <span class="stringliteral">"printReadBufferFormatted: insert newline i=%d j=%d\n"</span>,i,j);
<a name="l01122"></a>01122         }
<a name="l01123"></a>01123           }
<a name="l01124"></a>01124           bMissingNewline=0;
<a name="l01125"></a>01125           fprintf(fp, <span class="stringliteral">"\n"</span>);
<a name="l01126"></a>01126           i++;
<a name="l01127"></a>01127         }
<a name="l01128"></a>01128         j=-1;
<a name="l01129"></a>01129         <span class="keywordflow">break</span>;
<a name="l01130"></a>01130       <span class="keywordflow">default</span>:
<a name="l01131"></a>01131         <span class="keywordflow">if</span> (j&lt;0) j=i;
<a name="l01132"></a>01132       }
<a name="l01133"></a>01133     }
<a name="l01134"></a>01134     <span class="keywordflow">if</span> (j &lt; iFormatSize) {
<a name="l01135"></a>01135       <span class="comment">// print remaining characters</span>
<a name="l01136"></a>01136       fprintf(fp, &amp;(pWorkBuffer[j]));
<a name="l01137"></a>01137       j=iFormatSize;
<a name="l01138"></a>01138     }
<a name="l01139"></a>01139     <span class="keywordflow">if</span> (bMissingNewline==1 &amp;&amp; bBinary&lt;=0)
<a name="l01140"></a>01140       fprintf(fp, <span class="stringliteral">"\n"</span>);
<a name="l01141"></a>01141       }
<a name="l01142"></a>01142       fflush(fp);
<a name="l01143"></a>01143       free(pWorkBuffer);
<a name="l01144"></a>01144     } <span class="keywordflow">else</span> {
<a name="l01145"></a>01145       iResult=-ENOMEM;
<a name="l01146"></a>01146     }
<a name="l01147"></a>01147   } <span class="keywordflow">else</span> {
<a name="l01148"></a>01148     iResult=-EINVAL;
<a name="l01149"></a>01149   }
<a name="l01150"></a>01150   <span class="keywordflow">return</span> iResult;
<a name="l01151"></a>01151 }
<a name="l01152"></a>01152 
<a name="l01153"></a><a class="code" href="cmdInterpreter_8c.html#a7c39db1bcd241c2ae5f259c0281abb6">01153</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#a7c39db1bcd241c2ae5f259c0281abb6">execReadCmd</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg, <span class="keywordtype">int</span> iNofArgs, <span class="keywordtype">int</span> iMode)
<a name="l01154"></a>01154 {
<a name="l01155"></a>01155   <span class="keywordtype">int</span> iResult=0;
<a name="l01156"></a>01156   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> address=0;
<a name="l01157"></a>01157   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> data=0;
<a name="l01158"></a>01158   <span class="keywordtype">int</span> iNofWords=0;
<a name="l01159"></a>01159   <span class="keyword">const</span> <span class="keywordtype">char</span>* pFormatSingleRead=<span class="stringliteral">"%a: %#x"</span>; <span class="comment">// default format for rcu single read</span>
<a name="l01160"></a>01160   <span class="keyword">const</span> <span class="keywordtype">char</span>* pFormatMultiRead=<span class="stringliteral">"%a: %#x %#x %#x %#x"</span>; <span class="comment">// default format for rcu multi read</span>
<a name="l01161"></a>01161   <span class="keyword">const</span> <span class="keywordtype">char</span>* pFormatFlash=<span class="stringliteral">"%a: %#x[&amp;0xffff] %#x[&amp;0xffff] %#x[&amp;0xffff] %#x[&amp;0xffff]"</span>; <span class="comment">// default format for flash read</span>
<a name="l01162"></a>01162   <span class="keyword">const</span> <span class="keywordtype">char</span>* pFormat=NULL;
<a name="l01163"></a>01163   FILE* fp=NULL;
<a name="l01164"></a>01164   <span class="keywordtype">int</span> i=0;
<a name="l01165"></a>01165   <span class="keywordflow">if</span> (iNofArgs&gt;0 &amp;&amp; arrayArg!=NULL) {
<a name="l01166"></a>01166     <span class="keywordflow">if</span> ((iMode==8 &amp;&amp; <a class="code" href="mrshellprim_8c.html#fe29afcd7e0ed24611394b379523e597">getDecNumberFromArg</a>(arrayArg[0], &amp;address, 1)&gt;=0 ) ||
<a name="l01167"></a>01167     <a class="code" href="mrshellprim_8c.html#0244dae55f177bb00bfae3a0a39f6f5a">getHexNumberFromArg</a>(arrayArg[0], &amp;address, 1)&gt;=0) {
<a name="l01168"></a>01168       <span class="keywordflow">for</span> (i=1; i&lt;iNofArgs; i++) {
<a name="l01169"></a>01169     <span class="keywordflow">if</span> (*arrayArg[i]==<span class="charliteral">'-'</span>) {
<a name="l01170"></a>01170       <span class="comment">// identify the format options</span>
<a name="l01171"></a>01171       <span class="keywordflow">switch</span> (*(arrayArg[i]+1)) {
<a name="l01172"></a>01172       <span class="keywordflow">case</span> <span class="charliteral">'o'</span>: <span class="comment">// write output to file</span>
<a name="l01173"></a>01173       <span class="keywordflow">case</span> <span class="charliteral">'a'</span>: <span class="comment">// append output to file</span>
<a name="l01174"></a>01174         <span class="keywordflow">if</span> (iNofArgs&gt;i+1) {
<a name="l01175"></a>01175           <span class="keyword">const</span> <span class="keywordtype">char</span> * strMode = <span class="stringliteral">"w"</span>;
<a name="l01176"></a>01176           <span class="keywordflow">if</span> (*(arrayArg[i]+1)==<span class="charliteral">'a'</span>) strMode=<span class="stringliteral">"a"</span>;
<a name="l01177"></a>01177           fp = fopen(arrayArg[++i], strMode);
<a name="l01178"></a>01178           <span class="keywordflow">if</span> (fp==NULL)
<a name="l01179"></a>01179         fprintf(stderr, <span class="stringliteral">"execReadCmd: can not open file %s for writing\n"</span>, arrayArg[i]);
<a name="l01180"></a>01180         } <span class="keywordflow">else</span> {
<a name="l01181"></a>01181           fprintf(stderr, <span class="stringliteral">"execReadCmd: missing file name to %s option\n"</span>, arrayArg[i]);
<a name="l01182"></a>01182         }
<a name="l01183"></a>01183         <span class="keywordflow">break</span>;
<a name="l01184"></a>01184       <span class="keywordflow">case</span> <span class="charliteral">'f'</span>: <span class="comment">// format string</span>
<a name="l01185"></a>01185         <span class="keywordflow">if</span> (iNofArgs&gt;i+1) {
<a name="l01186"></a>01186           pFormat=arrayArg[++i];
<a name="l01187"></a>01187         } <span class="keywordflow">else</span> {
<a name="l01188"></a>01188           fprintf(stderr, <span class="stringliteral">"execReadCmd: missing format string to %s option\n"</span>, arrayArg[i]);
<a name="l01189"></a>01189         }
<a name="l01190"></a>01190         <span class="keywordflow">break</span>;
<a name="l01191"></a>01191       <span class="keywordflow">case</span> <span class="charliteral">'b'</span>: <span class="comment">// binary format</span>
<a name="l01192"></a>01192         <span class="keywordflow">if</span> (*(arrayArg[i]+2)==<span class="charliteral">'1'</span>) <span class="comment">// 8 bit format</span>
<a name="l01193"></a>01193           pFormat=<span class="stringliteral">"%b1"</span>;
<a name="l01194"></a>01194         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*(arrayArg[i]+2)==<span class="charliteral">'2'</span>) <span class="comment">// 16 bit format</span>
<a name="l01195"></a>01195           pFormat=<span class="stringliteral">"%b2"</span>;
<a name="l01196"></a>01196         <span class="keywordflow">else</span> <span class="comment">// 32 bit format</span>
<a name="l01197"></a>01197           pFormat=<span class="stringliteral">"%b4"</span>;
<a name="l01198"></a>01198         <span class="keywordflow">break</span>;
<a name="l01199"></a>01199       <span class="keywordflow">default</span>:
<a name="l01200"></a>01200         fprintf(stderr, <span class="stringliteral">"execReadCmd: unknown switch (\'%s\')\n"</span>, arrayArg[i]);
<a name="l01201"></a>01201       }
<a name="l01202"></a>01202     } <span class="keywordflow">else</span> {
<a name="l01203"></a>01203       <span class="keywordflow">if</span> (iMode != 8 &amp;&amp; <a class="code" href="mrshellprim_8c.html#fe29afcd7e0ed24611394b379523e597">getDecNumberFromArg</a>(arrayArg[i], &amp;iNofWords, 0)&gt;=0) {
<a name="l01204"></a>01204       }
<a name="l01205"></a>01205     }
<a name="l01206"></a>01206       }
<a name="l01207"></a>01207       <span class="keywordflow">if</span> (!fp) fp=stdout;
<a name="l01208"></a>01208       <span class="keywordflow">if</span> (iNofWords&gt;1) {
<a name="l01209"></a>01209     <span class="keywordtype">int</span> iBufferSize=iNofWords*<span class="keyword">sizeof</span>(__u32);
<a name="l01210"></a>01210     __u32* pData=(__u32*)malloc(iBufferSize);
<a name="l01211"></a>01211     <span class="keywordflow">if</span> (pData) {
<a name="l01212"></a>01212       memset(pData, 0, iBufferSize);
<a name="l01213"></a>01213       <span class="keywordflow">if</span> (iMode==0) {
<a name="l01214"></a>01214         iResult=<a class="code" href="group__dcsc__msg__buffer__access.html#g602216accce6913989f8b04b36157cd6">rcuMultipleRead</a>(address, iNofWords, pData);
<a name="l01215"></a>01215         <span class="keywordflow">if</span> (pFormat==0) pFormat=pFormatMultiRead;
<a name="l01216"></a>01216       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iMode==2) {
<a name="l01217"></a>01217         iResult=<a class="code" href="group__dcsc__msg__buffer__access.html#g24164f14711ead31a7e542711f0a08b3">rcuFlashRead</a>(address, iNofWords, pData);
<a name="l01218"></a>01218         <span class="keywordflow">if</span> (pFormat==0) pFormat=pFormatFlash;
<a name="l01219"></a>01219       } <span class="keywordflow">else</span>
<a name="l01220"></a>01220         fprintf(stderr, <span class="stringliteral">"internal error, wrong mode to execReadCmd (%d)\n"</span>, iMode);
<a name="l01221"></a>01221       <span class="keywordflow">if</span> (iResult&gt;0)
<a name="l01222"></a>01222         <a class="code" href="cmdInterpreter_8c.html#e3bcc6695f3c41940a8ab1f428101f07">printReadOutputFormatted</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)pData, iBufferSize, pFormat, address, fp);
<a name="l01223"></a>01223         <span class="comment">//printBufferHexFormatted((unsigned char*)pData, iBufferSize, 4, 4, address, NULL);</span>
<a name="l01224"></a>01224       free(pData);
<a name="l01225"></a>01225     } <span class="keywordflow">else</span> {
<a name="l01226"></a>01226       fprintf(stderr, <span class="stringliteral">"execReadCmd: internal error: memory allocation failed\n"</span>);
<a name="l01227"></a>01227       iResult=-ENOMEM;
<a name="l01228"></a>01228     }
<a name="l01229"></a>01229       } <span class="keywordflow">else</span> {
<a name="l01230"></a>01230     <span class="keywordflow">if</span> (pFormat==0) pFormat=pFormatSingleRead;
<a name="l01231"></a>01231       <span class="keywordflow">if</span> (iMode==0) 
<a name="l01232"></a>01232         iResult=<a class="code" href="group__dcsc__msg__buffer__access.html#g339b5922513d0f0211d7962234faa24f">rcuSingleRead</a>(address, &amp;data);
<a name="l01233"></a>01233       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iMode==2)
<a name="l01234"></a>01234         iResult=<a class="code" href="group__dcsc__msg__buffer__access.html#g24164f14711ead31a7e542711f0a08b3">rcuFlashRead</a>(address, 1, &amp;data);
<a name="l01235"></a>01235       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iMode==8)
<a name="l01236"></a>01236         iResult=<a class="code" href="group__selectmap__access.html#gf7536588344d4c30f928de00a240baa8">smRegisterRead</a>(address, &amp;data);
<a name="l01237"></a>01237       <span class="keywordflow">else</span> {
<a name="l01238"></a>01238         fprintf(stderr, <span class="stringliteral">"internal error, wrong mode to execReadCmd (%d)\n"</span>, iMode);
<a name="l01239"></a>01239         iResult=-EIO;
<a name="l01240"></a>01240       }
<a name="l01241"></a>01241     <span class="keywordflow">if</span> (iResult&gt;0)
<a name="l01242"></a>01242       <a class="code" href="cmdInterpreter_8c.html#e3bcc6695f3c41940a8ab1f428101f07">printReadOutputFormatted</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)&amp;data, 4, pFormat, address, fp);
<a name="l01243"></a>01243       <span class="comment">//printBufferHexFormatted((unsigned char*)&amp;data, 4, 4, 1, address, NULL);</span>
<a name="l01244"></a>01244       }
<a name="l01245"></a>01245     }
<a name="l01246"></a>01246   } <span class="keywordflow">else</span> {
<a name="l01247"></a>01247     iResult=-EINVAL;
<a name="l01248"></a>01248   }
<a name="l01249"></a>01249   <span class="keywordflow">return</span> iResult;
<a name="l01250"></a>01250 }
<a name="l01251"></a>01251 
<a name="l01252"></a><a class="code" href="cmdInterpreter_8c.html#ac7fb947e83d5813fb30995133f29955">01252</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#ac7fb947e83d5813fb30995133f29955">timedWait</a>(<span class="keywordtype">int</span> iWaitSec, <span class="keywordtype">int</span> iWaitMusec)
<a name="l01253"></a>01253 {
<a name="l01254"></a>01254   <span class="keywordtype">int</span> iResult=0;
<a name="l01255"></a>01255   <span class="comment">// this is maybe overdoing it a little</span>
<a name="l01256"></a>01256   <span class="keywordtype">int</span> iCurrSec=0;
<a name="l01257"></a>01257   <span class="keywordtype">int</span> iCurrMusec=0;
<a name="l01258"></a>01258   <span class="keywordtype">int</span> iTimer=<a class="code" href="mrtimers_8c.html#ccfd598b6f1a3ca5599e8bc3588d1cf7">startTimer</a>(0); <span class="comment">// timer of type ITIMER_REAL</span>
<a name="l01259"></a>01259   <span class="keywordflow">if</span> (iTimer&gt;0) {
<a name="l01260"></a>01260     <span class="keywordtype">int</span> iSleep=10;
<a name="l01261"></a>01261     <span class="keywordflow">if</span> (iWaitSec&gt;0) iSleep=500000;
<a name="l01262"></a>01262     <span class="keywordflow">else</span> iSleep=iWaitMusec/4;
<a name="l01263"></a>01263     <span class="keywordflow">do</span> {
<a name="l01264"></a>01264       usleep(iSleep);
<a name="l01265"></a>01265       iResult=<a class="code" href="mrtimers_8c.html#60a100d9612c31984637866c7e975958">getTimerValue</a>(iTimer, &amp;iCurrSec, &amp;iCurrMusec);
<a name="l01266"></a>01266       <span class="comment">//fprintf(stderr, "current timer val: %d sec  %d usec\n", iCurrSec, iCurrMusec);</span>
<a name="l01267"></a>01267     } <span class="keywordflow">while</span> (iResult&gt;=0 &amp;&amp; (iCurrSec&lt;iWaitSec || iCurrMusec&lt;iWaitMusec));
<a name="l01268"></a>01268     <a class="code" href="mrtimers_8c.html#fa991349587b8e300e5363a21dcee3b7">stopTimer</a>(iTimer);
<a name="l01269"></a>01269   } <span class="keywordflow">else</span> {
<a name="l01270"></a>01270     fprintf(stderr, <span class="stringliteral">"can not start timer, skip wait command\n"</span>);
<a name="l01271"></a>01271     iResult=-EACCES;
<a name="l01272"></a>01272   }
<a name="l01273"></a>01273   <span class="keywordflow">return</span> iResult;
<a name="l01274"></a>01274 }
<a name="l01275"></a>01275 
<a name="l01276"></a>01276 <span class="comment">/* termination handling</span>
<a name="l01277"></a>01277 <span class="comment">   called from SIGINT signal handler</span>
<a name="l01278"></a>01278 <span class="comment"> */</span>
<a name="l01279"></a><a class="code" href="cmdInterpreter_8c.html#0aee2ec97f7e88992f9b2b333ca99be2">01279</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#0aee2ec97f7e88992f9b2b333ca99be2">g_bBatchProcessing</a>=0;
<a name="l01280"></a><a class="code" href="cmdInterpreter_8h.html#ae37490e691f5b4d2c2e8f22713555da">01280</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#ae37490e691f5b4d2c2e8f22713555da">terminateBatchProcessing</a>() {
<a name="l01281"></a>01281   <span class="keywordtype">int</span> iResult=0;
<a name="l01282"></a>01282   <span class="keywordflow">if</span> (<a class="code" href="cmdInterpreter_8c.html#0aee2ec97f7e88992f9b2b333ca99be2">g_bBatchProcessing</a>&gt;0) {
<a name="l01283"></a>01283     iResult=1;
<a name="l01284"></a>01284     <a class="code" href="cmdInterpreter_8c.html#0aee2ec97f7e88992f9b2b333ca99be2">g_bBatchProcessing</a>=0;
<a name="l01285"></a>01285 <span class="preprocessor">#ifndef DCSC_TEST</span>
<a name="l01286"></a>01286 <span class="preprocessor"></span>    <span class="comment">// for some strange reason this output interferes with the time() function in the echo command</span>
<a name="l01287"></a>01287     <span class="comment">// this leads to a segfault on a redhat system although it works fine for the arm  </span>
<a name="l01288"></a>01288     fprintf(stderr, <span class="stringliteral">"\nterminating batch processing, please wait ...\n"</span>);
<a name="l01289"></a>01289 <span class="preprocessor">#endif //DCSC_TEST</span>
<a name="l01290"></a>01290 <span class="preprocessor"></span>  }
<a name="l01291"></a>01291   <span class="keywordflow">return</span> iResult;
<a name="l01292"></a>01292 }
<a name="l01293"></a>01293 
<a name="l01294"></a><a class="code" href="cmdInterpreter_8c.html#0977826c2ae8c6c45ccfcfa1843cf83c">01294</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#0977826c2ae8c6c45ccfcfa1843cf83c">execBatch</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg, <span class="keywordtype">int</span> iNofArgs)
<a name="l01295"></a>01295 {
<a name="l01296"></a>01296   <span class="keywordtype">int</span> iResult=0;
<a name="l01297"></a>01297   <span class="keywordflow">if</span> (arrayArg!=NULL &amp;&amp; iNofArgs&gt;0) {
<a name="l01298"></a>01298     FILE* fp=fopen(arrayArg[0], <span class="stringliteral">"r"</span>);
<a name="l01299"></a>01299     <span class="keywordflow">if</span> (fp) {
<a name="l01300"></a>01300       <span class="keyword">static</span> <span class="keywordtype">int</span> iInputBufferSize=100;
<a name="l01301"></a>01301       <span class="keywordtype">char</span> inputBuffer[iInputBufferSize];
<a name="l01302"></a>01302       <span class="keywordtype">int</span> iTimer=0;
<a name="l01303"></a>01303       <span class="keywordflow">if</span> (<a class="code" href="cmdInterpreter_8c.html#b1b44b602185677d4a2a372121627437">g_profiling</a>&gt;0) {
<a name="l01304"></a>01304     iTimer=<a class="code" href="mrtimers_8c.html#ccfd598b6f1a3ca5599e8bc3588d1cf7">startTimer</a>(0); <span class="comment">// timer of type ITIMER_REAL</span>
<a name="l01305"></a>01305     <span class="keywordflow">if</span> (iTimer==0)
<a name="l01306"></a>01306       fprintf(stderr, <span class="stringliteral">"can not start timer\n"</span>);
<a name="l01307"></a>01307       }
<a name="l01308"></a>01308       <span class="keywordtype">int</span> iWaitSec=0;
<a name="l01309"></a>01309       <span class="keywordtype">int</span> iWaitMusec=0;
<a name="l01310"></a>01310       <span class="keywordtype">int</span> iLoops=1;
<a name="l01311"></a>01311       <span class="keywordtype">int</span> bInfinite=0;
<a name="l01312"></a>01312       <span class="keywordtype">int</span> i=0;
<a name="l01313"></a>01313       <span class="comment">/* the verbosity handling has to be revised</span>
<a name="l01314"></a>01314 <span class="comment">     - local variable has to be initialized by the globel verbosity level</span>
<a name="l01315"></a>01315 <span class="comment">     - defines instead of numbers must be used </span>
<a name="l01316"></a>01316 <span class="comment">      */</span>
<a name="l01317"></a>01317       <span class="keywordtype">int</span> iVerbosity=2; <span class="comment">//VERBOSITY_HIGH</span>
<a name="l01318"></a>01318       <span class="keywordflow">for</span> (i=1; i&lt;iNofArgs; i++) {
<a name="l01319"></a>01319     <span class="keywordtype">int</span> bArgCheck=1;
<a name="l01320"></a>01320     <span class="keywordflow">if</span> (*arrayArg[i]==<span class="charliteral">'-'</span> &amp;&amp; *(arrayArg[i]+1)!=<span class="charliteral">'l'</span>) {
<a name="l01321"></a>01321       <span class="comment">// identify  options</span>
<a name="l01322"></a>01322       <span class="keywordflow">switch</span> (*(arrayArg[i]+1)) {
<a name="l01323"></a>01323       <span class="keywordflow">case</span> <span class="charliteral">'s'</span>: <span class="comment">// silent -&gt; verbosity=0</span>
<a name="l01324"></a>01324         iVerbosity=0; <span class="comment">// VERBOSITY_NONE</span>
<a name="l01325"></a>01325         <span class="keywordflow">break</span>;
<a name="l01326"></a>01326       <span class="keywordflow">case</span> <span class="charliteral">'v'</span>: <span class="comment">// verbosity</span>
<a name="l01327"></a>01327         <span class="keywordflow">if</span> ((bArgCheck=(iNofArgs&gt;i+1))==1) {
<a name="l01328"></a>01328           <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#fe29afcd7e0ed24611394b379523e597">getDecNumberFromArg</a>(arrayArg[++i], &amp;iVerbosity, 1)&lt;0) {
<a name="l01329"></a>01329           }
<a name="l01330"></a>01330         }
<a name="l01331"></a>01331         <span class="keywordflow">break</span>;
<a name="l01332"></a>01332       <span class="keywordflow">case</span> <span class="charliteral">'1'</span>:
<a name="l01333"></a>01333       <span class="keywordflow">case</span> <span class="charliteral">'i'</span>: <span class="comment">// ininite loop</span>
<a name="l01334"></a>01334         iLoops=-1;
<a name="l01335"></a>01335         <span class="keywordflow">break</span>;
<a name="l01336"></a>01336       <span class="keywordflow">case</span> <span class="charliteral">'w'</span>: <span class="comment">// read sleep parameters </span>
<a name="l01337"></a>01337         <span class="keywordflow">if</span> ((bArgCheck=(iNofArgs&gt;i+2))==1) {
<a name="l01338"></a>01338           <span class="keywordflow">if</span> (<a class="code" href="cmdInterpreter_8c.html#6ead18c93a106e1f1ba5871e908d9916">readTime</a>(&amp;arrayArg[i+1], 2, &amp;iWaitSec, &amp;iWaitMusec)&gt;=0) {
<a name="l01339"></a>01339           } <span class="keywordflow">else</span> {
<a name="l01340"></a>01340         fprintf(stderr, <span class="stringliteral">"execBatch: wrong argument format for \'%s\' switch, ignored\n"</span>, arrayArg[i]);
<a name="l01341"></a>01341           }
<a name="l01342"></a>01342           i+=2;
<a name="l01343"></a>01343         }
<a name="l01344"></a>01344         <span class="keywordflow">break</span>;
<a name="l01345"></a>01345       <span class="keywordflow">default</span>:
<a name="l01346"></a>01346         fprintf(stderr, <span class="stringliteral">"execBatch: unknown switch (\'%s\')\n"</span>, arrayArg[i]);
<a name="l01347"></a>01347       }
<a name="l01348"></a>01348     } <span class="keywordflow">else</span> {
<a name="l01349"></a>01349       <span class="keywordflow">if</span> (*arrayArg[i]==<span class="charliteral">'-'</span> &amp;&amp; *(arrayArg[i]+1)==<span class="charliteral">'l'</span>) {
<a name="l01350"></a>01350         <span class="keywordflow">if</span> ((bArgCheck=(iNofArgs&gt;i+1))==1) i++;
<a name="l01351"></a>01351       }
<a name="l01352"></a>01352       <span class="comment">// scan for the number of loops</span>
<a name="l01353"></a>01353       <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#fe29afcd7e0ed24611394b379523e597">getDecNumberFromArg</a>(arrayArg[i], &amp;iLoops, 0)&lt;0) {
<a name="l01354"></a>01354         fprintf(stderr, <span class="stringliteral">"execBatch: invalid argument, loop count expected (%s)\n"</span>, arrayArg[i]);
<a name="l01355"></a>01355         iLoops=1;
<a name="l01356"></a>01356       } 
<a name="l01357"></a>01357     }
<a name="l01358"></a>01358     <span class="keywordflow">if</span> (!bArgCheck) {
<a name="l01359"></a>01359       fprintf(stderr, <span class="stringliteral">"execBatch: missing argument for \'%s\' switch\n"</span>, arrayArg[i]);
<a name="l01360"></a>01360       iResult=-EINVAL;
<a name="l01361"></a>01361       i=iNofArgs;
<a name="l01362"></a>01362     }
<a name="l01363"></a>01363       }
<a name="l01364"></a>01364       <span class="keywordflow">if</span> (iResult&gt;=0) {
<a name="l01365"></a>01365     <span class="keywordflow">if</span> (iLoops&lt;0) {
<a name="l01366"></a>01366       bInfinite=1;
<a name="l01367"></a>01367       <span class="keywordflow">if</span> (iVerbosity&gt;=1<span class="comment">/*VERBOSITY_LOW*/</span>)
<a name="l01368"></a>01368         fprintf(stderr,<span class="stringliteral">"entering infinite loop, use CTRL-C to terminate\n"</span>);
<a name="l01369"></a>01369     }
<a name="l01370"></a>01370     <a class="code" href="cmdInterpreter_8c.html#0aee2ec97f7e88992f9b2b333ca99be2">g_bBatchProcessing</a>=1;
<a name="l01371"></a>01371     <span class="keywordflow">while</span> ((iLoops!=0) &amp;&amp; iResult&gt;=0) {
<a name="l01372"></a>01372       fseek(fp, 0, SEEK_SET);
<a name="l01373"></a>01373       <span class="keywordflow">while</span> (fgets(inputBuffer, iInputBufferSize, fp)!=NULL &amp;&amp; (iResult&gt;=0 || iResult==-ETIMEDOUT)) {
<a name="l01374"></a>01374         <span class="comment">//fprintf(stderr, "next line: (%d) %s\n", inputBuffer[0], inputBuffer);</span>
<a name="l01375"></a>01375         <span class="keywordflow">if</span> (inputBuffer[0]&gt;0) {
<a name="l01376"></a>01376           <a class="code" href="mrshellprim_8c.html#e8ed3396fcb78ea4adce3d902b77541a">removePrecAndTrailingSpecChars</a>(inputBuffer);
<a name="l01377"></a>01377           <span class="keywordtype">char</span>* pFound=strstr(inputBuffer, arrayArg[0]);
<a name="l01378"></a>01378           <span class="keywordflow">if</span> (inputBuffer[0]==<span class="charliteral">'b'</span> &amp;&amp; pFound!=NULL &amp;&amp; (pFound[strlen(arrayArg[0])]==0 || pFound[strlen(arrayArg[0])]==<span class="charliteral">' '</span>) ) { <span class="comment">// just to avoid endless iteration</span>
<a name="l01379"></a>01379         <span class="keywordflow">if</span> (iVerbosity&gt;=2<span class="comment">/*VERBOSITY_HIGH*/</span>)
<a name="l01380"></a>01380           fprintf(stderr,<span class="stringliteral">"skipping command %s\n"</span>, inputBuffer);
<a name="l01381"></a>01381           } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inputBuffer[0]&gt;15 &amp;&amp; inputBuffer[0]!=<span class="charliteral">'#'</span>) {
<a name="l01382"></a>01382         <span class="keywordflow">if</span> (iVerbosity&gt;=2<span class="comment">/*VERBOSITY_HIGH*/</span>)
<a name="l01383"></a>01383           fprintf(stderr,<span class="stringliteral">"executing: %s\n"</span>, inputBuffer);
<a name="l01384"></a>01384         iResult=<a class="code" href="cmdInterpreter_8c.html#48086998882e7d163126de4100aa12ac">executeCommandLine</a>(inputBuffer);
<a name="l01385"></a>01385         <span class="keywordflow">if</span> (iVerbosity&gt;=3<span class="comment">/*VERBOSITY_DEBUG*/</span>)
<a name="l01386"></a>01386           fprintf(stderr, <span class="stringliteral">"  result: %d\n"</span>, iResult);
<a name="l01387"></a>01387         <span class="keywordflow">if</span> (iResult==-EINTR) <span class="comment">// this was a terminated command, reset result</span>
<a name="l01388"></a>01388           iResult=0;
<a name="l01389"></a>01389           }
<a name="l01390"></a>01390         } <span class="keywordflow">else</span> {
<a name="l01391"></a>01391           <span class="keywordflow">break</span>;
<a name="l01392"></a>01392         }
<a name="l01393"></a>01393       }
<a name="l01394"></a>01394       <span class="keywordflow">if</span> (iResult&gt;=0 &amp;&amp; (iWaitSec&gt;0 || iWaitMusec&gt;0)) {
<a name="l01395"></a>01395         iResult=<a class="code" href="cmdInterpreter_8c.html#ac7fb947e83d5813fb30995133f29955">timedWait</a>(iWaitSec, iWaitMusec);
<a name="l01396"></a>01396       }
<a name="l01397"></a>01397       <span class="keywordflow">if</span> (bInfinite==0) iLoops--;
<a name="l01398"></a>01398       <span class="comment">// terminate on CTRL-C (SIGINT)</span>
<a name="l01399"></a>01399       <span class="keywordflow">if</span> (<a class="code" href="cmdInterpreter_8c.html#0aee2ec97f7e88992f9b2b333ca99be2">g_bBatchProcessing</a>==0) iLoops=0; 
<a name="l01400"></a>01400     }
<a name="l01401"></a>01401     <span class="keywordflow">if</span> (iResult&lt;0)
<a name="l01402"></a>01402       <span class="keywordflow">switch</span> (iResult) {
<a name="l01403"></a>01403       <span class="keywordflow">case</span> -ETIMEDOUT: <span class="keywordflow">break</span>;
<a name="l01404"></a>01404       <span class="keywordflow">case</span> -EIO: 
<a name="l01405"></a>01405         <span class="keywordflow">if</span> (inputBuffer[0]==<span class="charliteral">'?'</span>) {
<a name="l01406"></a>01406           fprintf(stderr, <span class="stringliteral">"batch processing aborted, check condition failed\n"</span>);
<a name="l01407"></a>01407           <span class="keywordflow">break</span>;
<a name="l01408"></a>01408         }
<a name="l01409"></a>01409       <span class="keywordflow">default</span>:
<a name="l01410"></a>01410         fprintf(stderr, <span class="stringliteral">"batch processing aborted, error %d\n"</span>, iResult);
<a name="l01411"></a>01411       }
<a name="l01412"></a>01412     <span class="keywordflow">if</span> (iTimer&gt;0) {
<a name="l01413"></a>01413       fprintf(stderr, <span class="stringliteral">"total time: %ssec\n"</span>, <a class="code" href="mrtimers_8c.html#eec88b57f56b75bdef646c5e44e0c2dc">getTimerValueString</a>(iTimer));
<a name="l01414"></a>01414       <a class="code" href="mrtimers_8c.html#fa991349587b8e300e5363a21dcee3b7">stopTimer</a>(iTimer);
<a name="l01415"></a>01415     }
<a name="l01416"></a>01416       }
<a name="l01417"></a>01417       fclose(fp);
<a name="l01418"></a>01418     } <span class="keywordflow">else</span> {
<a name="l01419"></a>01419       fprintf(stderr, <span class="stringliteral">"execBatch: can not open file %s\n"</span>, arrayArg[0]);
<a name="l01420"></a>01420     }
<a name="l01421"></a>01421   } <span class="keywordflow">else</span> {
<a name="l01422"></a>01422     iResult=-EINVAL;
<a name="l01423"></a>01423   }
<a name="l01424"></a>01424   <span class="keywordflow">return</span> iResult;
<a name="l01425"></a>01425 }
<a name="l01426"></a>01426 
<a name="l01427"></a><a class="code" href="cmdInterpreter_8c.html#083a182722ef62f10a68012ab6d7f707">01427</a> <a class="code" href="structArgDef__t.html">TArgDef</a> <a class="code" href="cmdInterpreter_8c.html#083a182722ef62f10a68012ab6d7f707">driverCtrlArgs</a>[] = {
<a name="l01428"></a>01428   {<span class="stringliteral">"i"</span>,<span class="stringliteral">"info"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#g919bc832f5a0e82c07cfafd699b1b2ea">printDriverInfo</a>}},{(<span class="keywordtype">void</span>*)1},<a class="code" href="mrshellprim_8h.html#fc218ec9b386341226b551419f3f624c">ARGDEF_BREAK</a>},
<a name="l01429"></a>01429   {<span class="stringliteral">"l"</span>,<span class="stringliteral">"lock"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#gb01774a452cb68f631a87d2d77ac79a5">dcscLockCtrl</a>}},{(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#ggbed82baf7f470b522273a3e37c24c600c0b7933997697a647dbfb83d828142f3">eLock</a>},<a class="code" href="mrshellprim_8h.html#fc218ec9b386341226b551419f3f624c">ARGDEF_BREAK</a>},
<a name="l01430"></a>01430   {<span class="stringliteral">"u"</span>,<span class="stringliteral">"unlock"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#gb01774a452cb68f631a87d2d77ac79a5">dcscLockCtrl</a>}},{(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#ggbed82baf7f470b522273a3e37c24c600fc021c4ba87bb9763ec7f4e07855d8f9">eUnlock</a>},ARGDEF_BREAK},
<a name="l01431"></a>01431   {<span class="stringliteral">"r"</span>,<span class="stringliteral">"reset"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#gb01774a452cb68f631a87d2d77ac79a5">dcscLockCtrl</a>}},{(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#ggbed82baf7f470b522273a3e37c24c600be8853084b74223aab7a0a0c8150eb5a">eDeactivateLock</a>},ARGDEF_BREAK},
<a name="l01432"></a>01432   {<span class="stringliteral">"a"</span>,<span class="stringliteral">"activate"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#gb01774a452cb68f631a87d2d77ac79a5">dcscLockCtrl</a>}},{(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#ggbed82baf7f470b522273a3e37c24c60052e15b8bac21d0241661e3caf289e745">eActivateLock</a>},ARGDEF_BREAK},
<a name="l01433"></a>01433   {NULL,<span class="stringliteral">"seize"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#gb01774a452cb68f631a87d2d77ac79a5">dcscLockCtrl</a>}},{(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#ggbed82baf7f470b522273a3e37c24c6001391714f3c5c8e7738e9b0e871dc3cce">eSeize</a>},ARGDEF_BREAK},
<a name="l01434"></a>01434   {NULL,<span class="stringliteral">"release"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#gb01774a452cb68f631a87d2d77ac79a5">dcscLockCtrl</a>}},{(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#ggbed82baf7f470b522273a3e37c24c6001349887513e044eb25dceda6bc2c9429">eRelease</a>},ARGDEF_BREAK},
<a name="l01435"></a>01435   {NULL,<span class="stringliteral">"debug"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a64d04be3dc94180a329fac904a5d239">eHex</a>, {NULL}},{NULL},ARGDEF_BREAK},
<a name="l01436"></a>01436   {<span class="stringliteral">""</span>,<span class="stringliteral">""</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a94b1781ada88507c56c4475f25fa92f">eUnknownType</a>, {NULL}},{NULL},<a class="code" href="mrshellprim_8h.html#ba7cfe65a42313488b4cfdf335409d39">ARGDEF_TERMINATE</a>},
<a name="l01437"></a>01437 };
<a name="l01438"></a>01438 
<a name="l01439"></a><a class="code" href="cmdInterpreter_8c.html#3e75245c450c10d2323442d359f053d7">01439</a> <a class="code" href="structFctArg__t.html">TFctArg</a> <a class="code" href="cmdInterpreter_8c.html#3e75245c450c10d2323442d359f053d7">driverCtrlDesc</a> = {
<a name="l01440"></a>01440   <a class="code" href="cmdInterpreter_8c.html#083a182722ef62f10a68012ab6d7f707">driverCtrlArgs</a>,
<a name="l01441"></a>01441   NULL,
<a name="l01442"></a>01442   NULL
<a name="l01443"></a>01443 };
<a name="l01444"></a>01444 
<a name="l01445"></a><a class="code" href="cmdInterpreter_8c.html#4a4e70ab937646237dbd0f0db81cdd99">01445</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#4a4e70ab937646237dbd0f0db81cdd99">driverCtrlCmds</a>(<a class="code" href="structArgDef__t.html">TArgDef</a>* pDef, <span class="keywordtype">void</span>* pUser, FILE* pOut)
<a name="l01446"></a>01446 {
<a name="l01447"></a>01447   <span class="comment">/* this function is only necessary as long as the eFctHexArgs is not implemented</span>
<a name="l01448"></a>01448 <span class="comment">   */</span>
<a name="l01449"></a>01449   <span class="keywordtype">int</span> iResult=0;
<a name="l01450"></a>01450   <span class="keywordflow">if</span> (pDef) {
<a name="l01451"></a>01451     <span class="keywordtype">int</span> iInt=0;
<a name="l01452"></a>01452     <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8h.html#abf55ec262e818b9d10781bbb71f18b1">ARGPROC_EXISTS</a>(<a class="code" href="mrshellprim_8c.html#c08c7b1e961204b98f9b29120f043c6c">mrShellPrimGetHex</a>(pDef, <span class="stringliteral">"debug"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>*)&amp;iInt))) { <span class="comment">// flags only 16 bit, can use same variable</span>
<a name="l01453"></a>01453       iResult=<a class="code" href="group__dcsc__msg__buffer__access.html#g8dc96e96fb45e86a27c98fbe8d816edf">dcscDriverDebug</a>(iInt);
<a name="l01454"></a>01454     }
<a name="l01455"></a>01455   }
<a name="l01456"></a>01456   <span class="keywordflow">return</span> iResult;
<a name="l01457"></a>01457 }
<a name="l01458"></a>01458 
<a name="l01459"></a><a class="code" href="cmdInterpreter_8c.html#11ec76f8e60016409f2f33d10c70ef7e">01459</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#11ec76f8e60016409f2f33d10c70ef7e">executeMainCommands</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* currentArg, <span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg, <span class="keywordtype">int</span> iNofArgs, <span class="keywordtype">void</span>* pUser, FILE* pOut)
<a name="l01460"></a>01460 {
<a name="l01461"></a>01461   <span class="keywordtype">int</span> iResult=0;
<a name="l01462"></a>01462   <span class="keywordtype">int</span> i=0;
<a name="l01463"></a>01463   <span class="keywordflow">if</span> (iNofArgs&gt;0 &amp;&amp; arrayArg) {
<a name="l01464"></a>01464     <span class="keywordflow">if</span> (<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0)&amp;<a class="code" href="mrshellprim_8h.html#13095cc00efe5276cf7a1794f0f8b7e5">DBG_ARGUMENT_CONVERT</a>) {
<a name="l01465"></a>01465       fprintf(stderr, <span class="stringliteral">"executeCommandArgs: %d argument(s): "</span>, iNofArgs);
<a name="l01466"></a>01466       <span class="keywordflow">for</span> (i=0; i&lt;iNofArgs; i++) {
<a name="l01467"></a>01467     fprintf(stderr, <span class="stringliteral">"%p (%s) "</span>, arrayArg[i], arrayArg[i]);
<a name="l01468"></a>01468       }
<a name="l01469"></a>01469       fprintf(stderr, <span class="stringliteral">"\n"</span>);
<a name="l01470"></a>01470     }
<a name="l01471"></a>01471     <span class="keywordflow">switch</span> (*arrayArg[0]) {
<a name="l01472"></a>01472 
<a name="l01473"></a>01473     <span class="comment">// print help</span>
<a name="l01474"></a>01474     <span class="comment">// h          - main help</span>
<a name="l01475"></a>01475     <span class="comment">// hd         - debug help</span>
<a name="l01476"></a>01476     <span class="comment">// hd &lt;level&gt; - extended debug help</span>
<a name="l01477"></a>01477     <span class="comment">// hr         - read command help</span>
<a name="l01478"></a>01478     <span class="comment">// hb         - batch command help</span>
<a name="l01479"></a>01479     <span class="keywordflow">case</span> <span class="charliteral">'h'</span>:
<a name="l01480"></a>01480       <span class="keywordflow">if</span> (*(arrayArg[0]+1)==<span class="charliteral">'d'</span>) {
<a name="l01481"></a>01481     <span class="keywordtype">int</span> iLevel=0;
<a name="l01482"></a>01482     <span class="keywordflow">if</span> (iNofArgs&gt;1) <a class="code" href="mrshellprim_8c.html#fe29afcd7e0ed24611394b379523e597">getDecNumberFromArg</a>(arrayArg[1], &amp;iLevel, 0);
<a name="l01483"></a>01483     <a class="code" href="cmdInterpreter_8c.html#15843554cb32ffb674f4245cfe5ee524">printDebugHelp</a>(iLevel);
<a name="l01484"></a>01484       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*(arrayArg[0]+1)==<span class="charliteral">'r'</span>) {
<a name="l01485"></a>01485     <a class="code" href="cmdInterpreter_8c.html#17ba9ebf0687897855a7c95f19e99c3d">printReadHelp</a>();
<a name="l01486"></a>01486       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*(arrayArg[0]+1)==<span class="charliteral">'b'</span>) {
<a name="l01487"></a>01487     <a class="code" href="cmdInterpreter_8c.html#c744cdcd05bdccf013ccbc82daa2282a">printBatchProcHelp</a>();
<a name="l01488"></a>01488       }
<a name="l01489"></a>01489       <span class="keywordflow">else</span>
<a name="l01490"></a>01490     <a class="code" href="cmdInterpreter_8c.html#f03f7609a66def2e7fae02a477c38d97">printHelp</a>();
<a name="l01491"></a>01491       <span class="keywordflow">break</span>;
<a name="l01492"></a>01492 
<a name="l01493"></a>01493     <span class="comment">// switching of debug flags</span>
<a name="l01494"></a>01494     <span class="keywordflow">case</span> <span class="charliteral">'+'</span>:
<a name="l01495"></a>01495     <span class="keywordflow">case</span> <span class="charliteral">'-'</span>:
<a name="l01496"></a>01496       {
<a name="l01497"></a>01497     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iDbgOption=0;
<a name="l01498"></a>01498     <span class="keywordtype">int</span> iDbgFlag=1; <span class="comment">// controls printing of the debug flags after the command interpretation </span>
<a name="l01499"></a>01499     <span class="keywordflow">if</span> (*arrayArg[0]==<span class="charliteral">'-'</span> &amp;&amp; *(arrayArg[0]+1)!=0) {
<a name="l01500"></a>01500       printf(<span class="stringliteral">"warning: you should check the command syntax, \n\'-\' is intended for switching debug flags\ntry \'%s\' instead of \'%s\'!\n"</span>, arrayArg[0]+1, arrayArg[0]);
<a name="l01501"></a>01501     } <span class="keywordflow">else</span> {
<a name="l01502"></a>01502       <span class="keywordflow">if</span> (iNofArgs&gt;1) {
<a name="l01503"></a>01503         <span class="comment">// check for 'profile' keyword</span>
<a name="l01504"></a>01504         <span class="keywordflow">if</span> (strcmp(arrayArg[1], <a class="code" href="cmdInterpreter_8c.html#c880e8e94aca75337b987af06141dcaa">CMD_STRING_PROFILE</a>)==0) {
<a name="l01505"></a>01505           iDbgFlag=0;<span class="comment">// supress message on debug flag status below</span>
<a name="l01506"></a>01506           <span class="keywordflow">if</span> (*arrayArg[0]==<span class="charliteral">'+'</span>) {
<a name="l01507"></a>01507         <a class="code" href="cmdInterpreter_8c.html#b1b44b602185677d4a2a372121627437">g_profiling</a>=1;
<a name="l01508"></a>01508         printf(<span class="stringliteral">"switching on profiling\n"</span>);
<a name="l01509"></a>01509           } <span class="keywordflow">else</span> {
<a name="l01510"></a>01510         <a class="code" href="cmdInterpreter_8c.html#b1b44b602185677d4a2a372121627437">g_profiling</a>=0;
<a name="l01511"></a>01511         printf(<span class="stringliteral">"switching off profiling\n"</span>);
<a name="l01512"></a>01512           }
<a name="l01513"></a>01513           <span class="comment">// check for 'timerdbg' keyword</span>
<a name="l01514"></a>01514         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(arrayArg[1], <a class="code" href="cmdInterpreter_8c.html#5d86dae553f9c8b404487c4f1d3592df">CMD_STRING_MRT_DEBUG</a>)==0) {
<a name="l01515"></a>01515           iDbgFlag=0;<span class="comment">// supress message on debug flag status below</span>
<a name="l01516"></a>01516           <span class="keywordflow">if</span> (iNofArgs&gt;2 &amp;&amp; <a class="code" href="mrshellprim_8c.html#0244dae55f177bb00bfae3a0a39f6f5a">getHexNumberFromArg</a>(arrayArg[2], &amp;iDbgOption, 0)&gt;=0) {
<a name="l01517"></a>01517         <span class="keywordflow">if</span> (*arrayArg[0]==<span class="charliteral">'+'</span>) {
<a name="l01518"></a>01518           iResult=<a class="code" href="mrtimers_8c.html#42192584a948fab8215173b75a4991b7">setMRTimerDebugFlag</a>(iDbgOption);
<a name="l01519"></a>01519         } <span class="keywordflow">else</span> {
<a name="l01520"></a>01520           iResult=<a class="code" href="mrtimers_8c.html#53329aecf5a990cc91ae4355794f32ed">clearMRTimerDebugFlag</a>(iDbgOption);
<a name="l01521"></a>01521         }
<a name="l01522"></a>01522         printf(<span class="stringliteral">"timer debug flags: %#x\n"</span>, iResult);
<a name="l01523"></a>01523           } <span class="keywordflow">else</span> {
<a name="l01524"></a>01524         iResult=-EINVAL;
<a name="l01525"></a>01525           }
<a name="l01526"></a>01526           <span class="comment">// read the flag</span>
<a name="l01527"></a>01527         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#0244dae55f177bb00bfae3a0a39f6f5a">getHexNumberFromArg</a>(arrayArg[1], &amp;iDbgOption, 0)&gt;=0) { 
<a name="l01528"></a>01528           <span class="keywordflow">if</span> (*arrayArg[0]==<span class="charliteral">'+'</span>)
<a name="l01529"></a>01529         iResult=<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>((<span class="keywordtype">int</span>)iDbgOption);
<a name="l01530"></a>01530           <span class="keywordflow">else</span>
<a name="l01531"></a>01531         iResult=<a class="code" href="group__dcsc__msg__buffer__access.html#g41201fc4dd5608bce4261b34eec28ca4">clearDebugOptionFlag</a>((<span class="keywordtype">int</span>)iDbgOption);
<a name="l01532"></a>01532         }
<a name="l01533"></a>01533       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*arrayArg[0]==<span class="charliteral">'-'</span>) {
<a name="l01534"></a>01534         iResult=<a class="code" href="group__dcsc__msg__buffer__access.html#gc07186b103fbe4c39531665c95e22c7e">setDebugOptions</a>(0);
<a name="l01535"></a>01535       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*arrayArg[0]==<span class="charliteral">'+'</span>) {
<a name="l01536"></a>01536         iResult=<a class="code" href="group__dcsc__msg__buffer__access.html#gc07186b103fbe4c39531665c95e22c7e">setDebugOptions</a>(<a class="code" href="group__dcsc__msg__buffer__access.html#gf34c3c30400c83a97dd0deadaead479c">DBG_DEFAULT</a>);
<a name="l01537"></a>01537       }
<a name="l01538"></a>01538       <span class="keywordflow">if</span> (iResult&gt;=0 &amp;&amp; iDbgFlag&gt;0)
<a name="l01539"></a>01539         printf(<span class="stringliteral">"debug options: 0x%x\n"</span>, iResult);
<a name="l01540"></a>01540     }
<a name="l01541"></a>01541       }
<a name="l01542"></a>01542       <span class="keywordflow">break</span>;
<a name="l01543"></a>01543 
<a name="l01544"></a>01544     <span class="comment">// command, substituted with w address 0x0</span>
<a name="l01545"></a>01545     <span class="keywordflow">case</span> <span class="charliteral">'c'</span>:
<a name="l01546"></a>01546       <span class="keywordflow">if</span> (iNofArgs&gt;1) {
<a name="l01547"></a>01547     <span class="keywordflow">if</span> (*(arrayArg[0]+1)==0 || strcmp(arrayArg[0], <span class="stringliteral">"command"</span>)==0) {
<a name="l01548"></a>01548       <span class="keyword">const</span> <span class="keywordtype">char</span>* tempArgs[2];
<a name="l01549"></a>01549       tempArgs[0]=arrayArg[1];
<a name="l01550"></a>01550       tempArgs[1]=<span class="stringliteral">"0x0"</span>;
<a name="l01551"></a>01551       iResult=<a class="code" href="cmdInterpreter_8c.html#6f67c6327e24c23440e0fdf83d06e41d">execWriteCmd</a>(tempArgs, 2, 0);
<a name="l01552"></a>01552     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strcmp(arrayArg[0], <span class="stringliteral">"checkmsgbuf"</span>)==0) {
<a name="l01553"></a>01553       iResult=<a class="code" href="cmdInterpreter_8c.html#6f67c6327e24c23440e0fdf83d06e41d">execWriteCmd</a>(arrayArg+1, iNofArgs-1, 1);
<a name="l01554"></a>01554     }
<a name="l01555"></a>01555       }
<a name="l01556"></a>01556       <span class="keywordflow">break</span>;
<a name="l01557"></a>01557 
<a name="l01558"></a>01558     <span class="comment">// the write and the wait command command</span>
<a name="l01559"></a>01559     <span class="keywordflow">case</span> <span class="charliteral">'w'</span>:
<a name="l01560"></a>01560       <span class="keywordflow">if</span> (iNofArgs&gt;1) {
<a name="l01561"></a>01561     <span class="keywordflow">if</span> (*(arrayArg[0]+1)==0 || strcmp(arrayArg[0], <span class="stringliteral">"write"</span>)==0) {
<a name="l01562"></a>01562       <span class="comment">// the write command</span>
<a name="l01563"></a>01563       iResult=<a class="code" href="cmdInterpreter_8c.html#6f67c6327e24c23440e0fdf83d06e41d">execWriteCmd</a>(arrayArg+1, iNofArgs-1, 0);
<a name="l01564"></a>01564     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(arrayArg[0], <span class="stringliteral">"wait"</span>)==0) {
<a name="l01565"></a>01565       <span class="comment">// the wait command</span>
<a name="l01566"></a>01566       <span class="keywordtype">int</span> iWaitSec=0;
<a name="l01567"></a>01567       <span class="keywordtype">int</span> iWaitMusec=0;
<a name="l01568"></a>01568       <span class="keywordflow">if</span> (iNofArgs&gt;=3) {
<a name="l01569"></a>01569         <span class="keywordflow">if</span> ((iResult=<a class="code" href="cmdInterpreter_8c.html#6ead18c93a106e1f1ba5871e908d9916">readTime</a>(arrayArg+1, 2, &amp;iWaitSec, &amp;iWaitMusec))&gt;=0) {
<a name="l01570"></a>01570           <span class="comment">//fprintf(stderr, "wait: %d sec  %d usec\n", iWaitSec, iWaitMusec);</span>
<a name="l01571"></a>01571           iResult=<a class="code" href="cmdInterpreter_8c.html#ac7fb947e83d5813fb30995133f29955">timedWait</a>(iWaitSec, iWaitMusec);
<a name="l01572"></a>01572         }
<a name="l01573"></a>01573       } <span class="keywordflow">else</span> {
<a name="l01574"></a>01574         iResult=-EINVAL;
<a name="l01575"></a>01575       }
<a name="l01576"></a>01576     } <span class="keywordflow">else</span> {
<a name="l01577"></a>01577       iResult=-EINVAL;
<a name="l01578"></a>01578     }
<a name="l01579"></a>01579       }
<a name="l01580"></a>01580       <span class="keywordflow">else</span>
<a name="l01581"></a>01581     iResult=-EINVAL;
<a name="l01582"></a>01582       <span class="keywordflow">break</span>;
<a name="l01583"></a>01583 
<a name="l01584"></a>01584     <span class="comment">// the read command</span>
<a name="l01585"></a>01585     <span class="keywordflow">case</span> <span class="charliteral">'r'</span>:
<a name="l01586"></a>01586       <span class="keywordflow">if</span> (iNofArgs&gt;1)
<a name="l01587"></a>01587     iResult=<a class="code" href="cmdInterpreter_8c.html#a7c39db1bcd241c2ae5f259c0281abb6">execReadCmd</a>(arrayArg+1, iNofArgs-1, 0);
<a name="l01588"></a>01588       <span class="keywordflow">else</span>
<a name="l01589"></a>01589     iResult=-EINVAL;
<a name="l01590"></a>01590       <span class="keywordflow">break</span>;
<a name="l01591"></a>01591 
<a name="l01592"></a>01592     <span class="comment">// batch processing</span>
<a name="l01593"></a>01593     <span class="keywordflow">case</span> <span class="charliteral">'b'</span>:
<a name="l01594"></a>01594       <span class="keywordflow">if</span> (iNofArgs&gt;1)
<a name="l01595"></a>01595     iResult=<a class="code" href="cmdInterpreter_8c.html#0977826c2ae8c6c45ccfcfa1843cf83c">execBatch</a>(arrayArg+1, iNofArgs-1);
<a name="l01596"></a>01596       <span class="keywordflow">else</span>
<a name="l01597"></a>01597     iResult=-EINVAL;
<a name="l01598"></a>01598       <span class="keywordflow">break</span>;
<a name="l01599"></a>01599 
<a name="l01600"></a>01600     <span class="comment">// waiting for conditions</span>
<a name="l01601"></a>01601     <span class="keywordflow">case</span> <span class="charliteral">'?'</span>:
<a name="l01602"></a>01602       iResult=<a class="code" href="cmdInterpreter_8c.html#a78c9a935a342b0b7b9a3c9896c5e85b">waitCondition</a>(arrayArg+1, iNofArgs-1);
<a name="l01603"></a>01603       <span class="keywordflow">break</span>;
<a name="l01604"></a>01604 
<a name="l01605"></a>01605       <span class="comment">/* the old memory check, deprecated</span>
<a name="l01606"></a>01606 <span class="comment">      case 'm':</span>
<a name="l01607"></a>01607 <span class="comment">      if (sscanf(pCmdLine+1, " 0x%x 0x%x", &amp;address, &amp;data)==2) {</span>
<a name="l01608"></a>01608 <span class="comment">      memTestAddressBus(address, data);</span>
<a name="l01609"></a>01609 <span class="comment">      memTestDevice(address, data);</span>
<a name="l01610"></a>01610 <span class="comment">      } else {</span>
<a name="l01611"></a>01611 <span class="comment">      printf("wrong format, try 'h' for help\n");</span>
<a name="l01612"></a>01612 <span class="comment">      }</span>
<a name="l01613"></a>01613 <span class="comment">      break;</span>
<a name="l01614"></a>01614 <span class="comment">    */</span>
<a name="l01615"></a>01615 
<a name="l01616"></a>01616     <span class="comment">// echo: print a message</span>
<a name="l01617"></a>01617     <span class="keywordflow">case</span> <span class="charliteral">'e'</span>:
<a name="l01618"></a>01618       {
<a name="l01619"></a>01619     <span class="keywordtype">int</span> i=0;
<a name="l01620"></a>01620     FILE* fp=stdout; <span class="comment">// make sure to change down as well if you change this default</span>
<a name="l01621"></a>01621     <span class="keywordflow">for</span> (i=1; i&lt;iNofArgs; i++) {
<a name="l01622"></a>01622       <span class="keyword">const</span> <span class="keywordtype">char</span>* pArg=NULL;
<a name="l01623"></a>01623       <span class="keywordflow">if</span> (*arrayArg[i]==<span class="charliteral">'-'</span>) {
<a name="l01624"></a>01624         <span class="keywordflow">switch</span> (*(arrayArg[i]+1)) {
<a name="l01625"></a>01625         <span class="keywordflow">case</span> <span class="charliteral">'o'</span>: <span class="comment">// write output to file</span>
<a name="l01626"></a>01626         <span class="keywordflow">case</span> <span class="charliteral">'a'</span>: <span class="comment">// append output to file</span>
<a name="l01627"></a>01627           <span class="keywordflow">if</span> (iNofArgs&gt;i+1) {
<a name="l01628"></a>01628         <span class="keyword">const</span> <span class="keywordtype">char</span> * strMode = <span class="stringliteral">"w"</span>;
<a name="l01629"></a>01629         <span class="keywordflow">if</span> (*(arrayArg[i]+1)==<span class="charliteral">'a'</span>) strMode=<span class="stringliteral">"a"</span>;
<a name="l01630"></a>01630         fp = fopen(arrayArg[++i], strMode);
<a name="l01631"></a>01631         <span class="keywordflow">if</span> (fp==NULL)
<a name="l01632"></a>01632           fprintf(stderr, <span class="stringliteral">"can not open file %s for writing\n"</span>, arrayArg[i]);
<a name="l01633"></a>01633           } <span class="keywordflow">else</span> {
<a name="l01634"></a>01634         fprintf(stderr, <span class="stringliteral">"missing file name to %s option\n"</span>, arrayArg[i]);
<a name="l01635"></a>01635           }
<a name="l01636"></a>01636           <span class="keywordflow">break</span>;
<a name="l01637"></a>01637         <span class="keywordflow">case</span> <span class="charliteral">'t'</span>: <span class="comment">// timestamp</span>
<a name="l01638"></a>01638           {
<a name="l01639"></a>01639         time_t currentTime;
<a name="l01640"></a>01640         time(&amp;currentTime);
<a name="l01641"></a>01641         <span class="keyword">const</span> <span class="keywordtype">int</span> iMaxChars=30;
<a name="l01642"></a>01642         <span class="keywordtype">char</span> strTime[iMaxChars+1];
<a name="l01643"></a>01643         memset(strTime, 0, iMaxChars+1);
<a name="l01644"></a>01644         strcpy(strTime, <span class="stringliteral">"blabla"</span>);
<a name="l01645"></a>01645         <span class="keywordflow">if</span> (strftime(strTime, iMaxChars, <span class="stringliteral">"%b %d %H:%M:%S %Y"</span>, localtime(&amp;currentTime))&gt;0) {
<a name="l01646"></a>01646           fprintf(fp, <span class="stringliteral">" %s"</span>, strTime);
<a name="l01647"></a>01647         }
<a name="l01648"></a>01648           }
<a name="l01649"></a>01649           <span class="keywordflow">break</span>;
<a name="l01650"></a>01650         <span class="keywordflow">default</span>:
<a name="l01651"></a>01651           pArg=arrayArg[i]+1;
<a name="l01652"></a>01652         }
<a name="l01653"></a>01653       } <span class="keywordflow">else</span> {
<a name="l01654"></a>01654         pArg=arrayArg[i];
<a name="l01655"></a>01655       }
<a name="l01656"></a>01656       <span class="keywordflow">if</span> (pArg) {
<a name="l01657"></a>01657         fprintf(fp, <span class="stringliteral">" %s"</span>, pArg);
<a name="l01658"></a>01658       }
<a name="l01659"></a>01659     }
<a name="l01660"></a>01660     <span class="keywordflow">if</span> (fp) {
<a name="l01661"></a>01661       fprintf(fp, <span class="stringliteral">"\n"</span>);
<a name="l01662"></a>01662       <span class="keywordflow">if</span> (fp!=stdout)
<a name="l01663"></a>01663         fclose(fp);
<a name="l01664"></a>01664     }
<a name="l01665"></a>01665       }
<a name="l01666"></a>01666       <span class="keywordflow">break</span>;
<a name="l01667"></a>01667     <span class="comment">//</span>
<a name="l01668"></a>01668     <span class="keywordflow">default</span>:
<a name="l01669"></a>01669       iResult=-ENOENT;
<a name="l01670"></a>01670     }
<a name="l01671"></a>01671   } <span class="keywordflow">else</span> {
<a name="l01672"></a>01672     iResult=-EINVAL;
<a name="l01673"></a>01673   }
<a name="l01674"></a>01674   <span class="keywordflow">return</span> iResult;
<a name="l01675"></a>01675 }
<a name="l01676"></a>01676 
<a name="l01677"></a><a class="code" href="cmdInterpreter_8c.html#587fc3f8784e8339c998d9ca71bd7e12">01677</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#587fc3f8784e8339c998d9ca71bd7e12">printFlashHelp</a>() {
<a name="l01678"></a>01678   printf(<span class="stringliteral">"  access to the RCU flash memory:\n"</span>);
<a name="l01679"></a>01679   printf(<span class="stringliteral">"  keyword \'flash\' followed by\n"</span>);
<a name="l01680"></a>01680   printf(<span class="stringliteral">"   enable  (e): enable access, this disables \'selectmap\' and \'message buffer\'\n"</span>);
<a name="l01681"></a>01681   printf(<span class="stringliteral">"   disable (d): disable access, switches back to \'message buffer\'\n"</span>);
<a name="l01682"></a>01682   printf(<span class="stringliteral">"   reset      : reset the flash\n"</span>);
<a name="l01683"></a>01683   printf(<span class="stringliteral">"   ctrldcs    : control via dcs board firmware (v2.2 or higher)\n"</span>);
<a name="l01684"></a>01684   printf(<span class="stringliteral">"   ctrlactel  : control via actel firmware (compatibility mode)\n"</span>);
<a name="l01685"></a>01685   printf(<span class="stringliteral">"   read    (r): read from the flash (format and options as rcu read)\n"</span>);
<a name="l01686"></a>01686   printf(<span class="stringliteral">"   write   (w): write to the flash (format and options as rcu write)\n"</span>);
<a name="l01687"></a>01687   printf(<span class="stringliteral">"   verify  (v): verify flash memory with file (format and options write)\n"</span>);
<a name="l01688"></a>01688   printf(<span class="stringliteral">"   id         : read the flash id\n"</span>);
<a name="l01689"></a>01689   printf(<span class="stringliteral">"   erase sector &lt;address&gt;        : erase sector &lt;address&gt;\n"</span>);
<a name="l01690"></a>01690   printf(<span class="stringliteral">"   erase sector &lt;address&gt; &lt;count&gt;: erase &lt;count&gt; sectors\n"</span>);
<a name="l01691"></a>01691   printf(<span class="stringliteral">"   erase all  :                     erase the whole flash\n"</span>);
<a name="l01692"></a>01692   
<a name="l01693"></a>01693   <span class="comment">//  printf("  \n");</span>
<a name="l01694"></a>01694   <span class="keywordflow">return</span> 0;
<a name="l01695"></a>01695 }
<a name="l01696"></a>01696 
<a name="l01697"></a><a class="code" href="cmdInterpreter_8c.html#765eadf200d9f408461f7469c791d22c">01697</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#765eadf200d9f408461f7469c791d22c">execFlashWriteCmd</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* currentArg, <span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg, <span class="keywordtype">int</span> iNofArgs, <span class="keywordtype">void</span>* pUser, FILE* pOut) 
<a name="l01698"></a>01698 {
<a name="l01699"></a>01699   <span class="keywordflow">if</span> (arrayArg &amp;&amp; iNofArgs&gt;0)
<a name="l01700"></a>01700     <span class="keywordflow">return</span> <a class="code" href="cmdInterpreter_8c.html#6f67c6327e24c23440e0fdf83d06e41d">execWriteCmd</a>(arrayArg+1, iNofArgs-1, 2);
<a name="l01701"></a>01701   <span class="keywordflow">return</span> -EINVAL;
<a name="l01702"></a>01702 }
<a name="l01703"></a>01703 
<a name="l01704"></a><a class="code" href="cmdInterpreter_8c.html#5df910c822508a5979806ec5d6548d65">01704</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#5df910c822508a5979806ec5d6548d65">execFlashVerifyCmd</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* currentArg, <span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg, <span class="keywordtype">int</span> iNofArgs, <span class="keywordtype">void</span>* pUser, FILE* pOut) 
<a name="l01705"></a>01705 {
<a name="l01706"></a>01706   <span class="keywordflow">if</span> (arrayArg &amp;&amp; iNofArgs&gt;0)
<a name="l01707"></a>01707     <span class="keywordflow">return</span> <a class="code" href="cmdInterpreter_8c.html#6f67c6327e24c23440e0fdf83d06e41d">execWriteCmd</a>(arrayArg+1, iNofArgs-1, 3);
<a name="l01708"></a>01708   <span class="keywordflow">return</span> -EINVAL;
<a name="l01709"></a>01709 }
<a name="l01710"></a>01710 
<a name="l01711"></a><a class="code" href="cmdInterpreter_8c.html#0069fb7612546c23d35da357dd126984">01711</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#0069fb7612546c23d35da357dd126984">execFlashReadCmd</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* currentArg, <span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg, <span class="keywordtype">int</span> iNofArgs, <span class="keywordtype">void</span>* pUser, FILE* pOut) 
<a name="l01712"></a>01712 {
<a name="l01713"></a>01713   <span class="keywordflow">if</span> (arrayArg &amp;&amp; iNofArgs&gt;0)
<a name="l01714"></a>01714     <span class="keywordflow">return</span> <a class="code" href="cmdInterpreter_8c.html#a7c39db1bcd241c2ae5f259c0281abb6">execReadCmd</a>(arrayArg+1, iNofArgs-1, 2);
<a name="l01715"></a>01715   <span class="keywordflow">return</span> -EINVAL;
<a name="l01716"></a>01716 }
<a name="l01717"></a>01717 
<a name="l01718"></a><a class="code" href="cmdInterpreter_8c.html#06be82b7d3ea06e8c4d3bc1aca1b63a1">01718</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#06be82b7d3ea06e8c4d3bc1aca1b63a1">execFlashEraseall</a>()
<a name="l01719"></a>01719 {
<a name="l01720"></a>01720   <span class="keywordflow">return</span> <a class="code" href="group__dcsc__msg__buffer__access.html#g78e6fc883a098cf548e9d0ba618ecb16">rcuFlashErase</a>(-1, 0);
<a name="l01721"></a>01721 }
<a name="l01722"></a>01722 
<a name="l01723"></a><a class="code" href="cmdInterpreter_8c.html#a4cd43e01e478de0f6dc0cec7ac6152b">01723</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#a4cd43e01e478de0f6dc0cec7ac6152b">execFlashErase</a>(<a class="code" href="structArgDef__t.html">TArgDef</a>* pDef, <span class="keywordtype">void</span>* pUser, FILE* pOut)
<a name="l01724"></a>01724 {
<a name="l01725"></a>01725   <span class="keywordtype">int</span> iResult=0;
<a name="l01726"></a>01726   <span class="keywordflow">if</span> (pDef) {
<a name="l01727"></a>01727     <span class="keywordtype">int</span> startsec=0;
<a name="l01728"></a>01728     <span class="keywordtype">int</span> count=1;
<a name="l01729"></a>01729     <span class="keywordtype">int</span> localRes=0;
<a name="l01730"></a>01730     <span class="comment">//    PrintArgumentDefinition(pDef, 1);</span>
<a name="l01731"></a>01731     <span class="keywordflow">if</span> ((localRes=<a class="code" href="mrshellprim_8c.html#8f73442602070f02c40b4b3e32ab61a3">mrShellPrimGetInt</a>(pDef, <span class="stringliteral">"all"</span>, &amp;startsec))&gt;=0 &amp;&amp; <a class="code" href="mrshellprim_8h.html#abf55ec262e818b9d10781bbb71f18b1">ARGPROC_EXISTS</a>(localRes) &amp;&amp; startsec==1) {
<a name="l01732"></a>01732       <span class="comment">//fprintf(stderr, "rcuFlashErase all\n");</span>
<a name="l01733"></a>01733       iResult=<a class="code" href="group__dcsc__msg__buffer__access.html#g78e6fc883a098cf548e9d0ba618ecb16">rcuFlashErase</a>(-1, 0);
<a name="l01734"></a>01734       startsec=-1;
<a name="l01735"></a>01735     } <span class="keywordflow">else</span> {
<a name="l01736"></a>01736       <span class="keywordflow">if</span> ((localRes=<a class="code" href="mrshellprim_8c.html#c08c7b1e961204b98f9b29120f043c6c">mrShellPrimGetHex</a>(pDef, <span class="stringliteral">"sector"</span>, &amp;startsec))&gt;=0 &amp;&amp; <a class="code" href="mrshellprim_8h.html#abf55ec262e818b9d10781bbb71f18b1">ARGPROC_EXISTS</a>(localRes)) {
<a name="l01737"></a>01737     <span class="keywordflow">if</span> ((localRes=<a class="code" href="mrshellprim_8c.html#8f73442602070f02c40b4b3e32ab61a3">mrShellPrimGetInt</a>(pDef, <span class="stringliteral">"_count"</span>, &amp;count))&lt;0 || !(<a class="code" href="mrshellprim_8h.html#abf55ec262e818b9d10781bbb71f18b1">ARGPROC_EXISTS</a>(localRes))) count=1;
<a name="l01738"></a>01738     <span class="comment">//fprintf(stderr, "rcuFlashErase startsec=%#x, count=%d\n", startsec, count);</span>
<a name="l01739"></a>01739     iResult=<a class="code" href="group__dcsc__msg__buffer__access.html#g78e6fc883a098cf548e9d0ba618ecb16">rcuFlashErase</a>(startsec, count);
<a name="l01740"></a>01740       }
<a name="l01741"></a>01741     }
<a name="l01742"></a>01742   }
<a name="l01743"></a>01743   <span class="keywordflow">return</span> iResult;
<a name="l01744"></a>01744 }
<a name="l01745"></a>01745 
<a name="l01746"></a><a class="code" href="cmdInterpreter_8c.html#a8f5aca148fba0272ac3acfee150f651">01746</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#a8f5aca148fba0272ac3acfee150f651">execSmWriteReg</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* currentArg, <span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg, <span class="keywordtype">int</span> iNofArgs, <span class="keywordtype">void</span>* pUser, FILE* pOut) 
<a name="l01747"></a>01747 {
<a name="l01748"></a>01748   <span class="keywordflow">if</span> (arrayArg &amp;&amp; iNofArgs&gt;0)
<a name="l01749"></a>01749     <span class="keywordflow">return</span> <a class="code" href="cmdInterpreter_8c.html#6f67c6327e24c23440e0fdf83d06e41d">execWriteCmd</a>(arrayArg+1, iNofArgs-1, 8);
<a name="l01750"></a>01750   <span class="keywordflow">return</span> -EINVAL;
<a name="l01751"></a>01751 }
<a name="l01752"></a>01752 
<a name="l01753"></a><a class="code" href="cmdInterpreter_8c.html#acf8d85528167524bef8a5e23b9ffd99">01753</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#acf8d85528167524bef8a5e23b9ffd99">execSmReadReg</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* currentArg, <span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg, <span class="keywordtype">int</span> iNofArgs, <span class="keywordtype">void</span>* pUser, FILE* pOut) 
<a name="l01754"></a>01754 {
<a name="l01755"></a>01755   <span class="keywordflow">if</span> (arrayArg &amp;&amp; iNofArgs&gt;0)
<a name="l01756"></a>01756     <span class="keywordflow">return</span> <a class="code" href="cmdInterpreter_8c.html#a7c39db1bcd241c2ae5f259c0281abb6">execReadCmd</a>(arrayArg+1, iNofArgs-1, 8);
<a name="l01757"></a>01757   <span class="keywordflow">return</span> -EINVAL;
<a name="l01758"></a>01758 }
<a name="l01759"></a>01759 
<a name="l01760"></a><a class="code" href="cmdInterpreter_8c.html#76b0a4b334ee64eb25b1637d709deb92">01760</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#76b0a4b334ee64eb25b1637d709deb92">printSelectmapHelp</a>() {
<a name="l01761"></a>01761   printf(<span class="stringliteral">"  access to the RCU FPGA via the select map interface:\n"</span>);
<a name="l01762"></a>01762   printf(<span class="stringliteral">"  keyword \'selectmap\' or \'sm\' followed by\n"</span>);
<a name="l01763"></a>01763   printf(<span class="stringliteral">"   enable        : enable access, this disable the flash and the msg buffer\n"</span>);
<a name="l01764"></a>01764   printf(<span class="stringliteral">"   disable       : disable access\n"</span>);
<a name="l01765"></a>01765   printf(<span class="stringliteral">"   read-reg  (rr): read register of the selectmap interface\n"</span>);
<a name="l01766"></a>01766   printf(<span class="stringliteral">"                   read-reg &lt;reg no&gt;\n"</span>);
<a name="l01767"></a>01767   printf(<span class="stringliteral">"   write-reg (wr): write register of the selectmap interface\n"</span>);
<a name="l01768"></a>01768   printf(<span class="stringliteral">"                   write-reg &lt;reg no&gt; 0x&lt;value&gt;\n"</span>);
<a name="l01769"></a>01769   <span class="comment">//  printf("  \n");</span>
<a name="l01770"></a>01770   <span class="keywordflow">return</span> 0;
<a name="l01771"></a>01771 }
<a name="l01772"></a>01772 
<a name="l01773"></a><a class="code" href="cmdInterpreter_8c.html#69279ab735c2dc7e0a73d9c0bfe44f20">01773</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#69279ab735c2dc7e0a73d9c0bfe44f20">printFirmwareHelp</a>() {
<a name="l01774"></a>01774   printf(<span class="stringliteral">"  DCS board firmware command group:\n"</span>);
<a name="l01775"></a>01775   printf(<span class="stringliteral">"  keyword \'firmware\' or \'fw\' followed by\n"</span>);
<a name="l01776"></a>01776   printf(<span class="stringliteral">"   reset        (r) :  triggers the reset sequence\n"</span>);
<a name="l01777"></a>01777   printf(<span class="stringliteral">"   read-reg     (rr):  read firmware register\n"</span>);
<a name="l01778"></a>01778   printf(<span class="stringliteral">"   write-reg    (wr):  write firmware register\n"</span>);
<a name="l01779"></a>01779   printf(<span class="stringliteral">"   enable-comp  (ec):  enable use of compressed data words\n"</span>);
<a name="l01780"></a>01780   printf(<span class="stringliteral">"   disable-comp (dc):  enable use of compressed data words\n"</span>);
<a name="l01781"></a>01781   <span class="comment">//  printf("  \n");</span>
<a name="l01782"></a>01782   <span class="keywordflow">return</span> 0;
<a name="l01783"></a>01783 }
<a name="l01784"></a>01784 
<a name="l01785"></a><a class="code" href="cmdInterpreter_8c.html#72ffcd5a8ec94bc388af9b6d9781f5de">01785</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#72ffcd5a8ec94bc388af9b6d9781f5de">execRegWriteCmd</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* currentArg, <span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg, <span class="keywordtype">int</span> iNofArgs, <span class="keywordtype">void</span>* pUser, FILE* pOut) 
<a name="l01786"></a>01786 {
<a name="l01787"></a>01787   <span class="keywordtype">int</span> regNo=0;
<a name="l01788"></a>01788   <span class="keywordtype">int</span> value=0;
<a name="l01789"></a>01789   <span class="keywordtype">int</span> iResult=-EINVAL;
<a name="l01790"></a>01790   <span class="keywordflow">if</span> (arrayArg &amp;&amp; iNofArgs&gt;2) {
<a name="l01791"></a>01791     <span class="keywordflow">if</span> ((<a class="code" href="mrshellprim_8c.html#fe29afcd7e0ed24611394b379523e597">getDecNumberFromArg</a>(arrayArg[1], &amp;regNo, 1)&gt;=0) &amp;&amp;
<a name="l01792"></a>01792     (<a class="code" href="mrshellprim_8c.html#0244dae55f177bb00bfae3a0a39f6f5a">getHexNumberFromArg</a>(arrayArg[2], &amp;value, 1)&gt;=0)) {
<a name="l01793"></a>01793       <span class="keywordflow">if</span> ((iResult=<a class="code" href="dcscMsgBufferInterface_8c.html#82e19c9d34c7ecebcba115d2a6393b6c">msgBufWriteRegister</a>(regNo, value))&lt;0) {
<a name="l01794"></a>01794     fprintf(stderr, <span class="stringliteral">"failed to write register %2d: %d\n"</span>, regNo, iResult);
<a name="l01795"></a>01795       }
<a name="l01796"></a>01796     }
<a name="l01797"></a>01797   }
<a name="l01798"></a>01798   <span class="keywordflow">return</span> iResult;
<a name="l01799"></a>01799 }
<a name="l01800"></a>01800 
<a name="l01801"></a><a class="code" href="cmdInterpreter_8c.html#371d348f7b5d98c0ad4e7d6d20deb65c">01801</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#371d348f7b5d98c0ad4e7d6d20deb65c">execRegReadCmd</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* currentArg, <span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg, <span class="keywordtype">int</span> iNofArgs, <span class="keywordtype">void</span>* pUser, FILE* pOut) 
<a name="l01802"></a>01802 {
<a name="l01803"></a>01803   <span class="keywordtype">int</span> regNo=0;
<a name="l01804"></a>01804   <span class="keywordtype">int</span> iResult=-EINVAL;
<a name="l01805"></a>01805   <span class="keywordflow">if</span> (arrayArg &amp;&amp; iNofArgs&gt;1) {
<a name="l01806"></a>01806     <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#fe29afcd7e0ed24611394b379523e597">getDecNumberFromArg</a>(arrayArg[1], &amp;regNo, 1)&gt;=0) {
<a name="l01807"></a>01807       <span class="keywordflow">if</span> ((iResult=<a class="code" href="dcscMsgBufferInterface_8c.html#7a5b0d57fbd0a68206468a01b0a63520">msgBufReadRegister</a>(regNo))&gt;=0) {
<a name="l01808"></a>01808     fprintf(stdout, <span class="stringliteral">"register %2d: %#x\n"</span>, regNo, iResult);
<a name="l01809"></a>01809     fflush(stdout);
<a name="l01810"></a>01810       }
<a name="l01811"></a>01811     }
<a name="l01812"></a>01812   }
<a name="l01813"></a>01813   <span class="keywordflow">return</span> iResult;
<a name="l01814"></a>01814 }
<a name="l01815"></a>01815 
<a name="l01816"></a><a class="code" href="cmdInterpreter_8c.html#7c4a53b4c0e418e7102cba28b663fbb5">01816</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#7c4a53b4c0e418e7102cba28b663fbb5">ctrlRegStatus</a>() {
<a name="l01817"></a>01817   <span class="keywordtype">int</span> iReg=<a class="code" href="group__dcsc__msg__buffer__access.html#gf74b29f8ded2feb57974c95e4863eac8">rcuBusControlCmd</a>(<a class="code" href="group__dcsc__msg__buffer__access.html#ggb04a0655cd1e3bcac5e8f48c18df1a57d3e958eb3b288db3f4942dd3a81c6087">eReadCtrlReg</a>);
<a name="l01818"></a>01818   <span class="keywordflow">if</span> (iReg&gt;=0) {
<a name="l01819"></a>01819     fprintf(stdout, <span class="stringliteral">"control register: %#x\n"</span>, iReg);
<a name="l01820"></a>01820   } <span class="keywordflow">else</span> {
<a name="l01821"></a>01821     fprintf(stderr, <span class="stringliteral">"ctrlRegStatus (%s) error: can not read control register (%d)\n"</span>, __FILE__, iReg);
<a name="l01822"></a>01822   }
<a name="l01823"></a>01823   <span class="keywordflow">return</span> 0;
<a name="l01824"></a>01824 }
<a name="l01825"></a>01825 
<a name="l01826"></a><a class="code" href="cmdInterpreter_8c.html#fbc09bb85c6e4618a38dba855c588abd">01826</a> <a class="code" href="structFctMode__t.html">TFctMode</a> <a class="code" href="cmdInterpreter_8c.html#fbc09bb85c6e4618a38dba855c588abd">scanModeDefault</a> = {<a class="code" href="mrshellprim_8h.html#3c911f1397ec09fbcc6a1feac53be850">SCANMODE_FORCE_TERMINATION</a>, NULL, NULL};
<a name="l01827"></a>01827 
<a name="l01828"></a><a class="code" href="cmdInterpreter_8c.html#4954a4ac4d6f82836d8b405a2ec86071">01828</a> <a class="code" href="structArgDef__t.html">TArgDef</a> <a class="code" href="cmdInterpreter_8c.html#4954a4ac4d6f82836d8b405a2ec86071">selectmapCmds</a>[] = {
<a name="l01829"></a>01829   {<span class="stringliteral">"e"</span>,<span class="stringliteral">"enable"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#gf74b29f8ded2feb57974c95e4863eac8">rcuBusControlCmd</a>}},{(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#ggb04a0655cd1e3bcac5e8f48c18df1a577b8222808ce70929afddb10c7855f13a">eEnableSelectmap</a>},<a class="code" href="mrshellprim_8h.html#ba7cfe65a42313488b4cfdf335409d39">ARGDEF_TERMINATE</a>},
<a name="l01830"></a>01830   {<span class="stringliteral">"d"</span>,<span class="stringliteral">"disable"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#gf74b29f8ded2feb57974c95e4863eac8">rcuBusControlCmd</a>}},{(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#ggb04a0655cd1e3bcac5e8f48c18df1a57e4c19a8b3abecb07f7e1a686e9e31b35">eDisableSelectmap</a>},ARGDEF_TERMINATE},
<a name="l01831"></a>01831   {<span class="stringliteral">"wr"</span>,<span class="stringliteral">"write-reg"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36b17c2f574c8a5697b118c8aa4a00bdad">eFctUserScan</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#a8f5aca148fba0272ac3acfee150f651">execSmWriteReg</a>}},{NULL},ARGDEF_TERMINATE},
<a name="l01832"></a>01832   {<span class="stringliteral">"rr"</span>,<span class="stringliteral">"read-reg"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36b17c2f574c8a5697b118c8aa4a00bdad">eFctUserScan</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#acf8d85528167524bef8a5e23b9ffd99">execSmReadReg</a>}},{NULL},ARGDEF_TERMINATE},
<a name="l01833"></a>01833   {<span class="stringliteral">"*"</span>,NULL,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3693da28770e1bd5abcff3bfab36328f85">eFctNoArg</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#76b0a4b334ee64eb25b1637d709deb92">printSelectmapHelp</a>}},{NULL},ARGDEF_TERMINATE},
<a name="l01834"></a>01834   {<span class="stringliteral">""</span>,<span class="stringliteral">""</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a94b1781ada88507c56c4475f25fa92f">eUnknownType</a>, {NULL}},{NULL},ARGDEF_TERMINATE},
<a name="l01835"></a>01835 };
<a name="l01836"></a>01836 
<a name="l01837"></a><a class="code" href="cmdInterpreter_8c.html#7399e2dab99f698c9275622762e94f74">01837</a> <a class="code" href="structArgDef__t.html">TArgDef</a> <a class="code" href="cmdInterpreter_8c.html#7399e2dab99f698c9275622762e94f74">flashEraseParams</a>[] = {
<a name="l01838"></a>01838   {NULL,<span class="stringliteral">"all"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b365461a9e2704387e11258e14a0b41ac1a">eBool</a>, {(<span class="keywordtype">void</span>*)0}},{(<span class="keywordtype">void</span>*)NULL},ARGDEF_BREAK},
<a name="l01839"></a>01839   {<span class="stringliteral">"sec"</span>,<span class="stringliteral">"sector"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a64d04be3dc94180a329fac904a5d239">eHex</a>, {(<span class="keywordtype">void</span>*)0}},{(<span class="keywordtype">void</span>*)NULL},0},
<a name="l01840"></a>01840   {NULL,<span class="stringliteral">"_count"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36dd647739976fe8f17c25e3fe04d30eeb">eInteger</a>, {(<span class="keywordtype">void</span>*)0}},{(<span class="keywordtype">void</span>*)NULL},<a class="code" href="mrshellprim_8h.html#c02c4c51c3c6ef7eddc4bd49a0f8df75">ARGDEF_RESUME</a>|<a class="code" href="mrshellprim_8h.html#9f63a516fdf6cc051373d525521dd03b">ARGDEF_KEYWORDLESS</a>},
<a name="l01841"></a>01841   {<span class="stringliteral">""</span>,<span class="stringliteral">""</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a94b1781ada88507c56c4475f25fa92f">eUnknownType</a>, {NULL}},{NULL},ARGDEF_TERMINATE},
<a name="l01842"></a>01842 };
<a name="l01843"></a>01843 
<a name="l01844"></a><a class="code" href="cmdInterpreter_8c.html#9a757fd68a4d59000e0938fcdb423996">01844</a> <a class="code" href="structFctArg__t.html">TFctArg</a> <a class="code" href="cmdInterpreter_8c.html#9a757fd68a4d59000e0938fcdb423996">flashEraseDesc</a> = {
<a name="l01845"></a>01845   <a class="code" href="cmdInterpreter_8c.html#7399e2dab99f698c9275622762e94f74">flashEraseParams</a>,
<a name="l01846"></a>01846   NULL,
<a name="l01847"></a>01847   NULL
<a name="l01848"></a>01848 };
<a name="l01849"></a>01849 
<a name="l01850"></a><a class="code" href="cmdInterpreter_8c.html#5a3ddbaacf0c338e408e3c0b55189d58">01850</a> <a class="code" href="structArgDef__t.html">TArgDef</a> <a class="code" href="cmdInterpreter_8c.html#5a3ddbaacf0c338e408e3c0b55189d58">flashCmds</a>[] = {
<a name="l01851"></a>01851   {<span class="stringliteral">"e"</span>,<span class="stringliteral">"enable"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#gf74b29f8ded2feb57974c95e4863eac8">rcuBusControlCmd</a>}},{(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#ggb04a0655cd1e3bcac5e8f48c18df1a573b9d25a6fa4e461b6eb1756217e2ccdd">eEnableFlash</a>},ARGDEF_TERMINATE},
<a name="l01852"></a>01852   {<span class="stringliteral">"d"</span>,<span class="stringliteral">"disable"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#gf74b29f8ded2feb57974c95e4863eac8">rcuBusControlCmd</a>}},{(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#ggb04a0655cd1e3bcac5e8f48c18df1a577c7ba96930a1249cc2049d4427fd9ac9">eDisableFlash</a>},ARGDEF_TERMINATE},
<a name="l01853"></a>01853   {NULL,<span class="stringliteral">"reset"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#gf74b29f8ded2feb57974c95e4863eac8">rcuBusControlCmd</a>}},{(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#ggb04a0655cd1e3bcac5e8f48c18df1a57fa0c1e1d2d3baba10b94f02c4b2c7f01">eResetFlash</a>},ARGDEF_TERMINATE},
<a name="l01854"></a>01854   {NULL,<span class="stringliteral">"id"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#gf74b29f8ded2feb57974c95e4863eac8">rcuBusControlCmd</a>}},{(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#ggb04a0655cd1e3bcac5e8f48c18df1a57298817c93fab57042b42b0c23d3efdc4">eFlashID</a>},ARGDEF_TERMINATE},
<a name="l01855"></a>01855   {NULL,<span class="stringliteral">"ctrldcs"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#gf74b29f8ded2feb57974c95e4863eac8">rcuBusControlCmd</a>}},{(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#ggb04a0655cd1e3bcac5e8f48c18df1a5756591b8d17f10234722790d952ed8781">eFlashCtrlDCS</a>},ARGDEF_TERMINATE},
<a name="l01856"></a>01856   {NULL,<span class="stringliteral">"ctrlactel"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#gf74b29f8ded2feb57974c95e4863eac8">rcuBusControlCmd</a>}},{(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#ggb04a0655cd1e3bcac5e8f48c18df1a574a96ce967a91331568455c580e4a2ca1">eFlashCtrlActel</a>},ARGDEF_TERMINATE},
<a name="l01857"></a>01857   {<span class="stringliteral">"w"</span>,<span class="stringliteral">"write"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36b17c2f574c8a5697b118c8aa4a00bdad">eFctUserScan</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#765eadf200d9f408461f7469c791d22c">execFlashWriteCmd</a>}},{NULL},ARGDEF_TERMINATE},
<a name="l01858"></a>01858   {<span class="stringliteral">"r"</span>,<span class="stringliteral">"read"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36b17c2f574c8a5697b118c8aa4a00bdad">eFctUserScan</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#0069fb7612546c23d35da357dd126984">execFlashReadCmd</a>}},{NULL},ARGDEF_TERMINATE},
<a name="l01859"></a>01859   {<span class="stringliteral">"v"</span>,<span class="stringliteral">"verify"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36b17c2f574c8a5697b118c8aa4a00bdad">eFctUserScan</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#5df910c822508a5979806ec5d6548d65">execFlashVerifyCmd</a>}},{NULL},ARGDEF_TERMINATE},
<a name="l01860"></a>01860   {NULL,<span class="stringliteral">"erase"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3607fd24779fbb8e0bc12b8241e0e436cc">eFctArgDef</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#a4cd43e01e478de0f6dc0cec7ac6152b">execFlashErase</a>}},{(<span class="keywordtype">void</span>*)&amp;<a class="code" href="cmdInterpreter_8c.html#9a757fd68a4d59000e0938fcdb423996">flashEraseDesc</a>},ARGDEF_TERMINATE},
<a name="l01861"></a>01861   {NULL,<span class="stringliteral">"eraseall"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3693da28770e1bd5abcff3bfab36328f85">eFctNoArg</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#06be82b7d3ea06e8c4d3bc1aca1b63a1">execFlashEraseall</a>}},{NULL},ARGDEF_TERMINATE},
<a name="l01862"></a>01862   {<span class="stringliteral">"*"</span>,NULL,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3693da28770e1bd5abcff3bfab36328f85">eFctNoArg</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#587fc3f8784e8339c998d9ca71bd7e12">printFlashHelp</a>}},{NULL},ARGDEF_TERMINATE},
<a name="l01863"></a>01863   {<span class="stringliteral">""</span>,<span class="stringliteral">""</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a94b1781ada88507c56c4475f25fa92f">eUnknownType</a>, {NULL}},{NULL},ARGDEF_TERMINATE},
<a name="l01864"></a>01864 };
<a name="l01865"></a>01865 
<a name="l01866"></a><a class="code" href="cmdInterpreter_8c.html#5a94aee581a390576806909f67968c30">01866</a> <a class="code" href="structArgDef__t.html">TArgDef</a> <a class="code" href="cmdInterpreter_8c.html#5a94aee581a390576806909f67968c30">firmwareCmds</a>[] = {
<a name="l01867"></a>01867   {<span class="stringliteral">"r"</span>,<span class="stringliteral">"reset"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#gf74b29f8ded2feb57974c95e4863eac8">rcuBusControlCmd</a>}},{(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#ggb04a0655cd1e3bcac5e8f48c18df1a5702c0aacdb67187c6b37d3a42cdf857cc">eResetFirmware</a>},ARGDEF_TERMINATE},
<a name="l01868"></a>01868   {<span class="stringliteral">"wr"</span>,<span class="stringliteral">"write-reg"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36b17c2f574c8a5697b118c8aa4a00bdad">eFctUserScan</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#72ffcd5a8ec94bc388af9b6d9781f5de">execRegWriteCmd</a>}},{NULL},ARGDEF_TERMINATE},
<a name="l01869"></a>01869   {<span class="stringliteral">"rr"</span>,<span class="stringliteral">"read-reg"</span>, {<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36b17c2f574c8a5697b118c8aa4a00bdad">eFctUserScan</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#371d348f7b5d98c0ad4e7d6d20deb65c">execRegReadCmd</a>}}, {NULL},ARGDEF_TERMINATE},
<a name="l01870"></a>01870   {<span class="stringliteral">"ec"</span>,<span class="stringliteral">"enable-comp"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#gf74b29f8ded2feb57974c95e4863eac8">rcuBusControlCmd</a>}},{(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#ggb04a0655cd1e3bcac5e8f48c18df1a57ec59997e5b2ac539cc85158012221f82">eEnableCompression</a>},ARGDEF_TERMINATE},
<a name="l01871"></a>01871   {<span class="stringliteral">"dc"</span>,<span class="stringliteral">"enable-comp"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#gf74b29f8ded2feb57974c95e4863eac8">rcuBusControlCmd</a>}},{(<span class="keywordtype">void</span>*)<a class="code" href="group__dcsc__msg__buffer__access.html#ggb04a0655cd1e3bcac5e8f48c18df1a57a371d588d9e5eb297b5e8c39d62bfe1c">eDisableCompression</a>},ARGDEF_TERMINATE},
<a name="l01872"></a>01872   {<span class="stringliteral">"*"</span>,NULL,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3693da28770e1bd5abcff3bfab36328f85">eFctNoArg</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#69279ab735c2dc7e0a73d9c0bfe44f20">printFirmwareHelp</a>}},{NULL},ARGDEF_TERMINATE},
<a name="l01873"></a>01873   {<span class="stringliteral">""</span>,<span class="stringliteral">""</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a94b1781ada88507c56c4475f25fa92f">eUnknownType</a>, {NULL}},{NULL},ARGDEF_TERMINATE},
<a name="l01874"></a>01874 };
<a name="l01875"></a>01875 
<a name="l01876"></a><a class="code" href="cmdInterpreter_8c.html#c1784239c15c2f1b5b4f1dbda9df65e7">01876</a> <a class="code" href="structArgDef__t.html">TArgDef</a> <a class="code" href="cmdInterpreter_8c.html#c1784239c15c2f1b5b4f1dbda9df65e7">ctrlRegCmds</a>[] = {
<a name="l01877"></a>01877   {<span class="stringliteral">""</span>,<span class="stringliteral">""</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a94b1781ada88507c56c4475f25fa92f">eUnknownType</a>, {NULL}},{NULL},ARGDEF_TERMINATE},
<a name="l01878"></a>01878 };
<a name="l01879"></a>01879 
<a name="l01880"></a><a class="code" href="cmdInterpreter_8c.html#014d78494c13d4dc0430ee68de158559">01880</a> <a class="code" href="structArgDef__t.html">TArgDef</a> <a class="code" href="cmdInterpreter_8c.html#014d78494c13d4dc0430ee68de158559">mainCommands</a>[] = {
<a name="l01881"></a>01881   {<span class="stringliteral">"sm"</span>,<span class="stringliteral">"selectmap"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36b36d09249e94b5aa513d0aa3c7aa08c8">eFctRemaining</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#4954a4ac4d6f82836d8b405a2ec86071">selectmapCmds</a>}},{(<span class="keywordtype">void</span>*)&amp;<a class="code" href="cmdInterpreter_8c.html#fbc09bb85c6e4618a38dba855c588abd">scanModeDefault</a>},ARGDEF_TERMINATE},
<a name="l01882"></a>01882   {NULL,<span class="stringliteral">"flash"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36b36d09249e94b5aa513d0aa3c7aa08c8">eFctRemaining</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#5a3ddbaacf0c338e408e3c0b55189d58">flashCmds</a>}},{(<span class="keywordtype">void</span>*)&amp;<a class="code" href="cmdInterpreter_8c.html#fbc09bb85c6e4618a38dba855c588abd">scanModeDefault</a>},ARGDEF_TERMINATE},
<a name="l01883"></a>01883   {<span class="stringliteral">"fw"</span>,<span class="stringliteral">"firmware"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36b36d09249e94b5aa513d0aa3c7aa08c8">eFctRemaining</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#5a94aee581a390576806909f67968c30">firmwareCmds</a>}},{(<span class="keywordtype">void</span>*)&amp;<a class="code" href="cmdInterpreter_8c.html#fbc09bb85c6e4618a38dba855c588abd">scanModeDefault</a>},ARGDEF_TERMINATE},
<a name="l01884"></a>01884   {<span class="stringliteral">"rcr"</span>,<span class="stringliteral">"read-ctrlreg"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3693da28770e1bd5abcff3bfab36328f85">eFctNoArg</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#7c4a53b4c0e418e7102cba28b663fbb5">ctrlRegStatus</a>}},{NULL},ARGDEF_TERMINATE},
<a name="l01885"></a>01885   {<span class="stringliteral">"d"</span>,<span class="stringliteral">"driver"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3607fd24779fbb8e0bc12b8241e0e436cc">eFctArgDef</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#4a4e70ab937646237dbd0f0db81cdd99">driverCtrlCmds</a>}},{(<span class="keywordtype">void</span>*)&amp;<a class="code" href="cmdInterpreter_8c.html#3e75245c450c10d2323442d359f053d7">driverCtrlDesc</a>},ARGDEF_TERMINATE},
<a name="l01886"></a>01886   {<span class="stringliteral">"i"</span>,<span class="stringliteral">"info"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3693da28770e1bd5abcff3bfab36328f85">eFctNoArg</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#ac3ae2fb745e63e33060d5c0b658f745">printInfo</a>}},{NULL},ARGDEF_TERMINATE},
<a name="l01887"></a>01887   {<span class="stringliteral">"#"</span>,NULL,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b365461a9e2704387e11258e14a0b41ac1a">eBool</a>, {NULL}},{NULL},ARGDEF_TERMINATE},
<a name="l01888"></a>01888   {NULL,<span class="stringliteral">"*"</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36b17c2f574c8a5697b118c8aa4a00bdad">eFctUserScan</a>, {(<span class="keywordtype">void</span>*)<a class="code" href="cmdInterpreter_8c.html#11ec76f8e60016409f2f33d10c70ef7e">executeMainCommands</a>}},{NULL},ARGDEF_TERMINATE},
<a name="l01889"></a>01889   {<span class="stringliteral">""</span>,<span class="stringliteral">""</span>,{<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a94b1781ada88507c56c4475f25fa92f">eUnknownType</a>, {NULL}},{NULL},ARGDEF_TERMINATE},
<a name="l01890"></a>01890 };
<a name="l01891"></a>01891 
<a name="l01892"></a><a class="code" href="cmdInterpreter_8h.html#54cbd6e4f4a91310f0c408dc5c6b413d">01892</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#54cbd6e4f4a91310f0c408dc5c6b413d">executeCommandArgs</a>(<span class="keywordtype">int</span> iNofArgs, <span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg)
<a name="l01893"></a>01893 {
<a name="l01894"></a>01894   <span class="keywordtype">int</span> iResult=0;
<a name="l01895"></a>01895   <a class="code" href="structArgDef__t.html">TArgDef</a>* pDef=<a class="code" href="mrshellprim_8c.html#60d2a9ecd4a849eaf72375ffeb666769">mrShellPrimCloneDef</a>(<a class="code" href="cmdInterpreter_8c.html#014d78494c13d4dc0430ee68de158559">mainCommands</a>);
<a name="l01896"></a>01896   <span class="keywordflow">if</span> (pDef) {
<a name="l01897"></a>01897     iResult=<a class="code" href="mrshellprim_8c.html#e2735ecedc52b1199ecf8a208339c072">ScanArguments</a>((<span class="keyword">const</span> <span class="keywordtype">char</span>**)arrayArg, iNofArgs, 0, pDef, NULL);
<a name="l01898"></a>01898     <span class="comment">/*  fprintf(stderr, "deleting definition clone\n"); */</span>
<a name="l01899"></a>01899     free(pDef);
<a name="l01900"></a>01900   }
<a name="l01901"></a>01901   <span class="keywordflow">return</span> iResult;
<a name="l01902"></a>01902 }
<a name="l01903"></a>01903 
<a name="l01904"></a><a class="code" href="cmdInterpreter_8h.html#48086998882e7d163126de4100aa12ac">01904</a> <span class="keywordtype">int</span> <a class="code" href="cmdInterpreter_8c.html#48086998882e7d163126de4100aa12ac">executeCommandLine</a>(<span class="keywordtype">char</span>* pCmdLine)
<a name="l01905"></a>01905 {
<a name="l01906"></a>01906   <span class="keywordtype">int</span> iResult=0;
<a name="l01907"></a>01907   <span class="keyword">static</span> <span class="keywordtype">int</span> iArraySize=15;
<a name="l01908"></a>01908   <span class="keywordtype">char</span>* arrayArg[iArraySize];
<a name="l01909"></a>01909   <span class="keywordtype">int</span> iNofArgs=0;
<a name="l01910"></a>01910   <span class="keywordtype">int</span> iDebugFlags=<a class="code" href="group__dcsc__msg__buffer__access.html#g36bb01dae6dd6edf579fe9878f9c6a20">setDebugOptionFlag</a>(0);
<a name="l01911"></a>01911   <span class="keywordflow">if</span> (iArraySize&gt;=(iNofArgs=<a class="code" href="mrshellprim_8c.html#cce515828d3fce502c94ea42d622bff4">buildArgumentsFromCommandLine</a>(pCmdLine, arrayArg, iArraySize, 1, iDebugFlags))) {
<a name="l01912"></a>01912     iResult=<a class="code" href="cmdInterpreter_8c.html#54cbd6e4f4a91310f0c408dc5c6b413d">executeCommandArgs</a>(iNofArgs, (<span class="keyword">const</span> <span class="keywordtype">char</span>**)arrayArg);
<a name="l01913"></a>01913     <span class="keywordflow">if</span> (iResult==-EINTR) iResult=0; <span class="comment">// -EINTR was used to indicated termination</span>
<a name="l01914"></a>01914     <span class="keywordflow">if</span> (iResult&lt;0 &amp;&amp; (iDebugFlags&amp;<a class="code" href="mrshellprim_8h.html#13095cc00efe5276cf7a1794f0f8b7e5">DBG_ARGUMENT_CONVERT</a>))
<a name="l01915"></a>01915       fprintf(stderr, <span class="stringliteral">"executeCommandArgsFailed (%d)\n"</span>, iResult);
<a name="l01916"></a>01916     <span class="keywordflow">if</span> (iResult==-EINVAL)
<a name="l01917"></a>01917       printf(<span class="stringliteral">"wrong format, try 'h' for help\n"</span>);
<a name="l01918"></a>01918     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iResult==-ENOENT)
<a name="l01919"></a>01919       printf(<span class="stringliteral">"wrong operation, try 'h' for help\n"</span>);
<a name="l01920"></a>01920   } <span class="keywordflow">else</span> {
<a name="l01921"></a>01921     fprintf(stderr, <span class="stringliteral">"argument list restricted to %d arguments\n"</span>, iArraySize);
<a name="l01922"></a>01922     iResult=-E2BIG;
<a name="l01923"></a>01923   }
<a name="l01924"></a>01924   <span class="keywordflow">return</span> iResult;
<a name="l01925"></a>01925 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on 12 Nov 2013 for RCU linux tools and drivers for the DCS board  by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
