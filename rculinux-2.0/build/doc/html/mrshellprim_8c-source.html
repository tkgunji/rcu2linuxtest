<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RCU linux tools and drivers for the DCS board : mrshellprim.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>mrshellprim.c</h1><a href="mrshellprim_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// $Id: mrshellprim.c,v 1.19 2006/06/15 09:53:24 richter Exp $</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/************************************************************************</span>
<a name="l00004"></a>00004 <span class="comment">**</span>
<a name="l00005"></a>00005 <span class="comment">**</span>
<a name="l00006"></a>00006 <span class="comment">** This file is property of and copyright by the Experimental Nuclear </span>
<a name="l00007"></a>00007 <span class="comment">** Physics Group, Dep. of Physics and Technology</span>
<a name="l00008"></a>00008 <span class="comment">** University of Bergen, Norway, 2004</span>
<a name="l00009"></a>00009 <span class="comment">** This file has been written by Matthias Richter,</span>
<a name="l00010"></a>00010 <span class="comment">** Matthias.Richter@ift.uib.no</span>
<a name="l00011"></a>00011 <span class="comment">**</span>
<a name="l00012"></a>00012 <span class="comment">** Permission to use, copy, modify and distribute this software and its  </span>
<a name="l00013"></a>00013 <span class="comment">** documentation strictly for non-commercial purposes is hereby granted  </span>
<a name="l00014"></a>00014 <span class="comment">** without fee, provided that the above copyright notice appears in all  </span>
<a name="l00015"></a>00015 <span class="comment">** copies and that both the copyright notice and this permission notice  </span>
<a name="l00016"></a>00016 <span class="comment">** appear in the supporting documentation. The authors make no claims    </span>
<a name="l00017"></a>00017 <span class="comment">** about the suitability of this software for any purpose. It is         </span>
<a name="l00018"></a>00018 <span class="comment">** provided "as is" without express or implied warranty.                 </span>
<a name="l00019"></a>00019 <span class="comment">**</span>
<a name="l00020"></a>00020 <span class="comment">*************************************************************************/</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;errno.h&gt;</span>
<a name="l00025"></a>00025 <span class="comment">// the fix came in when merging branch chc into the main trunk on April 19 2006</span>
<a name="l00026"></a>00026 <span class="comment">// memory guard should be enabled during configure in the future </span>
<a name="l00027"></a>00027 <span class="preprocessor">#ifdef HAVE_MEMORYGUARD</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="memoryguard_8h.html">memoryguard.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">#endif //HAVE_MEMORYGUARD</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 <span class="preprocessor">#include "<a class="code" href="mrshellprim_8h.html">mrshellprim.h</a>"</span>
<a name="l00032"></a>00032 
<a name="l00033"></a><a class="code" href="sendRCUcommand_8c.html#34fcfc606a53070425a87fce190ee38d">00033</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a> = 0x0;
<a name="l00034"></a>00034 
<a name="l00040"></a><a class="code" href="mrshellprim_8c.html#db27d0beb974602604e269d3efcdb71d">00040</a> <span class="preprocessor">#define ARGPROC_FOUND         0x1000</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a><a class="code" href="mrshellprim_8c.html#ca324a1333271c0a90fd93f2233f6de4">00042</a> <span class="preprocessor">#define ARGPROC_FAILED        0x2000</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span>
<a name="l00044"></a><a class="code" href="mrshellprim_8h.html#e8ed3396fcb78ea4adce3d902b77541a">00044</a> <span class="keywordtype">char</span>* <a class="code" href="mrshellprim_8c.html#e8ed3396fcb78ea4adce3d902b77541a">removePrecAndTrailingSpecChars</a>(<span class="keywordtype">char</span>* pCmd)
<a name="l00045"></a>00045 {
<a name="l00046"></a>00046   <span class="keywordtype">char</span>* pResult=NULL;
<a name="l00047"></a>00047   <span class="keywordflow">if</span> (pCmd) {
<a name="l00048"></a>00048     <span class="keywordtype">int</span> i=0;
<a name="l00049"></a>00049     <span class="keywordtype">int</span> iStart=-1;
<a name="l00050"></a>00050     <span class="keywordflow">for</span> (i=0; pCmd[i]!=0; i++) {
<a name="l00051"></a>00051       <span class="keywordflow">if</span> (pCmd[i]!=<span class="charliteral">' '</span> &amp;&amp; iStart&lt;0) iStart=i;
<a name="l00052"></a>00052       <span class="keywordflow">if</span> (pCmd[i]==<span class="charliteral">'\n'</span>) {
<a name="l00053"></a>00053     pCmd[i]=0;
<a name="l00054"></a>00054     <span class="keywordflow">break</span>;
<a name="l00055"></a>00055       }
<a name="l00056"></a>00056     }
<a name="l00057"></a>00057     <span class="keywordflow">if</span> (iStart&gt;=0 &amp;&amp; i-iStart&gt;0)
<a name="l00058"></a>00058       strcpy(pCmd, &amp;pCmd[iStart]);
<a name="l00059"></a>00059     <span class="keywordflow">else</span> 
<a name="l00060"></a>00060       *pCmd=0;
<a name="l00061"></a>00061     pResult=pCmd;
<a name="l00062"></a>00062   }
<a name="l00063"></a>00063   <span class="keywordflow">return</span> pResult;
<a name="l00064"></a>00064 }
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 
<a name="l00067"></a><a class="code" href="mrshellprim_8h.html#0244dae55f177bb00bfae3a0a39f6f5a">00067</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#0244dae55f177bb00bfae3a0a39f6f5a">getHexNumberFromArg</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* arg, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* pNumber, <span class="keywordtype">int</span> bWarning) {
<a name="l00068"></a>00068   <span class="keywordtype">int</span> iResult=0;
<a name="l00069"></a>00069   <span class="keywordflow">if</span> (arg &amp;&amp; pNumber &amp;&amp; strlen(arg)&gt;2) {
<a name="l00070"></a>00070     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> number=0;
<a name="l00071"></a>00071     <span class="keywordflow">if</span> (*arg==<span class="charliteral">'0'</span> &amp;&amp; *(arg+1)==<span class="charliteral">'x'</span> &amp;&amp; sscanf(arg, <span class="stringliteral">" 0x%x"</span>, &amp;number)==1) {
<a name="l00072"></a>00072       *pNumber = number;
<a name="l00073"></a>00073     } <span class="keywordflow">else</span> {
<a name="l00074"></a>00074       <span class="keywordflow">if</span> (bWarning)
<a name="l00075"></a>00075     fprintf(stderr, <span class="stringliteral">"wrong argument format (%s), expect hex value preceeded by 0x\n"</span>, arg);
<a name="l00076"></a>00076       iResult=-EINVAL;
<a name="l00077"></a>00077     } 
<a name="l00078"></a>00078   } <span class="keywordflow">else</span> {
<a name="l00079"></a>00079     iResult=-EINVAL;
<a name="l00080"></a>00080   } 
<a name="l00081"></a>00081   <span class="keywordflow">return</span> iResult;
<a name="l00082"></a>00082 }
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="mrshellprim_8h.html#fe29afcd7e0ed24611394b379523e597">00084</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#fe29afcd7e0ed24611394b379523e597">getDecNumberFromArg</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* arg, <span class="keywordtype">int</span>* pNumber, <span class="keywordtype">int</span> bWarning) {
<a name="l00085"></a>00085   <span class="keywordtype">int</span> iResult=0;
<a name="l00086"></a>00086   <span class="keywordflow">if</span> (arg &amp;&amp; pNumber &amp;&amp; strlen(arg)&gt;0) {
<a name="l00087"></a>00087     <span class="keywordtype">int</span> number=0;
<a name="l00088"></a>00088     <span class="keywordflow">if</span> (sscanf(arg, <span class="stringliteral">" %d"</span>, &amp;number)==1) {
<a name="l00089"></a>00089       *pNumber = number;
<a name="l00090"></a>00090     } <span class="keywordflow">else</span> {
<a name="l00091"></a>00091       <span class="keywordflow">if</span> (bWarning)
<a name="l00092"></a>00092     fprintf(stderr, <span class="stringliteral">"wrong argument format (%s), expect decimal value\n"</span>, arg);
<a name="l00093"></a>00093       iResult=-EINVAL;
<a name="l00094"></a>00094     } 
<a name="l00095"></a>00095   } <span class="keywordflow">else</span> {
<a name="l00096"></a>00096     iResult=-EINVAL;
<a name="l00097"></a>00097   } 
<a name="l00098"></a>00098   <span class="keywordflow">return</span> iResult;
<a name="l00099"></a>00099 }
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="mrshellprim_8h.html#bd0f88fefc2b7fb8ffa459b09018c921">00101</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#bd0f88fefc2b7fb8ffa459b09018c921">getFloatNumberFromArg</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* arg, <span class="keywordtype">float</span>* pNumber, <span class="keywordtype">int</span> bWarning) {
<a name="l00102"></a>00102   <span class="keywordtype">int</span> iResult=0;
<a name="l00103"></a>00103   <span class="keywordflow">if</span> (arg &amp;&amp; pNumber &amp;&amp; strlen(arg)&gt;0) {
<a name="l00104"></a>00104     <span class="keywordtype">float</span> number=0;
<a name="l00105"></a>00105     <span class="keywordflow">if</span> (sscanf(arg, <span class="stringliteral">" %f"</span>, &amp;number)==1) {
<a name="l00106"></a>00106       *pNumber = number;
<a name="l00107"></a>00107     } <span class="keywordflow">else</span> {
<a name="l00108"></a>00108       <span class="keywordflow">if</span> (bWarning)
<a name="l00109"></a>00109     fprintf(stderr, <span class="stringliteral">"wrong argument format (%s), expect float value\n"</span>, arg);
<a name="l00110"></a>00110       iResult=-EINVAL;
<a name="l00111"></a>00111     } 
<a name="l00112"></a>00112   } <span class="keywordflow">else</span> {
<a name="l00113"></a>00113     iResult=-EINVAL;
<a name="l00114"></a>00114   } 
<a name="l00115"></a>00115   <span class="keywordflow">return</span> iResult;
<a name="l00116"></a>00116 }
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 <span class="comment">/* scan a buffer of characters, separate commands and extract pointers to single command parameters</span>
<a name="l00119"></a>00119 <span class="comment">parameter:</span>
<a name="l00120"></a>00120 <span class="comment">  pCmdLine - pointer to zero terminated input char buffer, the content is changed if bSeparate==1!!!</span>
<a name="l00121"></a>00121 <span class="comment">  pTargetArray - array to receive pointers to separated strings</span>
<a name="l00122"></a>00122 <span class="comment">  iArraySize - size of the target array</span>
<a name="l00123"></a>00123 <span class="comment">  bSeparate - blanks and special characters set to zero to separate to command parameters</span>
<a name="l00124"></a>00124 <span class="comment">result:</span>
<a name="l00125"></a>00125 <span class="comment">  number of parameters if succeeded, pointers to separated strings in taget array</span>
<a name="l00126"></a>00126 <span class="comment">  error code &lt;0 if failed</span>
<a name="l00127"></a>00127 <span class="comment">*/</span>
<a name="l00128"></a><a class="code" href="mrshellprim_8h.html#cce515828d3fce502c94ea42d622bff4">00128</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#cce515828d3fce502c94ea42d622bff4">buildArgumentsFromCommandLine</a>(<span class="keywordtype">char</span>* pCmdLine, <span class="keywordtype">char</span>** pTargetArray, <span class="keywordtype">int</span> iArraySize, <span class="keywordtype">int</span> bSeparate, <span class="keywordtype">int</span> iDebugFlag)
<a name="l00129"></a>00129 {
<a name="l00130"></a>00130   <span class="keywordtype">int</span> iResult=0;
<a name="l00131"></a>00131   <span class="keywordflow">if</span> (pCmdLine) {
<a name="l00132"></a>00132     <span class="keywordtype">int</span> iLen=strlen(pCmdLine);
<a name="l00133"></a>00133     <span class="keywordflow">if</span> (pCmdLine) {
<a name="l00134"></a>00134       <span class="keywordtype">char</span>* pLastArg=NULL;
<a name="l00135"></a>00135       <span class="keywordtype">int</span> bQuotation=-1;
<a name="l00136"></a>00136       <span class="keywordflow">if</span> (pTargetArray) {
<a name="l00137"></a>00137     memset(pTargetArray, 0, iArraySize*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
<a name="l00138"></a>00138       }
<a name="l00139"></a>00139       <span class="keywordtype">int</span> iNofArgs=0;
<a name="l00140"></a>00140       iResult=0;
<a name="l00141"></a>00141       <span class="keywordtype">int</span> iPos=0;
<a name="l00142"></a>00142       <span class="comment">// loop over all characters in the command line until a '#' as beginning of comment is found</span>
<a name="l00143"></a>00143       <span class="keywordflow">for</span> (iPos=0; iPos&lt;iLen+1 &amp;&amp; (bQuotation&gt;=0 || pCmdLine[iPos]!=<span class="charliteral">'#'</span>) ; iPos++) {
<a name="l00144"></a>00144     <span class="comment">// commands separated by blanks or other special chars</span>
<a name="l00145"></a>00145     <span class="keywordflow">if</span> (bQuotation&lt;0 &amp;&amp; (pCmdLine[iPos]==<span class="charliteral">' '</span> || pCmdLine[iPos]&lt;16)){
<a name="l00146"></a>00146       <span class="keywordflow">if</span> (bSeparate&gt;0) {
<a name="l00147"></a>00147         pCmdLine[iPos]=0; <span class="comment">// delete the blank and cut the string</span>
<a name="l00148"></a>00148       }
<a name="l00149"></a>00149       <span class="keywordflow">if</span> (pLastArg!=NULL) {
<a name="l00150"></a>00150         <span class="comment">// this is the end of a command parameter, store it in the array</span>
<a name="l00151"></a>00151         <span class="keywordflow">if</span> (iNofArgs&lt;iArraySize &amp;&amp; pTargetArray!=NULL) {
<a name="l00152"></a>00152           pTargetArray[iNofArgs]=pLastArg;
<a name="l00153"></a>00153         }
<a name="l00154"></a>00154         iNofArgs++;
<a name="l00155"></a>00155         pLastArg=NULL;
<a name="l00156"></a>00156       }
<a name="l00157"></a>00157     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pLastArg==NULL &amp;&amp; (pCmdLine[iPos]==<span class="charliteral">'\''</span> || pCmdLine[iPos]==<span class="charliteral">'\"'</span>)) {
<a name="l00158"></a>00158       <span class="keywordflow">if</span> (bSeparate&gt;0) {
<a name="l00159"></a>00159         pCmdLine[iPos]=0;
<a name="l00160"></a>00160       }
<a name="l00161"></a>00161       <span class="keywordflow">if</span> (bQuotation&lt;0) {
<a name="l00162"></a>00162         bQuotation=iPos;
<a name="l00163"></a>00163       } <span class="keywordflow">else</span> {
<a name="l00164"></a>00164         <span class="keywordflow">if</span> (iPos-bQuotation&gt;1) {
<a name="l00165"></a>00165           <span class="keywordflow">if</span> (iNofArgs&lt;iArraySize &amp;&amp; pTargetArray!=NULL) {
<a name="l00166"></a>00166         pTargetArray[iNofArgs]=&amp;pCmdLine[bQuotation+1];
<a name="l00167"></a>00167           }
<a name="l00168"></a>00168           iNofArgs++;
<a name="l00169"></a>00169         }
<a name="l00170"></a>00170         bQuotation=-1;
<a name="l00171"></a>00171       }
<a name="l00172"></a>00172     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bQuotation&lt;0){
<a name="l00173"></a>00173       <span class="comment">// is this a new command parameter?</span>
<a name="l00174"></a>00174       <span class="keywordflow">if</span> (pLastArg==NULL) { 
<a name="l00175"></a>00175         <span class="comment">// store position of the command parameter</span>
<a name="l00176"></a>00176         pLastArg=&amp;(pCmdLine[iPos]);
<a name="l00177"></a>00177       }
<a name="l00178"></a>00178     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pLastArg!=NULL &amp;&amp; bQuotation&gt;=0) {
<a name="l00179"></a>00179       <span class="comment">// you should never end up here</span>
<a name="l00180"></a>00180       fprintf(stderr, <span class="stringliteral">"internal error while building the arguments\n"</span>);
<a name="l00181"></a>00181       pLastArg=NULL;
<a name="l00182"></a>00182     }
<a name="l00183"></a>00183       }
<a name="l00184"></a>00184       <span class="keywordflow">if</span> (bQuotation&gt;=0)
<a name="l00185"></a>00185     fprintf(stderr, <span class="stringliteral">"missing terminating quotation mark, the last argument might be missing\n"</span>);
<a name="l00186"></a>00186       <span class="keywordflow">if</span> (iDebugFlag&amp;<a class="code" href="mrshellprim_8h.html#13095cc00efe5276cf7a1794f0f8b7e5">DBG_ARGUMENT_CONVERT</a>) {
<a name="l00187"></a>00187     <span class="keywordflow">if</span> (iNofArgs&lt;=iArraySize)
<a name="l00188"></a>00188       printf(<span class="stringliteral">"found %d argument(s)\n"</span>, iNofArgs);
<a name="l00189"></a>00189     <span class="keywordflow">else</span> 
<a name="l00190"></a>00190       printf(<span class="stringliteral">"found %d argument(s), %d stored in array\n"</span>, iNofArgs, iArraySize);
<a name="l00191"></a>00191     <span class="keywordflow">if</span> (pTargetArray!=NULL) {
<a name="l00192"></a>00192       <span class="keywordflow">for</span> (iPos=0; iPos&lt;iNofArgs &amp;&amp; iPos&lt;iArraySize; iPos++) {
<a name="l00193"></a>00193         printf(<span class="stringliteral">"arg %d: %s\n"</span>, iPos, pTargetArray[iPos]);
<a name="l00194"></a>00194       }
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196       }
<a name="l00197"></a>00197       iResult=iNofArgs;
<a name="l00198"></a>00198     } <span class="keywordflow">else</span> {
<a name="l00199"></a>00199       iResult=-EINVAL;
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201   } <span class="keywordflow">else</span> {
<a name="l00202"></a>00202     iResult=-EINVAL;
<a name="l00203"></a>00203   }
<a name="l00204"></a>00204   <span class="keywordflow">return</span> iResult;
<a name="l00205"></a>00205 }
<a name="l00206"></a>00206 
<a name="l00207"></a><a class="code" href="mrshellprim_8c.html#a6f9bd761fef55fb0f9b33282fe34f1c">00207</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#a6f9bd761fef55fb0f9b33282fe34f1c">IsSeparator</a>(<span class="keywordtype">char</span> c, <span class="keyword">const</span> <span class="keywordtype">char</span>* pDelimiters)
<a name="l00208"></a>00208 {
<a name="l00209"></a>00209   <span class="keywordtype">int</span> iResult=0;
<a name="l00210"></a>00210   <span class="keywordflow">if</span> (c==0) {
<a name="l00211"></a>00211     <span class="comment">// the standard separator, this means the end of the element in the array of arguments </span>
<a name="l00212"></a>00212     <span class="keywordflow">if</span> ((<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;<a class="code" href="mrshellprim_8h.html#166878a3f27b25b7284a00810fbd06f9">DBG_SCAN_ARG_DEF_DETAIL</a>)==DBG_SCAN_ARG_DEF_DETAIL)
<a name="l00213"></a>00213       fprintf(stderr, <span class="stringliteral">"IsSeparator: found standard separator\n"</span>);
<a name="l00214"></a>00214     iResult=1;
<a name="l00215"></a>00215   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pDelimiters) {
<a name="l00216"></a>00216     <span class="comment">// additional separators, for more than one argument in one element of the array of arguments</span>
<a name="l00217"></a>00217     <span class="keywordtype">int</span> i=0;
<a name="l00218"></a>00218     <span class="keywordflow">for</span> (i=0; pDelimiters[i]!=0; i++) {
<a name="l00219"></a>00219       <span class="keywordflow">if</span> ((iResult=(c==pDelimiters[i]))) {
<a name="l00220"></a>00220     <span class="keywordflow">if</span> ((<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;<a class="code" href="mrshellprim_8h.html#166878a3f27b25b7284a00810fbd06f9">DBG_SCAN_ARG_DEF_DETAIL</a>)==DBG_SCAN_ARG_DEF_DETAIL)
<a name="l00221"></a>00221       fprintf(stderr, <span class="stringliteral">"IsSeparator: found separator %c\n"</span>, pDelimiters[i]);
<a name="l00222"></a>00222       }
<a name="l00223"></a>00223     }
<a name="l00224"></a>00224   }
<a name="l00225"></a>00225   <span class="keywordflow">return</span> iResult;
<a name="l00226"></a>00226 }
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 <span class="comment">/* read arguments for the current definition</span>
<a name="l00229"></a>00229 <span class="comment"> */</span>
<a name="l00230"></a><a class="code" href="mrshellprim_8c.html#2d0938d152be65a53ca257fe6fa69dc5">00230</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#2d0938d152be65a53ca257fe6fa69dc5">ReadArgument</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg, <span class="keywordtype">int</span> iNofArgs, <span class="keywordtype">int</span> iFirstArgStart, <a class="code" href="structArgDef__t.html">TArgDef</a>* pDef, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flags)
<a name="l00231"></a>00231 {
<a name="l00232"></a>00232   <span class="keywordtype">int</span> iResult=0;
<a name="l00233"></a>00233   <span class="keywordflow">if</span> (arrayArg &amp;&amp; arrayArg[0] &amp;&amp; pDef) {
<a name="l00234"></a>00234     <span class="comment">// the global variable errno (set by system calls) indicates errors</span>
<a name="l00235"></a>00235     <span class="comment">// since it is used later to check for errors in the number conversion,</span>
<a name="l00236"></a>00236     <span class="comment">// we need to zero 'errno' to clear pending error indications</span>
<a name="l00237"></a>00237     errno=0; 
<a name="l00238"></a>00238     <span class="keyword">const</span> <span class="keywordtype">char</span>* pArg=arrayArg[0]+iFirstArgStart;
<a name="l00239"></a>00239     <span class="keyword">const</span> <span class="keywordtype">char</span>* pMessage=<span class="stringliteral">""</span>;
<a name="l00240"></a>00240     <span class="keywordtype">int</span> iLen=strlen(pArg);
<a name="l00241"></a>00241     <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;(<a class="code" href="mrshellprim_8h.html#6ad8cce0cc2b52f3cd9c1918405c6585">DBG_ARGUMENT_READ</a>|<a class="code" href="mrshellprim_8h.html#20023ac34ff79c429ae27d33b9b876ac">DBG_SCAN_ARG_DEF</a>))
<a name="l00242"></a>00242       fprintf(stderr, <span class="stringliteral">"ReadArgument: scanning \'%s\' length=%d\n"</span>, pArg, iLen);
<a name="l00243"></a>00243     <span class="keywordflow">switch</span> (pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>) {
<a name="l00244"></a>00244     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36dd647739976fe8f17c25e3fe04d30eeb">eInteger</a>:
<a name="l00245"></a>00245       {
<a name="l00246"></a>00246     <span class="keywordtype">char</span>* pRemaining=NULL;
<a name="l00247"></a>00247     <span class="keywordtype">long</span> <span class="keywordtype">int</span> value=strtol(pArg, &amp;pRemaining, 10);
<a name="l00248"></a>00248     <span class="keywordflow">if</span> (errno==0) {
<a name="l00249"></a>00249       <span class="keywordflow">if</span> (pRemaining==NULL || *pRemaining==0) {
<a name="l00250"></a>00250         pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#bd711fd71d65cb2aa3f10d8e6793707d">Int</a>=value;
<a name="l00251"></a>00251         iResult=1;
<a name="l00252"></a>00252       }
<a name="l00253"></a>00253     } <span class="keywordflow">else</span> { 
<a name="l00254"></a>00254       iResult=-errno;
<a name="l00255"></a>00255     }
<a name="l00256"></a>00256       }
<a name="l00257"></a>00257       pMessage=<span class="stringliteral">"integer value expected"</span>;
<a name="l00258"></a>00258       <span class="keywordflow">break</span>;
<a name="l00259"></a>00259     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b364a5cba5eee27b47a9cf3714e4db4206d">eFloat</a>:
<a name="l00260"></a>00260       {
<a name="l00261"></a>00261     <span class="keywordtype">char</span>* pRemaining=NULL;
<a name="l00262"></a>00262     <span class="keywordtype">double</span> value=strtod(pArg, &amp;pRemaining);
<a name="l00263"></a>00263     <span class="keywordflow">if</span> (errno==0) {
<a name="l00264"></a>00264       <span class="keywordflow">if</span> (pRemaining==NULL || *pRemaining==0) {
<a name="l00265"></a>00265         pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#a7851afd8e427802c7fa7a2d7b9651dd">Float</a>=value;
<a name="l00266"></a>00266         iResult=1;
<a name="l00267"></a>00267       }
<a name="l00268"></a>00268     } <span class="keywordflow">else</span> { 
<a name="l00269"></a>00269       iResult=-errno;
<a name="l00270"></a>00270     }
<a name="l00271"></a>00271       }
<a name="l00272"></a>00272       pMessage=<span class="stringliteral">"float value expected"</span>;
<a name="l00273"></a>00273       <span class="keywordflow">break</span>;
<a name="l00274"></a>00274     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a64d04be3dc94180a329fac904a5d239">eHex</a>:
<a name="l00275"></a>00275       {
<a name="l00276"></a>00276     <span class="keywordtype">char</span>* pRemaining=NULL;
<a name="l00277"></a>00277     <span class="keywordtype">char</span>* pStart=strstr(pArg, <span class="stringliteral">"0x"</span>);
<a name="l00278"></a>00278     <span class="keywordflow">if</span> (pStart &amp;&amp; strlen(pStart)&gt;0) {
<a name="l00279"></a>00279       <span class="keywordtype">long</span> <span class="keywordtype">int</span> value=strtol(pStart+2, &amp;pRemaining, 16);
<a name="l00280"></a>00280       <span class="keywordflow">if</span> (errno==0) {
<a name="l00281"></a>00281         <span class="keywordflow">if</span> (pRemaining==NULL || *pRemaining==0) {
<a name="l00282"></a>00282           pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#fb6384a765e6dec1e70a7044d44cfbb5">Hex</a>=value;
<a name="l00283"></a>00283           iResult=1;
<a name="l00284"></a>00284         }
<a name="l00285"></a>00285       } <span class="keywordflow">else</span> { 
<a name="l00286"></a>00286         iResult=-errno;
<a name="l00287"></a>00287       }
<a name="l00288"></a>00288     }
<a name="l00289"></a>00289       }
<a name="l00290"></a>00290       pMessage=<span class="stringliteral">"hexadecimal value expected, use 0x to indicate hex"</span>;
<a name="l00291"></a>00291       <span class="keywordflow">break</span>;
<a name="l00292"></a>00292     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36be303c42da892f2d0101b668e8aa252a">eHexArray</a>:
<a name="l00293"></a>00293       <span class="keywordflow">if</span> (pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#7128a4892c178f6ab61b642e46b72720">pHex</a>) {
<a name="l00294"></a>00294     iResult=sscanf(pArg, <span class="stringliteral">" 0x%x"</span>, pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#7128a4892c178f6ab61b642e46b72720">pHex</a>);
<a name="l00295"></a>00295     <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;<a class="code" href="mrshellprim_8h.html#6ad8cce0cc2b52f3cd9c1918405c6585">DBG_ARGUMENT_READ</a>)
<a name="l00296"></a>00296       fprintf(stderr, <span class="stringliteral">"set %p with %s\n"</span>, pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#7128a4892c178f6ab61b642e46b72720">pHex</a>, pArg);
<a name="l00297"></a>00297       }
<a name="l00298"></a>00298       pMessage=<span class="stringliteral">"hexadecimal value expected, use 0x to indicate hex"</span>;
<a name="l00299"></a>00299       <span class="keywordflow">break</span>;
<a name="l00300"></a>00300     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369bf242e7bb183d9518928958c83c9a22">eConstString</a>:
<a name="l00301"></a>00301       pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#3ec8155fed9da63b73d80c0ef41ab2a4">pString</a>=pArg;
<a name="l00302"></a>00302       <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;<a class="code" href="mrshellprim_8h.html#6ad8cce0cc2b52f3cd9c1918405c6585">DBG_ARGUMENT_READ</a>)
<a name="l00303"></a>00303     fprintf(stderr, <span class="stringliteral">"ReadArgument: const string %p\n"</span>, pArg);
<a name="l00304"></a>00304       iResult=1;
<a name="l00305"></a>00305       <span class="keywordflow">break</span>;
<a name="l00306"></a>00306     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3607fd24779fbb8e0bc12b8241e0e436cc">eFctArgDef</a>:
<a name="l00307"></a>00307       <span class="keywordflow">if</span> (pDef-&gt;<a class="code" href="structArgDef__t.html#0b8bf4785dab58cdbf9124f23cf6346f">pFctArg</a> &amp;&amp; pDef-&gt;<a class="code" href="structArgDef__t.html#0b8bf4785dab58cdbf9124f23cf6346f">pFctArg</a>-&gt;<a class="code" href="structFctArg__t.html#59b99d7d99fff17580f67552428c3c98">pDef</a>) {
<a name="l00308"></a>00308     iResult=<a class="code" href="mrshellprim_8c.html#e2735ecedc52b1199ecf8a208339c072">ScanArguments</a>(arrayArg, iNofArgs, iFirstArgStart, pDef-&gt;<a class="code" href="structArgDef__t.html#0b8bf4785dab58cdbf9124f23cf6346f">pFctArg</a>-&gt;<a class="code" href="structFctArg__t.html#59b99d7d99fff17580f67552428c3c98">pDef</a>, pDef-&gt;<a class="code" href="structArgDef__t.html#0b8bf4785dab58cdbf9124f23cf6346f">pFctArg</a>-&gt;<a class="code" href="structFctArg__t.html#b84bb7d22c66809af5f97b860c3f818e">pMode</a>);
<a name="l00309"></a>00309       } <span class="keywordflow">else</span> {
<a name="l00310"></a>00310     fprintf(stderr, <span class="stringliteral">"ReadArgument error: invalid parameter to type eFctArgDef (pFctArg=%p)\n"</span>, pDef-&gt;<a class="code" href="structArgDef__t.html#0b8bf4785dab58cdbf9124f23cf6346f">pFctArg</a>);
<a name="l00311"></a>00311     iResult=-EFAULT;
<a name="l00312"></a>00312       }
<a name="l00313"></a>00313       <span class="keywordflow">break</span>;
<a name="l00314"></a>00314     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36f56ebbf9f6232a573f846cffa9f914e9">eIntegerArray</a>:
<a name="l00315"></a>00315     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b361cf54b260432a1baf68bed16081357c7">eFloatArray</a>:
<a name="l00316"></a>00316     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b360a10a6c7f681516162b85d6096fc394e">eCharArray</a>:
<a name="l00317"></a>00317     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36da4dfcdd447a4ba250c0f9b7c2dbf21e">eComposite</a>:
<a name="l00318"></a>00318     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b366feb19b8074a5ad5e422022891e6e2f5">eFctIntegerArgs</a>:  
<a name="l00319"></a>00319     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b363cf1e6253af3a5870b9c8cc15ce25900">eFctFloatArgs</a>:    
<a name="l00320"></a>00320     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3654420a8008623d27ad4e6cf8ba76f7b8">eFctHexArgs</a>: 
<a name="l00321"></a>00321     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3636b7e40fa597a694a95e617ee33e0e6b">eFctCompositeArgs</a>:
<a name="l00322"></a>00322       fprintf(stderr, <span class="stringliteral">"ReadArgument: not yet implemented\n"</span>);
<a name="l00323"></a>00323       <span class="keywordflow">break</span>;
<a name="l00324"></a>00324     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3693da28770e1bd5abcff3bfab36328f85">eFctNoArg</a>: 
<a name="l00325"></a>00325     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>: 
<a name="l00326"></a>00326     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36b36d09249e94b5aa513d0aa3c7aa08c8">eFctRemaining</a>:
<a name="l00327"></a>00327     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b364c15eefaf9247f7b503ae586294be587">eFctInclusive</a>:
<a name="l00328"></a>00328     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36b17c2f574c8a5697b118c8aa4a00bdad">eFctUserScan</a>:
<a name="l00329"></a>00329     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b365461a9e2704387e11258e14a0b41ac1a">eBool</a>:
<a name="l00330"></a>00330     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36514baa0f6ca7bbfba804b8826c13cffb">eFlag</a>:
<a name="l00331"></a>00331       <span class="comment">// no arguments to read</span>
<a name="l00332"></a>00332       <span class="keywordflow">break</span>;
<a name="l00333"></a>00333     <span class="keywordflow">default</span>:
<a name="l00334"></a>00334       fprintf(stderr, <span class="stringliteral">"ReadArgument: unknown argument type\n"</span>);
<a name="l00335"></a>00335       <span class="keywordflow">break</span>;
<a name="l00336"></a>00336     }
<a name="l00337"></a>00337     <span class="keywordflow">if</span> (iResult&gt;0) {
<a name="l00338"></a>00338       <span class="keywordflow">if</span> (pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>!=<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3607fd24779fbb8e0bc12b8241e0e436cc">eFctArgDef</a>) { <span class="comment">// the result is already set correctly since ScanArguments was used for the scan</span>
<a name="l00339"></a>00339     iResult=(iLen&lt;&lt;<a class="code" href="mrshellprim_8h.html#720b462066770425625df7cbf09e2274">SCANRET_BITSHIFT_OFFSET_LAST_ARG</a>);
<a name="l00340"></a>00340     <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;(<a class="code" href="mrshellprim_8h.html#6ad8cce0cc2b52f3cd9c1918405c6585">DBG_ARGUMENT_READ</a>|<a class="code" href="mrshellprim_8h.html#20023ac34ff79c429ae27d33b9b876ac">DBG_SCAN_ARG_DEF</a>))
<a name="l00341"></a>00341       fprintf(stderr, <span class="stringliteral">"ReadArgument: 1 argument scanned, length=%d\n"</span>, iLen);
<a name="l00342"></a>00342       }
<a name="l00343"></a>00343     } <span class="keywordflow">else</span> {
<a name="l00344"></a>00344       <span class="keyword">const</span> <span class="keywordtype">char</span>* pSrcFct=NULL;
<a name="l00345"></a>00345       <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;(<a class="code" href="mrshellprim_8h.html#6ad8cce0cc2b52f3cd9c1918405c6585">DBG_ARGUMENT_READ</a>|<a class="code" href="mrshellprim_8h.html#20023ac34ff79c429ae27d33b9b876ac">DBG_SCAN_ARG_DEF</a>))
<a name="l00346"></a>00346     pSrcFct=<span class="stringliteral">"ReadArgument: "</span>;
<a name="l00347"></a>00347       <span class="keywordflow">if</span> ((flags&amp;<a class="code" href="mrshellprim_8h.html#44108151eef216f1bbe017e9e1503c50">SCANMODE_SILENT</a>)==0)
<a name="l00348"></a>00348     fprintf(stderr, <span class="stringliteral">"%serror scanning argument \'%s\': %s\n"</span>, pSrcFct==NULL?<span class="stringliteral">""</span>:pSrcFct,pArg, pMessage);
<a name="l00349"></a>00349       iResult=-ENODATA;
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351   } <span class="keywordflow">else</span> {
<a name="l00352"></a>00352     iResult=-EINVAL;
<a name="l00353"></a>00353   }
<a name="l00354"></a>00354   <span class="keywordflow">return</span> iResult;
<a name="l00355"></a>00355 }
<a name="l00356"></a>00356 
<a name="l00357"></a><a class="code" href="mrshellprim_8c.html#18f04bffa1754658c42d2aca468f9b2c">00357</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#18f04bffa1754658c42d2aca468f9b2c">callCommandHandler</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg, <span class="keywordtype">int</span> iNofArgs, <span class="keywordtype">int</span> iFirstArgStart, <a class="code" href="structArgDef__t.html">TArgDef</a>* pDef, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flags)
<a name="l00358"></a>00358 {
<a name="l00359"></a>00359   <span class="keywordtype">int</span> iResult=0;
<a name="l00360"></a>00360   <span class="keywordflow">if</span> (pDef) {
<a name="l00361"></a>00361     <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;<a class="code" href="mrshellprim_8h.html#20023ac34ff79c429ae27d33b9b876ac">DBG_SCAN_ARG_DEF</a>)
<a name="l00362"></a>00362       fprintf(stderr, <span class="stringliteral">"callCommandHandler: %s, %s\n"</span>, pDef-&gt;<a class="code" href="structArgDef__t.html#4ca9eeaa97d70754a94cb018d13f21cd">s</a>?pDef-&gt;<a class="code" href="structArgDef__t.html#4ca9eeaa97d70754a94cb018d13f21cd">s</a>:<span class="stringliteral">"&lt;empty&gt;"</span>, pDef-&gt;<a class="code" href="structArgDef__t.html#c076508155e43ccd57ed2f6c871a107d">l</a>?pDef-&gt;<a class="code" href="structArgDef__t.html#c076508155e43ccd57ed2f6c871a107d">l</a>:<span class="stringliteral">"&lt;empty&gt;"</span>);
<a name="l00363"></a>00363     <span class="keywordflow">switch</span> (pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>) {
<a name="l00364"></a>00364     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36dd647739976fe8f17c25e3fe04d30eeb">eInteger</a>:
<a name="l00365"></a>00365     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b364a5cba5eee27b47a9cf3714e4db4206d">eFloat</a>:
<a name="l00366"></a>00366     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a64d04be3dc94180a329fac904a5d239">eHex</a>:
<a name="l00367"></a>00367     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369bf242e7bb183d9518928958c83c9a22">eConstString</a>:
<a name="l00368"></a>00368     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36f56ebbf9f6232a573f846cffa9f914e9">eIntegerArray</a>:
<a name="l00369"></a>00369     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b361cf54b260432a1baf68bed16081357c7">eFloatArray</a>:
<a name="l00370"></a>00370     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36be303c42da892f2d0101b668e8aa252a">eHexArray</a>:
<a name="l00371"></a>00371     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b360a10a6c7f681516162b85d6096fc394e">eCharArray</a>:
<a name="l00372"></a>00372     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36da4dfcdd447a4ba250c0f9b7c2dbf21e">eComposite</a>:
<a name="l00373"></a>00373       <span class="comment">// no sub function to call</span>
<a name="l00374"></a>00374       <span class="keywordflow">break</span>;
<a name="l00375"></a>00375     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b365461a9e2704387e11258e14a0b41ac1a">eBool</a>:
<a name="l00376"></a>00376       pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#bd711fd71d65cb2aa3f10d8e6793707d">Int</a>=1;
<a name="l00377"></a>00377       <span class="keywordflow">break</span>;
<a name="l00378"></a>00378     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36514baa0f6ca7bbfba804b8826c13cffb">eFlag</a>:
<a name="l00379"></a>00379       <span class="keywordflow">if</span> (pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d3d58b0a67cc759b746654b7b9d09ae5">pInt</a>) {
<a name="l00380"></a>00380     *pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d3d58b0a67cc759b746654b7b9d09ae5">pInt</a>|=pDef-&gt;<a class="code" href="structArgDef__t.html#fbd0df81e0a7ea0c1a62a3d1e2680d14">setFlagPattern</a>;
<a name="l00381"></a>00381       }
<a name="l00382"></a>00382       <span class="keywordflow">break</span>;
<a name="l00383"></a>00383     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b366feb19b8074a5ad5e422022891e6e2f5">eFctIntegerArgs</a>:  
<a name="l00384"></a>00384     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b363cf1e6253af3a5870b9c8cc15ce25900">eFctFloatArgs</a>:    
<a name="l00385"></a>00385     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3654420a8008623d27ad4e6cf8ba76f7b8">eFctHexArgs</a>: 
<a name="l00386"></a>00386     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3636b7e40fa597a694a95e617ee33e0e6b">eFctCompositeArgs</a>:
<a name="l00387"></a>00387       fprintf(stderr, <span class="stringliteral">"callCommandHandler: not yet implemented for type %d\n"</span>, pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>);
<a name="l00388"></a>00388       <span class="keywordflow">break</span>;
<a name="l00389"></a>00389     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3693da28770e1bd5abcff3bfab36328f85">eFctNoArg</a>:
<a name="l00390"></a>00390       <span class="keywordflow">if</span> (pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#8d22eeb05b434ae5553b78a0bf668b9d">pFctNoArg</a>) {
<a name="l00391"></a>00391     iResult=(*pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#8d22eeb05b434ae5553b78a0bf668b9d">pFctNoArg</a>)();
<a name="l00392"></a>00392       } <span class="keywordflow">else</span> {
<a name="l00393"></a>00393     fprintf(stderr, <span class="stringliteral">"callCommandHandler: warning no pointer of type FctNoArg\n"</span>);
<a name="l00394"></a>00394       }
<a name="l00395"></a>00395       <span class="keywordflow">break</span>;
<a name="l00396"></a>00396     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36b36d09249e94b5aa513d0aa3c7aa08c8">eFctRemaining</a>:
<a name="l00397"></a>00397     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b364c15eefaf9247f7b503ae586294be587">eFctInclusive</a>: <span class="comment">// gets other arguments</span>
<a name="l00398"></a>00398       <span class="keywordflow">if</span> (pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#efbba58fc516f932be799255c9b5e119">pSubArgDef</a>) {
<a name="l00399"></a>00399     <span class="keyword">const</span> <span class="keywordtype">char</span>* pNext=<span class="stringliteral">"&lt;empty&gt;"</span>;
<a name="l00400"></a>00400     <span class="keywordflow">if</span> (arrayArg &amp;&amp; arrayArg[0]) {
<a name="l00401"></a>00401       <span class="keywordflow">if</span> (strlen(arrayArg[0])&gt;iFirstArgStart)
<a name="l00402"></a>00402         pNext=arrayArg[0]+iFirstArgStart;
<a name="l00403"></a>00403       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iNofArgs&gt;1 &amp;&amp; strlen(arrayArg[0])==iFirstArgStart &amp;&amp; arrayArg[1])
<a name="l00404"></a>00404         pNext=arrayArg[1];
<a name="l00405"></a>00405     }
<a name="l00406"></a>00406     <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SCAN_ARG_DEF)
<a name="l00407"></a>00407       fprintf(stderr, <span class="stringliteral">"callCommandHandler: step into next iteration with argument \'%s\'\n"</span>, pNext);
<a name="l00408"></a>00408     iResult=<a class="code" href="mrshellprim_8c.html#e2735ecedc52b1199ecf8a208339c072">ScanArguments</a>(arrayArg, iNofArgs, iFirstArgStart, pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#efbba58fc516f932be799255c9b5e119">pSubArgDef</a>, pDef-&gt;<a class="code" href="structArgDef__t.html#f0e262a888279888219539148e30391b">pFctMode</a>);
<a name="l00409"></a>00409       } <span class="keywordflow">else</span> {
<a name="l00410"></a>00410     fprintf(stderr, <span class="stringliteral">"callCommandHandler: error, no sub level argument definitions\n"</span>);
<a name="l00411"></a>00411       }
<a name="l00412"></a>00412       <span class="keywordflow">break</span>;
<a name="l00413"></a>00413     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36b17c2f574c8a5697b118c8aa4a00bdad">eFctUserScan</a>:
<a name="l00414"></a>00414       <span class="keywordflow">if</span> (pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#bb58753067b96e761a11884323f1fca9">pFctUser</a>) {
<a name="l00415"></a>00415     iResult=(*pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#bb58753067b96e761a11884323f1fca9">pFctUser</a>)(arrayArg[0]+iFirstArgStart, arrayArg,iNofArgs, pDef-&gt;<a class="code" href="structArgDef__t.html#8705bbfe111541c0184b61a058ddccb1">pUser</a>, NULL);
<a name="l00416"></a>00416       } <span class="keywordflow">else</span> {
<a name="l00417"></a>00417     fprintf(stderr, <span class="stringliteral">"callCommandHandler: warning no pointer of type FctUserScan\n"</span>);
<a name="l00418"></a>00418       }
<a name="l00419"></a>00419       <span class="keywordflow">break</span>;
<a name="l00420"></a>00420     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>:
<a name="l00421"></a>00421       <span class="keywordflow">if</span> (pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#41090a9e6e4595a3b989893310a841dc">pFctIndex</a>) {
<a name="l00422"></a>00422     iResult=(*pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#41090a9e6e4595a3b989893310a841dc">pFctIndex</a>)(pDef-&gt;<a class="code" href="structArgDef__t.html#6dc5a1f0d48c5a90e40304930d77a0e2">size</a>);
<a name="l00423"></a>00423       } <span class="keywordflow">else</span> {
<a name="l00424"></a>00424     fprintf(stderr, <span class="stringliteral">"callCommandHandler: warning no pointer of type FctIndex\n"</span>);
<a name="l00425"></a>00425       }
<a name="l00426"></a>00426       <span class="keywordflow">break</span>;
<a name="l00427"></a>00427     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3607fd24779fbb8e0bc12b8241e0e436cc">eFctArgDef</a>:
<a name="l00428"></a>00428       <span class="keywordflow">if</span> (pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#6a4dac68cc3f46afeb1c668dd7f0fdd8">pFctArgDef</a> &amp;&amp; pDef-&gt;<a class="code" href="structArgDef__t.html#0b8bf4785dab58cdbf9124f23cf6346f">pFctArg</a>) {
<a name="l00429"></a>00429     iResult=(*pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#6a4dac68cc3f46afeb1c668dd7f0fdd8">pFctArgDef</a>)(pDef-&gt;<a class="code" href="structArgDef__t.html#0b8bf4785dab58cdbf9124f23cf6346f">pFctArg</a>-&gt;<a class="code" href="structFctArg__t.html#59b99d7d99fff17580f67552428c3c98">pDef</a>, pDef-&gt;<a class="code" href="structArgDef__t.html#0b8bf4785dab58cdbf9124f23cf6346f">pFctArg</a>-&gt;<a class="code" href="structFctArg__t.html#b84bb7d22c66809af5f97b860c3f818e">pMode</a>, pDef-&gt;<a class="code" href="structArgDef__t.html#0b8bf4785dab58cdbf9124f23cf6346f">pFctArg</a>-&gt;<a class="code" href="structFctArg__t.html#9369def59ef9b0c2510fe77f075c8bca">pUser</a>);
<a name="l00430"></a>00430       } <span class="keywordflow">else</span> {
<a name="l00431"></a>00431     fprintf(stderr, <span class="stringliteral">"callCommandHandler: warning no pointer of type FctArgDef\n"</span>);
<a name="l00432"></a>00432       }
<a name="l00433"></a>00433       <span class="keywordflow">break</span>;
<a name="l00434"></a>00434     <span class="keywordflow">default</span>:
<a name="l00435"></a>00435       fprintf(stderr, <span class="stringliteral">"unknown argument type\n"</span>);
<a name="l00436"></a>00436       <span class="keywordflow">break</span>;
<a name="l00437"></a>00437     }
<a name="l00438"></a>00438     <span class="keywordflow">if</span> (iResult==-ENODATA) {
<a name="l00439"></a>00439       <span class="keyword">const</span> <span class="keywordtype">char</span>* pArgName = <span class="stringliteral">"empty"</span>;
<a name="l00440"></a>00440       <span class="keywordflow">if</span> (pDef-&gt;<a class="code" href="structArgDef__t.html#4ca9eeaa97d70754a94cb018d13f21cd">s</a>) pArgName=pDef-&gt;<a class="code" href="structArgDef__t.html#4ca9eeaa97d70754a94cb018d13f21cd">s</a>;
<a name="l00441"></a>00441       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pDef-&gt;<a class="code" href="structArgDef__t.html#c076508155e43ccd57ed2f6c871a107d">l</a>) pArgName=pDef-&gt;<a class="code" href="structArgDef__t.html#c076508155e43ccd57ed2f6c871a107d">l</a>;
<a name="l00442"></a>00442       fprintf(stderr, <span class="stringliteral">"missing parameter for command \'%s\'\n"</span>, pArgName);
<a name="l00443"></a>00443     }
<a name="l00444"></a>00444   }
<a name="l00445"></a>00445   <span class="keywordflow">return</span> iResult;
<a name="l00446"></a>00446 }
<a name="l00447"></a>00447 
<a name="l00448"></a><a class="code" href="mrshellprim_8c.html#165feb129efb27e98051dd34ac03f6a4">00448</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#165feb129efb27e98051dd34ac03f6a4">SearchDef</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* pArg, <a class="code" href="structArgDef__t.html">TArgDef</a>* arrayDef, <a class="code" href="structFctMode__t.html">TFctMode</a> *pMode)
<a name="l00449"></a>00449 {
<a name="l00450"></a>00450   <span class="keywordtype">int</span> iResult=0;
<a name="l00451"></a>00451   <span class="keywordflow">if</span> (pArg &amp;&amp; arrayDef) {
<a name="l00452"></a>00452     <span class="keyword">const</span> <span class="keywordtype">char</span>* pDelimiters=NULL;
<a name="l00453"></a>00453     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> flags=0;
<a name="l00454"></a>00454     <span class="keywordflow">if</span> (pMode) {
<a name="l00455"></a>00455       pDelimiters=pMode-&gt;<a class="code" href="structFctMode__t.html#4b05e60cd819bcb5aa2eb72cf8764659">pDelimiters</a>;
<a name="l00456"></a>00456       flags=pMode-&gt;<a class="code" href="structFctMode__t.html#d8c5e03d86fa488caeb6891156875991">flags</a>;
<a name="l00457"></a>00457     }
<a name="l00458"></a>00458     <span class="keywordtype">int</span> i=0;
<a name="l00459"></a>00459     <span class="keywordflow">for</span> (i=0; arrayDef[i].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>!=<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a94b1781ada88507c56c4475f25fa92f">eUnknownType</a> &amp;&amp; iResult==0; i++) {
<a name="l00460"></a>00460       <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;<a class="code" href="mrshellprim_8h.html#6c6f952a74ebfbd09b41056fbd4325c0">DBG_SEARCH_ARG_DEF_DETAIL</a>)
<a name="l00461"></a>00461     fprintf(stderr, <span class="stringliteral">"SearchDef: check for argument no %d, flags %#x \n"</span>, i, arrayDef[i].flags);
<a name="l00462"></a>00462       <span class="keywordflow">if</span> ((arrayDef[i].flags&amp;<a class="code" href="mrshellprim_8c.html#ca324a1333271c0a90fd93f2233f6de4">ARGPROC_FAILED</a>)!=0 ||
<a name="l00463"></a>00463       ((arrayDef[i].flags&amp;<a class="code" href="mrshellprim_8c.html#db27d0beb974602604e269d3efcdb71d">ARGPROC_FOUND</a>)!=0 &amp;&amp; (arrayDef[i].flags&amp;<a class="code" href="mrshellprim_8h.html#88a540f6af1088e73e5a2c6f7070387c">ARGDEF_ONLY_ONCE</a>)!=0)) {
<a name="l00464"></a>00464     <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SEARCH_ARG_DEF_DETAIL)
<a name="l00465"></a>00465       fprintf(stderr, <span class="stringliteral">"SearchDef: previously %s argument %d skipped\n"</span>, (arrayDef[i].flags&amp;ARGPROC_FAILED)!=0?<span class="stringliteral">"failed"</span>:<span class="stringliteral">"found"</span>, i);
<a name="l00466"></a>00466     <span class="keywordflow">continue</span>;
<a name="l00467"></a>00467       }
<a name="l00468"></a>00468       <span class="keyword">const</span> <span class="keywordtype">char</span>* pMatch=NULL;
<a name="l00469"></a>00469       <span class="keywordtype">int</span> bUntermAllowed=0;
<a name="l00470"></a>00470       <span class="keywordtype">int</span> iLen=0;
<a name="l00471"></a>00471       <span class="keywordtype">int</span> bSeparated=1;
<a name="l00472"></a>00472       <span class="keywordflow">if</span> ((arrayDef[i].s==NULL || arrayDef[i].s[0]==0) &amp;&amp;
<a name="l00473"></a>00473       (arrayDef[i].l==NULL || arrayDef[i].l[0]==0)) {
<a name="l00474"></a>00474     <span class="comment">// special case for 'any argument'</span>
<a name="l00475"></a>00475     <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;<a class="code" href="mrshellprim_8h.html#4831316fb2db7fbc68ce24668992227a">DBG_SEARCH_ARG_DEF</a>)
<a name="l00476"></a>00476       fprintf(stderr, <span class="stringliteral">"SearchDef: \'any argument\' type matched\n"</span>);
<a name="l00477"></a>00477     <span class="keywordflow">if</span> (i&gt;0) {
<a name="l00478"></a>00478       pMatch=<span class="stringliteral">""</span>;
<a name="l00479"></a>00479     } <span class="keywordflow">else</span> {
<a name="l00480"></a>00480       fprintf(stderr, <span class="stringliteral">"SearchDef: there has to be a meaningfull argument definition in the first element\n"</span>);
<a name="l00481"></a>00481     }
<a name="l00482"></a>00482     bUntermAllowed=1;
<a name="l00483"></a>00483       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((arrayDef[i].flags&amp;<a class="code" href="mrshellprim_8h.html#9f63a516fdf6cc051373d525521dd03b">ARGDEF_KEYWORDLESS</a>)!=0) {
<a name="l00484"></a>00484     <span class="comment">// special case for keywordless arguments</span>
<a name="l00485"></a>00485     <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;<a class="code" href="mrshellprim_8h.html#4831316fb2db7fbc68ce24668992227a">DBG_SEARCH_ARG_DEF</a>)
<a name="l00486"></a>00486       fprintf(stderr, <span class="stringliteral">"SearchDef: keyword-less argument matched at position %d\n"</span>, i);
<a name="l00487"></a>00487     pMatch=<span class="stringliteral">""</span>;
<a name="l00488"></a>00488     <span class="keywordflow">if</span> (arrayDef[i].l!=NULL &amp;&amp; arrayDef[i].l[0]==0) pMatch=arrayDef[i].<a class="code" href="structArgDef__t.html#c076508155e43ccd57ed2f6c871a107d">l</a>; 
<a name="l00489"></a>00489     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arrayDef[i].s!=NULL &amp;&amp; arrayDef[i].s[0]==0) pMatch=arrayDef[i].<a class="code" href="structArgDef__t.html#4ca9eeaa97d70754a94cb018d13f21cd">s</a>; 
<a name="l00490"></a>00490       } <span class="keywordflow">else</span> {
<a name="l00491"></a>00491     <span class="comment">/*  if (arrayDef[i].l &amp;&amp; arrayDef[i].l[0]!=0 &amp;&amp; (strncmp(pArg, arrayDef[i].l, strlen(arrayDef[i].l))==0) &amp;&amp; */</span>
<a name="l00492"></a>00492     <span class="comment">/*      (arrayDef[i].s &amp;&amp; strlen(arrayDef[i].l)&lt;strlen(arrayDef[i].s) &amp;&amp;  */</span>
<a name="l00493"></a>00493     <span class="comment">/*        strncmp(arrayDef[i].l, arrayDef[i].s, strlen(arrayDef[i].l))==0)==0) { */</span>
<a name="l00494"></a>00494     <span class="comment">/*    pMatch=arrayDef[i].l; */</span>
<a name="l00495"></a>00495     <span class="comment">/*    bUntermAllowed=arrayDef[i].flags&amp;ARGDEF_UNTERM_LONG; */</span>
<a name="l00496"></a>00496     <span class="comment">/*  } else if (arrayDef[i].s &amp;&amp; arrayDef[i].s[0]!=0 &amp;&amp; (strncmp(pArg, arrayDef[i].s, strlen(arrayDef[i].s))==0)) { */</span>
<a name="l00497"></a>00497     <span class="comment">/*    pMatch=arrayDef[i].s; */</span>
<a name="l00498"></a>00498     <span class="comment">/*    bUntermAllowed=arrayDef[i].flags&amp;ARGDEF_UNTERM_SHORT; */</span>
<a name="l00499"></a>00499     <span class="comment">/*  } */</span>
<a name="l00500"></a>00500     <span class="keywordtype">int</span> bShortMatched=arrayDef[i].<a class="code" href="structArgDef__t.html#4ca9eeaa97d70754a94cb018d13f21cd">s</a>!=NULL;
<a name="l00501"></a>00501     <span class="keywordtype">int</span> bLongMatched=arrayDef[i].<a class="code" href="structArgDef__t.html#c076508155e43ccd57ed2f6c871a107d">l</a>!=NULL;
<a name="l00502"></a>00502     <span class="keywordflow">do</span> {
<a name="l00503"></a>00503       <span class="keywordflow">if</span> ((<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SEARCH_ARG_DEF_DETAIL)==DBG_SEARCH_ARG_DEF_DETAIL)
<a name="l00504"></a>00504         fprintf(stderr, <span class="stringliteral">"SearchDef: iteration %d of definition %d (%s)\n"</span>, iLen, i, &amp;pArg[iLen]);
<a name="l00505"></a>00505       bSeparated=<a class="code" href="mrshellprim_8c.html#a6f9bd761fef55fb0f9b33282fe34f1c">IsSeparator</a>(pArg[iLen], pDelimiters);
<a name="l00506"></a>00506       <span class="keywordflow">if</span> (bShortMatched==0 || arrayDef[i].s==NULL || arrayDef[i].s[0]==0) {}     <span class="comment">// nothing to do, priviously detected missmatch</span>
<a name="l00507"></a>00507       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bShortMatched==1 &amp;&amp; arrayDef[i].s[iLen]==<span class="charliteral">'*'</span>) {bShortMatched++;} <span class="comment">// wildcard, from now on all the characters allowd</span>
<a name="l00508"></a>00508       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((bShortMatched==1 &amp;&amp; arrayDef[i].s[iLen]==0)||(bShortMatched==2 &amp;&amp; bSeparated)) { <span class="comment">// end of this definition string</span>
<a name="l00509"></a>00509         bUntermAllowed=arrayDef[i].<a class="code" href="structArgDef__t.html#5b37c4058072b47e0392590c26f7d0ca">flags</a>&amp;<a class="code" href="mrshellprim_8h.html#6ec4b88030cc16c92c86aa9fcd1789ee">ARGDEF_UNTERM_SHORT</a>;
<a name="l00510"></a>00510         <span class="keywordflow">if</span> (bSeparated || bUntermAllowed) {
<a name="l00511"></a>00511           <span class="keywordflow">if</span> ((<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SEARCH_ARG_DEF_DETAIL)==DBG_SEARCH_ARG_DEF_DETAIL)
<a name="l00512"></a>00512         fprintf(stderr, <span class="stringliteral">"SearchDef: set pMatch to short version (%s)\n"</span>, arrayDef[i].s);
<a name="l00513"></a>00513           pMatch=arrayDef[i].<a class="code" href="structArgDef__t.html#4ca9eeaa97d70754a94cb018d13f21cd">s</a>;
<a name="l00514"></a>00514         }
<a name="l00515"></a>00515         bShortMatched=0;
<a name="l00516"></a>00516       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bShortMatched==1) {bShortMatched=(pArg[iLen]==arrayDef[i].<a class="code" href="structArgDef__t.html#4ca9eeaa97d70754a94cb018d13f21cd">s</a>[iLen]);}
<a name="l00517"></a>00517       <span class="keywordflow">if</span> (bLongMatched==0 || arrayDef[i].l==NULL || arrayDef[i].l[0]==0) {}     <span class="comment">// nothing to do, priviously detected missmatch</span>
<a name="l00518"></a>00518       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bLongMatched==1 &amp;&amp; arrayDef[i].l[iLen]==<span class="charliteral">'*'</span>) {bLongMatched++;} <span class="comment">// wildcard, from now on all the characters allowd</span>
<a name="l00519"></a>00519       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((bLongMatched==1 &amp;&amp; arrayDef[i].l[iLen]==0)||(bLongMatched==2 &amp;&amp; bSeparated)) {
<a name="l00520"></a>00520         bUntermAllowed=arrayDef[i].<a class="code" href="structArgDef__t.html#5b37c4058072b47e0392590c26f7d0ca">flags</a>&amp;<a class="code" href="mrshellprim_8h.html#9ecb4288871a72cb5f4cb8428498de9c">ARGDEF_UNTERM_LONG</a>;
<a name="l00521"></a>00521         <span class="keywordflow">if</span> (bSeparated || bUntermAllowed) {
<a name="l00522"></a>00522           <span class="keywordflow">if</span> ((<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SEARCH_ARG_DEF_DETAIL)==DBG_SEARCH_ARG_DEF_DETAIL)
<a name="l00523"></a>00523         fprintf(stderr, <span class="stringliteral">"SearchDef: set pMatch to long version (%s)\n"</span>, arrayDef[i].l);
<a name="l00524"></a>00524           pMatch=arrayDef[i].<a class="code" href="structArgDef__t.html#c076508155e43ccd57ed2f6c871a107d">l</a>;
<a name="l00525"></a>00525         }
<a name="l00526"></a>00526         bLongMatched=0;
<a name="l00527"></a>00527       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bLongMatched==1) {bLongMatched=(pArg[iLen]==arrayDef[i].<a class="code" href="structArgDef__t.html#c076508155e43ccd57ed2f6c871a107d">l</a>[iLen]);}
<a name="l00528"></a>00528       <span class="keywordflow">if</span> ((<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SEARCH_ARG_DEF_DETAIL)==DBG_SEARCH_ARG_DEF_DETAIL)
<a name="l00529"></a>00529         fprintf(stderr, <span class="stringliteral">"SearchDef: end iteration %d short=%d long=%d\n"</span>, iLen, bShortMatched, bLongMatched);
<a name="l00530"></a>00530       iLen++;
<a name="l00531"></a>00531     } <span class="keywordflow">while</span> ((bShortMatched || bLongMatched) &amp;&amp; bSeparated==0);
<a name="l00532"></a>00532     iLen--;
<a name="l00533"></a>00533       }
<a name="l00534"></a>00534       <span class="keywordflow">if</span> (pMatch) {
<a name="l00535"></a>00535     <span class="keywordflow">if</span> ((<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SEARCH_ARG_DEF_DETAIL)==DBG_SEARCH_ARG_DEF_DETAIL)
<a name="l00536"></a>00536       fprintf(stderr, <span class="stringliteral">"check termination conditions for pMatch (%s)\n"</span>, pMatch);
<a name="l00537"></a>00537     <span class="keywordflow">if</span> (bSeparated || bUntermAllowed) {
<a name="l00538"></a>00538       <span class="comment">//if (bSeparated==0 &amp;&amp; iLen&gt;0) iLen--;</span>
<a name="l00539"></a>00539       <span class="keyword">const</span> <span class="keywordtype">char</span>* pPrint=pMatch;
<a name="l00540"></a>00540       <span class="keywordflow">if</span> (pMatch[0]==0) pPrint=<span class="stringliteral">"&lt;empty&gt;"</span>;
<a name="l00541"></a>00541       <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;<a class="code" href="mrshellprim_8h.html#4831316fb2db7fbc68ce24668992227a">DBG_SEARCH_ARG_DEF</a>)
<a name="l00542"></a>00542         fprintf(stderr, <span class="stringliteral">"SearchDef: found argument %s index %d\n"</span>, pPrint, i);
<a name="l00543"></a>00543       <span class="comment">// build the return value (containing, offset in argument array and last element and index</span>
<a name="l00544"></a>00544       arrayDef[i].<a class="code" href="structArgDef__t.html#5b37c4058072b47e0392590c26f7d0ca">flags</a>|=ARGPROC_FOUND;
<a name="l00545"></a>00545       iResult|=(i&lt;&lt;<a class="code" href="mrshellprim_8h.html#9402133885fb87b81c4835a8fa4d7111">SCANRET_BITSHIFT_INDEX</a>);
<a name="l00546"></a>00546       iResult|=(iLen&lt;&lt;<a class="code" href="mrshellprim_8h.html#720b462066770425625df7cbf09e2274">SCANRET_BITSHIFT_OFFSET_LAST_ARG</a>);
<a name="l00547"></a>00547       <span class="comment">/* no offset in argument array!!</span>
<a name="l00548"></a>00548 <span class="comment">         if (pArg[iLen]==0)</span>
<a name="l00549"></a>00549 <span class="comment">         iResult|=(1&lt;&lt;SCANRET_BITSHIFT_PROCESSED_ARGS);</span>
<a name="l00550"></a>00550 <span class="comment">      */</span>
<a name="l00551"></a>00551       <span class="keywordflow">if</span> ((<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SEARCH_ARG_DEF_DETAIL)==DBG_SEARCH_ARG_DEF_DETAIL)
<a name="l00552"></a>00552         fprintf(stderr, <span class="stringliteral">"SearchDef: termination with pMatch (%s) iResult=%#x\n"</span>, pMatch, iResult);
<a name="l00553"></a>00553     } <span class="keywordflow">else</span> {
<a name="l00554"></a>00554       fprintf(stderr, <span class="stringliteral">"SearchDef: terminated argument reqired, set ARGDEF_UNTERM_SHORT/LONG flag(s) to allow unterminated argument\n"</span>);
<a name="l00555"></a>00555     }
<a name="l00556"></a>00556     <span class="keywordflow">break</span>;
<a name="l00557"></a>00557       }
<a name="l00558"></a>00558     }
<a name="l00559"></a>00559   } <span class="keywordflow">else</span> {
<a name="l00560"></a>00560     iResult=-EINVAL;
<a name="l00561"></a>00561   }
<a name="l00562"></a>00562   <span class="keywordflow">return</span> iResult;
<a name="l00563"></a>00563 }
<a name="l00564"></a>00564 
<a name="l00565"></a><a class="code" href="mrshellprim_8h.html#d50cc0ad50efa63a876cee5ef7caed9f">00565</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#d50cc0ad50efa63a876cee5ef7caed9f">PrintArgumentDefinition</a>(<a class="code" href="structArgDef__t.html">TArgDef</a>* arrayDef, <span class="keywordtype">int</span> bAll)
<a name="l00566"></a>00566 {
<a name="l00567"></a>00567   <span class="keywordtype">int</span> iResult=0;
<a name="l00568"></a>00568   <span class="keywordflow">if</span> (arrayDef) {
<a name="l00569"></a>00569     <span class="keywordtype">int</span> i=0;
<a name="l00570"></a>00570     <span class="keywordflow">for</span> (i=0; arrayDef[i].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>!=<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a94b1781ada88507c56c4475f25fa92f">eUnknownType</a> &amp;&amp; iResult==0; i++) {
<a name="l00571"></a>00571       <span class="keywordflow">if</span> (bAll==1 || arrayDef[i].flags&amp;<a class="code" href="mrshellprim_8c.html#db27d0beb974602604e269d3efcdb71d">ARGPROC_FOUND</a>) {
<a name="l00572"></a>00572     <span class="keyword">const</span> <span class="keywordtype">char</span>* pStrFound=<span class="stringliteral">""</span>;
<a name="l00573"></a>00573     <span class="keywordflow">if</span> (arrayDef[i].flags&amp;ARGPROC_FOUND) pStrFound=<span class="stringliteral">" - found"</span>;
<a name="l00574"></a>00574     <span class="keyword">const</span> <span class="keywordtype">char</span>* pArg = <span class="stringliteral">"empty"</span>;
<a name="l00575"></a>00575     <span class="keywordflow">if</span> (arrayDef[i].s) pArg=arrayDef[i].s;
<a name="l00576"></a>00576     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arrayDef[i].l) pArg=arrayDef[i].l;
<a name="l00577"></a>00577     <span class="keywordflow">switch</span> (arrayDef[i].data.type) {
<a name="l00578"></a>00578     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36dd647739976fe8f17c25e3fe04d30eeb">eInteger</a>:
<a name="l00579"></a>00579       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type integer: %d%s\n"</span>, i, pArg, arrayDef[i].data.Int, pStrFound);
<a name="l00580"></a>00580       <span class="keywordflow">break</span>;
<a name="l00581"></a>00581     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b364a5cba5eee27b47a9cf3714e4db4206d">eFloat</a>:
<a name="l00582"></a>00582       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type float: %f%s\n"</span>, i, pArg, arrayDef[i].data.Float, pStrFound);
<a name="l00583"></a>00583       <span class="keywordflow">break</span>;
<a name="l00584"></a>00584     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a64d04be3dc94180a329fac904a5d239">eHex</a>:
<a name="l00585"></a>00585       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type hexadecimal: %#x%s\n"</span>, i, pArg, arrayDef[i].data.Hex, pStrFound);
<a name="l00586"></a>00586       <span class="keywordflow">break</span>;
<a name="l00587"></a>00587     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369bf242e7bb183d9518928958c83c9a22">eConstString</a>:
<a name="l00588"></a>00588       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type const string: %p %s%s\n"</span>, i, pArg, arrayDef[i].data.pString, arrayDef[i].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#3ec8155fed9da63b73d80c0ef41ab2a4">pString</a>, pStrFound);
<a name="l00589"></a>00589       <span class="keywordflow">break</span>;
<a name="l00590"></a>00590     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36f56ebbf9f6232a573f846cffa9f914e9">eIntegerArray</a>:
<a name="l00591"></a>00591       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type integer array:%s\n"</span>, i, pArg, pStrFound);
<a name="l00592"></a>00592       <span class="keywordflow">break</span>;
<a name="l00593"></a>00593     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b361cf54b260432a1baf68bed16081357c7">eFloatArray</a>:
<a name="l00594"></a>00594       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type float array:%s\n"</span>, i, pArg, pStrFound);
<a name="l00595"></a>00595       <span class="keywordflow">break</span>;
<a name="l00596"></a>00596     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36be303c42da892f2d0101b668e8aa252a">eHexArray</a>:
<a name="l00597"></a>00597       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type hexadecimal array:%s\n"</span>, i, pArg, pStrFound);
<a name="l00598"></a>00598       <span class="keywordflow">break</span>;
<a name="l00599"></a>00599     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b360a10a6c7f681516162b85d6096fc394e">eCharArray</a>:
<a name="l00600"></a>00600       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type char array:%s\n"</span>, i, pArg, pStrFound);
<a name="l00601"></a>00601       <span class="keywordflow">break</span>;
<a name="l00602"></a>00602     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36da4dfcdd447a4ba250c0f9b7c2dbf21e">eComposite</a>:
<a name="l00603"></a>00603       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type composite array:%s\n"</span>, i, pArg, pStrFound);
<a name="l00604"></a>00604       <span class="keywordflow">break</span>;
<a name="l00605"></a>00605     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3693da28770e1bd5abcff3bfab36328f85">eFctNoArg</a>: 
<a name="l00606"></a>00606       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type function (no args):%s\n"</span>, i, pArg, pStrFound);
<a name="l00607"></a>00607       <span class="keywordflow">break</span>;
<a name="l00608"></a>00608     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369d37de9621433ecd8d0b29cb7a8b1536">eFctIndex</a>: 
<a name="l00609"></a>00609       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type function (index):%s\n"</span>, i, pArg, pStrFound);
<a name="l00610"></a>00610       <span class="keywordflow">break</span>;
<a name="l00611"></a>00611     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36b36d09249e94b5aa513d0aa3c7aa08c8">eFctRemaining</a>:
<a name="l00612"></a>00612       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type function (remaining args):%s\n"</span>, i, pArg, pStrFound);
<a name="l00613"></a>00613       <span class="keywordflow">break</span>;
<a name="l00614"></a>00614     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b364c15eefaf9247f7b503ae586294be587">eFctInclusive</a>:
<a name="l00615"></a>00615       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type function (remaining inclusive args):%s\n"</span>, i, pArg, pStrFound);
<a name="l00616"></a>00616       <span class="keywordflow">break</span>;
<a name="l00617"></a>00617     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36b17c2f574c8a5697b118c8aa4a00bdad">eFctUserScan</a>:
<a name="l00618"></a>00618       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type function (user scan):%s\n"</span>, i, pArg, pStrFound);
<a name="l00619"></a>00619       <span class="keywordflow">break</span>;
<a name="l00620"></a>00620     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b366feb19b8074a5ad5e422022891e6e2f5">eFctIntegerArgs</a>:  
<a name="l00621"></a>00621       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type function (int args):%s\n"</span>, i, pArg, pStrFound);
<a name="l00622"></a>00622       <span class="keywordflow">break</span>;
<a name="l00623"></a>00623     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b363cf1e6253af3a5870b9c8cc15ce25900">eFctFloatArgs</a>:    
<a name="l00624"></a>00624       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type function (float args):%s\n"</span>, i, pArg, pStrFound);
<a name="l00625"></a>00625       <span class="keywordflow">break</span>;
<a name="l00626"></a>00626     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3654420a8008623d27ad4e6cf8ba76f7b8">eFctHexArgs</a>: 
<a name="l00627"></a>00627       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type function (hex args):%s\n"</span>, i, pArg, pStrFound);
<a name="l00628"></a>00628       <span class="keywordflow">break</span>;
<a name="l00629"></a>00629     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3636b7e40fa597a694a95e617ee33e0e6b">eFctCompositeArgs</a>:
<a name="l00630"></a>00630       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type function (composite args):%s\n"</span>, i, pArg, pStrFound);
<a name="l00631"></a>00631       <span class="keywordflow">break</span>;
<a name="l00632"></a>00632     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3607fd24779fbb8e0bc12b8241e0e436cc">eFctArgDef</a>:
<a name="l00633"></a>00633       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type function (argument def):%s\n"</span>, i, pArg, pStrFound);
<a name="l00634"></a>00634       <span class="keywordflow">break</span>;
<a name="l00635"></a>00635     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b365461a9e2704387e11258e14a0b41ac1a">eBool</a>:
<a name="l00636"></a>00636       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type bool: %s%s\n"</span>, i, pArg, arrayDef[i].data.Int?<span class="stringliteral">"true"</span>:<span class="stringliteral">"false"</span>, pStrFound);
<a name="l00637"></a>00637       <span class="keywordflow">break</span>;
<a name="l00638"></a>00638     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36514baa0f6ca7bbfba804b8826c13cffb">eFlag</a>:
<a name="l00639"></a>00639       fprintf(stderr, <span class="stringliteral">"argument %d (%s) type flag: %#x%s\n"</span>, i, pArg, arrayDef[i].data.Int, pStrFound);
<a name="l00640"></a>00640       <span class="keywordflow">break</span>;
<a name="l00641"></a>00641     <span class="keywordflow">default</span>:
<a name="l00642"></a>00642       fprintf(stderr, <span class="stringliteral">"unknown argument\n"</span>);
<a name="l00643"></a>00643       <span class="keywordflow">break</span>;
<a name="l00644"></a>00644     }
<a name="l00645"></a>00645       }
<a name="l00646"></a>00646     }
<a name="l00647"></a>00647   } <span class="keywordflow">else</span> {
<a name="l00648"></a>00648     iResult=-EINVAL;
<a name="l00649"></a>00649   }
<a name="l00650"></a>00650   <span class="keywordflow">return</span> iResult;
<a name="l00651"></a>00651 }
<a name="l00652"></a>00652 
<a name="l00653"></a><a class="code" href="mrshellprim_8c.html#adf119666e05c73934d586afdb6b2462">00653</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#adf119666e05c73934d586afdb6b2462">GetNofRequiredArgs</a>(<a class="code" href="structArgDef__t.html">TArgDef</a>* pDef)
<a name="l00654"></a>00654 {
<a name="l00655"></a>00655   <span class="keywordtype">int</span> iResult=0;
<a name="l00656"></a>00656   <span class="keywordflow">if</span> (pDef) {
<a name="l00657"></a>00657     <span class="keywordflow">switch</span> (pDef-&gt;<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>) {
<a name="l00658"></a>00658     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36dd647739976fe8f17c25e3fe04d30eeb">eInteger</a>:
<a name="l00659"></a>00659     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b364a5cba5eee27b47a9cf3714e4db4206d">eFloat</a>:
<a name="l00660"></a>00660     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a64d04be3dc94180a329fac904a5d239">eHex</a>:
<a name="l00661"></a>00661     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369bf242e7bb183d9518928958c83c9a22">eConstString</a>:
<a name="l00662"></a>00662     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3607fd24779fbb8e0bc12b8241e0e436cc">eFctArgDef</a>:
<a name="l00663"></a>00663       iResult=1;
<a name="l00664"></a>00664       <span class="keywordflow">break</span>;
<a name="l00665"></a>00665     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36f56ebbf9f6232a573f846cffa9f914e9">eIntegerArray</a>:
<a name="l00666"></a>00666     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b361cf54b260432a1baf68bed16081357c7">eFloatArray</a>:
<a name="l00667"></a>00667     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36be303c42da892f2d0101b668e8aa252a">eHexArray</a>:
<a name="l00668"></a>00668     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b360a10a6c7f681516162b85d6096fc394e">eCharArray</a>:
<a name="l00669"></a>00669       iResult=pDef-&gt;<a class="code" href="structArgDef__t.html#6dc5a1f0d48c5a90e40304930d77a0e2">size</a>;
<a name="l00670"></a>00670       <span class="keywordflow">break</span>;
<a name="l00671"></a>00671     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b366feb19b8074a5ad5e422022891e6e2f5">eFctIntegerArgs</a>:  
<a name="l00672"></a>00672     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b363cf1e6253af3a5870b9c8cc15ce25900">eFctFloatArgs</a>:    
<a name="l00673"></a>00673     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3654420a8008623d27ad4e6cf8ba76f7b8">eFctHexArgs</a>: 
<a name="l00674"></a>00674     <span class="keywordflow">case</span> <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3636b7e40fa597a694a95e617ee33e0e6b">eFctCompositeArgs</a>:
<a name="l00675"></a>00675       {
<a name="l00676"></a>00676     <span class="comment">// the array is supposed to be terminated by a NULL element</span>
<a name="l00677"></a>00677     <a class="code" href="structTaggedData__t.html">TTaggedData</a>* arrayAddArgs = pDef-&gt;<a class="code" href="structArgDef__t.html#a1d8173daa98a2ba54340e7e6a29db2e">arrayComposite</a>;
<a name="l00678"></a>00678     <span class="keywordflow">for</span> (iResult=0; arrayAddArgs[iResult].<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>!=<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a94b1781ada88507c56c4475f25fa92f">eUnknownType</a>; iResult++);
<a name="l00679"></a>00679       }
<a name="l00680"></a>00680       <span class="keywordflow">break</span>;
<a name="l00681"></a>00681     <span class="keywordflow">default</span>:
<a name="l00682"></a>00682       iResult=0;
<a name="l00683"></a>00683     }
<a name="l00684"></a>00684   } <span class="keywordflow">else</span> {
<a name="l00685"></a>00685     iResult = -EINVAL;
<a name="l00686"></a>00686   }
<a name="l00687"></a>00687   <span class="keywordflow">if</span> ((<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;<a class="code" href="mrshellprim_8h.html#166878a3f27b25b7284a00810fbd06f9">DBG_SCAN_ARG_DEF_DETAIL</a>)==DBG_SCAN_ARG_DEF_DETAIL)
<a name="l00688"></a>00688     fprintf(stderr, <span class="stringliteral">"GetNofRequiredArgs: iResult=%d\n"</span>, iResult);
<a name="l00689"></a>00689   <span class="keywordflow">return</span> iResult;
<a name="l00690"></a>00690 }
<a name="l00691"></a>00691 
<a name="l00692"></a><a class="code" href="mrshellprim_8h.html#e2735ecedc52b1199ecf8a208339c072">00692</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#e2735ecedc52b1199ecf8a208339c072">ScanArguments</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>** arrayArg, <span class="keywordtype">int</span> iNofArgs, <span class="keywordtype">int</span> iFirstArgStart, <a class="code" href="structArgDef__t.html">TArgDef</a>* arrayDef, <a class="code" href="structFctMode__t.html">TFctMode</a> *pMode)
<a name="l00693"></a>00693 {
<a name="l00694"></a>00694   <span class="keywordtype">int</span> iResult=0;
<a name="l00695"></a>00695   <span class="keywordflow">if</span> (arrayArg &amp;&amp; arrayDef) {
<a name="l00696"></a>00696     <span class="keywordflow">if</span> (pMode==NULL || (pMode-&gt;<a class="code" href="structFctMode__t.html#d8c5e03d86fa488caeb6891156875991">flags</a>&amp;<a class="code" href="mrshellprim_8h.html#222a83d015679c34e763bc9f7d9778c5">SCANMODE_PERSISTENT</a>)==0) <a class="code" href="mrshellprim_8c.html#e24662763dc15a9b4719cc0f3d98f8fc">mrShellPrimResetVolatileFlags</a>(arrayDef);
<a name="l00697"></a>00697     <span class="keywordflow">if</span> ((<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;<a class="code" href="mrshellprim_8h.html#20023ac34ff79c429ae27d33b9b876ac">DBG_SCAN_ARG_DEF</a>)==DBG_SCAN_ARG_DEF) {
<a name="l00698"></a>00698       fprintf(stderr, <span class="stringliteral">"entering ScanArguments: %d arguments (first %s, offset %d)\n"</span>, iNofArgs, arrayArg[0], iFirstArgStart);
<a name="l00699"></a>00699     }
<a name="l00700"></a>00700     <span class="keywordflow">if</span> (iNofArgs==0 || iNofArgs==1 &amp;&amp; *(arrayArg[0]+iFirstArgStart)==0) <span class="keywordflow">return</span> -ENODATA;
<a name="l00701"></a>00701 
<a name="l00702"></a>00702     <span class="keywordtype">int</span> iCurrentArg=0;  <span class="comment">// element index of the current command</span>
<a name="l00703"></a>00703     <span class="keywordtype">int</span> iArg=0;         <span class="comment">// loop index</span>
<a name="l00704"></a>00704     <span class="keywordtype">int</span> iProcessedArgs=0; <span class="comment">// updated at each successfully processed argument -&gt; calculation of return value</span>
<a name="l00705"></a>00705     <span class="keywordtype">int</span> iProcessedChars=0;<span class="comment">// updated at each successfully processed argument -&gt; calculation of return value</span>
<a name="l00706"></a>00706     <span class="keywordtype">int</span> iCurrentCmd=-1; <span class="comment">// definition array index of current command</span>
<a name="l00707"></a>00707     <span class="keywordtype">int</span> iNofRequiredArgs=0; <span class="comment">// number of required arguments for the current command</span>
<a name="l00708"></a>00708     <span class="keywordtype">int</span> iProcArgStart=0;   <span class="comment">// start of the candidates for the required arguments</span>
<a name="l00709"></a>00709     <span class="keywordtype">int</span> iInitialPos=0; <span class="comment">// initial position for scan within the element</span>
<a name="l00710"></a>00710     <span class="keyword">const</span> <span class="keywordtype">char</span>* pDelimiters=NULL;
<a name="l00711"></a>00711     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flags=0;
<a name="l00712"></a>00712     <span class="keywordflow">if</span> (pMode) {
<a name="l00713"></a>00713       pDelimiters=pMode-&gt;<a class="code" href="structFctMode__t.html#4b05e60cd819bcb5aa2eb72cf8764659">pDelimiters</a>;
<a name="l00714"></a>00714       flags=pMode-&gt;<a class="code" href="structFctMode__t.html#d8c5e03d86fa488caeb6891156875991">flags</a>;
<a name="l00715"></a>00715     }
<a name="l00716"></a>00716     <span class="keywordflow">for</span> (iArg=0; iArg&lt;iNofArgs &amp;&amp; iResult==0; iArg++) {
<a name="l00717"></a>00717       <span class="keywordtype">int</span> iCurrentPos=iInitialPos; <span class="comment">// start of the current command within the current element</span>
<a name="l00718"></a>00718       <span class="keywordtype">int</span> iPos=iInitialPos;        <span class="comment">// loop index</span>
<a name="l00719"></a>00719       iInitialPos=0;
<a name="l00720"></a>00720       <span class="keywordflow">if</span> (iProcArgStart&gt;0) iProcArgStart=0; <span class="comment">// processing is actcive, but there was an element switch </span>
<a name="l00721"></a>00721       <span class="keywordflow">if</span> ((<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;<a class="code" href="mrshellprim_8h.html#166878a3f27b25b7284a00810fbd06f9">DBG_SCAN_ARG_DEF_DETAIL</a>)==DBG_SCAN_ARG_DEF_DETAIL) {
<a name="l00722"></a>00722     fprintf(stderr, <span class="stringliteral">"ScanArguments: scanning iArg=%d (%s)\n"</span>, iArg, arrayArg[iArg]);
<a name="l00723"></a>00723     fprintf(stderr, <span class="stringliteral">"ScanArguments: iCurrentCmd=%d iNofRequiredArgs=%d iProcArgStart=%d\n"</span>, iCurrentCmd, iNofRequiredArgs, iProcArgStart);
<a name="l00724"></a>00724       }
<a name="l00725"></a>00725       <span class="keyword">const</span> <span class="keywordtype">char</span>* pArg=arrayArg[iArg];
<a name="l00726"></a>00726       <span class="keywordtype">char</span>* pWork=NULL;
<a name="l00727"></a>00727       <span class="keywordflow">if</span> (pDelimiters) {
<a name="l00728"></a>00728     <span class="comment">// we need a working copy of the buffer since we have to temporarily alter it</span>
<a name="l00729"></a>00729     pWork=(<span class="keywordtype">char</span>*)malloc(strlen(arrayArg[iArg])+1);
<a name="l00730"></a>00730     <span class="keywordflow">if</span> (pWork) {
<a name="l00731"></a>00731       strcpy(pWork, arrayArg[iArg]);
<a name="l00732"></a>00732       pArg=(<span class="keyword">const</span> <span class="keywordtype">char</span>*)pWork;
<a name="l00733"></a>00733     }
<a name="l00734"></a>00734       }
<a name="l00735"></a>00735       <span class="keywordflow">if</span> (pArg) {
<a name="l00736"></a>00736     <span class="keywordtype">int</span> iSize=strlen(pArg);
<a name="l00737"></a>00737     <span class="keywordflow">if</span> (iArg==0 &amp;&amp; iFirstArgStart&gt;0) {
<a name="l00738"></a>00738       iPos=iFirstArgStart;
<a name="l00739"></a>00739       iProcArgStart=iFirstArgStart;
<a name="l00740"></a>00740     }
<a name="l00741"></a>00741     <span class="keywordflow">for</span> (; iPos&lt;=iSize &amp;&amp; iResult==0; iPos++) {
<a name="l00742"></a>00742       <span class="keywordflow">if</span> ((<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SCAN_ARG_DEF_DETAIL)==DBG_SCAN_ARG_DEF_DETAIL)
<a name="l00743"></a>00743         fprintf(stderr, <span class="stringliteral">"ScanArguments: iPos=%d (%s) iCurrentPos=%d (%s)\n"</span>, iPos, &amp;pArg[iPos], iCurrentPos, &amp;pArg[iCurrentPos]);
<a name="l00744"></a>00744       <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#a6f9bd761fef55fb0f9b33282fe34f1c">IsSeparator</a>(pArg[iPos], pDelimiters)) {
<a name="l00745"></a>00745         <span class="comment">// terminate the string</span>
<a name="l00746"></a>00746         <span class="keywordtype">int</span> iPosBackup=iPos;
<a name="l00747"></a>00747         <span class="keywordflow">if</span> (pWork) pWork[iPos]=0;
<a name="l00748"></a>00748         <span class="keywordflow">if</span> (iCurrentCmd&gt;=0) {
<a name="l00749"></a>00749           <span class="keywordflow">if</span> (iNofRequiredArgs&gt;0) {
<a name="l00750"></a>00750         <span class="comment">// there is a command active which needs to read the next argument</span>
<a name="l00751"></a>00751         <span class="keywordflow">if</span> (iPos-iProcArgStart&gt;0) {
<a name="l00752"></a>00752           <span class="keywordflow">if</span> (arrayDef[iCurrentCmd].data.type==<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b369bf242e7bb183d9518928958c83c9a22">eConstString</a>) pArg=arrayArg[iArg];
<a name="l00753"></a>00753           <span class="comment">// read the actual argument</span>
<a name="l00754"></a>00754           if (arrayDef[iCurrentCmd].data.type==<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b3607fd24779fbb8e0bc12b8241e0e436cc">eFctArgDef</a>) {
<a name="l00755"></a>00755             iResult=<a class="code" href="mrshellprim_8c.html#2d0938d152be65a53ca257fe6fa69dc5">ReadArgument</a>(&amp;arrayArg[iArg], iNofArgs-iArg, iProcArgStart, &amp;arrayDef[iCurrentCmd], 0);
<a name="l00756"></a>00756           } <span class="keywordflow">else</span> {
<a name="l00757"></a>00757             iResult=<a class="code" href="mrshellprim_8c.html#2d0938d152be65a53ca257fe6fa69dc5">ReadArgument</a>(&amp;pArg, 1, iProcArgStart, &amp;arrayDef[iCurrentCmd], 0);
<a name="l00758"></a>00758           }
<a name="l00759"></a>00759           <span class="keywordflow">if</span> (iResult&gt;=0) {
<a name="l00760"></a>00760 <span class="comment">/*          iPos+=(iResult&amp;SCANRET_MASK_OFFSET_LAST_ARG)&gt;&gt;SCANRET_BITSHIFT_OFFSET_LAST_ARG; */</span>
<a name="l00761"></a>00761 <span class="comment">/*          iArg+=(iResult&amp;SCANRET_MASK_PROCESSED_ARGS)&gt;&gt;SCANRET_BITSHIFT_PROCESSED_ARGS; */</span>
<a name="l00762"></a>00762             iProcArgStart=iPos;
<a name="l00763"></a>00763             iNofRequiredArgs--;
<a name="l00764"></a>00764             iResult=0; <span class="comment">// keep the loop going</span>
<a name="l00765"></a>00765           } <span class="keywordflow">else</span> {
<a name="l00766"></a>00766             <span class="comment">// handling of failed scan</span>
<a name="l00767"></a>00767             <span class="keywordflow">if</span> ((<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SCAN_ARG_DEF_DETAIL)==DBG_SCAN_ARG_DEF_DETAIL)
<a name="l00768"></a>00768               fprintf(stderr, <span class="stringliteral">"error scanning argument for command \'%s\' at index %d (still %d required)\n"</span>, arrayDef[iCurrentCmd].l, iCurrentCmd, iNofRequiredArgs);
<a name="l00769"></a>00769             <span class="keywordflow">if</span> (arrayDef[iCurrentCmd].flags&amp;<a class="code" href="mrshellprim_8h.html#c02c4c51c3c6ef7eddc4bd49a0f8df75">ARGDEF_RESUME</a>) {
<a name="l00770"></a>00770               <span class="comment">// forget about this command and try to find another matching sequence</span>
<a name="l00771"></a>00771               <span class="keywordflow">if</span> ((<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SCAN_ARG_DEF_DETAIL)==DBG_SCAN_ARG_DEF_DETAIL)
<a name="l00772"></a>00772             fprintf(stderr, <span class="stringliteral">"resume from failed command \'%s\' at index %d\n"</span>, arrayDef[iCurrentCmd].l, iCurrentCmd);
<a name="l00773"></a>00773               arrayDef[iCurrentCmd].<a class="code" href="structArgDef__t.html#5b37c4058072b47e0392590c26f7d0ca">flags</a>|=<a class="code" href="mrshellprim_8c.html#ca324a1333271c0a90fd93f2233f6de4">ARGPROC_FAILED</a>;
<a name="l00774"></a>00774               arrayDef[iCurrentCmd].<a class="code" href="structArgDef__t.html#5b37c4058072b47e0392590c26f7d0ca">flags</a>&amp;=~<a class="code" href="mrshellprim_8c.html#db27d0beb974602604e269d3efcdb71d">ARGPROC_FOUND</a>;
<a name="l00775"></a>00775               <span class="keywordflow">if</span> (iCurrentPos==0) {
<a name="l00776"></a>00776               iArg=iCurrentArg;
<a name="l00777"></a>00777               iPos=iCurrentPos-1;
<a name="l00778"></a>00778               iCurrentCmd=-1;
<a name="l00779"></a>00779               }
<a name="l00780"></a>00780               <span class="comment">// keep the loop going</span>
<a name="l00781"></a>00781               iResult=0;
<a name="l00782"></a>00782               <span class="keywordflow">continue</span>;
<a name="l00783"></a>00783             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags&amp;<a class="code" href="mrshellprim_8h.html#65e7fef3ff265436f120f3b3c070aff0">SCANMODE_SKIP_UKWN_SEQU</a>) {
<a name="l00784"></a>00784               <span class="comment">// update the values for calculation of result</span>
<a name="l00785"></a>00785               arrayDef[iCurrentCmd].<a class="code" href="structArgDef__t.html#5b37c4058072b47e0392590c26f7d0ca">flags</a>&amp;=~<a class="code" href="mrshellprim_8c.html#db27d0beb974602604e269d3efcdb71d">ARGPROC_FOUND</a>;
<a name="l00786"></a>00786               iProcessedArgs=iArg;
<a name="l00787"></a>00787               iProcessedChars=iPos;
<a name="l00788"></a>00788               iCurrentCmd=-1;
<a name="l00789"></a>00789               <span class="comment">// keep the loop going</span>
<a name="l00790"></a>00790               iResult=0;
<a name="l00791"></a>00791               <span class="keywordflow">continue</span>;
<a name="l00792"></a>00792             }
<a name="l00793"></a>00793           }
<a name="l00794"></a>00794         } <span class="keywordflow">else</span> {
<a name="l00795"></a>00795           <span class="comment">// just skip this separator</span>
<a name="l00796"></a>00796           iProcArgStart=iPos+1;
<a name="l00797"></a>00797           <span class="keywordflow">if</span> ((<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SCAN_ARG_DEF_DETAIL)==DBG_SCAN_ARG_DEF_DETAIL)
<a name="l00798"></a>00798             fprintf(stderr, <span class="stringliteral">"ScanArguments: skip this separator\n"</span>);
<a name="l00799"></a>00799         }
<a name="l00800"></a>00800           }
<a name="l00801"></a>00801           <span class="keywordflow">if</span> (iNofRequiredArgs==0) {
<a name="l00802"></a>00802         <span class="keywordflow">if</span> ((arrayDef[iCurrentCmd].flags&amp;<a class="code" href="mrshellprim_8h.html#bbe395069287967226d76ca691690f6a">ARGDEF_DELAY_EXECUTE</a>)==0) {
<a name="l00803"></a>00803           <span class="keywordflow">if</span> (arrayDef[iCurrentCmd].data.type==<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b364c15eefaf9247f7b503ae586294be587">eFctInclusive</a>)
<a name="l00804"></a>00804             iResult=<a class="code" href="mrshellprim_8c.html#18f04bffa1754658c42d2aca468f9b2c">callCommandHandler</a>(&amp;arrayArg[iCurrentArg], iNofArgs-iCurrentArg, iCurrentPos, &amp;arrayDef[iCurrentCmd],0);
<a name="l00805"></a>00805           <span class="keywordflow">else</span>
<a name="l00806"></a>00806             iResult=<a class="code" href="mrshellprim_8c.html#18f04bffa1754658c42d2aca468f9b2c">callCommandHandler</a>(&amp;arrayArg[iArg], iNofArgs-iArg, iProcArgStart, &amp;arrayDef[iCurrentCmd],0);
<a name="l00807"></a>00807           <span class="keywordflow">if</span> (iResult&gt;=0) {
<a name="l00808"></a>00808             <span class="keywordtype">int</span> iArgShift=(iResult&amp;<a class="code" href="mrshellprim_8h.html#26c19cdba298002712c08c9964edd0df">SCANRET_MASK_PROCESSED_ARGS</a>)&gt;&gt;<a class="code" href="mrshellprim_8h.html#8c595e09c68cb8c5ca0ce78002f48caf">SCANRET_BITSHIFT_PROCESSED_ARGS</a>;
<a name="l00809"></a>00809             <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SCAN_ARG_DEF_DETAIL)
<a name="l00810"></a>00810               fprintf(stderr, <span class="stringliteral">"ScanArguments: callCommandHandler result %#x\n"</span>, iResult);
<a name="l00811"></a>00811             <span class="keywordflow">if</span> (iArgShift&gt;0) {
<a name="l00812"></a>00812               <span class="comment">// iArg is set to the last processed command</span>
<a name="l00813"></a>00813               iArg+=iArgShift-1;
<a name="l00814"></a>00814               <span class="comment">// iPos is set to the iSize to terminate the inner loop, the next loop will start at</span>
<a name="l00815"></a>00815               <span class="comment">// iInitialPos, which is set to the start of the next argument</span>
<a name="l00816"></a>00816               iPos=iSize;
<a name="l00817"></a>00817               iInitialPos=(iResult&amp;<a class="code" href="mrshellprim_8h.html#b17dfbdaa414a0479199510989ed3daf">SCANRET_MASK_OFFSET_LAST_ARG</a>)&gt;&gt;<a class="code" href="mrshellprim_8h.html#720b462066770425625df7cbf09e2274">SCANRET_BITSHIFT_OFFSET_LAST_ARG</a>;
<a name="l00818"></a>00818               <span class="comment">// update the values for calculation of result</span>
<a name="l00819"></a>00819               <span class="keywordflow">if</span> ((arrayDef[iCurrentCmd].flags&amp;(<a class="code" href="mrshellprim_8h.html#418c1127f3854b9a10562114b5ca73d8">ARGDEF_EXIT</a>|<a class="code" href="mrshellprim_8h.html#fc218ec9b386341226b551419f3f624c">ARGDEF_BREAK</a>))==0) {
<a name="l00820"></a>00820             iProcessedArgs=iArg+1;
<a name="l00821"></a>00821             iProcessedChars=iInitialPos;
<a name="l00822"></a>00822               }
<a name="l00823"></a>00823             } <span class="keywordflow">else</span> {
<a name="l00824"></a>00824               <span class="comment">// only lPos has to be incremented by the number of processed characters</span>
<a name="l00825"></a>00825               iPos+=(iResult&amp;<a class="code" href="mrshellprim_8h.html#b17dfbdaa414a0479199510989ed3daf">SCANRET_MASK_OFFSET_LAST_ARG</a>)&gt;&gt;<a class="code" href="mrshellprim_8h.html#720b462066770425625df7cbf09e2274">SCANRET_BITSHIFT_OFFSET_LAST_ARG</a>;
<a name="l00826"></a>00826               <span class="comment">// update the values for calculation of result</span>
<a name="l00827"></a>00827               <span class="keywordflow">if</span> ((arrayDef[iCurrentCmd].flags&amp;(<a class="code" href="mrshellprim_8h.html#418c1127f3854b9a10562114b5ca73d8">ARGDEF_EXIT</a>|<a class="code" href="mrshellprim_8h.html#fc218ec9b386341226b551419f3f624c">ARGDEF_BREAK</a>))==0) {
<a name="l00828"></a>00828             iProcessedArgs=iArg;
<a name="l00829"></a>00829             iProcessedChars=iPos;
<a name="l00830"></a>00830               }
<a name="l00831"></a>00831             }
<a name="l00832"></a>00832             iResult=0;
<a name="l00833"></a>00833             <span class="comment">// there are two modes of termination: SCANMODE_READ_ONE_CMD is a mode to the scan function which</span>
<a name="l00834"></a>00834             <span class="comment">// causes it to terminate after one processed entry. ARGDEF_TERMINATE, ARGDEF_EXIT and ARGDEF_BREAK </span>
<a name="l00835"></a>00835             <span class="comment">// are options to an argument definition, which cause the function to return with either no error</span>
<a name="l00836"></a>00836             <span class="comment">// in case of ARGDEF_BREAK or error code -EINTR for the two others indicating that it was terminated</span>
<a name="l00837"></a>00837             <span class="keywordflow">if</span> (flags&amp;<a class="code" href="mrshellprim_8h.html#b41f1fbe57be88462133d6065f48a9f9">SCANMODE_READ_ONE_CMD</a> || arrayDef[iCurrentCmd].flags&amp;(<a class="code" href="mrshellprim_8h.html#ba7cfe65a42313488b4cfdf335409d39">ARGDEF_TERMINATE</a>|<a class="code" href="mrshellprim_8h.html#418c1127f3854b9a10562114b5ca73d8">ARGDEF_EXIT</a>|<a class="code" href="mrshellprim_8h.html#fc218ec9b386341226b551419f3f624c">ARGDEF_BREAK</a>)) {
<a name="l00838"></a>00838               <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SCAN_ARG_DEF)
<a name="l00839"></a>00839             fprintf(stderr, <span class="stringliteral">"ScanArguments: terminate at cmd=%d flags=%#x\n"</span>, iCurrentCmd, flags);
<a name="l00840"></a>00840               iArg=iNofArgs;
<a name="l00841"></a>00841               iPos=iSize;
<a name="l00842"></a>00842               <span class="keywordflow">if</span> (arrayDef[iCurrentCmd].flags&amp;(<a class="code" href="mrshellprim_8h.html#ba7cfe65a42313488b4cfdf335409d39">ARGDEF_TERMINATE</a>|<a class="code" href="mrshellprim_8h.html#418c1127f3854b9a10562114b5ca73d8">ARGDEF_EXIT</a>)) {
<a name="l00843"></a>00843             iResult=-EINTR;
<a name="l00844"></a>00844             <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SCAN_ARG_DEF)
<a name="l00845"></a>00845               fprintf(stderr, <span class="stringliteral">"ScanArguments: set result to -EINTR to indicate termination\n"</span>, iCurrentCmd, flags);
<a name="l00846"></a>00846               }
<a name="l00847"></a>00847             }
<a name="l00848"></a>00848           }
<a name="l00849"></a>00849         }
<a name="l00850"></a>00850         <span class="comment">// we are done with this command</span>
<a name="l00851"></a>00851         iCurrentPos=iPos+1;
<a name="l00852"></a>00852         iCurrentArg=iArg;
<a name="l00853"></a>00853         iProcArgStart=iCurrentPos;
<a name="l00854"></a>00854         <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SCAN_ARG_DEF)
<a name="l00855"></a>00855           fprintf(stderr, <span class="stringliteral">"ScanArguments: finished %d, iCurrentPos=%d iCurrentArg=%d\n"</span>, iCurrentCmd, iCurrentPos, iCurrentArg);
<a name="l00856"></a>00856         iCurrentCmd=-1;
<a name="l00857"></a>00857           }
<a name="l00858"></a>00858         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iProcArgStart&lt;iPos) {
<a name="l00859"></a>00859           <span class="comment">// no command active, output the char sequence if enabled</span>
<a name="l00860"></a>00860           <span class="keywordflow">if</span> (flags&amp;<a class="code" href="mrshellprim_8h.html#c2d1f169c5bb97507a98cda7ce973332">SCANMODE_PRINT_UKWN_SEQU</a>)
<a name="l00861"></a>00861         fprintf(stderr, &amp;pArg[iProcArgStart]);
<a name="l00862"></a>00862           <span class="keywordflow">if</span> ((flags&amp;<a class="code" href="mrshellprim_8h.html#44108151eef216f1bbe017e9e1503c50">SCANMODE_SILENT</a>)==0) {
<a name="l00863"></a>00863         fprintf(stderr, <span class="stringliteral">"unknown argument (%s)\n"</span>, &amp;pArg[iProcArgStart]);
<a name="l00864"></a>00864           }
<a name="l00865"></a>00865           <span class="keywordflow">if</span> (flags&amp;(<a class="code" href="mrshellprim_8h.html#b41f1fbe57be88462133d6065f48a9f9">SCANMODE_READ_ONE_CMD</a>|<a class="code" href="mrshellprim_8h.html#3c911f1397ec09fbcc6a1feac53be850">SCANMODE_FORCE_TERMINATION</a>)) {
<a name="l00866"></a>00866         iPos=iSize;
<a name="l00867"></a>00867         iArg=iNofArgs;
<a name="l00868"></a>00868           } <span class="keywordflow">else</span> {
<a name="l00869"></a>00869         iProcArgStart=iPos; <span class="comment">// processing finished</span>
<a name="l00870"></a>00870           }
<a name="l00871"></a>00871         }
<a name="l00872"></a>00872         <span class="comment">// set the string back</span>
<a name="l00873"></a>00873         <span class="keywordflow">if</span> (pWork) pWork[iPosBackup]=arrayArg[iArg][iPosBackup];
<a name="l00874"></a>00874       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iCurrentCmd&gt;=0) {
<a name="l00875"></a>00875         <span class="comment">// command active, continue iteration</span>
<a name="l00876"></a>00876       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iCurrentPos&lt;iPos) {
<a name="l00877"></a>00877         <span class="comment">// there is no command active but we are not right behind a separator or at beginning of element</span>
<a name="l00878"></a>00878       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((iResult=<a class="code" href="mrshellprim_8c.html#165feb129efb27e98051dd34ac03f6a4">SearchDef</a>((<span class="keyword">const</span> <span class="keywordtype">char</span>*)&amp;pArg[iPos], arrayDef, pMode))&gt;0) {
<a name="l00879"></a>00879         <span class="comment">// a definition is matched</span>
<a name="l00880"></a>00880         iCurrentCmd=(iResult&amp;<a class="code" href="mrshellprim_8h.html#37fb2e6805fb0fc8a1a19cf7b75b2a54">SCANRET_MASK_INDEX</a>)&gt;&gt;<a class="code" href="mrshellprim_8h.html#9402133885fb87b81c4835a8fa4d7111">SCANRET_BITSHIFT_INDEX</a>;
<a name="l00881"></a>00881         <span class="keywordflow">if</span> (iCurrentCmd!=0xff) {
<a name="l00882"></a>00882         iCurrentPos=iPos;
<a name="l00883"></a>00883         iCurrentArg=iArg;
<a name="l00884"></a>00884         iPos+=(iResult&amp;<a class="code" href="mrshellprim_8h.html#b17dfbdaa414a0479199510989ed3daf">SCANRET_MASK_OFFSET_LAST_ARG</a>)&gt;&gt;<a class="code" href="mrshellprim_8h.html#720b462066770425625df7cbf09e2274">SCANRET_BITSHIFT_OFFSET_LAST_ARG</a>;
<a name="l00885"></a>00885         iArg+=(iResult&amp;<a class="code" href="mrshellprim_8h.html#26c19cdba298002712c08c9964edd0df">SCANRET_MASK_PROCESSED_ARGS</a>)&gt;&gt;<a class="code" href="mrshellprim_8h.html#8c595e09c68cb8c5ca0ce78002f48caf">SCANRET_BITSHIFT_PROCESSED_ARGS</a>;
<a name="l00886"></a>00886         iProcArgStart=iPos--;
<a name="l00887"></a>00887         iNofRequiredArgs=<a class="code" href="mrshellprim_8c.html#adf119666e05c73934d586afdb6b2462">GetNofRequiredArgs</a>(&amp;arrayDef[iCurrentCmd]);
<a name="l00888"></a>00888         <span class="keywordflow">if</span> ((<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SCAN_ARG_DEF_DETAIL)==DBG_SCAN_ARG_DEF_DETAIL)
<a name="l00889"></a>00889           fprintf(stderr, <span class="stringliteral">"ScanArguments: iCurentPos=%d iPos=%d iCurrentArg=%d iArg=%d\n"</span>, iCurrentPos, iPos, iCurrentArg, iArg);
<a name="l00890"></a>00890         iResult=0;
<a name="l00891"></a>00891         } <span class="keywordflow">else</span> {
<a name="l00892"></a>00892           <span class="comment">// bad internal error</span>
<a name="l00893"></a>00893           fprintf(stderr, <span class="stringliteral">"ScanArguments: internal error\n"</span>);
<a name="l00894"></a>00894           iCurrentCmd=-1;
<a name="l00895"></a>00895           iResult=-EFAULT;
<a name="l00896"></a>00896         }
<a name="l00897"></a>00897       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iResult==-ENOENT &amp;&amp; flags&amp;<a class="code" href="mrshellprim_8h.html#3c911f1397ec09fbcc6a1feac53be850">SCANMODE_FORCE_TERMINATION</a>) {
<a name="l00898"></a>00898         <span class="comment">// the argument was not found in the list, termination is forced</span>
<a name="l00899"></a>00899         <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;DBG_SCAN_ARG_DEF) {
<a name="l00900"></a>00900           fprintf(stderr, <span class="stringliteral">"ScanArguments: no entry found, terminate ...\n"</span>);
<a name="l00901"></a>00901         }
<a name="l00902"></a>00902       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iResult==-ENOENT) {
<a name="l00903"></a>00903         <span class="comment">//if (iProcArgStart&lt;0) {</span>
<a name="l00904"></a>00904           <span class="comment">// neither separator nor command, but start of a normal char sequence, save the position</span>
<a name="l00905"></a>00905         <span class="comment">// iProcArgStart=iPos;</span>
<a name="l00906"></a>00906         <span class="comment">//}</span>
<a name="l00907"></a>00907         iResult=0; <span class="comment">// keep the loop going</span>
<a name="l00908"></a>00908       }
<a name="l00909"></a>00909     }
<a name="l00910"></a>00910       } <span class="keywordflow">else</span> {
<a name="l00911"></a>00911     fprintf(stderr, <span class="stringliteral">"ScanArguments warning: ignore NULL argument at position %d\n"</span>, iPos);
<a name="l00912"></a>00912       }
<a name="l00913"></a>00913       <span class="keywordflow">if</span> (pWork) free(pWork);
<a name="l00914"></a>00914     }
<a name="l00915"></a>00915     <span class="keywordflow">if</span> (iNofRequiredArgs&gt;0 &amp;&amp; iResult&gt;=0) {
<a name="l00916"></a>00916       <span class="keywordflow">if</span> ((flags&amp;<a class="code" href="mrshellprim_8h.html#44108151eef216f1bbe017e9e1503c50">SCANMODE_SILENT</a>)==0) {
<a name="l00917"></a>00917     <span class="keyword">const</span> <span class="keywordtype">char</span>* pArg = <span class="stringliteral">"empty"</span>;
<a name="l00918"></a>00918     <span class="keywordflow">if</span> (iCurrentCmd&gt;=0) {
<a name="l00919"></a>00919       <span class="keywordflow">if</span> (arrayDef[iCurrentCmd].s) pArg=arrayDef[iCurrentCmd].<a class="code" href="structArgDef__t.html#4ca9eeaa97d70754a94cb018d13f21cd">s</a>;
<a name="l00920"></a>00920       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arrayDef[iCurrentCmd].l) pArg=arrayDef[iCurrentCmd].<a class="code" href="structArgDef__t.html#c076508155e43ccd57ed2f6c871a107d">l</a>;
<a name="l00921"></a>00921     }
<a name="l00922"></a>00922     fprintf(stderr, <span class="stringliteral">"missing parameter for command \'%s\'\n"</span>, pArg);
<a name="l00923"></a>00923       }
<a name="l00924"></a>00924       iResult=-ENODATA;
<a name="l00925"></a>00925     }
<a name="l00926"></a>00926     <span class="keywordflow">if</span> (iResult&gt;=0) {
<a name="l00927"></a>00927       <span class="comment">// build the return value. it contains element offset, position within the last element and a command</span>
<a name="l00928"></a>00928       <span class="comment">// index (not used outside, invalid so far)</span>
<a name="l00929"></a>00929       <span class="comment">// iProcessedArgs points to the last array element which was processed, iProcessedChars points to the </span>
<a name="l00930"></a>00930       <span class="comment">// position within this element. The character at this position is supposed to be a separator</span>
<a name="l00931"></a>00931       <span class="comment">// If it is also the end of the element and there are more elements available, the variables are set </span>
<a name="l00932"></a>00932       <span class="comment">// to the beginning of the next element, iProcessedChars incremented otherwize</span>
<a name="l00933"></a>00933       <span class="keywordflow">if</span> (iProcessedArgs&lt;iNofArgs &amp;&amp; *(arrayArg[iProcessedArgs]+iProcessedChars)==0) {
<a name="l00934"></a>00934     iProcessedArgs++; iProcessedChars=0;
<a name="l00935"></a>00935       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iProcessedArgs&lt;iNofArgs &amp;&amp; iProcessedChars&gt;0) {
<a name="l00936"></a>00936     <span class="comment">// </span>
<a name="l00937"></a>00937     <span class="comment">//</span>
<a name="l00938"></a>00938     iProcessedChars++;
<a name="l00939"></a>00939       }
<a name="l00940"></a>00940       iResult=(iProcessedArgs&lt;&lt;<a class="code" href="mrshellprim_8h.html#8c595e09c68cb8c5ca0ce78002f48caf">SCANRET_BITSHIFT_PROCESSED_ARGS</a>);
<a name="l00941"></a>00941       iResult+=(iProcessedChars&lt;&lt;<a class="code" href="mrshellprim_8h.html#720b462066770425625df7cbf09e2274">SCANRET_BITSHIFT_OFFSET_LAST_ARG</a>);
<a name="l00942"></a>00942       iResult+=(<a class="code" href="mrshellprim_8h.html#660c0a7279105aabf7af9b5305d10edd">SCANRET_INVAL_INDEX</a>&lt;&lt;<a class="code" href="mrshellprim_8h.html#9402133885fb87b81c4835a8fa4d7111">SCANRET_BITSHIFT_INDEX</a>);
<a name="l00943"></a>00943       <span class="keywordflow">if</span> (<a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;<a class="code" href="mrshellprim_8h.html#20023ac34ff79c429ae27d33b9b876ac">DBG_SCAN_ARG_DEF</a>) {
<a name="l00944"></a>00944     fprintf(stderr, <span class="stringliteral">"finalize ScanArguments: iResult=%#x, %d argument(s) required\n"</span>, iResult, iNofRequiredArgs);
<a name="l00945"></a>00945     <a class="code" href="mrshellprim_8c.html#d50cc0ad50efa63a876cee5ef7caed9f">PrintArgumentDefinition</a>(arrayDef, 1);
<a name="l00946"></a>00946       }
<a name="l00947"></a>00947     }
<a name="l00948"></a>00948   } <span class="keywordflow">else</span> {
<a name="l00949"></a>00949     iResult=-EINVAL;
<a name="l00950"></a>00950   }
<a name="l00951"></a>00951   <span class="keywordflow">return</span> iResult;
<a name="l00952"></a>00952 }
<a name="l00953"></a>00953 
<a name="l00954"></a><a class="code" href="mrshellprim_8h.html#84fd8dd7e4af266b7b6a400c0cacaea4">00954</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#84fd8dd7e4af266b7b6a400c0cacaea4">mrShellPrimSetDebugFlag</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flag)
<a name="l00955"></a>00955 {
<a name="l00956"></a>00956   <a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>|=flag;
<a name="l00957"></a>00957   <span class="keywordflow">return</span> <a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>;
<a name="l00958"></a>00958 }
<a name="l00959"></a>00959 
<a name="l00960"></a><a class="code" href="mrshellprim_8h.html#1d4f9511ebb635164beca6c9a4a52756">00960</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#1d4f9511ebb635164beca6c9a4a52756">mrShellPrimClearDebugFlag</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flag)
<a name="l00961"></a>00961 {
<a name="l00962"></a>00962   <a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>&amp;=~flag;
<a name="l00963"></a>00963   <span class="keywordflow">return</span> <a class="code" href="mrshellprim_8c.html#34fcfc606a53070425a87fce190ee38d">g_mrShellPrimDbg</a>;
<a name="l00964"></a>00964 }
<a name="l00965"></a>00965 
<a name="l00966"></a><a class="code" href="mrshellprim_8h.html#20b23f294fae687b7b0ad7c6483ec564">00966</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#20b23f294fae687b7b0ad7c6483ec564">mrShellPrimPrintDbgFlags</a>()
<a name="l00967"></a>00967 {
<a name="l00968"></a>00968   fprintf(stderr, <span class="stringliteral">"mr shell primitives help:\n"</span>);
<a name="l00969"></a>00969   fprintf(stderr, <span class="stringliteral">"use '--mrsdbg &lt;hex number&gt;' to set the following flags\n"</span>);
<a name="l00970"></a>00970   fprintf(stderr, <span class="stringliteral">"DBG_SEARCH_ARG_DEF       : %#x\n"</span>,<a class="code" href="mrshellprim_8h.html#4831316fb2db7fbc68ce24668992227a">DBG_SEARCH_ARG_DEF</a>);
<a name="l00971"></a>00971   fprintf(stderr, <span class="stringliteral">"DBG_SEARCH_ARG_DEF_DETAIL: %#x\n"</span>,<a class="code" href="mrshellprim_8h.html#6c6f952a74ebfbd09b41056fbd4325c0">DBG_SEARCH_ARG_DEF_DETAIL</a>);
<a name="l00972"></a>00972   fprintf(stderr, <span class="stringliteral">"DBG_SCAN_ARG_DEF         : %#x\n"</span>,<a class="code" href="mrshellprim_8h.html#20023ac34ff79c429ae27d33b9b876ac">DBG_SCAN_ARG_DEF</a>);
<a name="l00973"></a>00973   fprintf(stderr, <span class="stringliteral">"DBG_SCAN_ARG_DEF_DETAIL  : %#x\n"</span>,<a class="code" href="mrshellprim_8h.html#166878a3f27b25b7284a00810fbd06f9">DBG_SCAN_ARG_DEF_DETAIL</a>);
<a name="l00974"></a>00974   fprintf(stderr, <span class="stringliteral">"DBG_ARGUMENT_READ        : %#x\n"</span>,<a class="code" href="mrshellprim_8h.html#6ad8cce0cc2b52f3cd9c1918405c6585">DBG_ARGUMENT_READ</a>);
<a name="l00975"></a>00975   fprintf(stderr, <span class="stringliteral">"DBG_ARGUMENT_CONVERT     : %#x\n"</span>,<a class="code" href="mrshellprim_8h.html#13095cc00efe5276cf7a1794f0f8b7e5">DBG_ARGUMENT_CONVERT</a>);
<a name="l00976"></a>00976   <span class="keywordflow">return</span> 0;
<a name="l00977"></a>00977 }
<a name="l00978"></a>00978 
<a name="l00979"></a><a class="code" href="mrshellprim_8h.html#24d874900c59cf760f128ae366f7a72e">00979</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#24d874900c59cf760f128ae366f7a72e">mrShellPrimGetIndex</a>(<a class="code" href="structArgDef__t.html">TArgDef</a>* arrayDef, <span class="keyword">const</span> <span class="keywordtype">char</span>* pCmd, <span class="keywordtype">int</span> iType) {
<a name="l00980"></a>00980   <span class="keywordtype">int</span> iResult=-ENOENT;
<a name="l00981"></a>00981   <span class="keywordflow">if</span> (arrayDef &amp;&amp; pCmd) {
<a name="l00982"></a>00982     <span class="keywordtype">int</span> i=0;
<a name="l00983"></a>00983     <span class="keywordflow">for</span> (i=0; arrayDef[i].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>!=<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a94b1781ada88507c56c4475f25fa92f">eUnknownType</a>; i++) {
<a name="l00984"></a>00984       <span class="keywordflow">if</span> ((arrayDef[i].s &amp;&amp; strcmp(arrayDef[i].s, pCmd)==0) || 
<a name="l00985"></a>00985       (arrayDef[i].l &amp;&amp; strcmp(arrayDef[i].l, pCmd)==0)) {
<a name="l00986"></a>00986     <span class="comment">// type check if argument not eUnknownType</span>
<a name="l00987"></a>00987     <span class="keywordflow">if</span> (iType==arrayDef[i].data.type || iType==<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a94b1781ada88507c56c4475f25fa92f">eUnknownType</a>) {
<a name="l00988"></a>00988         iResult=i;
<a name="l00989"></a>00989     } <span class="keywordflow">else</span> {
<a name="l00990"></a>00990       iResult=-EBADF;
<a name="l00991"></a>00991       fprintf(stderr, <span class="stringliteral">"mrShellPrim: type missmatch for element %d (%s)\n"</span>, i, pCmd);
<a name="l00992"></a>00992     }
<a name="l00993"></a>00993     <span class="keywordflow">break</span>;
<a name="l00994"></a>00994       }
<a name="l00995"></a>00995     }
<a name="l00996"></a>00996     <span class="keywordflow">if</span> (iResult==-ENOENT) {
<a name="l00997"></a>00997       fprintf(stderr, <span class="stringliteral">"mrShellPrim: can not find element %s\n"</span>, pCmd);
<a name="l00998"></a>00998     }
<a name="l00999"></a>00999   } <span class="keywordflow">else</span> {
<a name="l01000"></a>01000     iResult=-EINVAL;
<a name="l01001"></a>01001   }
<a name="l01002"></a>01002   <span class="keywordflow">return</span> iResult;
<a name="l01003"></a>01003 }
<a name="l01004"></a>01004 
<a name="l01005"></a><a class="code" href="mrshellprim_8h.html#9f0fe9837b7198fea2f3c32bcf203ed9">01005</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#9f0fe9837b7198fea2f3c32bcf203ed9">mrShellPrimSetData</a>(<a class="code" href="structArgDef__t.html">TArgDef</a>* arrayDef, <span class="keyword">const</span> <span class="keywordtype">char</span>* pCmd, <span class="keywordtype">void</span>* pData, <span class="keywordtype">int</span> iType) {
<a name="l01006"></a>01006   <span class="keywordtype">int</span> iResult=<a class="code" href="mrshellprim_8c.html#24d874900c59cf760f128ae366f7a72e">mrShellPrimGetIndex</a>(arrayDef, pCmd, iType);
<a name="l01007"></a>01007   <span class="keywordflow">if</span> (iResult&gt;=0) {
<a name="l01008"></a>01008     <span class="keywordflow">if</span> (arrayDef[iResult].data.type!=<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36dd647739976fe8f17c25e3fe04d30eeb">eInteger</a> &amp;&amp; arrayDef[iResult].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>!=<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b364a5cba5eee27b47a9cf3714e4db4206d">eFloat</a> &amp;&amp; 
<a name="l01009"></a>01009     arrayDef[iResult].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>!=<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a64d04be3dc94180a329fac904a5d239">eHex</a> &amp;&amp; arrayDef[iResult].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>!=<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b365461a9e2704387e11258e14a0b41ac1a">eBool</a>) {
<a name="l01010"></a>01010       arrayDef[iResult].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#5aa3ac9b92e687fc48272ced2ec2f662">pVoid</a>=pData;
<a name="l01011"></a>01011     } <span class="keywordflow">else</span> {
<a name="l01012"></a>01012       fprintf(stderr, <span class="stringliteral">"mrShellPrim: set data function only available for pointer types (%s)\n"</span>, pCmd);
<a name="l01013"></a>01013       iResult=-ENOSYS;
<a name="l01014"></a>01014     }
<a name="l01015"></a>01015   }
<a name="l01016"></a>01016   <span class="keywordflow">return</span> iResult;
<a name="l01017"></a>01017 }
<a name="l01018"></a>01018 
<a name="l01019"></a><a class="code" href="mrshellprim_8h.html#aa038cf5a29f51145c876af7fb5271d3">01019</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#aa038cf5a29f51145c876af7fb5271d3">mrShellPrimGetData</a>(<a class="code" href="structArgDef__t.html">TArgDef</a>* arrayDef, <span class="keyword">const</span> <span class="keywordtype">char</span>* pCmd, <span class="keywordtype">void</span>** ppData, <span class="keywordtype">int</span> iType) {
<a name="l01020"></a>01020   <span class="keywordtype">int</span> iResult=<a class="code" href="mrshellprim_8c.html#24d874900c59cf760f128ae366f7a72e">mrShellPrimGetIndex</a>(arrayDef, pCmd, iType);
<a name="l01021"></a>01021   <span class="keywordflow">if</span> (iResult&gt;=0) {
<a name="l01022"></a>01022     <span class="keywordtype">int</span> idx=iResult;
<a name="l01023"></a>01023     <span class="keywordflow">if</span> (arrayDef[idx].data.type!=<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36dd647739976fe8f17c25e3fe04d30eeb">eInteger</a> &amp;&amp; arrayDef[idx].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>!=<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b364a5cba5eee27b47a9cf3714e4db4206d">eFloat</a> &amp;&amp; 
<a name="l01024"></a>01024     arrayDef[idx].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>!=<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a64d04be3dc94180a329fac904a5d239">eHex</a> &amp;&amp; arrayDef[idx].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>!=<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b365461a9e2704387e11258e14a0b41ac1a">eBool</a>) {
<a name="l01025"></a>01025       <span class="keywordflow">if</span> (arrayDef[idx].flags&amp;<a class="code" href="mrshellprim_8c.html#db27d0beb974602604e269d3efcdb71d">ARGPROC_FOUND</a>) {
<a name="l01026"></a>01026     iResult|=0x1&lt;&lt;<a class="code" href="mrshellprim_8h.html#c578c0285e80db135a272b77d4c426eb">ARGPROC_EXISTS_BITSHIFT</a>;
<a name="l01027"></a>01027     <span class="keywordflow">if</span> (ppData) {
<a name="l01028"></a>01028       *ppData=arrayDef[idx].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#5aa3ac9b92e687fc48272ced2ec2f662">pVoid</a>;
<a name="l01029"></a>01029     } <span class="keywordflow">else</span>
<a name="l01030"></a>01030       iResult=-EINVAL;
<a name="l01031"></a>01031       }
<a name="l01032"></a>01032     } <span class="keywordflow">else</span> {
<a name="l01033"></a>01033       fprintf(stderr, <span class="stringliteral">"mrShellPrim: function only available for pointer types (%s)\n"</span>, pCmd);
<a name="l01034"></a>01034       iResult=-ENOSYS;
<a name="l01035"></a>01035     }
<a name="l01036"></a>01036   }
<a name="l01037"></a>01037   <span class="keywordflow">return</span> iResult;
<a name="l01038"></a>01038 }
<a name="l01039"></a>01039 
<a name="l01040"></a><a class="code" href="mrshellprim_8h.html#1e963c0f8d38ab1305d075b016de0a65">01040</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#1e963c0f8d38ab1305d075b016de0a65">mrShellPrimGetFloat</a>(<a class="code" href="structArgDef__t.html">TArgDef</a>* arrayDef, <span class="keyword">const</span> <span class="keywordtype">char</span>* pCmd, <span class="keywordtype">float</span>* pFloat) {
<a name="l01041"></a>01041   <span class="keywordtype">int</span> iResult=<a class="code" href="mrshellprim_8c.html#24d874900c59cf760f128ae366f7a72e">mrShellPrimGetIndex</a>(arrayDef, pCmd, <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b364a5cba5eee27b47a9cf3714e4db4206d">eFloat</a>);
<a name="l01042"></a>01042   <span class="keywordflow">if</span> (iResult&gt;=0) {
<a name="l01043"></a>01043     <span class="keywordtype">int</span> idx=iResult;
<a name="l01044"></a>01044     <span class="keywordflow">if</span> (arrayDef[idx].flags&amp;<a class="code" href="mrshellprim_8c.html#db27d0beb974602604e269d3efcdb71d">ARGPROC_FOUND</a>) {
<a name="l01045"></a>01045       iResult|=0x1&lt;&lt;<a class="code" href="mrshellprim_8h.html#c578c0285e80db135a272b77d4c426eb">ARGPROC_EXISTS_BITSHIFT</a>;
<a name="l01046"></a>01046       <span class="keywordflow">if</span> (pFloat) *pFloat=arrayDef[idx].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#a7851afd8e427802c7fa7a2d7b9651dd">Float</a>;
<a name="l01047"></a>01047     }
<a name="l01048"></a>01048   }
<a name="l01049"></a>01049   <span class="keywordflow">return</span> iResult;
<a name="l01050"></a>01050 }
<a name="l01051"></a>01051 
<a name="l01052"></a><a class="code" href="mrshellprim_8h.html#8f73442602070f02c40b4b3e32ab61a3">01052</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#8f73442602070f02c40b4b3e32ab61a3">mrShellPrimGetInt</a>(<a class="code" href="structArgDef__t.html">TArgDef</a>* arrayDef, <span class="keyword">const</span> <span class="keywordtype">char</span>* pCmd, <span class="keywordtype">int</span>* pInt) {
<a name="l01053"></a>01053   <span class="comment">// call with disabled type check, since two types are possible </span>
<a name="l01054"></a>01054   <span class="keywordtype">int</span> iResult=<a class="code" href="mrshellprim_8c.html#24d874900c59cf760f128ae366f7a72e">mrShellPrimGetIndex</a>(arrayDef, pCmd, <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a94b1781ada88507c56c4475f25fa92f">eUnknownType</a>);
<a name="l01055"></a>01055   <span class="keywordflow">if</span> (iResult&gt;=0) {
<a name="l01056"></a>01056     <span class="keywordtype">int</span> idx=iResult;
<a name="l01057"></a>01057     <span class="keywordflow">if</span> (arrayDef[idx].data.type==<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36dd647739976fe8f17c25e3fe04d30eeb">eInteger</a> || arrayDef[idx].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>==<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b365461a9e2704387e11258e14a0b41ac1a">eBool</a>) {
<a name="l01058"></a>01058       <span class="keywordflow">if</span> (arrayDef[idx].flags&amp;<a class="code" href="mrshellprim_8c.html#db27d0beb974602604e269d3efcdb71d">ARGPROC_FOUND</a>) {
<a name="l01059"></a>01059     iResult|=0x1&lt;&lt;<a class="code" href="mrshellprim_8h.html#c578c0285e80db135a272b77d4c426eb">ARGPROC_EXISTS_BITSHIFT</a>;
<a name="l01060"></a>01060     <span class="keywordflow">if</span> (pInt) *pInt=arrayDef[idx].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#bd711fd71d65cb2aa3f10d8e6793707d">Int</a>;
<a name="l01061"></a>01061       }
<a name="l01062"></a>01062     } <span class="keywordflow">else</span> {
<a name="l01063"></a>01063       iResult=-EBADF;
<a name="l01064"></a>01064       fprintf(stderr, <span class="stringliteral">"mrShellPrim: type missmatch for element %d (%s)\n"</span>, iResult, pCmd);
<a name="l01065"></a>01065     }
<a name="l01066"></a>01066   }
<a name="l01067"></a>01067   <span class="keywordflow">return</span> iResult;
<a name="l01068"></a>01068 }
<a name="l01069"></a>01069 
<a name="l01070"></a><a class="code" href="mrshellprim_8h.html#c08c7b1e961204b98f9b29120f043c6c">01070</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#c08c7b1e961204b98f9b29120f043c6c">mrShellPrimGetHex</a>(<a class="code" href="structArgDef__t.html">TArgDef</a>* arrayDef, <span class="keyword">const</span> <span class="keywordtype">char</span>* pCmd, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* pHex) {
<a name="l01071"></a>01071   <span class="keywordtype">int</span> iResult=<a class="code" href="mrshellprim_8c.html#24d874900c59cf760f128ae366f7a72e">mrShellPrimGetIndex</a>(arrayDef, pCmd, <a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a64d04be3dc94180a329fac904a5d239">eHex</a>);
<a name="l01072"></a>01072   <span class="keywordflow">if</span> (iResult&gt;=0) {
<a name="l01073"></a>01073     <span class="keywordtype">int</span> idx=iResult;
<a name="l01074"></a>01074     <span class="keywordflow">if</span> (arrayDef[idx].flags&amp;<a class="code" href="mrshellprim_8c.html#db27d0beb974602604e269d3efcdb71d">ARGPROC_FOUND</a>) {
<a name="l01075"></a>01075       iResult|=0x1&lt;&lt;<a class="code" href="mrshellprim_8h.html#c578c0285e80db135a272b77d4c426eb">ARGPROC_EXISTS_BITSHIFT</a>;
<a name="l01076"></a>01076       <span class="keywordflow">if</span> (pHex) *pHex=arrayDef[idx].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#fb6384a765e6dec1e70a7044d44cfbb5">Hex</a>;
<a name="l01077"></a>01077     }
<a name="l01078"></a>01078   }
<a name="l01079"></a>01079   <span class="keywordflow">return</span> iResult;
<a name="l01080"></a>01080 }
<a name="l01081"></a>01081 
<a name="l01082"></a><a class="code" href="mrshellprim_8h.html#60d2a9ecd4a849eaf72375ffeb666769">01082</a> <a class="code" href="structArgDef__t.html">TArgDef</a>* <a class="code" href="mrshellprim_8c.html#60d2a9ecd4a849eaf72375ffeb666769">mrShellPrimCloneDef</a>(<a class="code" href="structArgDef__t.html">TArgDef</a>* arrayDef) {
<a name="l01083"></a>01083   <a class="code" href="structArgDef__t.html">TArgDef</a>* pResult=NULL;
<a name="l01084"></a>01084   <span class="keywordflow">if</span> (arrayDef) {
<a name="l01085"></a>01085     <span class="keywordtype">int</span> i=0;
<a name="l01086"></a>01086     <span class="keywordflow">for</span> (i=0; arrayDef[i].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>!=<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a94b1781ada88507c56c4475f25fa92f">eUnknownType</a>; i++);
<a name="l01087"></a>01087     <span class="keywordflow">if</span> (i&gt;0) {
<a name="l01088"></a>01088       i++;
<a name="l01089"></a>01089       pResult=(<a class="code" href="structArgDef__t.html">TArgDef</a>*)malloc(i*<span class="keyword">sizeof</span>(<a class="code" href="structArgDef__t.html">TArgDef</a>));
<a name="l01090"></a>01090       <span class="keywordflow">if</span> (pResult) {
<a name="l01091"></a>01091     memcpy(pResult, arrayDef, i*<span class="keyword">sizeof</span>(TArgDef));
<a name="l01092"></a>01092       }
<a name="l01093"></a>01093     }
<a name="l01094"></a>01094   }
<a name="l01095"></a>01095   <span class="keywordflow">return</span> pResult;
<a name="l01096"></a>01096 }
<a name="l01097"></a>01097 
<a name="l01098"></a><a class="code" href="mrshellprim_8h.html#e24662763dc15a9b4719cc0f3d98f8fc">01098</a> <span class="keywordtype">int</span> <a class="code" href="mrshellprim_8c.html#e24662763dc15a9b4719cc0f3d98f8fc">mrShellPrimResetVolatileFlags</a>(<a class="code" href="structArgDef__t.html">TArgDef</a>* arrayDef) {
<a name="l01099"></a>01099   <span class="keywordtype">int</span> iResult=0;
<a name="l01100"></a>01100   <span class="keywordflow">if</span> (arrayDef) {
<a name="l01101"></a>01101     <span class="keywordtype">int</span> i=0;
<a name="l01102"></a>01102     <span class="keywordflow">for</span> (i=0; arrayDef[i].<a class="code" href="structArgDef__t.html#75389251964258516f1e52fb06df857b">data</a>.<a class="code" href="structTaggedData__t.html#d577c1ca9cfb883e8f61383aee2eb9b4">type</a>!=<a class="code" href="mrshellprim_8h.html#76a810650461f2062938ee9b82666b36a94b1781ada88507c56c4475f25fa92f">eUnknownType</a>; i++) {
<a name="l01103"></a>01103       arrayDef[i].flags&amp;=~(<a class="code" href="mrshellprim_8c.html#db27d0beb974602604e269d3efcdb71d">ARGPROC_FOUND</a>|<a class="code" href="mrshellprim_8c.html#ca324a1333271c0a90fd93f2233f6de4">ARGPROC_FAILED</a>);
<a name="l01104"></a>01104     }
<a name="l01105"></a>01105   }
<a name="l01106"></a>01106   <span class="keywordflow">return</span> iResult;
<a name="l01107"></a>01107 }
<a name="l01108"></a>01108 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on 12 Nov 2013 for RCU linux tools and drivers for the DCS board  by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
