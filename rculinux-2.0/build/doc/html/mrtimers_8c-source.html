<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RCU linux tools and drivers for the DCS board : mrtimers.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>mrtimers.c</h1><a href="mrtimers_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// $Id: mrtimers.c,v 1.3 2006/02/13 11:16:22 richter Exp $</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/************************************************************************</span>
<a name="l00004"></a>00004 <span class="comment">**</span>
<a name="l00005"></a>00005 <span class="comment">**</span>
<a name="l00006"></a>00006 <span class="comment">** This file is property of and copyright by the Experimental Nuclear </span>
<a name="l00007"></a>00007 <span class="comment">** Physics Group, Dep. of Physics and Technology</span>
<a name="l00008"></a>00008 <span class="comment">** University of Bergen, Norway, 2004</span>
<a name="l00009"></a>00009 <span class="comment">** This file has been written by Matthias Richter,</span>
<a name="l00010"></a>00010 <span class="comment">** Matthias.Richter@ift.uib.no</span>
<a name="l00011"></a>00011 <span class="comment">**</span>
<a name="l00012"></a>00012 <span class="comment">** Permission to use, copy, modify and distribute this software and its  </span>
<a name="l00013"></a>00013 <span class="comment">** documentation strictly for non-commercial purposes is hereby granted  </span>
<a name="l00014"></a>00014 <span class="comment">** without fee, provided that the above copyright notice appears in all  </span>
<a name="l00015"></a>00015 <span class="comment">** copies and that both the copyright notice and this permission notice  </span>
<a name="l00016"></a>00016 <span class="comment">** appear in the supporting documentation. The authors make no claims    </span>
<a name="l00017"></a>00017 <span class="comment">** about the suitability of this software for any purpose. It is         </span>
<a name="l00018"></a>00018 <span class="comment">** provided "as is" without express or implied warranty.                 </span>
<a name="l00019"></a>00019 <span class="comment">**</span>
<a name="l00020"></a>00020 <span class="comment">*************************************************************************/</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;time.h&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;signal.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;errno.h&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include "<a class="code" href="memoryguard_8h.html">memoryguard.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include "<a class="code" href="mrtimers_8h.html">mrtimers.h</a>"</span>
<a name="l00030"></a>00030 
<a name="l00031"></a><a class="code" href="mrtimers_8c.html#14497ff785c41d98a9be15617f68c063">00031</a> <span class="preprocessor">#define MRT_DBG_INIT_MSG               0x01</span>
<a name="l00032"></a><a class="code" href="mrtimers_8c.html#632abc514382013ffc96901425623723">00032</a> <span class="preprocessor"></span><span class="preprocessor">#define MRT_DBG_HANDLER_MSG            0x02</span>
<a name="l00033"></a><a class="code" href="mrtimers_8c.html#c5bd1b7687abdf5329151279fca0ea5b">00033</a> <span class="preprocessor"></span><span class="preprocessor">#define MRT_DBG_TIMER_MSG              0x04</span>
<a name="l00034"></a><a class="code" href="mrtimers_8c.html#d49fd48232e4a34aa52e75dceb435387">00034</a> <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="mrtimers_8c.html#d49fd48232e4a34aa52e75dceb435387">g_MRTdbgFlags</a>=0;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="comment">/***************************************************************************************</span>
<a name="l00037"></a>00037 <span class="comment"> * internal functions</span>
<a name="l00038"></a>00038 <span class="comment"> */</span>
<a name="l00039"></a>00039 
<a name="l00040"></a><a class="code" href="structTMRSysTimer.html">00040</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00041"></a><a class="code" href="structTMRSysTimer.html#4b6f19be2b38b35ed1401866ec85d1bf">00041</a>   <span class="keywordtype">int</span> type;
<a name="l00042"></a><a class="code" href="structTMRSysTimer.html#4a98635d66efe9a7ff4980629216c88a">00042</a>   time_t started;
<a name="l00043"></a><a class="code" href="structTMRSysTimer.html#582418d1e112e6ee5626fa92f6e42e0b">00043</a>   <span class="keyword">struct </span>itimerval value;
<a name="l00044"></a><a class="code" href="structTMRSysTimer.html#178f6c1cd23308ca9cc80e7d1312ead6">00044</a>   <span class="keywordtype">int</span> cycleCount;
<a name="l00045"></a>00045 } <a class="code" href="structTMRSysTimer.html">TMRSysTimer</a>;
<a name="l00046"></a>00046 
<a name="l00047"></a><a class="code" href="structTMRTimerHandler.html">00047</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00048"></a><a class="code" href="structTMRTimerHandler.html#2da8162b04f70a60ac2bc7b37d97e5a1">00048</a>   <span class="keywordtype">int</span> TimeOutSec;
<a name="l00049"></a><a class="code" href="structTMRTimerHandler.html#ceccedecb73edf56b8aece303bd50521">00049</a>   <span class="keywordtype">int</span> iTimeOutUsec;
<a name="l00050"></a><a class="code" href="structTMRTimerHandler.html#a96173b2d71794fe6ce4c1b4765e81e8">00050</a>   <a class="code" href="mrtimers_8h.html#9c199b5712594663db80db9a9ec6d6e0">mrTimerHandler_t</a> pHandler;
<a name="l00051"></a>00051 } <a class="code" href="structTMRTimerHandler.html">TMRTimerHandler</a>;
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="structTMRTimer.html">00053</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00054"></a><a class="code" href="structTMRTimer.html#ca4322de3f2a2e73ef2e26c7f3ce9a27">00054</a>   <span class="keywordtype">int</span> id;
<a name="l00055"></a><a class="code" href="structTMRTimer.html#09f50fe723b1b20ac76d41e7ccc925a5">00055</a>   <span class="keywordtype">int</span> typeIndex;
<a name="l00056"></a><a class="code" href="structTMRTimer.html#43ffe7cabf87a2cbb545d37eafd42236">00056</a>   <span class="keywordtype">int</span> startcycle;
<a name="l00057"></a><a class="code" href="structTMRTimer.html#fab1ebdf9b11ae3bfd43feb3e598226b">00057</a>   <span class="keyword">struct </span>itimerval startvalue;
<a name="l00058"></a>00058 } <a class="code" href="structTMRTimer.html">TMRTimer</a>;
<a name="l00059"></a>00059 
<a name="l00060"></a><a class="code" href="mrtimers_8c.html#9361c4a76eaa5dc9c005e0cf2c3e4077">00060</a> <span class="preprocessor">#define MAX_SYS_TIMERS 3</span>
<a name="l00061"></a><a class="code" href="mrtimers_8c.html#918e72d38ef74b456fdf4be5930d6aee">00061</a> <span class="preprocessor"></span><span class="preprocessor">#define INITIAL_TIMER_ARRAY_SIZE 10</span>
<a name="l00062"></a><a class="code" href="mrtimers_8c.html#ea8ea38e23fffb861f535c3e4d933ced">00062</a> <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="mrtimers_8c.html#ea8ea38e23fffb861f535c3e4d933ced">g_systimertypes</a>[<a class="code" href="mrtimers_8c.html#9361c4a76eaa5dc9c005e0cf2c3e4077">MAX_SYS_TIMERS</a>]={ITIMER_REAL, ITIMER_VIRTUAL, ITIMER_PROF};
<a name="l00063"></a><a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">00063</a> <a class="code" href="structTMRSysTimer.html">TMRSysTimer</a> <a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[<a class="code" href="mrtimers_8c.html#9361c4a76eaa5dc9c005e0cf2c3e4077">MAX_SYS_TIMERS</a>];
<a name="l00064"></a><a class="code" href="mrtimers_8c.html#5b4db1e2c62e8f1bb62e4dc80bb3e378">00064</a> <a class="code" href="structTMRTimer.html">TMRTimer</a>* <a class="code" href="mrtimers_8c.html#5b4db1e2c62e8f1bb62e4dc80bb3e378">g_arrayTimers</a>=NULL;
<a name="l00065"></a><a class="code" href="mrtimers_8c.html#72e2c21038581ad06e38f329d8661e3c">00065</a> <span class="keywordtype">int</span> <a class="code" href="mrtimers_8c.html#72e2c21038581ad06e38f329d8661e3c">g_arrayTimerSize</a>=0;
<a name="l00066"></a>00066 
<a name="l00067"></a><a class="code" href="mrtimers_8c.html#1be5b70d8f918fc6dd65a4bad657e1f3">00067</a> <span class="keywordtype">int</span> <a class="code" href="mrtimers_8c.html#1be5b70d8f918fc6dd65a4bad657e1f3">getTypeIndexFromTimerType</a>(<span class="keywordtype">int</span> iType)
<a name="l00068"></a>00068 {
<a name="l00069"></a>00069   <span class="keywordtype">int</span> index=-1;
<a name="l00070"></a>00070   <span class="keywordflow">switch</span> (iType) {
<a name="l00071"></a>00071   <span class="keywordflow">case</span> ITIMER_REAL: index=0;
<a name="l00072"></a>00072     <span class="keywordflow">break</span>;
<a name="l00073"></a>00073   <span class="keywordflow">case</span> ITIMER_VIRTUAL: index=1;
<a name="l00074"></a>00074     <span class="keywordflow">break</span>;
<a name="l00075"></a>00075   <span class="keywordflow">case</span> ITIMER_PROF: index=2;
<a name="l00076"></a>00076     <span class="keywordflow">break</span>;
<a name="l00077"></a>00077   }
<a name="l00078"></a>00078   <span class="keywordflow">return</span> index;
<a name="l00079"></a>00079 }
<a name="l00080"></a>00080 
<a name="l00081"></a><a class="code" href="mrtimers_8c.html#d14acb6d2d5840dfea0620b069869b82">00081</a> <span class="keywordtype">int</span> <a class="code" href="mrtimers_8c.html#d14acb6d2d5840dfea0620b069869b82">createTimer</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> type, <a class="code" href="structTMRTimer.html">TMRTimer</a>* pTimer)
<a name="l00082"></a>00082 {
<a name="l00083"></a>00083   <span class="keywordtype">int</span> iResult=-ENOSYS;
<a name="l00084"></a>00084   <span class="keywordtype">int</span> iTIndex=<a class="code" href="mrtimers_8c.html#1be5b70d8f918fc6dd65a4bad657e1f3">getTypeIndexFromTimerType</a>(type);
<a name="l00085"></a>00085   <span class="keywordflow">if</span> (pTimer &amp;&amp; iTIndex&gt;=0 &amp;&amp; iTIndex&lt;<a class="code" href="mrtimers_8c.html#9361c4a76eaa5dc9c005e0cf2c3e4077">MAX_SYS_TIMERS</a>) {
<a name="l00086"></a>00086     memset(pTimer, 0, <span class="keyword">sizeof</span>(<a class="code" href="structTMRTimer.html">TMRTimer</a>));
<a name="l00087"></a>00087     <span class="keywordflow">if</span> (getitimer(<a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[iTIndex].type, &amp;pTimer-&gt;startvalue)&gt;=0) {
<a name="l00088"></a>00088       pTimer-&gt;id=id;
<a name="l00089"></a>00089       pTimer-&gt;typeIndex=iTIndex;
<a name="l00090"></a>00090       pTimer-&gt;startcycle=<a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[iTIndex].<a class="code" href="structTMRSysTimer.html#178f6c1cd23308ca9cc80e7d1312ead6">cycleCount</a>;
<a name="l00091"></a>00091       <span class="keywordflow">if</span> (<a class="code" href="mrtimers_8c.html#d49fd48232e4a34aa52e75dceb435387">g_MRTdbgFlags</a>&amp;<a class="code" href="mrtimers_8c.html#c5bd1b7687abdf5329151279fca0ea5b">MRT_DBG_TIMER_MSG</a>)
<a name="l00092"></a>00092     fprintf(stderr, <span class="stringliteral">"create timer %d: type %d, cycle %d, sec %d, usec %d\n"</span>, <span class="keywordtype">id</span>, <a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[iTIndex].type, pTimer-&gt;startcycle, (<span class="keywordtype">int</span>)pTimer-&gt;startvalue.it_value.tv_sec, (<span class="keywordtype">int</span>)pTimer-&gt;startvalue.it_value.tv_usec);
<a name="l00093"></a>00093       iResult=id;
<a name="l00094"></a>00094     } <span class="keywordflow">else</span> {
<a name="l00095"></a>00095       fprintf(stderr, <span class="stringliteral">"getitimer failed: error %d\n"</span>, errno);
<a name="l00096"></a>00096       iResult=-EBADR;
<a name="l00097"></a>00097     }
<a name="l00098"></a>00098   } <span class="keywordflow">else</span> {
<a name="l00099"></a>00099     iResult=-EINVAL;
<a name="l00100"></a>00100   }
<a name="l00101"></a>00101   <span class="keywordflow">return</span> iResult;
<a name="l00102"></a>00102 }
<a name="l00103"></a>00103 
<a name="l00104"></a><a class="code" href="mrtimers_8c.html#9cf3aced645ad1e1ccb56d713de29748">00104</a> <span class="keywordtype">int</span> <a class="code" href="mrtimers_8c.html#9cf3aced645ad1e1ccb56d713de29748">deleteTimer</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>) {
<a name="l00105"></a>00105   <span class="keywordtype">int</span> iResult=0;
<a name="l00106"></a>00106   <span class="keywordflow">if</span> (<a class="code" href="mrtimers_8c.html#5b4db1e2c62e8f1bb62e4dc80bb3e378">g_arrayTimers</a>) {
<a name="l00107"></a>00107     <span class="keywordflow">if</span> (<a class="code" href="mrtimers_8c.html#5b4db1e2c62e8f1bb62e4dc80bb3e378">g_arrayTimers</a>[<span class="keywordtype">id</span>-1].<span class="keywordtype">id</span>==<span class="keywordtype">id</span>) {
<a name="l00108"></a>00108       memset(&amp;<a class="code" href="mrtimers_8c.html#5b4db1e2c62e8f1bb62e4dc80bb3e378">g_arrayTimers</a>[<span class="keywordtype">id</span>-1], 0, <span class="keyword">sizeof</span>(<a class="code" href="structTMRTimer.html">TMRTimer</a>));
<a name="l00109"></a>00109       <span class="keywordflow">if</span> (<a class="code" href="mrtimers_8c.html#d49fd48232e4a34aa52e75dceb435387">g_MRTdbgFlags</a>&amp;<a class="code" href="mrtimers_8c.html#c5bd1b7687abdf5329151279fca0ea5b">MRT_DBG_TIMER_MSG</a>)
<a name="l00110"></a>00110     fprintf(stderr, <span class="stringliteral">"delete timer #%d\n"</span>, <span class="keywordtype">id</span>);
<a name="l00111"></a>00111     } <span class="keywordflow">else</span> {
<a name="l00112"></a>00112       fprintf(stderr, <span class="stringliteral">"can not delete timer #%d, entry not found\n"</span>, <span class="keywordtype">id</span>);
<a name="l00113"></a>00113       iResult=-ENOENT;
<a name="l00114"></a>00114     }
<a name="l00115"></a>00115   } <span class="keywordflow">else</span> {
<a name="l00116"></a>00116     fprintf(stderr, <span class="stringliteral">"mrtimers internal error: not initialized\n"</span>);
<a name="l00117"></a>00117     iResult=-EPERM;
<a name="l00118"></a>00118   }
<a name="l00119"></a>00119   <span class="keywordflow">return</span> iResult;
<a name="l00120"></a>00120 }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <span class="comment">/* find an existing entry or find an empty entry for a new timer</span>
<a name="l00123"></a>00123 <span class="comment"> * parameter:</span>
<a name="l00124"></a>00124 <span class="comment"> *   pID - pointer to id, if zero an empty entry is searched, otherwize the entry of timer id</span>
<a name="l00125"></a>00125 <span class="comment"> * result:</span>
<a name="l00126"></a>00126 <span class="comment"> *   pointer to timer structure</span>
<a name="l00127"></a>00127 <span class="comment"> *   id of the timer entry in pID</span>
<a name="l00128"></a>00128 <span class="comment"> */</span>
<a name="l00129"></a><a class="code" href="mrtimers_8c.html#544cb64de2918fd37dfc350f240a8310">00129</a> <a class="code" href="structTMRTimer.html">TMRTimer</a>* <a class="code" href="mrtimers_8c.html#544cb64de2918fd37dfc350f240a8310">findTimerEntry</a>(<span class="keywordtype">int</span>* pID)
<a name="l00130"></a>00130 {
<a name="l00131"></a>00131   <a class="code" href="structTMRTimer.html">TMRTimer</a>* pResult=NULL;
<a name="l00132"></a>00132   <span class="keywordflow">if</span> (<a class="code" href="mrtimers_8c.html#5b4db1e2c62e8f1bb62e4dc80bb3e378">g_arrayTimers</a>) {
<a name="l00133"></a>00133     <span class="keywordtype">int</span> iSearchID=0;
<a name="l00134"></a>00134     <span class="keywordflow">if</span> (pID!=NULL &amp;&amp; *pID&gt;=0) {
<a name="l00135"></a>00135       iSearchID=*pID;
<a name="l00136"></a>00136     }
<a name="l00137"></a>00137     <span class="keywordtype">int</span> i=0;
<a name="l00138"></a>00138     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="mrtimers_8c.html#72e2c21038581ad06e38f329d8661e3c">g_arrayTimerSize</a> &amp;&amp; pResult==NULL; i++) {
<a name="l00139"></a>00139       <span class="keywordflow">if</span> (<a class="code" href="mrtimers_8c.html#5b4db1e2c62e8f1bb62e4dc80bb3e378">g_arrayTimers</a>[i].<span class="keywordtype">id</span>==iSearchID) {
<a name="l00140"></a>00140     pResult=&amp;<a class="code" href="mrtimers_8c.html#5b4db1e2c62e8f1bb62e4dc80bb3e378">g_arrayTimers</a>[i];
<a name="l00141"></a>00141     <span class="keywordflow">if</span> (pID!=NULL &amp;&amp; iSearchID==0) *pID=i+1;
<a name="l00142"></a>00142     <span class="keywordflow">break</span>;
<a name="l00143"></a>00143       }
<a name="l00144"></a>00144     }
<a name="l00145"></a>00145     <span class="keywordflow">if</span> (pResult==0 &amp;&amp; iSearchID==0) {
<a name="l00146"></a>00146       fprintf(stderr, <span class="stringliteral">"mrtimers limited to %d timers at a time\n"</span>, <a class="code" href="mrtimers_8c.html#918e72d38ef74b456fdf4be5930d6aee">INITIAL_TIMER_ARRAY_SIZE</a>);
<a name="l00147"></a>00147       <span class="comment">//iResult=-E2BIG;</span>
<a name="l00148"></a>00148     }
<a name="l00149"></a>00149   } <span class="keywordflow">else</span> {
<a name="l00150"></a>00150     fprintf(stderr, <span class="stringliteral">"mrtimers internal error: not initialized\n"</span>);
<a name="l00151"></a>00151     <span class="comment">//iResult=-EPERM;</span>
<a name="l00152"></a>00152   }
<a name="l00153"></a>00153   <span class="keywordflow">return</span> pResult;
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 <span class="comment">/***************************************************************************************</span>
<a name="l00157"></a>00157 <span class="comment"> * signal handlers</span>
<a name="l00158"></a>00158 <span class="comment"> */</span>
<a name="l00159"></a><a class="code" href="mrtimers_8c.html#144a8348d04e0dda04351b16708de5fc">00159</a> <span class="keywordtype">void</span> <a class="code" href="mrtimers_8c.html#144a8348d04e0dda04351b16708de5fc">sigalarmHandler</a>(<span class="keywordtype">int</span> param) {
<a name="l00160"></a>00160   <a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[0].<a class="code" href="structTMRSysTimer.html#178f6c1cd23308ca9cc80e7d1312ead6">cycleCount</a>++;
<a name="l00161"></a>00161   <span class="keywordflow">if</span> (<a class="code" href="mrtimers_8c.html#d49fd48232e4a34aa52e75dceb435387">g_MRTdbgFlags</a>&amp;<a class="code" href="mrtimers_8c.html#632abc514382013ffc96901425623723">MRT_DBG_HANDLER_MSG</a>)
<a name="l00162"></a>00162     fprintf(stderr, <span class="stringliteral">"sigalarmHandler: %d param=%d\n"</span>, <a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[0].cycleCount, param);
<a name="l00163"></a>00163 }
<a name="l00164"></a>00164 
<a name="l00165"></a><a class="code" href="mrtimers_8c.html#1b718b2ab1a0bda15118a813b608b3f7">00165</a> <span class="keywordtype">void</span> <a class="code" href="mrtimers_8c.html#1b718b2ab1a0bda15118a813b608b3f7">sigvtalarmHandler</a>(<span class="keywordtype">int</span> param) {
<a name="l00166"></a>00166   <a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[1].<a class="code" href="structTMRSysTimer.html#178f6c1cd23308ca9cc80e7d1312ead6">cycleCount</a>++;
<a name="l00167"></a>00167   <span class="keywordflow">if</span> (<a class="code" href="mrtimers_8c.html#d49fd48232e4a34aa52e75dceb435387">g_MRTdbgFlags</a>&amp;<a class="code" href="mrtimers_8c.html#632abc514382013ffc96901425623723">MRT_DBG_HANDLER_MSG</a>)
<a name="l00168"></a>00168     fprintf(stderr, <span class="stringliteral">"sigvtalarmHandler: %d param=%d\n"</span>, <a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[1].cycleCount, param);
<a name="l00169"></a>00169 }
<a name="l00170"></a>00170 
<a name="l00171"></a><a class="code" href="mrtimers_8c.html#96f4bfdf8f5792ecf27625f902384b74">00171</a> <span class="keywordtype">void</span> <a class="code" href="mrtimers_8c.html#96f4bfdf8f5792ecf27625f902384b74">sigprofHandler</a>(<span class="keywordtype">int</span> param) {
<a name="l00172"></a>00172   <a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[2].<a class="code" href="structTMRSysTimer.html#178f6c1cd23308ca9cc80e7d1312ead6">cycleCount</a>++;
<a name="l00173"></a>00173   <span class="keywordflow">if</span> (<a class="code" href="mrtimers_8c.html#d49fd48232e4a34aa52e75dceb435387">g_MRTdbgFlags</a>&amp;<a class="code" href="mrtimers_8c.html#632abc514382013ffc96901425623723">MRT_DBG_HANDLER_MSG</a>)
<a name="l00174"></a>00174     fprintf(stderr, <span class="stringliteral">"sigprofHandler: %d param=%d\n"</span>, <a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[2].cycleCount, param);
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 
<a name="l00177"></a><a class="code" href="mrtimers_8c.html#a4909967ae2a0c587ebc1b8fe7be6f9f">00177</a> <span class="keyword">typedef</span> void (*<a class="code" href="mrtimers_8c.html#a4909967ae2a0c587ebc1b8fe7be6f9f">sighandler_t</a>)(int);
<a name="l00178"></a><a class="code" href="mrtimers_8c.html#251b26222e6aa201fc81e02dc657678a">00178</a> <span class="keywordtype">int</span> <a class="code" href="mrtimers_8c.html#251b26222e6aa201fc81e02dc657678a">g_signals</a>[<a class="code" href="mrtimers_8c.html#9361c4a76eaa5dc9c005e0cf2c3e4077">MAX_SYS_TIMERS</a>]={SIGALRM, SIGVTALRM, SIGPROF};
<a name="l00179"></a><a class="code" href="mrtimers_8c.html#53abeef10d8db3cb7de4bc0b681fddc4">00179</a> <a class="code" href="mrtimers_8c.html#a4909967ae2a0c587ebc1b8fe7be6f9f">sighandler_t</a> <a class="code" href="mrtimers_8c.html#53abeef10d8db3cb7de4bc0b681fddc4">g_signalHandler</a>[<a class="code" href="mrtimers_8c.html#9361c4a76eaa5dc9c005e0cf2c3e4077">MAX_SYS_TIMERS</a>]={<a class="code" href="mrtimers_8c.html#144a8348d04e0dda04351b16708de5fc">sigalarmHandler</a>, <a class="code" href="mrtimers_8c.html#1b718b2ab1a0bda15118a813b608b3f7">sigvtalarmHandler</a>, <a class="code" href="mrtimers_8c.html#96f4bfdf8f5792ecf27625f902384b74">sigprofHandler</a>};
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 <span class="comment">/***************************************************************************************</span>
<a name="l00182"></a>00182 <span class="comment"> * interface functions</span>
<a name="l00183"></a>00183 <span class="comment"> */</span>
<a name="l00184"></a><a class="code" href="mrtimers_8h.html#bf67f427f962506bad53c7ade379249c">00184</a> <span class="keywordtype">int</span> <a class="code" href="mrtimers_8c.html#bf67f427f962506bad53c7ade379249c">initMRTimers</a>(<span class="keywordtype">int</span> iBaseTime)
<a name="l00185"></a>00185 {
<a name="l00186"></a>00186   <span class="keywordtype">int</span> iResult=0;
<a name="l00187"></a>00187   <span class="keywordtype">int</span> i=0;
<a name="l00188"></a>00188   <span class="keyword">struct </span>itimerval value;
<a name="l00189"></a>00189   <span class="keywordflow">if</span> (iBaseTime==0) iBaseTime=1000000;
<a name="l00190"></a>00190   <span class="keywordflow">if</span> (<a class="code" href="mrtimers_8c.html#d49fd48232e4a34aa52e75dceb435387">g_MRTdbgFlags</a>&amp;<a class="code" href="mrtimers_8c.html#14497ff785c41d98a9be15617f68c063">MRT_DBG_INIT_MSG</a>)
<a name="l00191"></a>00191     fprintf(stderr, <span class="stringliteral">"initMRTimers: iBaseTime=%d\n"</span>, iBaseTime);
<a name="l00192"></a>00192   <span class="keywordflow">for</span> (i=0; i&lt;MAX_SYS_TIMERS &amp;&amp; iResult&gt;=0; i++) {
<a name="l00193"></a>00193     <span class="comment">// register handlers for timer signals</span>
<a name="l00194"></a>00194     <span class="keywordflow">if</span> (signal(<a class="code" href="mrtimers_8c.html#251b26222e6aa201fc81e02dc657678a">g_signals</a>[i], <a class="code" href="mrtimers_8c.html#53abeef10d8db3cb7de4bc0b681fddc4">g_signalHandler</a>[i])!=SIG_ERR) {
<a name="l00195"></a>00195       <span class="comment">// check timer</span>
<a name="l00196"></a>00196       <span class="keywordflow">if</span> ((iResult=getitimer(<a class="code" href="mrtimers_8c.html#ea8ea38e23fffb861f535c3e4d933ced">g_systimertypes</a>[i], &amp;value))&gt;=0) {
<a name="l00197"></a>00197     <span class="keywordflow">if</span> (<a class="code" href="mrtimers_8c.html#d49fd48232e4a34aa52e75dceb435387">g_MRTdbgFlags</a>&amp;MRT_DBG_INIT_MSG)
<a name="l00198"></a>00198       fprintf(stderr, <span class="stringliteral">"initMRTimers: system timer %d: value=%d interval=%d\n"</span>, <a class="code" href="mrtimers_8c.html#ea8ea38e23fffb861f535c3e4d933ced">g_systimertypes</a>[i], (<span class="keywordtype">int</span>)value.it_value.tv_usec, (<span class="keywordtype">int</span>)value.it_interval.tv_usec);
<a name="l00199"></a>00199     value.it_value.tv_usec=iBaseTime%1000000;
<a name="l00200"></a>00200     value.it_value.tv_sec=iBaseTime/1000000;
<a name="l00201"></a>00201     value.it_interval.tv_usec=value.it_value.tv_usec;
<a name="l00202"></a>00202     value.it_interval.tv_sec=value.it_value.tv_sec;
<a name="l00203"></a>00203     <span class="comment">// set timer value</span>
<a name="l00204"></a>00204     if ((iResult=setitimer(<a class="code" href="mrtimers_8c.html#ea8ea38e23fffb861f535c3e4d933ced">g_systimertypes</a>[i], &amp;value, NULL))&gt;=0) {
<a name="l00205"></a>00205       <span class="comment">// init systimer struct</span>
<a name="l00206"></a>00206       <a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[i].type=<a class="code" href="mrtimers_8c.html#ea8ea38e23fffb861f535c3e4d933ced">g_systimertypes</a>[i];
<a name="l00207"></a>00207       time(&amp;(<a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[i].started));
<a name="l00208"></a>00208       memcpy(&amp;(<a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[i].value), &amp;value, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> itimerval));
<a name="l00209"></a>00209       <a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[i].<a class="code" href="structTMRSysTimer.html#178f6c1cd23308ca9cc80e7d1312ead6">cycleCount</a>=0;
<a name="l00210"></a>00210     } <span class="keywordflow">else</span> {
<a name="l00211"></a>00211       fprintf(stderr, <span class="stringliteral">"initMRTimers: can not set system timer %d, error %d\n"</span>, <a class="code" href="mrtimers_8c.html#ea8ea38e23fffb861f535c3e4d933ced">g_systimertypes</a>[i], iResult);
<a name="l00212"></a>00212       iResult=-EPERM;
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214       } <span class="keywordflow">else</span> {
<a name="l00215"></a>00215     fprintf(stderr, <span class="stringliteral">"initMRTimers: can not get status of system timer %d, error %d\n"</span>, <a class="code" href="mrtimers_8c.html#ea8ea38e23fffb861f535c3e4d933ced">g_systimertypes</a>[i], iResult);
<a name="l00216"></a>00216     iResult=-EPERM;
<a name="l00217"></a>00217       }
<a name="l00218"></a>00218     } <span class="keywordflow">else</span> {
<a name="l00219"></a>00219       fprintf(stderr, <span class="stringliteral">"can not register signal handler for signal %d\n"</span>, <a class="code" href="mrtimers_8c.html#ea8ea38e23fffb861f535c3e4d933ced">g_systimertypes</a>[i]);
<a name="l00220"></a>00220       iResult=-EPERM;
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222   }
<a name="l00223"></a>00223   <span class="keywordflow">if</span> (iResult&gt;=0) {
<a name="l00224"></a>00224     <a class="code" href="mrtimers_8c.html#72e2c21038581ad06e38f329d8661e3c">g_arrayTimerSize</a>=10;
<a name="l00225"></a>00225     <a class="code" href="mrtimers_8c.html#5b4db1e2c62e8f1bb62e4dc80bb3e378">g_arrayTimers</a>=(<a class="code" href="structTMRTimer.html">TMRTimer</a>*)malloc(<a class="code" href="mrtimers_8c.html#72e2c21038581ad06e38f329d8661e3c">g_arrayTimerSize</a>*<span class="keyword">sizeof</span>(<a class="code" href="structTMRTimer.html">TMRTimer</a>));
<a name="l00226"></a>00226     <span class="keywordflow">if</span> (<a class="code" href="mrtimers_8c.html#5b4db1e2c62e8f1bb62e4dc80bb3e378">g_arrayTimers</a>!=NULL) {
<a name="l00227"></a>00227       memset(<a class="code" href="mrtimers_8c.html#5b4db1e2c62e8f1bb62e4dc80bb3e378">g_arrayTimers</a>, 0, <a class="code" href="mrtimers_8c.html#72e2c21038581ad06e38f329d8661e3c">g_arrayTimerSize</a>*<span class="keyword">sizeof</span>(TMRTimer));
<a name="l00228"></a>00228     } <span class="keywordflow">else</span> {
<a name="l00229"></a>00229       <a class="code" href="mrtimers_8c.html#72e2c21038581ad06e38f329d8661e3c">g_arrayTimerSize</a>=0;
<a name="l00230"></a>00230       iResult=-ENOMEM;
<a name="l00231"></a>00231     }
<a name="l00232"></a>00232   }
<a name="l00233"></a>00233   <span class="keywordflow">return</span> iResult;
<a name="l00234"></a>00234 }
<a name="l00235"></a>00235 
<a name="l00236"></a><a class="code" href="mrtimers_8h.html#7ce639af18d4674cf8e9ad36b95e76da">00236</a> <span class="keywordtype">int</span> <a class="code" href="mrtimers_8c.html#7ce639af18d4674cf8e9ad36b95e76da">releaseMRTimers</a>()
<a name="l00237"></a>00237 {
<a name="l00238"></a>00238   <span class="keywordtype">int</span> iResult=0;
<a name="l00239"></a>00239   <span class="keywordflow">if</span> (<a class="code" href="mrtimers_8c.html#5b4db1e2c62e8f1bb62e4dc80bb3e378">g_arrayTimers</a>!=NULL) {
<a name="l00240"></a>00240     <a class="code" href="structTMRTimer.html">TMRTimer</a>* array=<a class="code" href="mrtimers_8c.html#5b4db1e2c62e8f1bb62e4dc80bb3e378">g_arrayTimers</a>;
<a name="l00241"></a>00241     <a class="code" href="mrtimers_8c.html#72e2c21038581ad06e38f329d8661e3c">g_arrayTimerSize</a>=0;
<a name="l00242"></a>00242     <a class="code" href="mrtimers_8c.html#5b4db1e2c62e8f1bb62e4dc80bb3e378">g_arrayTimers</a>=NULL;
<a name="l00243"></a>00243     free(array);
<a name="l00244"></a>00244   }
<a name="l00245"></a>00245   <span class="keywordflow">return</span> iResult;
<a name="l00246"></a>00246 }
<a name="l00247"></a>00247 
<a name="l00248"></a><a class="code" href="mrtimers_8h.html#42192584a948fab8215173b75a4991b7">00248</a> <span class="keywordtype">int</span> <a class="code" href="mrtimers_8c.html#42192584a948fab8215173b75a4991b7">setMRTimerDebugFlag</a>(<span class="keywordtype">int</span> iFlag)
<a name="l00249"></a>00249 {
<a name="l00250"></a>00250   <a class="code" href="mrtimers_8c.html#d49fd48232e4a34aa52e75dceb435387">g_MRTdbgFlags</a>|=iFlag;
<a name="l00251"></a>00251   <span class="keywordflow">return</span> <a class="code" href="mrtimers_8c.html#d49fd48232e4a34aa52e75dceb435387">g_MRTdbgFlags</a>;
<a name="l00252"></a>00252 }
<a name="l00253"></a>00253 
<a name="l00254"></a><a class="code" href="mrtimers_8h.html#53329aecf5a990cc91ae4355794f32ed">00254</a> <span class="keywordtype">int</span> <a class="code" href="mrtimers_8c.html#53329aecf5a990cc91ae4355794f32ed">clearMRTimerDebugFlag</a>(<span class="keywordtype">int</span> iFlag)
<a name="l00255"></a>00255 {
<a name="l00256"></a>00256   <a class="code" href="mrtimers_8c.html#d49fd48232e4a34aa52e75dceb435387">g_MRTdbgFlags</a>&amp;=~iFlag;
<a name="l00257"></a>00257   <span class="keywordflow">return</span> <a class="code" href="mrtimers_8c.html#d49fd48232e4a34aa52e75dceb435387">g_MRTdbgFlags</a>;
<a name="l00258"></a>00258 }
<a name="l00259"></a>00259 
<a name="l00260"></a><a class="code" href="mrtimers_8h.html#ccfd598b6f1a3ca5599e8bc3588d1cf7">00260</a> <span class="keywordtype">int</span> <a class="code" href="mrtimers_8c.html#ccfd598b6f1a3ca5599e8bc3588d1cf7">startTimer</a>(<span class="keywordtype">int</span> iType)
<a name="l00261"></a>00261 {
<a name="l00262"></a>00262   <span class="keywordtype">int</span> iResult=0;
<a name="l00263"></a>00263   <span class="keywordtype">int</span> iTimerID=0;
<a name="l00264"></a>00264   <a class="code" href="structTMRTimer.html">TMRTimer</a>* pTimer=<a class="code" href="mrtimers_8c.html#544cb64de2918fd37dfc350f240a8310">findTimerEntry</a>(&amp;iTimerID);
<a name="l00265"></a>00265   iResult=<a class="code" href="mrtimers_8c.html#d14acb6d2d5840dfea0620b069869b82">createTimer</a>(iTimerID, iType, pTimer);
<a name="l00266"></a>00266   <span class="keywordflow">if</span> (pTimer) {
<a name="l00267"></a>00267   } <span class="keywordflow">else</span> {
<a name="l00268"></a>00268     iResult=-1;
<a name="l00269"></a>00269   }
<a name="l00270"></a>00270   <span class="keywordflow">return</span> iResult;
<a name="l00271"></a>00271 }
<a name="l00272"></a>00272 
<a name="l00273"></a><a class="code" href="mrtimers_8h.html#bca69eeff549afdd7d72c0d011eea863">00273</a> <span class="keywordtype">int</span> <a class="code" href="mrtimers_8c.html#bca69eeff549afdd7d72c0d011eea863">setTimerHandler</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> iTimeOutSec, <span class="keywordtype">int</span> iTimeOutUsec, <a class="code" href="mrtimers_8h.html#9c199b5712594663db80db9a9ec6d6e0">mrTimerHandler_t</a> handler)
<a name="l00274"></a>00274 {
<a name="l00275"></a>00275   <span class="keywordtype">int</span> iResult=-ENOSYS;
<a name="l00276"></a>00276   <span class="keywordflow">return</span> iResult;
<a name="l00277"></a>00277 }
<a name="l00278"></a>00278 
<a name="l00279"></a><a class="code" href="mrtimers_8h.html#fa991349587b8e300e5363a21dcee3b7">00279</a> <span class="keywordtype">int</span> <a class="code" href="mrtimers_8c.html#fa991349587b8e300e5363a21dcee3b7">stopTimer</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>)
<a name="l00280"></a>00280 {
<a name="l00281"></a>00281   <span class="keywordtype">int</span> iResult=<a class="code" href="mrtimers_8c.html#9cf3aced645ad1e1ccb56d713de29748">deleteTimer</a>(<span class="keywordtype">id</span>);
<a name="l00282"></a>00282   <span class="keywordflow">return</span> iResult;
<a name="l00283"></a>00283 }
<a name="l00284"></a>00284 
<a name="l00285"></a><a class="code" href="mrtimers_8h.html#60a100d9612c31984637866c7e975958">00285</a> <span class="keywordtype">int</span> <a class="code" href="mrtimers_8c.html#60a100d9612c31984637866c7e975958">getTimerValue</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">int</span>* pSec, <span class="keywordtype">int</span>* pUsec)
<a name="l00286"></a>00286 {
<a name="l00287"></a>00287   <span class="keywordtype">int</span> iResult=0;
<a name="l00288"></a>00288   <a class="code" href="structTMRTimer.html">TMRTimer</a>* pTimer=<a class="code" href="mrtimers_8c.html#544cb64de2918fd37dfc350f240a8310">findTimerEntry</a>(&amp;<span class="keywordtype">id</span>);
<a name="l00289"></a>00289   <span class="keywordflow">if</span> (pTimer) {
<a name="l00290"></a>00290     <span class="keyword">struct </span>itimerval currval;
<a name="l00291"></a>00291     <span class="keywordflow">if</span> ((iResult=getitimer(<a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[pTimer-&gt;<a class="code" href="structTMRTimer.html#09f50fe723b1b20ac76d41e7ccc925a5">typeIndex</a>].type, &amp;currval))&gt;=0) {
<a name="l00292"></a>00292       <span class="keywordflow">if</span> (<a class="code" href="mrtimers_8c.html#d49fd48232e4a34aa52e75dceb435387">g_MRTdbgFlags</a>&amp;<a class="code" href="mrtimers_8c.html#c5bd1b7687abdf5329151279fca0ea5b">MRT_DBG_TIMER_MSG</a>)
<a name="l00293"></a>00293     fprintf(stderr, <span class="stringliteral">"calculating time value for timer %d: systimer cycle %d, sec %d, usec %d\n"</span>, (<span class="keywordtype">int</span>)<span class="keywordtype">id</span>, <a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[pTimer-&gt;<a class="code" href="structTMRTimer.html#09f50fe723b1b20ac76d41e7ccc925a5">typeIndex</a>].cycleCount, (<span class="keywordtype">int</span>)currval.it_value.tv_sec, (<span class="keywordtype">int</span>)currval.it_value.tv_usec);
<a name="l00294"></a>00294       <span class="keywordtype">int</span> iCycles=<a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[pTimer-&gt;<a class="code" href="structTMRTimer.html#09f50fe723b1b20ac76d41e7ccc925a5">typeIndex</a>].<a class="code" href="structTMRSysTimer.html#178f6c1cd23308ca9cc80e7d1312ead6">cycleCount</a>-pTimer-&gt;<a class="code" href="structTMRTimer.html#43ffe7cabf87a2cbb545d37eafd42236">startcycle</a>;
<a name="l00295"></a>00295       <span class="keywordtype">int</span> iTimeUsec=0;
<a name="l00296"></a>00296       <span class="keywordtype">int</span> iTimeSec=0;
<a name="l00297"></a>00297       iTimeUsec=iCycles*pTimer-&gt;<a class="code" href="structTMRTimer.html#fab1ebdf9b11ae3bfd43feb3e598226b">startvalue</a>.it_interval.tv_usec+pTimer-&gt;<a class="code" href="structTMRTimer.html#fab1ebdf9b11ae3bfd43feb3e598226b">startvalue</a>.it_value.tv_usec-currval.it_value.tv_usec;
<a name="l00298"></a>00298       iTimeSec=iCycles*pTimer-&gt;<a class="code" href="structTMRTimer.html#fab1ebdf9b11ae3bfd43feb3e598226b">startvalue</a>.it_interval.tv_sec+pTimer-&gt;<a class="code" href="structTMRTimer.html#fab1ebdf9b11ae3bfd43feb3e598226b">startvalue</a>.it_value.tv_sec-currval.it_value.tv_sec;
<a name="l00299"></a>00299       <span class="keywordflow">while</span> (iTimeUsec&lt;0) {
<a name="l00300"></a>00300     iTimeUsec+=1000000;
<a name="l00301"></a>00301     iTimeSec--;
<a name="l00302"></a>00302       }
<a name="l00303"></a>00303       <span class="keywordflow">while</span> (iTimeUsec&gt;1000000) {
<a name="l00304"></a>00304     iTimeUsec-=1000000;
<a name="l00305"></a>00305     iTimeSec++;
<a name="l00306"></a>00306       }
<a name="l00307"></a>00307       <span class="keywordflow">if</span> (pSec!=NULL &amp;&amp; pUsec!=NULL) {
<a name="l00308"></a>00308     *pSec=iTimeSec;
<a name="l00309"></a>00309     *pUsec=iTimeUsec;
<a name="l00310"></a>00310       }
<a name="l00311"></a>00311       iResult=iTimeSec;
<a name="l00312"></a>00312     } <span class="keywordflow">else</span> {
<a name="l00313"></a>00313       fprintf(stderr, <span class="stringliteral">"mrtimers: can not get current time of systemtimer %d\n"</span>, <a class="code" href="mrtimers_8c.html#a7cc6d5cbb6a544ce433ed47ae8006fd">g_systimers</a>[pTimer-&gt;<a class="code" href="structTMRTimer.html#09f50fe723b1b20ac76d41e7ccc925a5">typeIndex</a>].type);
<a name="l00314"></a>00314     }
<a name="l00315"></a>00315   } <span class="keywordflow">else</span> {
<a name="l00316"></a>00316     fprintf(stderr, <span class="stringliteral">"mrtimers: can not get entry for timer %d\n"</span>, <span class="keywordtype">id</span>);
<a name="l00317"></a>00317     iResult=-ENOENT;
<a name="l00318"></a>00318   }
<a name="l00319"></a>00319   <span class="keywordflow">return</span> iResult;
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00322"></a><a class="code" href="mrtimers_8c.html#c52e8029ebd28d6104402bc3f1f7948b">00322</a> <span class="keywordtype">char</span> <a class="code" href="mrtimers_8c.html#c52e8029ebd28d6104402bc3f1f7948b">g_strTime</a>[20];
<a name="l00323"></a><a class="code" href="mrtimers_8h.html#eec88b57f56b75bdef646c5e44e0c2dc">00323</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="mrtimers_8c.html#eec88b57f56b75bdef646c5e44e0c2dc">getTimerValueString</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>)
<a name="l00324"></a>00324 {
<a name="l00325"></a>00325   <a class="code" href="mrtimers_8c.html#c52e8029ebd28d6104402bc3f1f7948b">g_strTime</a>[0]=0;
<a name="l00326"></a>00326   <span class="keywordtype">int</span> iSec=0;
<a name="l00327"></a>00327   <span class="keywordtype">int</span> iUsec=0;
<a name="l00328"></a>00328   <span class="keywordflow">if</span> (<a class="code" href="mrtimers_8c.html#60a100d9612c31984637866c7e975958">getTimerValue</a>(<span class="keywordtype">id</span>, &amp;iSec, &amp;iUsec)&gt;=0) {
<a name="l00329"></a>00329     sprintf(<a class="code" href="mrtimers_8c.html#c52e8029ebd28d6104402bc3f1f7948b">g_strTime</a>, <span class="stringliteral">"%d.%d"</span>, iSec, iUsec);
<a name="l00330"></a>00330   }
<a name="l00331"></a>00331   <span class="keywordflow">return</span> (<span class="keyword">const</span> <span class="keywordtype">char</span>*)<a class="code" href="mrtimers_8c.html#c52e8029ebd28d6104402bc3f1f7948b">g_strTime</a>;
<a name="l00332"></a>00332 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on 12 Nov 2013 for RCU linux tools and drivers for the DCS board  by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
