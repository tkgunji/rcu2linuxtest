<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RCU linux tools and drivers for the DCS board : Getline.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>Getline.c</h1><a href="Getline_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* $Id: Getline.c,v 1.2 2005/11/01 14:27:51 richter Exp $ */</span>
<a name="l00002"></a>00002 <span class="comment">/* this file has been taken from the ROOT framework without changes */</span>
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="comment">/* Author: */</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="comment">/*</span>
<a name="l00007"></a>00007 <span class="comment"> * Copyright (C) 1991, 1992 by Chris Thewalt (thewalt@ce.berkeley.edu)</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * Permission to use, copy, modify, and distribute this software</span>
<a name="l00010"></a>00010 <span class="comment"> * for any purpose and without fee is hereby granted, provided</span>
<a name="l00011"></a>00011 <span class="comment"> * that the above copyright notices appear in all copies and that both the</span>
<a name="l00012"></a>00012 <span class="comment"> * copyright notice and this permission notice appear in supporting</span>
<a name="l00013"></a>00013 <span class="comment"> * documentation.  This software is provided "as is" without express or</span>
<a name="l00014"></a>00014 <span class="comment"> * implied warranty.</span>
<a name="l00015"></a>00015 <span class="comment"> */</span>
<a name="l00016"></a>00016 <span class="comment">/*</span>
<a name="l00017"></a>00017 <span class="comment">*************************** Motivation **********************************</span>
<a name="l00018"></a>00018 <span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">Many interactive programs read input line by line, but would like to</span>
<a name="l00020"></a>00020 <span class="comment">provide line editing and history functionality to the end-user that</span>
<a name="l00021"></a>00021 <span class="comment">runs the program.</span>
<a name="l00022"></a>00022 <span class="comment"></span>
<a name="l00023"></a>00023 <span class="comment">The input-edit package provides that functionality.  As far as the</span>
<a name="l00024"></a>00024 <span class="comment">programmer is concerned, the program only asks for the next line</span>
<a name="l00025"></a>00025 <span class="comment">of input. However, until the user presses the RETURN key they can use</span>
<a name="l00026"></a>00026 <span class="comment">emacs-style line editing commands and can traverse the history of lines</span>
<a name="l00027"></a>00027 <span class="comment">previously typed.</span>
<a name="l00028"></a>00028 <span class="comment"></span>
<a name="l00029"></a>00029 <span class="comment">Other packages, such as GNU's readline, have greater capability but are</span>
<a name="l00030"></a>00030 <span class="comment">also substantially larger.  Input-edit is small, since it uses neither</span>
<a name="l00031"></a>00031 <span class="comment">stdio nor any termcap features, and is also quite portable.  It only uses</span>
<a name="l00032"></a>00032 <span class="comment">\b to backspace and \007 to ring the bell on errors.  Since it cannot</span>
<a name="l00033"></a>00033 <span class="comment">edit multiple lines it scrolls long lines left and right on the same line.</span>
<a name="l00034"></a>00034 <span class="comment"></span>
<a name="l00035"></a>00035 <span class="comment">Input edit uses classic (not ANSI) C, and should run on any Unix</span>
<a name="l00036"></a>00036 <span class="comment">system (BSD or SYSV), PC's with the MSC compiler, or Vax/VMS (untested by me).</span>
<a name="l00037"></a>00037 <span class="comment">Porting the package to new systems basicaly requires code to read a</span>
<a name="l00038"></a>00038 <span class="comment">character when it is typed without echoing it, everything else should be OK.</span>
<a name="l00039"></a>00039 <span class="comment"></span>
<a name="l00040"></a>00040 <span class="comment">I have run the package on:</span>
<a name="l00041"></a>00041 <span class="comment"></span>
<a name="l00042"></a>00042 <span class="comment">        DECstation 5000, Ultrix 4.2 with cc and gcc</span>
<a name="l00043"></a>00043 <span class="comment">        Sun Sparc 2, SunOS 4.1.1, with cc</span>
<a name="l00044"></a>00044 <span class="comment">        SGI Iris, IRIX System V.3, with cc</span>
<a name="l00045"></a>00045 <span class="comment">        PC, DRDOS 5.0, with MSC 6.0</span>
<a name="l00046"></a>00046 <span class="comment"></span>
<a name="l00047"></a>00047 <span class="comment">The description below is broken into two parts, the end-user (editing)</span>
<a name="l00048"></a>00048 <span class="comment">interface and the programmer interface.  Send bug reports, fixes and</span>
<a name="l00049"></a>00049 <span class="comment">enhancements to:</span>
<a name="l00050"></a>00050 <span class="comment"></span>
<a name="l00051"></a>00051 <span class="comment">Chris Thewalt (thewalt@ce.berkeley.edu)</span>
<a name="l00052"></a>00052 <span class="comment">2/4/92</span>
<a name="l00053"></a>00053 <span class="comment"></span>
<a name="l00054"></a>00054 <span class="comment">PS: I don't have, and don't want to add, a vi mode, sorry.</span>
<a name="l00055"></a>00055 <span class="comment"></span>
<a name="l00056"></a>00056 <span class="comment">************************** End-User Interface ***************************</span>
<a name="l00057"></a>00057 <span class="comment"></span>
<a name="l00058"></a>00058 <span class="comment">Entering printable keys generally inserts new text into the buffer (unless</span>
<a name="l00059"></a>00059 <span class="comment">in overwrite mode, see below).  Other special keys can be used to modify</span>
<a name="l00060"></a>00060 <span class="comment">the text in the buffer.  In the description of the keys below, ^n means</span>
<a name="l00061"></a>00061 <span class="comment">Control-n, or holding the CONTROL key down while pressing "n". M-B means</span>
<a name="l00062"></a>00062 <span class="comment">Meta-B (or Alt-B). Errors will ring the terminal bell.</span>
<a name="l00063"></a>00063 <span class="comment"></span>
<a name="l00064"></a>00064 <span class="comment">^A/^E   : Move cursor to beginning/end of the line.</span>
<a name="l00065"></a>00065 <span class="comment">^F/^B   : Move cursor forward/backward one character.</span>
<a name="l00066"></a>00066 <span class="comment">^D      : Delete the character under the cursor.</span>
<a name="l00067"></a>00067 <span class="comment">^H, DEL : Delete the character to the left of the cursor.</span>
<a name="l00068"></a>00068 <span class="comment">^K      : Kill from the cursor to the end of line.</span>
<a name="l00069"></a>00069 <span class="comment">^L      : Redraw current line.</span>
<a name="l00070"></a>00070 <span class="comment">^O      : Toggle overwrite/insert mode. Initially in insert mode. Text</span>
<a name="l00071"></a>00071 <span class="comment">          added in overwrite mode (including yanks) overwrite</span>
<a name="l00072"></a>00072 <span class="comment">          existing text, while insert mode does not overwrite.</span>
<a name="l00073"></a>00073 <span class="comment">^P/^N   : Move to previous/next item on history list.</span>
<a name="l00074"></a>00074 <span class="comment">^R/^S   : Perform incremental reverse/forward search for string on</span>
<a name="l00075"></a>00075 <span class="comment">          the history list.  Typing normal characters adds to the current</span>
<a name="l00076"></a>00076 <span class="comment">          search string and searches for a match. Typing ^R/^S marks</span>
<a name="l00077"></a>00077 <span class="comment">          the start of a new search, and moves on to the next match.</span>
<a name="l00078"></a>00078 <span class="comment">          Typing ^H or DEL deletes the last character from the search</span>
<a name="l00079"></a>00079 <span class="comment">          string, and searches from the starting location of the last search.</span>
<a name="l00080"></a>00080 <span class="comment">          Therefore, repeated DEL's appear to unwind to the match nearest</span>
<a name="l00081"></a>00081 <span class="comment">          the point at which the last ^R or ^S was typed.  If DEL is</span>
<a name="l00082"></a>00082 <span class="comment">          repeated until the search string is empty the search location</span>
<a name="l00083"></a>00083 <span class="comment">          begins from the start of the history list.  Typing ESC or</span>
<a name="l00084"></a>00084 <span class="comment">          any other editing character accepts the current match and</span>
<a name="l00085"></a>00085 <span class="comment">          loads it into the buffer, terminating the search.</span>
<a name="l00086"></a>00086 <span class="comment">^T      : Toggle the characters under and to the left of the cursor.</span>
<a name="l00087"></a>00087 <span class="comment">^U      : Kill from beginning to the end of the line.</span>
<a name="l00088"></a>00088 <span class="comment">^Y      : Yank previously killed text back at current location.  Note that</span>
<a name="l00089"></a>00089 <span class="comment">          this will overwrite or insert, depending on the current mode.</span>
<a name="l00090"></a>00090 <span class="comment">M-F/M-B : Move cursor forward/backward one word.</span>
<a name="l00091"></a>00091 <span class="comment">M-D     : Delete the word under the cursor.</span>
<a name="l00092"></a>00092 <span class="comment">^SPC    : Set mark.</span>
<a name="l00093"></a>00093 <span class="comment">^W      : Kill from mark to point.</span>
<a name="l00094"></a>00094 <span class="comment">^X      : Exchange mark and point.</span>
<a name="l00095"></a>00095 <span class="comment">TAB     : By default adds spaces to buffer to get to next TAB stop</span>
<a name="l00096"></a>00096 <span class="comment">          (just after every 8th column), although this may be rebound by the</span>
<a name="l00097"></a>00097 <span class="comment">          programmer, as described below.</span>
<a name="l00098"></a>00098 <span class="comment">NL, CR  : returns current buffer to the program.</span>
<a name="l00099"></a>00099 <span class="comment"></span>
<a name="l00100"></a>00100 <span class="comment">DOS and ANSI terminal arrow key sequences are recognized, and act like:</span>
<a name="l00101"></a>00101 <span class="comment"></span>
<a name="l00102"></a>00102 <span class="comment">  up    : same as ^P</span>
<a name="l00103"></a>00103 <span class="comment">  down  : same as ^N</span>
<a name="l00104"></a>00104 <span class="comment">  left  : same as ^B</span>
<a name="l00105"></a>00105 <span class="comment">  right : same as ^F</span>
<a name="l00106"></a>00106 <span class="comment"></span>
<a name="l00107"></a>00107 <span class="comment">************************** Programmer Interface ***************************</span>
<a name="l00108"></a>00108 <span class="comment"></span>
<a name="l00109"></a>00109 <span class="comment">The programmer accesses input-edit through five functions, and optionally</span>
<a name="l00110"></a>00110 <span class="comment">through three additional function pointer hooks.  The five functions are:</span>
<a name="l00111"></a>00111 <span class="comment"></span>
<a name="l00112"></a>00112 <span class="comment">char *Getline(const char *prompt)</span>
<a name="l00113"></a>00113 <span class="comment"></span>
<a name="l00114"></a>00114 <span class="comment">        Prints the prompt and allows the user to edit the current line. A</span>
<a name="l00115"></a>00115 <span class="comment">        pointer to the line is returned when the user finishes by</span>
<a name="l00116"></a>00116 <span class="comment">        typing a newline or a return.  Unlike GNU readline, the returned</span>
<a name="l00117"></a>00117 <span class="comment">        pointer points to a static buffer, so it should not be free'd, and</span>
<a name="l00118"></a>00118 <span class="comment">        the buffer contains the newline character.  The user enters an</span>
<a name="l00119"></a>00119 <span class="comment">        end-of-file by typing ^D on an empty line, in which case the</span>
<a name="l00120"></a>00120 <span class="comment">        first character of the returned buffer is '\0'.  Getline never</span>
<a name="l00121"></a>00121 <span class="comment">        returns a NULL pointer.  The getline function sets terminal modes</span>
<a name="l00122"></a>00122 <span class="comment">        needed to make it work, and resets them before returning to the</span>
<a name="l00123"></a>00123 <span class="comment">        caller.  The getline function also looks for characters that would</span>
<a name="l00124"></a>00124 <span class="comment">        generate a signal, and resets the terminal modes before raising the</span>
<a name="l00125"></a>00125 <span class="comment">        signal condition.  If the signal handler returns to getline,</span>
<a name="l00126"></a>00126 <span class="comment">        the screen is automatically redrawn and editing can continue.</span>
<a name="l00127"></a>00127 <span class="comment">        Getline now requires both the input and output stream be connected</span>
<a name="l00128"></a>00128 <span class="comment">        to the terminal (not redirected) so the main program should check</span>
<a name="l00129"></a>00129 <span class="comment">        to make sure this is true.  If input or output have been redirected</span>
<a name="l00130"></a>00130 <span class="comment">        the main program should use buffered IO (stdio) rather than</span>
<a name="l00131"></a>00131 <span class="comment">        the slow 1 character read()s that getline uses (note: this limitation</span>
<a name="l00132"></a>00132 <span class="comment">        has been removed).</span>
<a name="l00133"></a>00133 <span class="comment"></span>
<a name="l00134"></a>00134 <span class="comment">char *Getlinem(int mode, const char *prompt)</span>
<a name="l00135"></a>00135 <span class="comment"></span>
<a name="l00136"></a>00136 <span class="comment">        mode: -1 = init, 0 = line mode, 1 = one char at a time mode, 2 = cleanup</span>
<a name="l00137"></a>00137 <span class="comment"></span>
<a name="l00138"></a>00138 <span class="comment">        More specialized version of the previous function. Depending on</span>
<a name="l00139"></a>00139 <span class="comment">        the mode, it behaves differently. Its main use is to allow</span>
<a name="l00140"></a>00140 <span class="comment">        character by character input from the input stream (useful when</span>
<a name="l00141"></a>00141 <span class="comment">        in an X eventloop). It will return NULL as long as no newline</span>
<a name="l00142"></a>00142 <span class="comment">        has been received. Its use is typically as follows:</span>
<a name="l00143"></a>00143 <span class="comment">        1) In the program initialization part one calls: Getlinem(-1,"prompt&gt;")</span>
<a name="l00144"></a>00144 <span class="comment">        2) In the X inputhandler: if ((line = Getlinem(1,NULL))) {</span>
<a name="l00145"></a>00145 <span class="comment">        3) In the termination routine: Getlinem(2,NULL)</span>
<a name="l00146"></a>00146 <span class="comment">        With mode=0 the function behaves exactly like the previous function.</span>
<a name="l00147"></a>00147 <span class="comment"></span>
<a name="l00148"></a>00148 <span class="comment">void Gl_config(const char *which, int value)</span>
<a name="l00149"></a>00149 <span class="comment"></span>
<a name="l00150"></a>00150 <span class="comment">        Set some config options. Which can be:</span>
<a name="l00151"></a>00151 <span class="comment">          "noecho":  do not echo characters (used for passwd input)</span>
<a name="l00152"></a>00152 <span class="comment">          "erase":   do erase line after return (used for text scrollers)</span>
<a name="l00153"></a>00153 <span class="comment"></span>
<a name="l00154"></a>00154 <span class="comment">void Gl_setwidth(int width)</span>
<a name="l00155"></a>00155 <span class="comment"></span>
<a name="l00156"></a>00156 <span class="comment">        Set the width of the terminal to the specified width. The default</span>
<a name="l00157"></a>00157 <span class="comment">        width is 80 characters, so this function need only be called if the</span>
<a name="l00158"></a>00158 <span class="comment">        width of the terminal is not 80.  Since horizontal scrolling is</span>
<a name="l00159"></a>00159 <span class="comment">        controlled by this parameter it is important to get it right.</span>
<a name="l00160"></a>00160 <span class="comment"></span>
<a name="l00161"></a>00161 <span class="comment">void Gl_histinit(char *file)</span>
<a name="l00162"></a>00162 <span class="comment"></span>
<a name="l00163"></a>00163 <span class="comment">        This function reads a history list from file. So lines from a</span>
<a name="l00164"></a>00164 <span class="comment">        previous session can be used again.</span>
<a name="l00165"></a>00165 <span class="comment"></span>
<a name="l00166"></a>00166 <span class="comment">void Gl_histadd(char *buf)</span>
<a name="l00167"></a>00167 <span class="comment"></span>
<a name="l00168"></a>00168 <span class="comment">        The Gl_histadd function checks to see if the buf is not empty or</span>
<a name="l00169"></a>00169 <span class="comment">        whitespace, and also checks to make sure it is different than</span>
<a name="l00170"></a>00170 <span class="comment">        the last saved buffer to avoid repeats on the history list.</span>
<a name="l00171"></a>00171 <span class="comment">        If the buf is a new non-blank string a copy is made and saved on</span>
<a name="l00172"></a>00172 <span class="comment">        the history list, so the caller can re-use the specified buf.</span>
<a name="l00173"></a>00173 <span class="comment"></span>
<a name="l00174"></a>00174 <span class="comment">The main loop in testgl.c, included in this directory, shows how the</span>
<a name="l00175"></a>00175 <span class="comment">input-edit package can be used:</span>
<a name="l00176"></a>00176 <span class="comment"></span>
<a name="l00177"></a>00177 <span class="comment">extern char *Getline();</span>
<a name="l00178"></a>00178 <span class="comment">extern void  Gl_histadd();</span>
<a name="l00179"></a>00179 <span class="comment">main()</span>
<a name="l00180"></a>00180 <span class="comment">{</span>
<a name="l00181"></a>00181 <span class="comment">    char *p;</span>
<a name="l00182"></a>00182 <span class="comment">    Gl_histinit(".hist");</span>
<a name="l00183"></a>00183 <span class="comment">    do {</span>
<a name="l00184"></a>00184 <span class="comment">        p = Getline("PROMPT&gt;&gt;&gt;&gt; ");</span>
<a name="l00185"></a>00185 <span class="comment">        Gl_histadd(p);</span>
<a name="l00186"></a>00186 <span class="comment">        fputs(p, stdout);</span>
<a name="l00187"></a>00187 <span class="comment">    } while (*p != 0);</span>
<a name="l00188"></a>00188 <span class="comment">}</span>
<a name="l00189"></a>00189 <span class="comment"></span>
<a name="l00190"></a>00190 <span class="comment">In order to allow the main program to have additional access to the buffer,</span>
<a name="l00191"></a>00191 <span class="comment">to implement things such as completion or auto-indent modes, three</span>
<a name="l00192"></a>00192 <span class="comment">function pointers can be bound to user functions to modify the buffer as</span>
<a name="l00193"></a>00193 <span class="comment">described below.  By default Gl_in_hook and Gl_out_hook are set to NULL,</span>
<a name="l00194"></a>00194 <span class="comment">and Gl_tab_hook is bound to a function that inserts spaces until the next</span>
<a name="l00195"></a>00195 <span class="comment">logical tab stop is reached.  The user can reassign any of these pointers</span>
<a name="l00196"></a>00196 <span class="comment">to other functions.  Each of the functions bound to these hooks receives</span>
<a name="l00197"></a>00197 <span class="comment">the current buffer as the first argument, and must return the location of</span>
<a name="l00198"></a>00198 <span class="comment">the leftmost change made in the buffer.  If the buffer isn't modified the</span>
<a name="l00199"></a>00199 <span class="comment">functions should return -1.  When the hook function returns the screen is</span>
<a name="l00200"></a>00200 <span class="comment">updated to reflect any changes made by the user function.</span>
<a name="l00201"></a>00201 <span class="comment"></span>
<a name="l00202"></a>00202 <span class="comment">int (*Gl_in_hook)(char *buf)</span>
<a name="l00203"></a>00203 <span class="comment"></span>
<a name="l00204"></a>00204 <span class="comment">        If Gl_in_hook is non-NULL the function is called each time a new</span>
<a name="l00205"></a>00205 <span class="comment">        buffer is loaded. It is called when getline is entered, with an</span>
<a name="l00206"></a>00206 <span class="comment">        empty buffer, it is called each time a new buffer is loaded from</span>
<a name="l00207"></a>00207 <span class="comment">        the history with ^P or ^N, and it is called when an incremental</span>
<a name="l00208"></a>00208 <span class="comment">        search string is accepted (when the search is terminated). The</span>
<a name="l00209"></a>00209 <span class="comment">        buffer can be modified and will be redrawn upon return to Getline().</span>
<a name="l00210"></a>00210 <span class="comment"></span>
<a name="l00211"></a>00211 <span class="comment">int (*Gl_out_hook)(char *buf)</span>
<a name="l00212"></a>00212 <span class="comment"></span>
<a name="l00213"></a>00213 <span class="comment">        If Gl_out_hook is non-NULL it is called when a line has been</span>
<a name="l00214"></a>00214 <span class="comment">        completed by the user entering a newline or return. The buffer</span>
<a name="l00215"></a>00215 <span class="comment">        handed to the hook does not yet have the newline appended. If the</span>
<a name="l00216"></a>00216 <span class="comment">        buffer is modified the screen is redrawn before getline returns the</span>
<a name="l00217"></a>00217 <span class="comment">        buffer to the caller.</span>
<a name="l00218"></a>00218 <span class="comment"></span>
<a name="l00219"></a>00219 <span class="comment">int (*Gl_tab_hook)(char *buf, int prompt_width, int *cursor_loc)</span>
<a name="l00220"></a>00220 <span class="comment"></span>
<a name="l00221"></a>00221 <span class="comment">        If Gl_tab_hook is non-NULL, it is called whenever a tab is typed.</span>
<a name="l00222"></a>00222 <span class="comment">        In addition to receiving the buffer, the current prompt width is</span>
<a name="l00223"></a>00223 <span class="comment">        given (needed to do tabbing right) and a pointer to the cursor</span>
<a name="l00224"></a>00224 <span class="comment">        offset is given, where a 0 offset means the first character in the</span>
<a name="l00225"></a>00225 <span class="comment">        line.  Not only does the cursor_loc tell the programmer where the</span>
<a name="l00226"></a>00226 <span class="comment">        TAB was received, but it can be reset so that the cursor will end</span>
<a name="l00227"></a>00227 <span class="comment">        up at the specified location after the screen is redrawn.</span>
<a name="l00228"></a>00228 <span class="comment">*/</span>
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 <span class="comment">/* forward reference needed for Gl_tab_hook */</span>
<a name="l00231"></a>00231 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="Getline_8c.html#4a8ec09a3528876aa0d3f6532e2180cc">gl_tab</a>(<span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> offset, <span class="keywordtype">int</span> *loc);
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 <span class="comment">/********************* exported interface ********************************/</span>
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 <span class="keywordtype">char</span>   *<a class="code" href="Getline_8c.html#d4f9d54d023bc30cc8f3e721d81ce386">Getline</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *prompt); <span class="comment">/* read a line of input */</span>
<a name="l00236"></a>00236 <span class="keywordtype">char</span>   *<a class="code" href="Getline_8c.html#9645d45daf029b25184ebb1632e3bec2">Getlinem</a>(<span class="keywordtype">int</span> mode, <span class="keyword">const</span> <span class="keywordtype">char</span> *prompt); <span class="comment">/* allows reading char by char */</span>
<a name="l00237"></a>00237 <span class="keywordtype">void</span>    <a class="code" href="Getline_8c.html#666d05c4f215e909faf86ddb23f80f67">Gl_config</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *which, <span class="keywordtype">int</span> value); <span class="comment">/* set some options */</span>
<a name="l00238"></a>00238 <span class="keywordtype">void</span>    <a class="code" href="Getline_8c.html#e5f71b17ad9b817aea471a77c807481b">Gl_setwidth</a>(<span class="keywordtype">int</span> w);          <span class="comment">/* specify width of screen */</span>
<a name="l00239"></a>00239 <span class="keywordtype">void</span>    <a class="code" href="Getline_8c.html#2b3c73f73a6552fbda3e4f0189110502">Gl_windowchanged</a>();          <span class="comment">/* call after SIGWINCH signal */</span>
<a name="l00240"></a>00240 <span class="keywordtype">void</span>    <a class="code" href="Getline_8c.html#3d83e69b1227d6eb301637ec4977c76b">Gl_histinit</a>(<span class="keywordtype">char</span> *file);     <span class="comment">/* read entries from old histfile */</span>
<a name="l00241"></a>00241 <span class="keywordtype">void</span>    <a class="code" href="Getline_8c.html#5bc9732aae5850cd5a7b8c7886f3384f">Gl_histadd</a>(<span class="keywordtype">char</span> *buf);       <span class="comment">/* adds entries to hist */</span>
<a name="l00242"></a>00242 
<a name="l00243"></a><a class="code" href="Getline_8c.html#f3a7308de9b610f1230c5f54befd2b9a">00243</a> int             (*<a class="code" href="Getline_8c.html#f3a7308de9b610f1230c5f54befd2b9a">Gl_in_hook</a>)(<span class="keywordtype">char</span> *buf) = 0;
<a name="l00244"></a><a class="code" href="Getline_8c.html#5b29019cf7968853ffb03243c3bea424">00244</a> int             (*<a class="code" href="Getline_8c.html#5b29019cf7968853ffb03243c3bea424">Gl_out_hook</a>)(<span class="keywordtype">char</span> *buf) = 0;
<a name="l00245"></a><a class="code" href="Getline_8c.html#e85d40db728ac8437000be3c637b98ab">00245</a> int             (*<a class="code" href="Getline_8c.html#e85d40db728ac8437000be3c637b98ab">Gl_tab_hook</a>)(<span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> prompt_width, <span class="keywordtype">int</span> *loc) = <a class="code" href="Getline_8c.html#4a8ec09a3528876aa0d3f6532e2180cc">gl_tab</a>;
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 <span class="comment">/******************** imported interface *********************************/</span>
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00250"></a>00250 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00251"></a>00251 <span class="preprocessor">#include &lt;errno.h&gt;</span>
<a name="l00252"></a>00252 <span class="preprocessor">#include &lt;signal.h&gt;</span>
<a name="l00253"></a>00253 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00254"></a>00254 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 <span class="comment">/******************** internal interface *********************************/</span>
<a name="l00257"></a>00257 
<a name="l00258"></a><a class="code" href="Getline_8c.html#6821bafc3c88dfb2e433a095df9940c6">00258</a> <span class="preprocessor">#define BUF_SIZE 1024</span>
<a name="l00259"></a>00259 <span class="preprocessor"></span>
<a name="l00260"></a><a class="code" href="Getline_8c.html#530bc6f98e7807246ab93a1056a22211">00260</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#530bc6f98e7807246ab93a1056a22211">gl_init_done</a> = -1;      <span class="comment">/* terminal mode flag  */</span>
<a name="l00261"></a><a class="code" href="Getline_8c.html#7f7957926207f30e875bb787f2dc7a3d">00261</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#7f7957926207f30e875bb787f2dc7a3d">gl_notty</a> = 0;           <span class="comment">/* 1 when not a tty */</span>
<a name="l00262"></a><a class="code" href="Getline_8c.html#0f75a96ef89d563b1d6e0d33e6393239">00262</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#0f75a96ef89d563b1d6e0d33e6393239">gl_eof</a> = 0;             <span class="comment">/* 1 when not a tty and read() == -1 */</span>
<a name="l00263"></a><a class="code" href="Getline_8c.html#47ad6029530fe4c2b9e47f2dcfbf1690">00263</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#47ad6029530fe4c2b9e47f2dcfbf1690">gl_termw</a> = 80;          <span class="comment">/* actual terminal width */</span>
<a name="l00264"></a><a class="code" href="Getline_8c.html#3425dfcd249ed4b5c439727afff7edb7">00264</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#3425dfcd249ed4b5c439727afff7edb7">gl_scroll</a> = 27;         <span class="comment">/* width of EOL scrolling region */</span>
<a name="l00265"></a><a class="code" href="Getline_8c.html#219531cddf67f1009a3d23c599f0138c">00265</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#219531cddf67f1009a3d23c599f0138c">gl_width</a> = 0;           <span class="comment">/* net size available for input */</span>
<a name="l00266"></a><a class="code" href="Getline_8c.html#7ebc25e8509b7b84cc07e10ced5eb694">00266</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#7ebc25e8509b7b84cc07e10ced5eb694">gl_extent</a> = 0;          <span class="comment">/* how far to redraw, 0 means all */</span>
<a name="l00267"></a><a class="code" href="Getline_8c.html#9024eafac53bfdf2232bf173e993845a">00267</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#9024eafac53bfdf2232bf173e993845a">gl_overwrite</a> = 0;       <span class="comment">/* overwrite mode */</span>
<a name="l00268"></a><a class="code" href="Getline_8c.html#9485d52cc09fd6c0880d4e70ca25c797">00268</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#9485d52cc09fd6c0880d4e70ca25c797">gl_no_echo</a> = 0;         <span class="comment">/* do not echo input characters */</span>
<a name="l00269"></a><a class="code" href="Getline_8c.html#a98e28c464dc7ca1a561c2aac2d1f1c0">00269</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#a98e28c464dc7ca1a561c2aac2d1f1c0">gl_passwd</a> = 0;          <span class="comment">/* do not echo input characters */</span>
<a name="l00270"></a><a class="code" href="Getline_8c.html#61d4581ca5282abe15cbcc74213a94f9">00270</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#61d4581ca5282abe15cbcc74213a94f9">gl_erase_line</a> = 0;      <span class="comment">/* erase line before returning */</span>
<a name="l00271"></a><a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">00271</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>, <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> = 0;     <span class="comment">/* position and size of input */</span>
<a name="l00272"></a><a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">00272</a> <span class="keyword">static</span> <span class="keywordtype">char</span>     <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[<a class="code" href="Getline_8c.html#6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>];       <span class="comment">/* input buffer */</span>
<a name="l00273"></a><a class="code" href="Getline_8c.html#c589fb8abd0b14513bd0c4593ab5cadb">00273</a> <span class="keyword">static</span> <span class="keywordtype">char</span>     <a class="code" href="Getline_8c.html#c589fb8abd0b14513bd0c4593ab5cadb">gl_killbuf</a>[<a class="code" href="Getline_8c.html#6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>]=<span class="stringliteral">""</span>; <span class="comment">/* killed text */</span>
<a name="l00274"></a><a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">00274</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>;           <span class="comment">/* to save the prompt string */</span>
<a name="l00275"></a><a class="code" href="Getline_8c.html#3316befdd86d49873d6d0d2e84e800dd">00275</a> <span class="keyword">static</span> <span class="keywordtype">char</span>     <a class="code" href="Getline_8c.html#3316befdd86d49873d6d0d2e84e800dd">gl_intrc</a> = 0;           <span class="comment">/* keyboard SIGINT char */</span>
<a name="l00276"></a><a class="code" href="Getline_8c.html#e04b98935d9fe3c71398c4d28d3477bc">00276</a> <span class="keyword">static</span> <span class="keywordtype">char</span>     <a class="code" href="Getline_8c.html#e04b98935d9fe3c71398c4d28d3477bc">gl_quitc</a> = 0;           <span class="comment">/* keyboard SIGQUIT char */</span>
<a name="l00277"></a><a class="code" href="Getline_8c.html#f8145cf01d4e6042f3e0ea077628a62b">00277</a> <span class="keyword">static</span> <span class="keywordtype">char</span>     <a class="code" href="Getline_8c.html#f8145cf01d4e6042f3e0ea077628a62b">gl_suspc</a> = 0;           <span class="comment">/* keyboard SIGTSTP char */</span>
<a name="l00278"></a><a class="code" href="Getline_8c.html#74bfc882d1e203ae8025d2f177dc325f">00278</a> <span class="keyword">static</span> <span class="keywordtype">char</span>     <a class="code" href="Getline_8c.html#74bfc882d1e203ae8025d2f177dc325f">gl_dsuspc</a> = 0;          <span class="comment">/* delayed SIGTSTP char */</span>
<a name="l00279"></a><a class="code" href="Getline_8c.html#3063e9d42fe363bf22e21c5e77c4400b">00279</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#3063e9d42fe363bf22e21c5e77c4400b">gl_search_mode</a> = 0;     <span class="comment">/* search mode flag */</span>
<a name="l00280"></a><a class="code" href="Getline_8c.html#17c85c52fc2ba8b95cd30777835f076b">00280</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#17c85c52fc2ba8b95cd30777835f076b">gl_savehist</a> = 0;        <span class="comment">/* # of lines to save in hist file */</span>
<a name="l00281"></a><a class="code" href="Getline_8c.html#c7655631f248a9c980d1b7974639d9e6">00281</a> <span class="keyword">static</span> <span class="keywordtype">char</span>     <a class="code" href="Getline_8c.html#c7655631f248a9c980d1b7974639d9e6">gl_histfile</a>[256];       <span class="comment">/* name of history file */</span>
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#0b988a2248f31975c52df57f36cf9a99">gl_init</a>();              <span class="comment">/* prepare to edit a line */</span>
<a name="l00284"></a>00284 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#05208e7c512c81f59e60b8aec4e062f3">gl_cleanup</a>();           <span class="comment">/* to undo gl_init */</span>
<a name="l00285"></a>00285 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#a45d56c113f81d0636f653902dfd171c">gl_char_init</a>();         <span class="comment">/* get ready for no echo input */</span>
<a name="l00286"></a>00286 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#97bed2798833768f757d6479d30ef58c">gl_char_cleanup</a>();      <span class="comment">/* undo gl_char_init */</span>
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#5568ec10a1b63f2014af7a7c09e52e0a">gl_addchar</a>(<span class="keywordtype">int</span> c);      <span class="comment">/* install specified char */</span>
<a name="l00289"></a>00289 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#8891c31c58a74ec80d900d3d2562b418">gl_del</a>(<span class="keywordtype">int</span> loc);        <span class="comment">/* del, either left (-1) or cur (0) */</span>
<a name="l00290"></a>00290 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#4770103b7ab977b0c878790929860a8a">gl_error</a>(<span class="keywordtype">char</span> *buf);    <span class="comment">/* write error msg and die */</span>
<a name="l00291"></a>00291 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *p, <span class="keywordtype">int</span> c, <span class="keywordtype">int</span> cur); <span class="comment">/* fixup state variables and screen */</span>
<a name="l00292"></a>00292 <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#d722d07834674dc6b1c9e7fa9e25a354">gl_getc</a>();              <span class="comment">/* read one char from terminal */</span>
<a name="l00293"></a>00293 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#092e74bdcde8cba164a1eff7b1d7e981">gl_kill</a>();              <span class="comment">/* delete to EOL */</span>
<a name="l00294"></a>00294 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#f61647c1811f8083b89c84dea02464bd">gl_newline</a>();           <span class="comment">/* handle \n or \r */</span>
<a name="l00295"></a>00295 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="keywordtype">int</span> c);         <span class="comment">/* write one char to terminal */</span>
<a name="l00296"></a>00296 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#92664f0ddff00272b6801917b04b74e4">gl_puts</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *buf); <span class="comment">/* write a line to terminal */</span>
<a name="l00297"></a>00297 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#2e04ab80238f627d734ebcdf879321aa">gl_redraw</a>();            <span class="comment">/* issue \n and redraw all */</span>
<a name="l00298"></a>00298 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#656d83a0fc9e30a199c9cc35bcccbdc6">gl_transpose</a>();         <span class="comment">/* transpose two chars */</span>
<a name="l00299"></a>00299 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#2b19e812d00fc84dcfa3628fde26f8f8">gl_yank</a>();              <span class="comment">/* yank killed text */</span>
<a name="l00300"></a>00300 
<a name="l00301"></a>00301 <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#cc7f63289d0484554fd5f4b1debb4450">is_whitespace</a>(<span class="keywordtype">char</span> c);  <span class="comment">/* "whitespace" very loosely interpreted */</span>
<a name="l00302"></a>00302 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#821ee3fc2397e5abec67375f3129fff9">gl_back_1_word</a>();       <span class="comment">/* move cursor back one word */</span>
<a name="l00303"></a>00303 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#56af07ae473ac2bc5281ba45bdf165c1">gl_kill_1_word</a>();       <span class="comment">/* kill to end of word */</span>
<a name="l00304"></a>00304 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#959275de9f5e497fa3be7c729521dd8f">gl_kill_back_1_word</a>();  <span class="comment">/* kill to begin of word */</span>
<a name="l00305"></a>00305 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#9550cb1b8a1f9bdb21b55052abf39de6">gl_kill_region</a>(<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j); <span class="comment">/* kills from i to j */</span>
<a name="l00306"></a>00306 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#d64a9a053cf1e79f45cfe508476636f8">gl_fwd_1_word</a>();        <span class="comment">/* move cursor forward one word */</span>
<a name="l00307"></a>00307 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#e99f301c318e367b7b409b2cbb6c2607">gl_set_mark</a>();          <span class="comment">/* sets mark to be at point */</span>
<a name="l00308"></a>00308 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#afe258d2fe04a339bcba29dba4c27653">gl_exch</a>();              <span class="comment">/* exchanges point and mark */</span>
<a name="l00309"></a>00309 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#922cd7283fa8eef047b969d96bbef302">gl_wipe</a>();              <span class="comment">/* kills from mark to point */</span>
<a name="l00310"></a><a class="code" href="Getline_8c.html#9e39f121e80f71b767a8c22e16a0a226">00310</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#9e39f121e80f71b767a8c22e16a0a226">gl_mark</a> = -1;           <span class="comment">/* position of mark. gl_mark&lt;0 if not set */</span>
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#7aeb84b1bf3e118eab18a7e523d3a14e">hist_init</a>();            <span class="comment">/* initializes hist pointers */</span>
<a name="l00313"></a>00313 <span class="keyword">static</span> <span class="keywordtype">char</span>    *<a class="code" href="Getline_8c.html#55da523ba030c0c07019af7d536b48b1">hist_next</a>();            <span class="comment">/* return ptr to next item */</span>
<a name="l00314"></a>00314 <span class="keyword">static</span> <span class="keywordtype">char</span>    *<a class="code" href="Getline_8c.html#a0ff91ed11b5c20ac307a4b2c020ce92">hist_prev</a>();            <span class="comment">/* return ptr to prev item */</span>
<a name="l00315"></a>00315 <span class="keyword">static</span> <span class="keywordtype">char</span>    *<a class="code" href="Getline_8c.html#dd824ad58eca56693b14aa0598113678">hist_save</a>(<span class="keywordtype">char</span> *p);     <span class="comment">/* makes copy of a string, without NL */</span>
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#a1d090c3a4e5647f8ec95f0bdd59b2ee">search_addchar</a>(<span class="keywordtype">int</span> c);  <span class="comment">/* increment search string */</span>
<a name="l00318"></a>00318 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#423e523cc4e5c6ce59fc0fc35a9697ea">search_term</a>();          <span class="comment">/* reset with current contents */</span>
<a name="l00319"></a>00319 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#19a8833a6643d6d93b023b33f9344c49">search_back</a>(<span class="keywordtype">int</span> s);     <span class="comment">/* look back for current string */</span>
<a name="l00320"></a>00320 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="Getline_8c.html#2a70d511cb480dcd1aeb46d63396f950">search_forw</a>(<span class="keywordtype">int</span> s);     <span class="comment">/* look forw for current string */</span>
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 <span class="comment">/************************ nonportable part *********************************/</span>
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 <span class="preprocessor">#ifdef MSDOS</span>
<a name="l00325"></a>00325 <span class="preprocessor"></span><span class="preprocessor">#include &lt;bios.h&gt;</span>
<a name="l00326"></a>00326 <span class="preprocessor">#endif</span>
<a name="l00327"></a>00327 <span class="preprocessor"></span>
<a name="l00328"></a>00328 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00329"></a>00329 <span class="preprocessor"></span><span class="preprocessor">#  define MSDOS</span>
<a name="l00330"></a>00330 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;io.h&gt;</span>
<a name="l00331"></a>00331 <span class="preprocessor">#  include &lt;windows.h&gt;</span>
<a name="l00332"></a>00332 <span class="preprocessor">#endif </span><span class="comment">/* WIN32 */</span>
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 <span class="preprocessor">#ifdef __MWERKS__</span>
<a name="l00335"></a>00335 <span class="preprocessor"></span><span class="preprocessor">#define R__MWERKS</span>
<a name="l00336"></a>00336 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00337"></a>00337 <span class="preprocessor"></span>
<a name="l00338"></a>00338 <span class="preprocessor">#ifdef R__MWERKS</span>
<a name="l00339"></a>00339 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;unistd.h&gt;</span>
<a name="l00340"></a>00340 <span class="preprocessor">#endif</span>
<a name="l00341"></a>00341 <span class="preprocessor"></span>
<a name="l00342"></a>00342 <span class="preprocessor">#if defined(_AIX) || defined(__Lynx__) || defined(__APPLE__)</span>
<a name="l00343"></a>00343 <span class="preprocessor"></span><span class="preprocessor">#define unix</span>
<a name="l00344"></a>00344 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00345"></a>00345 <span class="preprocessor"></span>
<a name="l00346"></a>00346 <span class="preprocessor">#if defined(__hpux) || defined(__osf__)       </span><span class="comment">/* W.Karig@gsi.de */</span>
<a name="l00347"></a>00347 <span class="preprocessor">#ifndef unix</span>
<a name="l00348"></a>00348 <span class="preprocessor"></span><span class="preprocessor">#define unix</span>
<a name="l00349"></a>00349 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00350"></a>00350 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00351"></a>00351 <span class="preprocessor"></span>
<a name="l00352"></a>00352 <span class="preprocessor">#ifdef unix</span>
<a name="l00353"></a>00353 <span class="preprocessor"></span><span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00354"></a>00354 <span class="preprocessor">#if !defined(__osf__) &amp;&amp; !defined(_AIX)       </span><span class="comment">/* W.Karig@gsi.de */</span>
<a name="l00355"></a>00355 <span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span>
<a name="l00356"></a>00356 <span class="preprocessor">#endif</span>
<a name="l00357"></a>00357 <span class="preprocessor"></span>
<a name="l00358"></a>00358 <span class="preprocessor">#if defined(__linux__) &amp;&amp; defined(__powerpc__)</span>
<a name="l00359"></a>00359 <span class="preprocessor"></span><span class="preprocessor">#   define R__MKLINUX       // = linux on PowerMac</span>
<a name="l00360"></a>00360 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00361"></a>00361 <span class="preprocessor"></span><span class="preprocessor">#if defined(__linux__) &amp;&amp; defined(__alpha__)</span>
<a name="l00362"></a>00362 <span class="preprocessor"></span><span class="preprocessor">#   define R__ALPHALINUX    // = linux on Alpha</span>
<a name="l00363"></a>00363 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00364"></a>00364 <span class="preprocessor"></span>
<a name="l00365"></a>00365 <span class="preprocessor">#if defined(TIOCGETP) &amp;&amp; !defined(__sgi) &amp;&amp; !defined(R__MKLINUX) &amp;&amp; \</span>
<a name="l00366"></a>00366 <span class="preprocessor">   !defined(R__ALPHALINUX)  </span><span class="comment">/* use BSD interface if possible */</span>
<a name="l00367"></a>00367 <span class="preprocessor">#include &lt;sgtty.h&gt;</span>
<a name="l00368"></a>00368 <span class="keyword">struct </span>sgttyb   new_tty, old_tty;
<a name="l00369"></a>00369 <span class="keyword">struct </span>tchars   tch;
<a name="l00370"></a>00370 <span class="keyword">struct </span>ltchars  ltch;
<a name="l00371"></a>00371 <span class="preprocessor">#else</span>
<a name="l00372"></a>00372 <span class="preprocessor"></span><span class="preprocessor">#ifdef SIGTSTP          </span><span class="comment">/* need POSIX interface to handle SUSP */</span>
<a name="l00373"></a>00373 <span class="preprocessor">#include &lt;termios.h&gt;</span>
<a name="l00374"></a>00374 <span class="preprocessor">#if defined(__sun) || defined(__sgi) || defined(R__MKLINUX) || \</span>
<a name="l00375"></a>00375 <span class="preprocessor">    defined(R__ALPHALINUX)</span>
<a name="l00376"></a>00376 <span class="preprocessor"></span><span class="preprocessor">#undef TIOCGETP         </span><span class="comment">/* Solaris and SGI define TIOCGETP in &lt;termios.h&gt; */</span>
<a name="l00377"></a>00377 <span class="preprocessor">#undef TIOCSETP</span>
<a name="l00378"></a>00378 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00379"></a>00379 <span class="preprocessor"></span><span class="keyword">struct </span>termios  new_termios, old_termios;
<a name="l00380"></a>00380 <span class="preprocessor">#else                   </span><span class="comment">/* use SYSV interface */</span>
<a name="l00381"></a>00381 <span class="preprocessor">#include &lt;termio.h&gt;</span>
<a name="l00382"></a>00382 <span class="keyword">struct </span>termio   new_termio, old_termio;
<a name="l00383"></a>00383 <span class="preprocessor">#endif</span>
<a name="l00384"></a>00384 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00385"></a>00385 <span class="preprocessor"></span><span class="preprocessor">#endif  </span><span class="comment">/* unix */</span>
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 <span class="preprocessor">#ifdef VMS</span>
<a name="l00388"></a>00388 <span class="preprocessor"></span><span class="preprocessor">#include &lt;descrip.h&gt;</span>
<a name="l00389"></a>00389 <span class="preprocessor">#include &lt;ttdef.h&gt;</span>
<a name="l00390"></a>00390 <span class="preprocessor">#include &lt;iodef.h&gt;</span>
<a name="l00391"></a>00391 <span class="preprocessor">#include &lt;starlet.h&gt;</span>
<a name="l00392"></a>00392 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00393"></a>00393 <span class="preprocessor">#include unixio</span>
<a name="l00394"></a>00394 <span class="preprocessor"></span>
<a name="l00395"></a>00395 <span class="keyword">static</span> <span class="keywordtype">int</span>   setbuff[2];             <span class="comment">/* buffer to set terminal attributes */</span>
<a name="l00396"></a>00396 <span class="keyword">static</span> <span class="keywordtype">short</span> chan = -1;              <span class="comment">/* channel to terminal */</span>
<a name="l00397"></a>00397 <span class="keyword">struct </span>dsc$descriptor_s descrip;     <span class="comment">/* VMS descriptor */</span>
<a name="l00398"></a>00398 <span class="preprocessor">#endif</span>
<a name="l00399"></a>00399 <span class="preprocessor"></span>
<a name="l00400"></a>00400 <span class="keywordtype">void</span>
<a name="l00401"></a><a class="code" href="Getline_8c.html#666d05c4f215e909faf86ddb23f80f67">00401</a> <a class="code" href="Getline_8c.html#666d05c4f215e909faf86ddb23f80f67">Gl_config</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *which, <span class="keywordtype">int</span> value)
<a name="l00402"></a>00402 {
<a name="l00403"></a>00403    <span class="keywordflow">if</span> (strcmp(which, <span class="stringliteral">"noecho"</span>) == 0)
<a name="l00404"></a>00404       <a class="code" href="Getline_8c.html#9485d52cc09fd6c0880d4e70ca25c797">gl_no_echo</a> = value;
<a name="l00405"></a>00405    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(which, <span class="stringliteral">"erase"</span>) == 0)
<a name="l00406"></a>00406       <a class="code" href="Getline_8c.html#61d4581ca5282abe15cbcc74213a94f9">gl_erase_line</a> = value;
<a name="l00407"></a>00407    <span class="keywordflow">else</span>
<a name="l00408"></a>00408       printf(<span class="stringliteral">"gl_config: %s ?\n"</span>, which);
<a name="l00409"></a>00409 }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00412"></a><a class="code" href="Getline_8c.html#a45d56c113f81d0636f653902dfd171c">00412</a> <a class="code" href="Getline_8c.html#a45d56c113f81d0636f653902dfd171c">gl_char_init</a>()                  <span class="comment">/* turn off input echo */</span>
<a name="l00413"></a>00413 {
<a name="l00414"></a>00414     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#7f7957926207f30e875bb787f2dc7a3d">gl_notty</a>) <span class="keywordflow">return</span>;
<a name="l00415"></a>00415 <span class="preprocessor">#ifdef unix</span>
<a name="l00416"></a>00416 <span class="preprocessor"></span><span class="preprocessor">#ifdef TIOCGETP                 </span><span class="comment">/* BSD */</span>
<a name="l00417"></a>00417     ioctl(0, TIOCGETC, &amp;tch);
<a name="l00418"></a>00418     ioctl(0, TIOCGLTC, &amp;ltch);
<a name="l00419"></a>00419     <a class="code" href="Getline_8c.html#3316befdd86d49873d6d0d2e84e800dd">gl_intrc</a> = tch.t_intrc;
<a name="l00420"></a>00420     <a class="code" href="Getline_8c.html#e04b98935d9fe3c71398c4d28d3477bc">gl_quitc</a> = tch.t_quitc;
<a name="l00421"></a>00421     <a class="code" href="Getline_8c.html#f8145cf01d4e6042f3e0ea077628a62b">gl_suspc</a> = ltch.t_suspc;
<a name="l00422"></a>00422     <a class="code" href="Getline_8c.html#74bfc882d1e203ae8025d2f177dc325f">gl_dsuspc</a> = ltch.t_dsuspc;
<a name="l00423"></a>00423     ioctl(0, TIOCGETP, &amp;old_tty);
<a name="l00424"></a>00424     new_tty = old_tty;
<a name="l00425"></a>00425     new_tty.sg_flags |= RAW;
<a name="l00426"></a>00426     new_tty.sg_flags &amp;= ~ECHO;
<a name="l00427"></a>00427     ioctl(0, TIOCSETP, &amp;new_tty);
<a name="l00428"></a>00428 <span class="preprocessor">#else</span>
<a name="l00429"></a>00429 <span class="preprocessor"></span><span class="preprocessor">#ifdef SIGTSTP                  </span><span class="comment">/* POSIX */</span>
<a name="l00430"></a>00430     tcgetattr(0, &amp;old_termios);
<a name="l00431"></a>00431     <a class="code" href="Getline_8c.html#3316befdd86d49873d6d0d2e84e800dd">gl_intrc</a> = old_termios.c_cc[VINTR];
<a name="l00432"></a>00432     <a class="code" href="Getline_8c.html#e04b98935d9fe3c71398c4d28d3477bc">gl_quitc</a> = old_termios.c_cc[VQUIT];
<a name="l00433"></a>00433 <span class="preprocessor">#ifdef VSUSP</span>
<a name="l00434"></a>00434 <span class="preprocessor"></span>    <a class="code" href="Getline_8c.html#f8145cf01d4e6042f3e0ea077628a62b">gl_suspc</a> = old_termios.c_cc[VSUSP];
<a name="l00435"></a>00435 <span class="preprocessor">#endif</span>
<a name="l00436"></a>00436 <span class="preprocessor"></span><span class="preprocessor">#ifdef VDSUSP</span>
<a name="l00437"></a>00437 <span class="preprocessor"></span>    <a class="code" href="Getline_8c.html#74bfc882d1e203ae8025d2f177dc325f">gl_dsuspc</a> = old_termios.c_cc[VDSUSP];
<a name="l00438"></a>00438 <span class="preprocessor">#endif</span>
<a name="l00439"></a>00439 <span class="preprocessor"></span>    new_termios = old_termios;
<a name="l00440"></a>00440     new_termios.c_iflag &amp;= ~(BRKINT|ISTRIP|IXON|IXOFF);
<a name="l00441"></a>00441     new_termios.c_iflag |= (IGNBRK|IGNPAR);
<a name="l00442"></a>00442     new_termios.c_lflag &amp;= ~(ICANON|ISIG|IEXTEN|ECHO);
<a name="l00443"></a>00443     new_termios.c_cc[VMIN] = 1;
<a name="l00444"></a>00444     new_termios.c_cc[VTIME] = 0;
<a name="l00445"></a>00445     tcsetattr(0, TCSANOW, &amp;new_termios);
<a name="l00446"></a>00446 <span class="preprocessor">#else                           </span><span class="comment">/* SYSV */</span>
<a name="l00447"></a>00447     ioctl(0, TCGETA, &amp;old_termio);
<a name="l00448"></a>00448     <a class="code" href="Getline_8c.html#3316befdd86d49873d6d0d2e84e800dd">gl_intrc</a> = old_termio.c_cc[VINTR];
<a name="l00449"></a>00449     <a class="code" href="Getline_8c.html#e04b98935d9fe3c71398c4d28d3477bc">gl_quitc</a> = old_termio.c_cc[VQUIT];
<a name="l00450"></a>00450     new_termio = old_termio;
<a name="l00451"></a>00451     new_termio.c_iflag &amp;= ~(BRKINT|ISTRIP|IXON|IXOFF);
<a name="l00452"></a>00452     new_termio.c_iflag |= (IGNBRK|IGNPAR);
<a name="l00453"></a>00453     new_termio.c_lflag &amp;= ~(ICANON|ISIG|ECHO);
<a name="l00454"></a>00454     new_termio.c_cc[VMIN] = 1;
<a name="l00455"></a>00455     new_termio.c_cc[VTIME] = 0;
<a name="l00456"></a>00456     ioctl(0, TCSETA, &amp;new_termio);
<a name="l00457"></a>00457 <span class="preprocessor">#endif</span>
<a name="l00458"></a>00458 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00459"></a>00459 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* unix */</span>
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 <span class="preprocessor">#ifdef MSDOS</span>
<a name="l00462"></a>00462 <span class="preprocessor"></span>    <a class="code" href="Getline_8c.html#3316befdd86d49873d6d0d2e84e800dd">gl_intrc</a> = <span class="charliteral">'C'</span> - <span class="charliteral">'@'</span>;
<a name="l00463"></a>00463     <a class="code" href="Getline_8c.html#e04b98935d9fe3c71398c4d28d3477bc">gl_quitc</a> = <span class="charliteral">'Q'</span> - <span class="charliteral">'@'</span>;
<a name="l00464"></a>00464 <span class="comment">//    gl_suspc = ltch.t_suspc;</span>
<a name="l00465"></a>00465 <span class="preprocessor">#endif </span><span class="comment">/* MSDOS */</span>
<a name="l00466"></a>00466 
<a name="l00467"></a>00467 <span class="preprocessor">#ifdef R__MWERKS</span>
<a name="l00468"></a>00468 <span class="preprocessor"></span>    <a class="code" href="Getline_8c.html#3316befdd86d49873d6d0d2e84e800dd">gl_intrc</a> = <span class="charliteral">'C'</span> - <span class="charliteral">'@'</span>;
<a name="l00469"></a>00469     <a class="code" href="Getline_8c.html#e04b98935d9fe3c71398c4d28d3477bc">gl_quitc</a> = <span class="charliteral">'Q'</span> - <span class="charliteral">'@'</span>;
<a name="l00470"></a>00470 <span class="preprocessor">#endif</span>
<a name="l00471"></a>00471 <span class="preprocessor"></span>
<a name="l00472"></a>00472 <span class="preprocessor">#ifdef vms</span>
<a name="l00473"></a>00473 <span class="preprocessor"></span>    descrip.dsc$w_length  = strlen(<span class="stringliteral">"tt:"</span>);
<a name="l00474"></a>00474     descrip.dsc$b_dtype   = DSC$K_DTYPE_T;
<a name="l00475"></a>00475     descrip.dsc$b_class   = DSC$K_CLASS_S;
<a name="l00476"></a>00476     descrip.dsc$a_pointer = <span class="stringliteral">"tt:"</span>;
<a name="l00477"></a>00477     (void)sys$assign(&amp;descrip,&amp;chan,0,0);
<a name="l00478"></a>00478     (void)sys$qiow(0,chan,IO$_SENSEMODE,0,0,0,setbuff,8,0,0,0,0);
<a name="l00479"></a>00479     setbuff[1] |= TT$M_NOECHO;
<a name="l00480"></a>00480     (void)sys$qiow(0,chan,IO$_SETMODE,0,0,0,setbuff,8,0,0,0,0);
<a name="l00481"></a>00481 <span class="preprocessor">#endif </span><span class="comment">/* vms */</span>
<a name="l00482"></a>00482 }
<a name="l00483"></a>00483 
<a name="l00484"></a>00484 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00485"></a><a class="code" href="Getline_8c.html#97bed2798833768f757d6479d30ef58c">00485</a> <a class="code" href="Getline_8c.html#97bed2798833768f757d6479d30ef58c">gl_char_cleanup</a>()               <span class="comment">/* undo effects of gl_char_init */</span>
<a name="l00486"></a>00486 {
<a name="l00487"></a>00487     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#7f7957926207f30e875bb787f2dc7a3d">gl_notty</a>) <span class="keywordflow">return</span>;
<a name="l00488"></a>00488 <span class="preprocessor">#ifdef unix</span>
<a name="l00489"></a>00489 <span class="preprocessor"></span><span class="preprocessor">#ifdef TIOCSETP         </span><span class="comment">/* BSD */</span>
<a name="l00490"></a>00490     ioctl(0, TIOCSETP, &amp;old_tty);
<a name="l00491"></a>00491 <span class="preprocessor">#else</span>
<a name="l00492"></a>00492 <span class="preprocessor"></span><span class="preprocessor">#ifdef SIGTSTP          </span><span class="comment">/* POSIX */</span>
<a name="l00493"></a>00493     tcsetattr(0, TCSANOW, &amp;old_termios);
<a name="l00494"></a>00494 <span class="preprocessor">#else                   </span><span class="comment">/* SYSV */</span>
<a name="l00495"></a>00495     ioctl(0, TCSETA, &amp;old_termio);
<a name="l00496"></a>00496 <span class="preprocessor">#endif</span>
<a name="l00497"></a>00497 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00498"></a>00498 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* unix */</span>
<a name="l00499"></a>00499 
<a name="l00500"></a>00500 <span class="preprocessor">#ifdef vms</span>
<a name="l00501"></a>00501 <span class="preprocessor"></span>    setbuff[1] &amp;= ~TT$M_NOECHO;
<a name="l00502"></a>00502     (void)sys$qiow(0,chan,IO$_SETMODE,0,0,0,setbuff,8,0,0,0,0);
<a name="l00503"></a>00503     sys$dassgn(chan);
<a name="l00504"></a>00504     chan = -1;
<a name="l00505"></a>00505 <span class="preprocessor">#endif</span>
<a name="l00506"></a>00506 <span class="preprocessor"></span>}
<a name="l00507"></a>00507 
<a name="l00508"></a>00508 <span class="preprocessor">#if defined(MSDOS) &amp;&amp; !defined(WIN32)</span>
<a name="l00509"></a>00509 <span class="preprocessor"></span><span class="comment">// +DECK, PAUSE, T=XCC, IF=WINNT. (from KERNDOS.CAR )</span>
<a name="l00510"></a>00510 <span class="preprocessor">#  include &lt;conio.h&gt;</span>
<a name="l00511"></a>00511    <span class="keywordtype">int</span> pause_()
<a name="l00512"></a>00512    {
<a name="l00513"></a>00513       <span class="keywordtype">int</span> first_char;
<a name="l00514"></a>00514         first_char = _getch();
<a name="l00515"></a>00515         <span class="keywordflow">if</span> (first_char == 0 || first_char == 0xE0) first_char = -_getch();
<a name="l00516"></a>00516         <span class="keywordflow">return</span> first_char;
<a name="l00517"></a>00517    }
<a name="l00518"></a>00518 <span class="preprocessor">#endif</span>
<a name="l00519"></a>00519 <span class="preprocessor"></span>
<a name="l00520"></a>00520 <span class="preprocessor">#if defined(MSDOS) &amp;&amp; defined(WIN32)</span>
<a name="l00521"></a>00521 <span class="preprocessor"></span><span class="comment">//______________________________________________________________________________</span>
<a name="l00522"></a>00522 <span class="keywordtype">int</span> pause_()
<a name="l00523"></a>00523 {
<a name="l00524"></a>00524  <span class="keyword">static</span> HANDLE hConsoleInput = NULL;
<a name="l00525"></a>00525  <span class="keyword">static</span> iCharCount = 0;
<a name="l00526"></a>00526  <span class="keyword">static</span> <span class="keywordtype">int</span> chLastChar = 0;
<a name="l00527"></a>00527 
<a name="l00528"></a>00528  DWORD cRead;
<a name="l00529"></a>00529 
<a name="l00530"></a>00530  INPUT_RECORD pirBuffer;
<a name="l00531"></a>00531  KEY_EVENT_RECORD *KeyEvent= (KEY_EVENT_RECORD *)&amp;(pirBuffer.Event);
<a name="l00532"></a>00532 
<a name="l00533"></a>00533  <span class="keywordflow">if</span> (!hConsoleInput) hConsoleInput = GetStdHandle(STD_INPUT_HANDLE);
<a name="l00534"></a>00534 
<a name="l00535"></a>00535  <span class="keywordflow">if</span> (iCharCount) iCharCount--;      <span class="comment">// Whether several symbols had been read</span>
<a name="l00536"></a>00536  <span class="keywordflow">else</span> {
<a name="l00537"></a>00537    chLastChar = 0;
<a name="l00538"></a>00538    <span class="keywordflow">while</span> (chLastChar == 0) {
<a name="l00539"></a>00539      <span class="keywordflow">if</span> (!ReadConsoleInput(hConsoleInput,       <span class="comment">// handle of a console input buffer</span>
<a name="l00540"></a>00540                            &amp;pirBuffer,          <span class="comment">// address of the buffer for read data</span>
<a name="l00541"></a>00541                            1,                   <span class="comment">// number of records to read</span>
<a name="l00542"></a>00542                            &amp;cRead               <span class="comment">// address of number of records read</span>
<a name="l00543"></a>00543         )) <span class="keywordflow">return</span> 0;
<a name="l00544"></a>00544 
<a name="l00545"></a>00545      <span class="keywordflow">if</span> (pirBuffer.EventType == KEY_EVENT  &amp;&amp; KeyEvent-&gt;bKeyDown == <a class="code" href="rcuflashprog_8c.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>){
<a name="l00546"></a>00546          iCharCount = KeyEvent-&gt;wRepeatCount - 1;
<a name="l00547"></a>00547          chLastChar = ((int) (KeyEvent-&gt;uChar).AsciiChar &amp; 0xffff);
<a name="l00548"></a>00548          <span class="keywordflow">if</span> (chLastChar)
<a name="l00549"></a>00549               OemToCharBuff((<span class="keywordtype">char</span> <span class="keyword">const</span> *)&amp;chLastChar,(<span class="keywordtype">char</span> *)&amp;chLastChar,1);
<a name="l00550"></a>00550          <span class="keywordflow">else</span>
<a name="l00551"></a>00551               chLastChar = - (KeyEvent-&gt;wVirtualScanCode);
<a name="l00552"></a>00552 <span class="comment">//            chLastChar = - (KeyEvent-&gt;wVirtualKeyCode);</span>
<a name="l00553"></a>00553      }
<a name="l00554"></a>00554    }
<a name="l00555"></a>00555  }
<a name="l00556"></a>00556  <span class="keywordflow">return</span> chLastChar;
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 }
<a name="l00559"></a>00559 <span class="preprocessor">#endif</span>
<a name="l00560"></a>00560 <span class="preprocessor"></span>
<a name="l00561"></a>00561 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00562"></a><a class="code" href="Getline_8c.html#d722d07834674dc6b1c9e7fa9e25a354">00562</a> <a class="code" href="Getline_8c.html#d722d07834674dc6b1c9e7fa9e25a354">gl_getc</a>()
<a name="l00563"></a>00563 <span class="comment">/* get a character without echoing it to screen */</span>
<a name="l00564"></a>00564 {
<a name="l00565"></a>00565 <span class="preprocessor">#ifdef MSDOS</span>
<a name="l00566"></a>00566 <span class="preprocessor"></span><span class="preprocessor"># define k_ctrl_C   3</span>
<a name="l00567"></a>00567 <span class="preprocessor"></span><span class="preprocessor"># define k_ctrl_Z  26</span>
<a name="l00568"></a>00568 <span class="preprocessor"></span><span class="preprocessor"># define k_ctrl_Q  17</span>
<a name="l00569"></a>00569 <span class="preprocessor"></span><span class="preprocessor"># define k_ctrl_K  11</span>
<a name="l00570"></a>00570 <span class="preprocessor"></span><span class="preprocessor"># define k_rt_arr -77</span>
<a name="l00571"></a>00571 <span class="preprocessor"></span><span class="preprocessor"># define k_lt_arr -75</span>
<a name="l00572"></a>00572 <span class="preprocessor"></span><span class="preprocessor"># define k_up_arr -72</span>
<a name="l00573"></a>00573 <span class="preprocessor"></span><span class="preprocessor"># define k_dn_arr -80</span>
<a name="l00574"></a>00574 <span class="preprocessor"></span><span class="preprocessor"># define k_PGUP   -73</span>
<a name="l00575"></a>00575 <span class="preprocessor"></span><span class="preprocessor"># define k_PGDW   -81</span>
<a name="l00576"></a>00576 <span class="preprocessor"></span><span class="preprocessor"># define k_HOME   -71</span>
<a name="l00577"></a>00577 <span class="preprocessor"></span><span class="preprocessor"># define k_END    -79</span>
<a name="l00578"></a>00578 <span class="preprocessor"></span><span class="preprocessor"># define k_INS    -82</span>
<a name="l00579"></a>00579 <span class="preprocessor"></span><span class="preprocessor"># define k_DEL    -83</span>
<a name="l00580"></a>00580 <span class="preprocessor"></span><span class="preprocessor"># define k_ENTER   13</span>
<a name="l00581"></a>00581 <span class="preprocessor"></span><span class="preprocessor"># define k_CR      13</span>
<a name="l00582"></a>00582 <span class="preprocessor"></span><span class="preprocessor"># define k_BS       8</span>
<a name="l00583"></a>00583 <span class="preprocessor"></span><span class="preprocessor"># define k_ESC     27</span>
<a name="l00584"></a>00584 <span class="preprocessor"></span><span class="preprocessor"># define k_alt_H  -35</span>
<a name="l00585"></a>00585 <span class="preprocessor"></span><span class="preprocessor"># define k_beep     7</span>
<a name="l00586"></a>00586 <span class="preprocessor"></span><span class="preprocessor"># ifndef WIN32</span>
<a name="l00587"></a>00587 <span class="preprocessor"></span>    <span class="keywordtype">int</span> get_cursor__(<span class="keywordtype">int</span> *,<span class="keywordtype">int</span> *);
<a name="l00588"></a>00588     <span class="keywordtype">int</span> display_off__(<span class="keywordtype">int</span> *);
<a name="l00589"></a>00589     <span class="keywordtype">int</span> display_on__();
<a name="l00590"></a>00590     <span class="keywordtype">int</span> locate_(<span class="keywordtype">int</span> *,<span class="keywordtype">int</span> *);
<a name="l00591"></a>00591     <span class="keywordtype">int</span> ixc, iyc;
<a name="l00592"></a>00592 <span class="preprocessor"># endif</span>
<a name="l00593"></a>00593 <span class="preprocessor"></span>    <span class="keywordtype">int</span> pause_();
<a name="l00594"></a>00594 <span class="preprocessor">#endif</span>
<a name="l00595"></a>00595 <span class="preprocessor"></span>
<a name="l00596"></a>00596     <span class="keywordtype">int</span> c;
<a name="l00597"></a>00597 
<a name="l00598"></a>00598 <span class="preprocessor">#if defined(unix)</span>
<a name="l00599"></a>00599 <span class="preprocessor"></span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ch;
<a name="l00600"></a>00600     <span class="keywordflow">while</span> ((c = (read(0, &amp;ch, 1) &gt; 0) ? ch : -1) == -1 &amp;&amp; errno == EINTR)
<a name="l00601"></a>00601        errno = 0;
<a name="l00602"></a>00602 <span class="preprocessor">#endif</span>
<a name="l00603"></a>00603 <span class="preprocessor"></span>
<a name="l00604"></a>00604 <span class="preprocessor">#if defined(R__MWERKS)</span>
<a name="l00605"></a>00605 <span class="preprocessor"></span>    c = getchar();
<a name="l00606"></a>00606 <span class="preprocessor">#endif</span>
<a name="l00607"></a>00607 <span class="preprocessor"></span>
<a name="l00608"></a>00608 <span class="preprocessor">#ifdef MSDOS</span>
<a name="l00609"></a>00609 <span class="preprocessor"></span>    c = pause_();
<a name="l00610"></a>00610      <span class="keywordflow">if</span> (c &lt; 0) {
<a name="l00611"></a>00611          <span class="keywordflow">switch</span> (c) {
<a name="l00612"></a>00612            <span class="keywordflow">case</span> k_up_arr: c =  <span class="charliteral">'P'</span> - <span class="charliteral">'@'</span>;   <span class="comment">/* up -&gt; ^P = 16 */</span>
<a name="l00613"></a>00613              <span class="keywordflow">break</span>;
<a name="l00614"></a>00614            <span class="keywordflow">case</span> k_dn_arr: c =  <span class="charliteral">'N'</span> - <span class="charliteral">'@'</span>;   <span class="comment">/* down -&gt; ^N = 14 */</span>
<a name="l00615"></a>00615              <span class="keywordflow">break</span>;
<a name="l00616"></a>00616            <span class="keywordflow">case</span> k_lt_arr: c =  <span class="charliteral">'B'</span> - <span class="charliteral">'@'</span>;   <span class="comment">/* left -&gt; ^B =2 */</span>
<a name="l00617"></a>00617              <span class="keywordflow">break</span>;
<a name="l00618"></a>00618            <span class="keywordflow">case</span> k_rt_arr: c =  <span class="charliteral">'F'</span> - <span class="charliteral">'@'</span>;   <span class="comment">/* right -&gt; ^F = 6*/</span>
<a name="l00619"></a>00619              <span class="keywordflow">break</span>;
<a name="l00620"></a>00620            <span class="keywordflow">case</span> k_INS:    c =  <span class="charliteral">'O'</span> - <span class="charliteral">'@'</span>;   <span class="comment">/* right -&gt; ^O  = 15*/</span>
<a name="l00621"></a>00621              <span class="keywordflow">break</span>;
<a name="l00622"></a>00622            <span class="keywordflow">case</span> k_DEL:    c =  <span class="charliteral">'D'</span> - <span class="charliteral">'@'</span>;   <span class="comment">/* Delete character under cursor = 4*/</span>
<a name="l00623"></a>00623              <span class="keywordflow">break</span>;
<a name="l00624"></a>00624            <span class="keywordflow">case</span> k_END:    c =  <span class="charliteral">'E'</span> - <span class="charliteral">'@'</span>;   <span class="comment">/* Moves cursor to end of line * = 5 */</span>
<a name="l00625"></a>00625              <span class="keywordflow">break</span>;
<a name="l00626"></a>00626            <span class="keywordflow">case</span> k_HOME:   c =  <span class="charliteral">'A'</span> - <span class="charliteral">'@'</span>;   <span class="comment">/* Moves cursor to beginning of line = 1*/</span>
<a name="l00627"></a>00627              <span class="keywordflow">break</span>;
<a name="l00628"></a>00628            <span class="keywordflow">default</span>: c = 0;    <span class="comment">/* make it garbage */</span>
<a name="l00629"></a>00629          }
<a name="l00630"></a>00630      }
<a name="l00631"></a>00631      <span class="keywordflow">else</span> {
<a name="l00632"></a>00632        <span class="keywordflow">switch</span>(c) {
<a name="l00633"></a>00633            <span class="keywordflow">case</span> k_ESC:    c =  <span class="charliteral">'U'</span> - <span class="charliteral">'@'</span>; <span class="comment">/* Clear full line  -&gt; ^U */</span>
<a name="l00634"></a>00634              <span class="keywordflow">break</span>;
<a name="l00635"></a>00635            <span class="keywordflow">default</span>:
<a name="l00636"></a>00636              <span class="keywordflow">break</span>;
<a name="l00637"></a>00637          }
<a name="l00638"></a>00638      }
<a name="l00639"></a>00639 <span class="preprocessor">#endif</span>
<a name="l00640"></a>00640 <span class="preprocessor"></span>
<a name="l00641"></a>00641 <span class="preprocessor">#ifdef vms</span>
<a name="l00642"></a>00642 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(chan &lt; 0) {
<a name="l00643"></a>00643        c=<span class="charliteral">'\0'</span>;
<a name="l00644"></a>00644     }
<a name="l00645"></a>00645     (void)sys$qiow(0,chan,IO$_TTYREADALL,0,0,0,&amp;c,1,0,0,0,0);
<a name="l00646"></a>00646     c &amp;= 0177;                        <span class="comment">/* get a char */</span>
<a name="l00647"></a>00647 <span class="preprocessor">#endif</span>
<a name="l00648"></a>00648 <span class="preprocessor"></span>    <span class="keywordflow">return</span> c;
<a name="l00649"></a>00649 }
<a name="l00650"></a>00650 
<a name="l00651"></a>00651 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00652"></a><a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">00652</a> <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="keywordtype">int</span> c)
<a name="l00653"></a>00653 {
<a name="l00654"></a>00654     <span class="keywordtype">char</span>   ch = c;
<a name="l00655"></a>00655 
<a name="l00656"></a>00656     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#7f7957926207f30e875bb787f2dc7a3d">gl_notty</a>) <span class="keywordflow">return</span>;
<a name="l00657"></a>00657 
<a name="l00658"></a>00658     <span class="keywordflow">if</span> ( !<a class="code" href="Getline_8c.html#a98e28c464dc7ca1a561c2aac2d1f1c0">gl_passwd</a> || !isgraph(c))
<a name="l00659"></a>00659     {
<a name="l00660"></a>00660 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00661"></a>00661 <span class="preprocessor"></span>       CharToOemBuff((<span class="keywordtype">char</span> <span class="keyword">const</span> *)&amp;c,&amp;ch,1);
<a name="l00662"></a>00662 <span class="preprocessor">#endif</span>
<a name="l00663"></a>00663 <span class="preprocessor"></span>
<a name="l00664"></a>00664        write(1, &amp;ch, 1);
<a name="l00665"></a>00665     }
<a name="l00666"></a>00666 <span class="preprocessor">#if defined(unix) || defined(MSDOS) || defined(WIN32) || defined(R__MWERKS)</span>
<a name="l00667"></a>00667 <span class="preprocessor"></span><span class="preprocessor">#ifdef TIOCSETP         </span><span class="comment">/* BSD in RAW mode, map NL to NL,CR */</span>
<a name="l00668"></a>00668     <span class="keywordflow">if</span> (ch == <span class="charliteral">'\n'</span>) {
<a name="l00669"></a>00669         ch = <span class="charliteral">'\r'</span>;
<a name="l00670"></a>00670         write(1, &amp;ch, 1);
<a name="l00671"></a>00671     }
<a name="l00672"></a>00672 <span class="preprocessor">#endif</span>
<a name="l00673"></a>00673 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00674"></a>00674 <span class="preprocessor"></span>}
<a name="l00675"></a>00675 
<a name="l00676"></a>00676 <span class="comment">/******************** fairly portable part *********************************/</span>
<a name="l00677"></a>00677 
<a name="l00678"></a>00678 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00679"></a><a class="code" href="Getline_8c.html#92664f0ddff00272b6801917b04b74e4">00679</a> <a class="code" href="Getline_8c.html#92664f0ddff00272b6801917b04b74e4">gl_puts</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *buf)
<a name="l00680"></a>00680 {
<a name="l00681"></a>00681     <span class="keywordtype">int</span> len = strlen(buf);
<a name="l00682"></a>00682 
<a name="l00683"></a>00683     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#7f7957926207f30e875bb787f2dc7a3d">gl_notty</a>) <span class="keywordflow">return</span>;
<a name="l00684"></a>00684 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00685"></a>00685 <span class="preprocessor"></span>    {
<a name="l00686"></a>00686      <span class="keywordtype">char</span> *OemBuf = (<span class="keywordtype">char</span> *)malloc(2*len);
<a name="l00687"></a>00687      CharToOemBuff(buf,OemBuf,len);
<a name="l00688"></a>00688      write(1, OemBuf, len);
<a name="l00689"></a>00689      free(OemBuf);
<a name="l00690"></a>00690     }
<a name="l00691"></a>00691 <span class="preprocessor">#else</span>
<a name="l00692"></a>00692 <span class="preprocessor"></span>    write(1, buf, len);
<a name="l00693"></a>00693 <span class="preprocessor">#endif</span>
<a name="l00694"></a>00694 <span class="preprocessor"></span>}
<a name="l00695"></a>00695 
<a name="l00696"></a>00696 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00697"></a><a class="code" href="Getline_8c.html#4770103b7ab977b0c878790929860a8a">00697</a> <a class="code" href="Getline_8c.html#4770103b7ab977b0c878790929860a8a">gl_error</a>(<span class="keywordtype">char</span> *buf)
<a name="l00698"></a>00698 {
<a name="l00699"></a>00699     <span class="keywordtype">int</span> len = strlen(buf);
<a name="l00700"></a>00700 
<a name="l00701"></a>00701     <a class="code" href="Getline_8c.html#05208e7c512c81f59e60b8aec4e062f3">gl_cleanup</a>();
<a name="l00702"></a>00702 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00703"></a>00703 <span class="preprocessor"></span>    {
<a name="l00704"></a>00704       <span class="keywordtype">char</span> *OemBuf = (<span class="keywordtype">char</span> *)malloc(2*len);
<a name="l00705"></a>00705       CharToOemBuff(buf,OemBuf,len);
<a name="l00706"></a>00706       write(2, OemBuf, len);
<a name="l00707"></a>00707       free(OemBuf);
<a name="l00708"></a>00708     }
<a name="l00709"></a>00709 <span class="preprocessor">#else</span>
<a name="l00710"></a>00710 <span class="preprocessor"></span>    write(2, buf, len);
<a name="l00711"></a>00711 <span class="preprocessor">#endif</span>
<a name="l00712"></a>00712 <span class="preprocessor"></span>    exit(1);
<a name="l00713"></a>00713 }
<a name="l00714"></a>00714 
<a name="l00715"></a>00715 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00716"></a><a class="code" href="Getline_8c.html#0b988a2248f31975c52df57f36cf9a99">00716</a> <a class="code" href="Getline_8c.html#0b988a2248f31975c52df57f36cf9a99">gl_init</a>()
<a name="l00717"></a>00717 <span class="comment">/* set up variables and terminal */</span>
<a name="l00718"></a>00718 {
<a name="l00719"></a>00719     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#530bc6f98e7807246ab93a1056a22211">gl_init_done</a> &lt; 0) {             <span class="comment">/* -1 only on startup */</span>
<a name="l00720"></a>00720         <a class="code" href="Getline_8c.html#7aeb84b1bf3e118eab18a7e523d3a14e">hist_init</a>();
<a name="l00721"></a>00721     }
<a name="l00722"></a>00722     <span class="keywordflow">if</span> (isatty(0) == 0 || isatty(1) == 0)
<a name="l00723"></a>00723         <a class="code" href="Getline_8c.html#7f7957926207f30e875bb787f2dc7a3d">gl_notty</a> = 1;
<a name="l00724"></a>00724     <a class="code" href="Getline_8c.html#a45d56c113f81d0636f653902dfd171c">gl_char_init</a>();
<a name="l00725"></a>00725     <a class="code" href="Getline_8c.html#530bc6f98e7807246ab93a1056a22211">gl_init_done</a> = 1;
<a name="l00726"></a>00726 }
<a name="l00727"></a>00727 
<a name="l00728"></a>00728 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00729"></a><a class="code" href="Getline_8c.html#05208e7c512c81f59e60b8aec4e062f3">00729</a> <a class="code" href="Getline_8c.html#05208e7c512c81f59e60b8aec4e062f3">gl_cleanup</a>()
<a name="l00730"></a>00730 <span class="comment">/* undo effects of gl_init, as necessary */</span>
<a name="l00731"></a>00731 {
<a name="l00732"></a>00732     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#530bc6f98e7807246ab93a1056a22211">gl_init_done</a> &gt; 0)
<a name="l00733"></a>00733         <a class="code" href="Getline_8c.html#97bed2798833768f757d6479d30ef58c">gl_char_cleanup</a>();
<a name="l00734"></a>00734     <a class="code" href="Getline_8c.html#530bc6f98e7807246ab93a1056a22211">gl_init_done</a> = 0;
<a name="l00735"></a>00735 }
<a name="l00736"></a>00736 
<a name="l00737"></a>00737 <span class="keywordtype">void</span>
<a name="l00738"></a><a class="code" href="Getline_8c.html#e5f71b17ad9b817aea471a77c807481b">00738</a> <a class="code" href="Getline_8c.html#e5f71b17ad9b817aea471a77c807481b">Gl_setwidth</a>(<span class="keywordtype">int</span> w)
<a name="l00739"></a>00739 {
<a name="l00740"></a>00740     <span class="keywordflow">if</span> (w &gt; 20) {
<a name="l00741"></a>00741         <a class="code" href="Getline_8c.html#47ad6029530fe4c2b9e47f2dcfbf1690">gl_termw</a> = w;
<a name="l00742"></a>00742         <a class="code" href="Getline_8c.html#3425dfcd249ed4b5c439727afff7edb7">gl_scroll</a> = w / 3;
<a name="l00743"></a>00743     } <span class="keywordflow">else</span> {
<a name="l00744"></a>00744         <a class="code" href="Getline_8c.html#4770103b7ab977b0c878790929860a8a">gl_error</a>(<span class="stringliteral">"\n*** Error: minimum screen width is 21\n"</span>);
<a name="l00745"></a>00745     }
<a name="l00746"></a>00746 }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748 <span class="keywordtype">void</span>
<a name="l00749"></a><a class="code" href="Getline_8c.html#2b3c73f73a6552fbda3e4f0189110502">00749</a> <a class="code" href="Getline_8c.html#2b3c73f73a6552fbda3e4f0189110502">Gl_windowchanged</a>()
<a name="l00750"></a>00750 {
<a name="l00751"></a>00751 <span class="preprocessor">#ifdef TIOCGWINSZ</span>
<a name="l00752"></a>00752 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (isatty(0)) {
<a name="l00753"></a>00753       <span class="keyword">static</span> <span class="keywordtype">char</span> lenv[32], cenv[32];
<a name="l00754"></a>00754       <span class="keyword">struct </span>winsize wins;
<a name="l00755"></a>00755       ioctl(0, TIOCGWINSZ, &amp;wins);
<a name="l00756"></a>00756 
<a name="l00757"></a>00757       <span class="keywordflow">if</span> (wins.ws_col == 0) wins.ws_col = 80;
<a name="l00758"></a>00758       <span class="keywordflow">if</span> (wins.ws_row == 0) wins.ws_row = 24;
<a name="l00759"></a>00759 
<a name="l00760"></a>00760       <a class="code" href="Getline_8c.html#e5f71b17ad9b817aea471a77c807481b">Gl_setwidth</a>(wins.ws_col);
<a name="l00761"></a>00761 
<a name="l00762"></a>00762       sprintf(lenv, <span class="stringliteral">"LINES=%d"</span>, wins.ws_row);
<a name="l00763"></a>00763       putenv(lenv);
<a name="l00764"></a>00764       sprintf(cenv, <span class="stringliteral">"COLUMNS=%d"</span>, wins.ws_col);
<a name="l00765"></a>00765       putenv(cenv);
<a name="l00766"></a>00766    }
<a name="l00767"></a>00767 <span class="preprocessor">#endif</span>
<a name="l00768"></a>00768 <span class="preprocessor"></span>}
<a name="l00769"></a>00769 
<a name="l00770"></a>00770 <span class="comment">/* -1 = init, 0 = line mode, 1 = one char at a time mode, 2 = cleanup */</span>
<a name="l00771"></a>00771 
<a name="l00772"></a>00772 <span class="keywordtype">char</span> *
<a name="l00773"></a><a class="code" href="Getline_8c.html#9645d45daf029b25184ebb1632e3bec2">00773</a> <a class="code" href="Getline_8c.html#9645d45daf029b25184ebb1632e3bec2">Getlinem</a>(<span class="keywordtype">int</span> mode, <span class="keyword">const</span> <span class="keywordtype">char</span> *prompt)
<a name="l00774"></a>00774 {
<a name="l00775"></a>00775     <span class="keywordtype">int</span>             c, loc, tmp;
<a name="l00776"></a>00776     <span class="keywordtype">int</span>             sig;
<a name="l00777"></a>00777 
<a name="l00778"></a>00778     <span class="keywordflow">if</span> (mode == 2) {
<a name="l00779"></a>00779        <a class="code" href="Getline_8c.html#05208e7c512c81f59e60b8aec4e062f3">gl_cleanup</a>();
<a name="l00780"></a>00780        <span class="keywordflow">return</span> NULL;
<a name="l00781"></a>00781     }
<a name="l00782"></a>00782 
<a name="l00783"></a>00783     <span class="keywordflow">if</span> (mode &lt; 1) {
<a name="l00784"></a>00784        <span class="keywordflow">if</span> (mode == -1) {
<a name="l00785"></a>00785            <a class="code" href="Getline_8c.html#666d05c4f215e909faf86ddb23f80f67">Gl_config</a>(<span class="stringliteral">"noecho"</span>, 0);
<a name="l00786"></a>00786            <a class="code" href="Getline_8c.html#666d05c4f215e909faf86ddb23f80f67">Gl_config</a>(<span class="stringliteral">"erase"</span>, 0);
<a name="l00787"></a>00787        }
<a name="l00788"></a>00788        <a class="code" href="Getline_8c.html#0b988a2248f31975c52df57f36cf9a99">gl_init</a>();
<a name="l00789"></a>00789        <a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a> = (prompt) ? prompt : <span class="stringliteral">""</span>;
<a name="l00790"></a>00790        <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[0] = 0;
<a name="l00791"></a>00791        <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#f3a7308de9b610f1230c5f54befd2b9a">Gl_in_hook</a>)
<a name="l00792"></a>00792            <a class="code" href="Getline_8c.html#f3a7308de9b610f1230c5f54befd2b9a">Gl_in_hook</a>(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>);
<a name="l00793"></a>00793        <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, -2, <a class="code" href="Getline_8c.html#6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>);
<a name="l00794"></a>00794        <span class="keywordflow">if</span> (mode == -1) <span class="keywordflow">return</span> NULL;
<a name="l00795"></a>00795     }
<a name="l00796"></a>00796     <span class="keywordflow">while</span> ((c = <a class="code" href="Getline_8c.html#d722d07834674dc6b1c9e7fa9e25a354">gl_getc</a>()) &gt;= 0) {
<a name="l00797"></a>00797         <a class="code" href="Getline_8c.html#7ebc25e8509b7b84cc07e10ced5eb694">gl_extent</a> = 0;          <span class="comment">/* reset to full extent */</span>
<a name="l00798"></a>00798 <span class="preprocessor">#ifndef WIN32</span>
<a name="l00799"></a>00799 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (isprint(c)) {
<a name="l00800"></a>00800 <span class="preprocessor">#else</span>
<a name="l00801"></a>00801 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (c &gt;= <span class="charliteral">' '</span>) {
<a name="l00802"></a>00802 <span class="preprocessor">#endif</span>
<a name="l00803"></a>00803 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#3063e9d42fe363bf22e21c5e77c4400b">gl_search_mode</a>)
<a name="l00804"></a>00804                <a class="code" href="Getline_8c.html#a1d090c3a4e5647f8ec95f0bdd59b2ee">search_addchar</a>(c);
<a name="l00805"></a>00805             <span class="keywordflow">else</span>
<a name="l00806"></a>00806                <a class="code" href="Getline_8c.html#5568ec10a1b63f2014af7a7c09e52e0a">gl_addchar</a>(c);
<a name="l00807"></a>00807         } <span class="keywordflow">else</span> {
<a name="l00808"></a>00808             <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#3063e9d42fe363bf22e21c5e77c4400b">gl_search_mode</a>) {
<a name="l00809"></a>00809                 <span class="keywordflow">if</span> (c == <span class="charliteral">'\033'</span> || c == <span class="charliteral">'\016'</span> || c == <span class="charliteral">'\020'</span>) {
<a name="l00810"></a>00810                     <a class="code" href="Getline_8c.html#423e523cc4e5c6ce59fc0fc35a9697ea">search_term</a>();
<a name="l00811"></a>00811                     c = 0;              <span class="comment">/* ignore the character */</span>
<a name="l00812"></a>00812                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">'\010'</span> || c == '\177') {
<a name="l00813"></a>00813                     <a class="code" href="Getline_8c.html#a1d090c3a4e5647f8ec95f0bdd59b2ee">search_addchar</a>(-1); <span class="comment">/* unwind search string */</span>
<a name="l00814"></a>00814                     c = 0;
<a name="l00815"></a>00815                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c != <span class="charliteral">'\022'</span> &amp;&amp; c != <span class="charliteral">'\023'</span>) {
<a name="l00816"></a>00816                     <a class="code" href="Getline_8c.html#423e523cc4e5c6ce59fc0fc35a9697ea">search_term</a>();      <span class="comment">/* terminate and handle char */</span>
<a name="l00817"></a>00817                 }
<a name="l00818"></a>00818             }
<a name="l00819"></a>00819             <span class="comment">/* NOTE:</span>
<a name="l00820"></a>00820 <span class="comment">             * sometimes M-x turns on bit 8               ( M-x --&gt; 'x' + 128  )</span>
<a name="l00821"></a>00821 <span class="comment">             * sometimes M-x prepends an escape character ( M-x --&gt; '\033','x' )</span>
<a name="l00822"></a>00822 <span class="comment">             * both cases are handled ...</span>
<a name="l00823"></a>00823 <span class="comment">             */</span>
<a name="l00824"></a>00824             <span class="keywordflow">switch</span> (c)
<a name="l00825"></a>00825             {
<a name="l00826"></a>00826             <span class="keywordflow">case</span> <span class="charliteral">'b'</span>+128:                           <span class="comment">/* M-b */</span>
<a name="l00827"></a>00827             <span class="keywordflow">case</span> <span class="charliteral">'B'</span>+128:                           <span class="comment">/* M-B */</span>
<a name="l00828"></a>00828                  <a class="code" href="Getline_8c.html#821ee3fc2397e5abec67375f3129fff9">gl_back_1_word</a>();
<a name="l00829"></a>00829                  <span class="keywordflow">break</span>;
<a name="l00830"></a>00830             <span class="keywordflow">case</span> <span class="charliteral">'d'</span>+128:                           <span class="comment">/* M-d */</span>
<a name="l00831"></a>00831             <span class="keywordflow">case</span> <span class="charliteral">'D'</span>+128:                           <span class="comment">/* M-D */</span>
<a name="l00832"></a>00832                  <a class="code" href="Getline_8c.html#56af07ae473ac2bc5281ba45bdf165c1">gl_kill_1_word</a>();
<a name="l00833"></a>00833                  <span class="keywordflow">break</span>;
<a name="l00834"></a>00834             <span class="keywordflow">case</span> <span class="charliteral">'f'</span>+128:                           <span class="comment">/* M-f */</span>
<a name="l00835"></a>00835             <span class="keywordflow">case</span> <span class="charliteral">'F'</span>+128:                           <span class="comment">/* M-F */</span>
<a name="l00836"></a>00836                  <a class="code" href="Getline_8c.html#d64a9a053cf1e79f45cfe508476636f8">gl_fwd_1_word</a>();
<a name="l00837"></a>00837                  <span class="keywordflow">break</span>;
<a name="l00838"></a>00838             <span class="keywordflow">case</span> <span class="charliteral">'\000'</span>:                           <span class="comment">/* ^SPC */</span>
<a name="l00839"></a>00839                  <a class="code" href="Getline_8c.html#e99f301c318e367b7b409b2cbb6c2607">gl_set_mark</a>();
<a name="l00840"></a>00840                  <span class="keywordflow">break</span>;
<a name="l00841"></a>00841             <span class="keywordflow">case</span> <span class="charliteral">'\027'</span>:                           <span class="comment">/* ^W  */</span>
<a name="l00842"></a>00842                  <a class="code" href="Getline_8c.html#922cd7283fa8eef047b969d96bbef302">gl_wipe</a>();
<a name="l00843"></a>00843                  <span class="keywordflow">break</span>;
<a name="l00844"></a>00844             <span class="keywordflow">case</span> <span class="charliteral">'\030'</span>:                           <span class="comment">/* ^X  */</span>
<a name="l00845"></a>00845                  <a class="code" href="Getline_8c.html#afe258d2fe04a339bcba29dba4c27653">gl_exch</a>();
<a name="l00846"></a>00846                  <span class="keywordflow">break</span>;
<a name="l00847"></a>00847             <span class="keywordflow">case</span> <span class="charliteral">'\n'</span>:                             <span class="comment">/* newline */</span>
<a name="l00848"></a>00848             <span class="keywordflow">case</span> <span class="charliteral">'\r'</span>:
<a name="l00849"></a>00849                  <a class="code" href="Getline_8c.html#f61647c1811f8083b89c84dea02464bd">gl_newline</a>();
<a name="l00850"></a>00850                  <a class="code" href="Getline_8c.html#05208e7c512c81f59e60b8aec4e062f3">gl_cleanup</a>();
<a name="l00851"></a>00851                  <span class="keywordflow">return</span> <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>;
<a name="l00852"></a>00852                  <span class="comment">/*NOTREACHED*/</span>
<a name="l00853"></a>00853                  <span class="keywordflow">break</span>;
<a name="l00854"></a>00854             <span class="keywordflow">case</span> <span class="charliteral">'\001'</span>: <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, -1, 0);          <span class="comment">/* ^A */</span>
<a name="l00855"></a>00855                  <span class="keywordflow">break</span>;
<a name="l00856"></a>00856             <span class="keywordflow">case</span> <span class="charliteral">'\002'</span>: <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, -1, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>-1);   <span class="comment">/* ^B */</span>
<a name="l00857"></a>00857                  <span class="keywordflow">break</span>;
<a name="l00858"></a>00858             <span class="keywordflow">case</span> <span class="charliteral">'\004'</span>:                                      <span class="comment">/* ^D */</span>
<a name="l00859"></a>00859                  <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> == 0) {
<a name="l00860"></a>00860                       <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[0] = 0;
<a name="l00861"></a>00861                       <a class="code" href="Getline_8c.html#05208e7c512c81f59e60b8aec4e062f3">gl_cleanup</a>();
<a name="l00862"></a>00862                       <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\n'</span>);
<a name="l00863"></a>00863                       <span class="keywordflow">return</span> <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>;
<a name="l00864"></a>00864                  } <span class="keywordflow">else</span> {
<a name="l00865"></a>00865                       <a class="code" href="Getline_8c.html#8891c31c58a74ec80d900d3d2562b418">gl_del</a>(0);
<a name="l00866"></a>00866                  }
<a name="l00867"></a>00867                  <span class="keywordflow">break</span>;
<a name="l00868"></a>00868             <span class="keywordflow">case</span> <span class="charliteral">'\005'</span>: <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, -1, <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a>);     <span class="comment">/* ^E */</span>
<a name="l00869"></a>00869                  <span class="keywordflow">break</span>;
<a name="l00870"></a>00870             <span class="keywordflow">case</span> <span class="charliteral">'\006'</span>: <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, -1, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>+1);   <span class="comment">/* ^F */</span>
<a name="l00871"></a>00871                  <span class="keywordflow">break</span>;
<a name="l00872"></a>00872             <span class="keywordflow">case</span> <span class="charliteral">'\010'</span>: <span class="keywordflow">case</span> '\177': <a class="code" href="Getline_8c.html#8891c31c58a74ec80d900d3d2562b418">gl_del</a>(-1);     <span class="comment">/* ^H and DEL */</span>
<a name="l00873"></a>00873                  <span class="keywordflow">break</span>;
<a name="l00874"></a>00874             <span class="keywordflow">case</span> <span class="charliteral">'\t'</span>:                                        <span class="comment">/* TAB */</span>
<a name="l00875"></a>00875                  <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#e85d40db728ac8437000be3c637b98ab">Gl_tab_hook</a>) {
<a name="l00876"></a>00876                       tmp = <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>;
<a name="l00877"></a>00877                       loc = <a class="code" href="Getline_8c.html#e85d40db728ac8437000be3c637b98ab">Gl_tab_hook</a>(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>, strlen(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>), &amp;tmp);
<a name="l00878"></a>00878                       <span class="keywordflow">if</span> (loc &gt;= 0 || tmp != <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> || loc == -2)
<a name="l00879"></a>00879                            <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, loc, tmp);
<a name="l00880"></a>00880                  }
<a name="l00881"></a>00881                  <span class="keywordflow">break</span>;
<a name="l00882"></a>00882             <span class="keywordflow">case</span> <span class="charliteral">'\013'</span>: <a class="code" href="Getline_8c.html#092e74bdcde8cba164a1eff7b1d7e981">gl_kill</a>();                           <span class="comment">/* ^K */</span>
<a name="l00883"></a>00883                  <span class="keywordflow">break</span>;
<a name="l00884"></a>00884             <span class="keywordflow">case</span> <span class="charliteral">'\014'</span>: <a class="code" href="Getline_8c.html#2e04ab80238f627d734ebcdf879321aa">gl_redraw</a>();                         <span class="comment">/* ^L */</span>
<a name="l00885"></a>00885                  <span class="keywordflow">break</span>;
<a name="l00886"></a>00886             <span class="keywordflow">case</span> <span class="charliteral">'\016'</span>:                                      <span class="comment">/* ^N */</span>
<a name="l00887"></a>00887                  strcpy(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>, <a class="code" href="Getline_8c.html#55da523ba030c0c07019af7d536b48b1">hist_next</a>());
<a name="l00888"></a>00888                  <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#f3a7308de9b610f1230c5f54befd2b9a">Gl_in_hook</a>)
<a name="l00889"></a>00889                       <a class="code" href="Getline_8c.html#f3a7308de9b610f1230c5f54befd2b9a">Gl_in_hook</a>(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>);
<a name="l00890"></a>00890                  <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, 0, <a class="code" href="Getline_8c.html#6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>);
<a name="l00891"></a>00891                  <span class="keywordflow">break</span>;
<a name="l00892"></a>00892             <span class="keywordflow">case</span> <span class="charliteral">'\017'</span>: <a class="code" href="Getline_8c.html#9024eafac53bfdf2232bf173e993845a">gl_overwrite</a> = !<a class="code" href="Getline_8c.html#9024eafac53bfdf2232bf173e993845a">gl_overwrite</a>;        <span class="comment">/* ^O */</span>
<a name="l00893"></a>00893                  <span class="keywordflow">break</span>;
<a name="l00894"></a>00894             <span class="keywordflow">case</span> <span class="charliteral">'\020'</span>:                                      <span class="comment">/* ^P */</span>
<a name="l00895"></a>00895                  strcpy(gl_buf, <a class="code" href="Getline_8c.html#a0ff91ed11b5c20ac307a4b2c020ce92">hist_prev</a>());
<a name="l00896"></a>00896                  <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#f3a7308de9b610f1230c5f54befd2b9a">Gl_in_hook</a>)
<a name="l00897"></a>00897                       <a class="code" href="Getline_8c.html#f3a7308de9b610f1230c5f54befd2b9a">Gl_in_hook</a>(gl_buf);
<a name="l00898"></a>00898                  <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, 0, <a class="code" href="Getline_8c.html#6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>);
<a name="l00899"></a>00899                  <span class="keywordflow">break</span>;
<a name="l00900"></a>00900             <span class="keywordflow">case</span> <span class="charliteral">'\022'</span>: <a class="code" href="Getline_8c.html#19a8833a6643d6d93b023b33f9344c49">search_back</a>(1);                      <span class="comment">/* ^R */</span>
<a name="l00901"></a>00901                  <span class="keywordflow">break</span>;
<a name="l00902"></a>00902             <span class="keywordflow">case</span> <span class="charliteral">'\023'</span>: <a class="code" href="Getline_8c.html#2a70d511cb480dcd1aeb46d63396f950">search_forw</a>(1);                      <span class="comment">/* ^S */</span>
<a name="l00903"></a>00903                  <span class="keywordflow">break</span>;
<a name="l00904"></a>00904             <span class="keywordflow">case</span> <span class="charliteral">'\024'</span>: <a class="code" href="Getline_8c.html#656d83a0fc9e30a199c9cc35bcccbdc6">gl_transpose</a>();                      <span class="comment">/* ^T */</span>
<a name="l00905"></a>00905                  <span class="keywordflow">break</span>;
<a name="l00906"></a>00906             <span class="keywordflow">case</span> <span class="charliteral">'\025'</span>: <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>,-1,0); <a class="code" href="Getline_8c.html#092e74bdcde8cba164a1eff7b1d7e981">gl_kill</a>(); <span class="comment">/* ^U */</span>
<a name="l00907"></a>00907                  <span class="keywordflow">break</span>;
<a name="l00908"></a>00908             <span class="keywordflow">case</span> <span class="charliteral">'\031'</span>: <a class="code" href="Getline_8c.html#2b19e812d00fc84dcfa3628fde26f8f8">gl_yank</a>();                           <span class="comment">/* ^Y */</span>
<a name="l00909"></a>00909                  <span class="keywordflow">break</span>;
<a name="l00910"></a>00910             <span class="keywordflow">case</span> <span class="charliteral">'\033'</span>:
<a name="l00911"></a>00911                  <span class="keywordflow">switch</span>(c = <a class="code" href="Getline_8c.html#d722d07834674dc6b1c9e7fa9e25a354">gl_getc</a>())
<a name="l00912"></a>00912                  {
<a name="l00913"></a>00913                  <span class="keywordflow">case</span> <span class="charliteral">'b'</span>:                           <span class="comment">/* M-b */</span>
<a name="l00914"></a>00914                  <span class="keywordflow">case</span> <span class="charliteral">'B'</span>:                           <span class="comment">/* M-B */</span>
<a name="l00915"></a>00915                       <a class="code" href="Getline_8c.html#821ee3fc2397e5abec67375f3129fff9">gl_back_1_word</a>();
<a name="l00916"></a>00916                       <span class="keywordflow">break</span>;
<a name="l00917"></a>00917                  <span class="keywordflow">case</span> <span class="charliteral">'d'</span>:                           <span class="comment">/* M-d */</span>
<a name="l00918"></a>00918                  <span class="keywordflow">case</span> <span class="charliteral">'D'</span>:                           <span class="comment">/* M-D */</span>
<a name="l00919"></a>00919                       <a class="code" href="Getline_8c.html#56af07ae473ac2bc5281ba45bdf165c1">gl_kill_1_word</a>();
<a name="l00920"></a>00920                       <span class="keywordflow">break</span>;
<a name="l00921"></a>00921                  <span class="keywordflow">case</span> <span class="charliteral">'f'</span>:                           <span class="comment">/* M-f */</span>
<a name="l00922"></a>00922                  <span class="keywordflow">case</span> <span class="charliteral">'F'</span>:                           <span class="comment">/* M-F */</span>
<a name="l00923"></a>00923                       <a class="code" href="Getline_8c.html#d64a9a053cf1e79f45cfe508476636f8">gl_fwd_1_word</a>();
<a name="l00924"></a>00924                       <span class="keywordflow">break</span>;
<a name="l00925"></a>00925                  <span class="keywordflow">case</span> <span class="charliteral">'['</span>:                                <span class="comment">/* ansi arrow keys */</span>
<a name="l00926"></a>00926                  <span class="keywordflow">case</span> <span class="charliteral">'O'</span>:                                <span class="comment">/* xterm arrow keys */</span>
<a name="l00927"></a>00927                       <span class="keywordflow">switch</span>(c = <a class="code" href="Getline_8c.html#d722d07834674dc6b1c9e7fa9e25a354">gl_getc</a>())
<a name="l00928"></a>00928                       {
<a name="l00929"></a>00929                       <span class="keywordflow">case</span> <span class="charliteral">'A'</span>:                           <span class="comment">/* up */</span>
<a name="l00930"></a>00930                            strcpy(gl_buf, <a class="code" href="Getline_8c.html#a0ff91ed11b5c20ac307a4b2c020ce92">hist_prev</a>());
<a name="l00931"></a>00931                            <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#f3a7308de9b610f1230c5f54befd2b9a">Gl_in_hook</a>)
<a name="l00932"></a>00932                                 <a class="code" href="Getline_8c.html#f3a7308de9b610f1230c5f54befd2b9a">Gl_in_hook</a>(gl_buf);
<a name="l00933"></a>00933                            <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, 0, <a class="code" href="Getline_8c.html#6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>);
<a name="l00934"></a>00934                            <span class="keywordflow">break</span>;
<a name="l00935"></a>00935                       <span class="keywordflow">case</span> <span class="charliteral">'B'</span>:                          <span class="comment">/* down */</span>
<a name="l00936"></a>00936                            strcpy(gl_buf, <a class="code" href="Getline_8c.html#55da523ba030c0c07019af7d536b48b1">hist_next</a>());
<a name="l00937"></a>00937                            <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#f3a7308de9b610f1230c5f54befd2b9a">Gl_in_hook</a>)
<a name="l00938"></a>00938                                 <a class="code" href="Getline_8c.html#f3a7308de9b610f1230c5f54befd2b9a">Gl_in_hook</a>(gl_buf);
<a name="l00939"></a>00939                            <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, 0, <a class="code" href="Getline_8c.html#6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>);
<a name="l00940"></a>00940                            <span class="keywordflow">break</span>;
<a name="l00941"></a>00941                       <span class="keywordflow">case</span> <span class="charliteral">'C'</span>: <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, -1, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>+1);  <span class="comment">/* right */</span>
<a name="l00942"></a>00942                            <span class="keywordflow">break</span>;
<a name="l00943"></a>00943                       <span class="keywordflow">case</span> <span class="charliteral">'D'</span>: <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, -1, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>-1);  <span class="comment">/* left */</span>
<a name="l00944"></a>00944                            <span class="keywordflow">break</span>;
<a name="l00945"></a>00945                       <span class="keywordflow">default</span>:                                 <span class="comment">/* who knows */</span>
<a name="l00946"></a>00946                            <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\007'</span>);
<a name="l00947"></a>00947                            <span class="keywordflow">break</span>;
<a name="l00948"></a>00948                       }
<a name="l00949"></a>00949                       <span class="keywordflow">break</span>;
<a name="l00950"></a>00950                  <span class="keywordflow">case</span> <span class="charliteral">'\010'</span>:           <span class="comment">/* DEL and ^H */</span>
<a name="l00951"></a>00951                  <span class="keywordflow">case</span> '\177':
<a name="l00952"></a>00952                       <a class="code" href="Getline_8c.html#959275de9f5e497fa3be7c729521dd8f">gl_kill_back_1_word</a>();
<a name="l00953"></a>00953                       <span class="keywordflow">break</span>;
<a name="l00954"></a>00954                  <span class="keywordflow">default</span>:
<a name="l00955"></a>00955                       <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\007'</span>);
<a name="l00956"></a>00956                  }
<a name="l00957"></a>00957                  <span class="keywordflow">break</span>;
<a name="l00958"></a>00958             <span class="keywordflow">default</span>:          <span class="comment">/* check for a terminal signal */</span>
<a name="l00959"></a>00959 
<a name="l00960"></a>00960 <span class="preprocessor">#if defined(unix) || defined(WIN32) || defined(R__MWERKS)</span>
<a name="l00961"></a>00961 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (c &gt; 0) {    <span class="comment">/* ignore 0 (reset above) */</span>
<a name="l00962"></a>00962                     sig = 0;
<a name="l00963"></a>00963 <span class="preprocessor">#ifdef SIGINT</span>
<a name="l00964"></a>00964 <span class="preprocessor"></span>                    <span class="keywordflow">if</span> (c == <a class="code" href="Getline_8c.html#3316befdd86d49873d6d0d2e84e800dd">gl_intrc</a>)
<a name="l00965"></a>00965                         sig = SIGINT;
<a name="l00966"></a>00966 <span class="preprocessor">#endif</span>
<a name="l00967"></a>00967 <span class="preprocessor"></span><span class="preprocessor">#ifdef SIGQUIT</span>
<a name="l00968"></a>00968 <span class="preprocessor"></span>                    <span class="keywordflow">if</span> (c == <a class="code" href="Getline_8c.html#e04b98935d9fe3c71398c4d28d3477bc">gl_quitc</a>)
<a name="l00969"></a>00969                         sig = SIGQUIT;
<a name="l00970"></a>00970 <span class="preprocessor">#endif</span>
<a name="l00971"></a>00971 <span class="preprocessor"></span><span class="preprocessor">#ifdef SIGTSTP</span>
<a name="l00972"></a>00972 <span class="preprocessor"></span>                    <span class="keywordflow">if</span> (c == <a class="code" href="Getline_8c.html#f8145cf01d4e6042f3e0ea077628a62b">gl_suspc</a> || c == <a class="code" href="Getline_8c.html#74bfc882d1e203ae8025d2f177dc325f">gl_dsuspc</a>)
<a name="l00973"></a>00973                         sig = SIGTSTP;
<a name="l00974"></a>00974 <span class="preprocessor">#endif</span>
<a name="l00975"></a>00975 <span class="preprocessor"></span>                    <span class="keywordflow">if</span> (sig != 0) {
<a name="l00976"></a>00976                         <a class="code" href="Getline_8c.html#05208e7c512c81f59e60b8aec4e062f3">gl_cleanup</a>();
<a name="l00977"></a>00977 <span class="preprocessor">#if !defined(WIN32)</span>
<a name="l00978"></a>00978 <span class="preprocessor"></span>                        raise(sig);
<a name="l00979"></a>00979 <span class="preprocessor">#endif</span>
<a name="l00980"></a>00980 <span class="preprocessor"></span><span class="preprocessor">#ifdef WIN32</span>
<a name="l00981"></a>00981 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (sig == SIGINT) GenerateConsoleCtrlEvent(CTRL_C_EVENT,0);
<a name="l00982"></a>00982                         <span class="keywordflow">else</span> raise(sig);
<a name="l00983"></a>00983 <span class="preprocessor">#endif</span>
<a name="l00984"></a>00984 <span class="preprocessor"></span>                        <a class="code" href="Getline_8c.html#0b988a2248f31975c52df57f36cf9a99">gl_init</a>();
<a name="l00985"></a>00985                         <a class="code" href="Getline_8c.html#2e04ab80238f627d734ebcdf879321aa">gl_redraw</a>();
<a name="l00986"></a>00986                         c = 0;
<a name="l00987"></a>00987                     }
<a name="l00988"></a>00988                 }
<a name="l00989"></a>00989 <span class="preprocessor">#endif </span><span class="comment">/* unix */</span>
<a name="l00990"></a>00990                 <span class="keywordflow">if</span> (c &gt; 0)
<a name="l00991"></a>00991                     <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\007'</span>);
<a name="l00992"></a>00992                 <span class="keywordflow">break</span>;
<a name="l00993"></a>00993             }
<a name="l00994"></a>00994         }
<a name="l00995"></a>00995         <span class="keywordflow">if</span> (mode == 1) <span class="keywordflow">return</span> NULL;
<a name="l00996"></a>00996     }
<a name="l00997"></a>00997     <span class="keywordflow">if</span> (c == -1 &amp;&amp; <a class="code" href="Getline_8c.html#7f7957926207f30e875bb787f2dc7a3d">gl_notty</a>)
<a name="l00998"></a>00998        <a class="code" href="Getline_8c.html#0f75a96ef89d563b1d6e0d33e6393239">gl_eof</a> = 1;
<a name="l00999"></a>00999     <span class="keywordflow">else</span>
<a name="l01000"></a>01000        <a class="code" href="Getline_8c.html#0f75a96ef89d563b1d6e0d33e6393239">gl_eof</a> = 0;
<a name="l01001"></a>01001 
<a name="l01002"></a>01002     <a class="code" href="Getline_8c.html#05208e7c512c81f59e60b8aec4e062f3">gl_cleanup</a>();
<a name="l01003"></a>01003     <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[0] = 0;
<a name="l01004"></a>01004     <span class="keywordflow">return</span> <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>;
<a name="l01005"></a>01005 }
<a name="l01006"></a>01006 
<a name="l01007"></a>01007 <span class="keywordtype">int</span>
<a name="l01008"></a><a class="code" href="Getline_8c.html#15de2dae18f362e6211ac28598b0daf3">01008</a> <a class="code" href="Getline_8c.html#15de2dae18f362e6211ac28598b0daf3">Gl_eof</a>()
<a name="l01009"></a>01009 {
<a name="l01010"></a>01010    <span class="keywordflow">return</span> <a class="code" href="Getline_8c.html#0f75a96ef89d563b1d6e0d33e6393239">gl_eof</a>;
<a name="l01011"></a>01011 }
<a name="l01012"></a>01012 
<a name="l01013"></a>01013 <span class="keywordtype">char</span> *
<a name="l01014"></a><a class="code" href="Getline_8c.html#d4f9d54d023bc30cc8f3e721d81ce386">01014</a> <a class="code" href="Getline_8c.html#d4f9d54d023bc30cc8f3e721d81ce386">Getline</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *prompt)
<a name="l01015"></a>01015 {
<a name="l01016"></a>01016    <span class="keywordflow">return</span> <a class="code" href="Getline_8c.html#9645d45daf029b25184ebb1632e3bec2">Getlinem</a>(0, prompt);
<a name="l01017"></a>01017 }
<a name="l01018"></a>01018 
<a name="l01019"></a>01019 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01020"></a><a class="code" href="Getline_8c.html#5568ec10a1b63f2014af7a7c09e52e0a">01020</a> <a class="code" href="Getline_8c.html#5568ec10a1b63f2014af7a7c09e52e0a">gl_addchar</a>(<span class="keywordtype">int</span> c)
<a name="l01021"></a>01021 <span class="comment">/* adds the character c to the input buffer at current location */</span>
<a name="l01022"></a>01022 {
<a name="l01023"></a>01023     <span class="keywordtype">int</span>  i;
<a name="l01024"></a>01024 
<a name="l01025"></a>01025     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> &gt;= <a class="code" href="Getline_8c.html#6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a> - 1)
<a name="l01026"></a>01026         <a class="code" href="Getline_8c.html#4770103b7ab977b0c878790929860a8a">gl_error</a>(<span class="stringliteral">"\n*** Error: Getline(): input buffer overflow\n"</span>);
<a name="l01027"></a>01027     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#9024eafac53bfdf2232bf173e993845a">gl_overwrite</a> == 0 || <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> == <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a>) {
<a name="l01028"></a>01028         <span class="keywordflow">for</span> (i=<a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a>; i &gt;= <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>; i--)
<a name="l01029"></a>01029             <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[i+1] = <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[i];
<a name="l01030"></a>01030         <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[<a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>] = c;
<a name="l01031"></a>01031         <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>+1);
<a name="l01032"></a>01032     } <span class="keywordflow">else</span> {
<a name="l01033"></a>01033         <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[<a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>] = c;
<a name="l01034"></a>01034         <a class="code" href="Getline_8c.html#7ebc25e8509b7b84cc07e10ced5eb694">gl_extent</a> = 1;
<a name="l01035"></a>01035         <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>+1);
<a name="l01036"></a>01036     }
<a name="l01037"></a>01037 }
<a name="l01038"></a>01038 
<a name="l01039"></a>01039 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01040"></a><a class="code" href="Getline_8c.html#2b19e812d00fc84dcfa3628fde26f8f8">01040</a> <a class="code" href="Getline_8c.html#2b19e812d00fc84dcfa3628fde26f8f8">gl_yank</a>()
<a name="l01041"></a>01041 <span class="comment">/* adds the kill buffer to the input buffer at current location */</span>
<a name="l01042"></a>01042 {
<a name="l01043"></a>01043     <span class="keywordtype">int</span>  i, len;
<a name="l01044"></a>01044 
<a name="l01045"></a>01045     len = strlen(<a class="code" href="Getline_8c.html#c589fb8abd0b14513bd0c4593ab5cadb">gl_killbuf</a>);
<a name="l01046"></a>01046     <span class="keywordflow">if</span> (len &gt; 0) {
<a name="l01047"></a>01047         <a class="code" href="Getline_8c.html#9e39f121e80f71b767a8c22e16a0a226">gl_mark</a> = <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>;
<a name="l01048"></a>01048         <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#9024eafac53bfdf2232bf173e993845a">gl_overwrite</a> == 0) {
<a name="l01049"></a>01049             <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> + len &gt;= <a class="code" href="Getline_8c.html#6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a> - 1)
<a name="l01050"></a>01050                 <a class="code" href="Getline_8c.html#4770103b7ab977b0c878790929860a8a">gl_error</a>(<span class="stringliteral">"\n*** Error: Getline(): input buffer overflow\n"</span>);
<a name="l01051"></a>01051             <span class="keywordflow">for</span> (i=<a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a>; i &gt;= <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>; i--)
<a name="l01052"></a>01052                 <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[i+len] = <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[i];
<a name="l01053"></a>01053             <span class="keywordflow">for</span> (i=0; i &lt; len; i++)
<a name="l01054"></a>01054                 <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[<a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>+i] = <a class="code" href="Getline_8c.html#c589fb8abd0b14513bd0c4593ab5cadb">gl_killbuf</a>[i];
<a name="l01055"></a>01055             <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>+len);
<a name="l01056"></a>01056         } <span class="keywordflow">else</span> {
<a name="l01057"></a>01057             <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> + len &gt; <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a>) {
<a name="l01058"></a>01058                 <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> + len &gt;= <a class="code" href="Getline_8c.html#6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a> - 1)
<a name="l01059"></a>01059                     <a class="code" href="Getline_8c.html#4770103b7ab977b0c878790929860a8a">gl_error</a>(<span class="stringliteral">"\n*** Error: Getline(): input buffer overflow\n"</span>);
<a name="l01060"></a>01060                 <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[<a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> + len] = 0;
<a name="l01061"></a>01061             }
<a name="l01062"></a>01062             <span class="keywordflow">for</span> (i=0; i &lt; len; i++)
<a name="l01063"></a>01063                 <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[<a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>+i] = <a class="code" href="Getline_8c.html#c589fb8abd0b14513bd0c4593ab5cadb">gl_killbuf</a>[i];
<a name="l01064"></a>01064             <a class="code" href="Getline_8c.html#7ebc25e8509b7b84cc07e10ced5eb694">gl_extent</a> = len;
<a name="l01065"></a>01065             <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>+len);
<a name="l01066"></a>01066         }
<a name="l01067"></a>01067     } <span class="keywordflow">else</span>
<a name="l01068"></a>01068         <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\007'</span>);
<a name="l01069"></a>01069 }
<a name="l01070"></a>01070 
<a name="l01071"></a>01071 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01072"></a><a class="code" href="Getline_8c.html#656d83a0fc9e30a199c9cc35bcccbdc6">01072</a> <a class="code" href="Getline_8c.html#656d83a0fc9e30a199c9cc35bcccbdc6">gl_transpose</a>()
<a name="l01073"></a>01073 <span class="comment">/* switch character under cursor and to left of cursor */</span>
<a name="l01074"></a>01074 {
<a name="l01075"></a>01075     <span class="keywordtype">int</span>    c;
<a name="l01076"></a>01076 
<a name="l01077"></a>01077     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> &gt; 0 &amp;&amp; <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> &gt; <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>) {
<a name="l01078"></a>01078         c = <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[<a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>-1];
<a name="l01079"></a>01079         <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[<a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>-1] = <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[<a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>];
<a name="l01080"></a>01080         <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[<a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>] = c;
<a name="l01081"></a>01081         <a class="code" href="Getline_8c.html#7ebc25e8509b7b84cc07e10ced5eb694">gl_extent</a> = 2;
<a name="l01082"></a>01082         <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>-1, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>);
<a name="l01083"></a>01083     } <span class="keywordflow">else</span>
<a name="l01084"></a>01084         <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\007'</span>);
<a name="l01085"></a>01085 }
<a name="l01086"></a>01086 
<a name="l01087"></a>01087 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01088"></a><a class="code" href="Getline_8c.html#f61647c1811f8083b89c84dea02464bd">01088</a> <a class="code" href="Getline_8c.html#f61647c1811f8083b89c84dea02464bd">gl_newline</a>()
<a name="l01089"></a>01089 <span class="comment">/*</span>
<a name="l01090"></a>01090 <span class="comment"> * Cleans up entire line before returning to caller. A \n is appended.</span>
<a name="l01091"></a>01091 <span class="comment"> * If line longer than screen, we redraw starting at beginning</span>
<a name="l01092"></a>01092 <span class="comment"> */</span>
<a name="l01093"></a>01093 {
<a name="l01094"></a>01094     <span class="keywordtype">int</span> change = <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a>;
<a name="l01095"></a>01095     <span class="keywordtype">int</span> len = <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a>;
<a name="l01096"></a>01096     <span class="keywordtype">int</span> loc = <a class="code" href="Getline_8c.html#219531cddf67f1009a3d23c599f0138c">gl_width</a> - 5;     <span class="comment">/* shifts line back to start position */</span>
<a name="l01097"></a>01097 
<a name="l01098"></a>01098     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> &gt;= <a class="code" href="Getline_8c.html#6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a> - 1)
<a name="l01099"></a>01099         <a class="code" href="Getline_8c.html#4770103b7ab977b0c878790929860a8a">gl_error</a>(<span class="stringliteral">"\n*** Error: Getline(): input buffer overflow\n"</span>);
<a name="l01100"></a>01100     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#5b29019cf7968853ffb03243c3bea424">Gl_out_hook</a>) {
<a name="l01101"></a>01101         change = <a class="code" href="Getline_8c.html#5b29019cf7968853ffb03243c3bea424">Gl_out_hook</a>(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>);
<a name="l01102"></a>01102         len = strlen(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>);
<a name="l01103"></a>01103     }
<a name="l01104"></a>01104     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#61d4581ca5282abe15cbcc74213a94f9">gl_erase_line</a>) {
<a name="l01105"></a>01105         <span class="keywordtype">char</span> gl_buf0 = <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[0];
<a name="l01106"></a>01106         <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[0] = <span class="charliteral">'\0'</span>;
<a name="l01107"></a>01107         <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<span class="stringliteral">""</span>, 0, 0);
<a name="l01108"></a>01108         <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[0] = gl_buf0;
<a name="l01109"></a>01109     }
<a name="l01110"></a>01110     <span class="keywordflow">else</span> {
<a name="l01111"></a>01111         <span class="keywordflow">if</span> (loc &gt; len)
<a name="l01112"></a>01112             loc = len;
<a name="l01113"></a>01113         <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, change, loc);   <span class="comment">/* must do this before appending \n */</span>
<a name="l01114"></a>01114         <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\n'</span>);
<a name="l01115"></a>01115     }
<a name="l01116"></a>01116     <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[len] = <span class="charliteral">'\n'</span>;
<a name="l01117"></a>01117     <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[len+1] = <span class="charliteral">'\0'</span>;
<a name="l01118"></a>01118     <a class="code" href="Getline_8c.html#9e39f121e80f71b767a8c22e16a0a226">gl_mark</a> = -1;
<a name="l01119"></a>01119 }
<a name="l01120"></a>01120 
<a name="l01121"></a>01121 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01122"></a><a class="code" href="Getline_8c.html#8891c31c58a74ec80d900d3d2562b418">01122</a> <a class="code" href="Getline_8c.html#8891c31c58a74ec80d900d3d2562b418">gl_del</a>(<span class="keywordtype">int</span> loc)
<a name="l01123"></a>01123 <span class="comment">/*</span>
<a name="l01124"></a>01124 <span class="comment"> * Delete a character.  The loc variable can be:</span>
<a name="l01125"></a>01125 <span class="comment"> *    -1 : delete character to left of cursor</span>
<a name="l01126"></a>01126 <span class="comment"> *     0 : delete character under cursor</span>
<a name="l01127"></a>01127 <span class="comment"> */</span>
<a name="l01128"></a>01128 {
<a name="l01129"></a>01129     <span class="keywordtype">int</span> i;
<a name="l01130"></a>01130 
<a name="l01131"></a>01131     <span class="keywordflow">if</span> ((loc == -1 &amp;&amp; <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> &gt; 0) || (loc == 0 &amp;&amp; <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> &lt; <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a>)) {
<a name="l01132"></a>01132         <span class="keywordflow">for</span> (i=<a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>+loc; i &lt; <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a>; i++)
<a name="l01133"></a>01133             <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[i] = <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[i+1];
<a name="l01134"></a>01134         <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>+loc, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>+loc);
<a name="l01135"></a>01135     } <span class="keywordflow">else</span>
<a name="l01136"></a>01136         <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\007'</span>);
<a name="l01137"></a>01137 }
<a name="l01138"></a>01138 
<a name="l01139"></a>01139 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01140"></a><a class="code" href="Getline_8c.html#092e74bdcde8cba164a1eff7b1d7e981">01140</a> <a class="code" href="Getline_8c.html#092e74bdcde8cba164a1eff7b1d7e981">gl_kill</a>()
<a name="l01141"></a>01141 <span class="comment">/* delete from current position to the end of line */</span>
<a name="l01142"></a>01142 {
<a name="l01143"></a>01143     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> &lt; <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a>) {
<a name="l01144"></a>01144         strcpy(<a class="code" href="Getline_8c.html#c589fb8abd0b14513bd0c4593ab5cadb">gl_killbuf</a>, <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a> + <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>);
<a name="l01145"></a>01145         <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[<a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>] = <span class="charliteral">'\0'</span>;
<a name="l01146"></a>01146         <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>);
<a name="l01147"></a>01147     } <span class="keywordflow">else</span>
<a name="l01148"></a>01148         <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\007'</span>);
<a name="l01149"></a>01149 }
<a name="l01150"></a>01150 
<a name="l01151"></a>01151 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01152"></a><a class="code" href="Getline_8c.html#2e04ab80238f627d734ebcdf879321aa">01152</a> <a class="code" href="Getline_8c.html#2e04ab80238f627d734ebcdf879321aa">gl_redraw</a>()
<a name="l01153"></a>01153 <span class="comment">/* emit a newline, reset and redraw prompt and current input line */</span>
<a name="l01154"></a>01154 {
<a name="l01155"></a>01155     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#530bc6f98e7807246ab93a1056a22211">gl_init_done</a> &gt; 0) {
<a name="l01156"></a>01156         <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\n'</span>);
<a name="l01157"></a>01157         <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, -2, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>);
<a name="l01158"></a>01158     }
<a name="l01159"></a>01159 }
<a name="l01160"></a>01160 
<a name="l01161"></a>01161 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01162"></a><a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">01162</a> <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *prompt, <span class="keywordtype">int</span> change, <span class="keywordtype">int</span> cursor)
<a name="l01163"></a>01163 <span class="comment">/*</span>
<a name="l01164"></a>01164 <span class="comment"> * This function is used both for redrawing when input changes or for</span>
<a name="l01165"></a>01165 <span class="comment"> * moving within the input line.  The parameters are:</span>
<a name="l01166"></a>01166 <span class="comment"> *   prompt:  compared to last_prompt[] for changes;</span>
<a name="l01167"></a>01167 <span class="comment"> *   change : the index of the start of changes in the input buffer,</span>
<a name="l01168"></a>01168 <span class="comment"> *            with -1 indicating no changes, -2 indicating we're on</span>
<a name="l01169"></a>01169 <span class="comment"> *            a new line, redraw everything.</span>
<a name="l01170"></a>01170 <span class="comment"> *   cursor : the desired location of the cursor after the call.</span>
<a name="l01171"></a>01171 <span class="comment"> *            A value of BUF_SIZE can be used  to indicate the cursor should</span>
<a name="l01172"></a>01172 <span class="comment"> *            move just past the end of the input line.</span>
<a name="l01173"></a>01173 <span class="comment"> */</span>
<a name="l01174"></a>01174 {
<a name="l01175"></a>01175     <span class="keyword">static</span> <span class="keywordtype">int</span>   gl_shift;      <span class="comment">/* index of first on screen character */</span>
<a name="l01176"></a>01176     <span class="keyword">static</span> <span class="keywordtype">int</span>   off_right;     <span class="comment">/* true if more text right of screen */</span>
<a name="l01177"></a>01177     <span class="keyword">static</span> <span class="keywordtype">int</span>   off_left;      <span class="comment">/* true if more text left of screen */</span>
<a name="l01178"></a>01178     <span class="keyword">static</span> <span class="keywordtype">char</span>  last_prompt[80] = <span class="stringliteral">""</span>;
<a name="l01179"></a>01179     <span class="keywordtype">int</span>          left = 0, right = -1;          <span class="comment">/* bounds for redraw */</span>
<a name="l01180"></a>01180     <span class="keywordtype">int</span>          padl;          <span class="comment">/* how much to erase at end of line */</span>
<a name="l01181"></a>01181     <span class="keywordtype">int</span>          backup;        <span class="comment">/* how far to backup before fixing */</span>
<a name="l01182"></a>01182     <span class="keywordtype">int</span>          new_shift;     <span class="comment">/* value of shift based on cursor */</span>
<a name="l01183"></a>01183     <span class="keywordtype">int</span>          extra;         <span class="comment">/* adjusts when shift (scroll) happens */</span>
<a name="l01184"></a>01184     <span class="keywordtype">int</span>          i;
<a name="l01185"></a>01185     <span class="keywordtype">int</span>          new_right = -1; <span class="comment">/* alternate right bound, using gl_extent */</span>
<a name="l01186"></a>01186     <span class="keywordtype">int</span>          l1, l2;
<a name="l01187"></a>01187 
<a name="l01188"></a>01188     <span class="keywordflow">if</span> (change == -2) {   <span class="comment">/* reset */</span>
<a name="l01189"></a>01189         <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> = <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> = gl_shift = off_right = off_left = 0;
<a name="l01190"></a>01190         <a class="code" href="Getline_8c.html#a98e28c464dc7ca1a561c2aac2d1f1c0">gl_passwd</a> = 0;
<a name="l01191"></a>01191         <a class="code" href="Getline_8c.html#92664f0ddff00272b6801917b04b74e4">gl_puts</a>(prompt);
<a name="l01192"></a>01192         <a class="code" href="Getline_8c.html#a98e28c464dc7ca1a561c2aac2d1f1c0">gl_passwd</a> = <a class="code" href="Getline_8c.html#9485d52cc09fd6c0880d4e70ca25c797">gl_no_echo</a>;
<a name="l01193"></a>01193         strcpy(last_prompt, prompt);
<a name="l01194"></a>01194         change = 0;
<a name="l01195"></a>01195         <a class="code" href="Getline_8c.html#219531cddf67f1009a3d23c599f0138c">gl_width</a> = <a class="code" href="Getline_8c.html#47ad6029530fe4c2b9e47f2dcfbf1690">gl_termw</a> - strlen(prompt);
<a name="l01196"></a>01196     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(prompt, last_prompt) != 0) {
<a name="l01197"></a>01197         l1 = strlen(last_prompt);
<a name="l01198"></a>01198         l2 = strlen(prompt);
<a name="l01199"></a>01199         <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> = <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> + l1 - l2;
<a name="l01200"></a>01200         strcpy(last_prompt, prompt);
<a name="l01201"></a>01201         backup = <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> - gl_shift + l1;
<a name="l01202"></a>01202         <span class="keywordflow">for</span> (i=0; i &lt; backup; i++)
<a name="l01203"></a>01203             <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\b'</span>);
<a name="l01204"></a>01204         <a class="code" href="Getline_8c.html#a98e28c464dc7ca1a561c2aac2d1f1c0">gl_passwd</a> = 0;
<a name="l01205"></a>01205         <a class="code" href="Getline_8c.html#92664f0ddff00272b6801917b04b74e4">gl_puts</a>(prompt);
<a name="l01206"></a>01206         <a class="code" href="Getline_8c.html#a98e28c464dc7ca1a561c2aac2d1f1c0">gl_passwd</a> = <a class="code" href="Getline_8c.html#9485d52cc09fd6c0880d4e70ca25c797">gl_no_echo</a>;
<a name="l01207"></a>01207         <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> = gl_shift;
<a name="l01208"></a>01208         <a class="code" href="Getline_8c.html#219531cddf67f1009a3d23c599f0138c">gl_width</a> = <a class="code" href="Getline_8c.html#47ad6029530fe4c2b9e47f2dcfbf1690">gl_termw</a> - l2;
<a name="l01209"></a>01209         change = 0;
<a name="l01210"></a>01210     }
<a name="l01211"></a>01211     padl = (off_right)? <a class="code" href="Getline_8c.html#219531cddf67f1009a3d23c599f0138c">gl_width</a> - 1 : <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> - gl_shift;   <span class="comment">/* old length */</span>
<a name="l01212"></a>01212     backup = <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> - gl_shift;
<a name="l01213"></a>01213     <span class="keywordflow">if</span> (change &gt;= 0) {
<a name="l01214"></a>01214         <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> = strlen(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>);
<a name="l01215"></a>01215         <span class="keywordflow">if</span> (change &gt; <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a>)
<a name="l01216"></a>01216             change = <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a>;
<a name="l01217"></a>01217     }
<a name="l01218"></a>01218     <span class="keywordflow">if</span> (cursor &gt; <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a>) {
<a name="l01219"></a>01219         <span class="keywordflow">if</span> (cursor != <a class="code" href="Getline_8c.html#6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>)         <span class="comment">/* BUF_SIZE means end of line */</span>
<a name="l01220"></a>01220             <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\007'</span>);
<a name="l01221"></a>01221         cursor = <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a>;
<a name="l01222"></a>01222     }
<a name="l01223"></a>01223     <span class="keywordflow">if</span> (cursor &lt; 0) {
<a name="l01224"></a>01224         <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\007'</span>);
<a name="l01225"></a>01225         cursor = 0;
<a name="l01226"></a>01226     }
<a name="l01227"></a>01227     <span class="keywordflow">if</span> (off_right || (off_left &amp;&amp; cursor &lt; gl_shift + <a class="code" href="Getline_8c.html#219531cddf67f1009a3d23c599f0138c">gl_width</a> - <a class="code" href="Getline_8c.html#3425dfcd249ed4b5c439727afff7edb7">gl_scroll</a> / 2))
<a name="l01228"></a>01228         extra = 2;                      <span class="comment">/* shift the scrolling boundary */</span>
<a name="l01229"></a>01229     <span class="keywordflow">else</span>
<a name="l01230"></a>01230         extra = 0;
<a name="l01231"></a>01231     new_shift = cursor + extra + <a class="code" href="Getline_8c.html#3425dfcd249ed4b5c439727afff7edb7">gl_scroll</a> - <a class="code" href="Getline_8c.html#219531cddf67f1009a3d23c599f0138c">gl_width</a>;
<a name="l01232"></a>01232     <span class="keywordflow">if</span> (new_shift &gt; 0) {
<a name="l01233"></a>01233         new_shift /= <a class="code" href="Getline_8c.html#3425dfcd249ed4b5c439727afff7edb7">gl_scroll</a>;
<a name="l01234"></a>01234         new_shift *= <a class="code" href="Getline_8c.html#3425dfcd249ed4b5c439727afff7edb7">gl_scroll</a>;
<a name="l01235"></a>01235     } <span class="keywordflow">else</span>
<a name="l01236"></a>01236         new_shift = 0;
<a name="l01237"></a>01237     <span class="keywordflow">if</span> (new_shift != gl_shift) {        <span class="comment">/* scroll occurs */</span>
<a name="l01238"></a>01238         gl_shift = new_shift;
<a name="l01239"></a>01239         off_left = (gl_shift)? 1 : 0;
<a name="l01240"></a>01240         off_right = (<a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> &gt; gl_shift + gl_width - 1)? 1 : 0;
<a name="l01241"></a>01241         left = gl_shift;
<a name="l01242"></a>01242         new_right = right = (off_right)? gl_shift + gl_width - 2 : <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a>;
<a name="l01243"></a>01243     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (change &gt;= 0) {           <span class="comment">/* no scroll, but text changed */</span>
<a name="l01244"></a>01244         <span class="keywordflow">if</span> (change &lt; gl_shift + off_left) {
<a name="l01245"></a>01245             left = gl_shift;
<a name="l01246"></a>01246         } <span class="keywordflow">else</span> {
<a name="l01247"></a>01247             left = change;
<a name="l01248"></a>01248             backup = <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> - change;
<a name="l01249"></a>01249         }
<a name="l01250"></a>01250         off_right = (<a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> &gt; gl_shift + gl_width - 1)? 1 : 0;
<a name="l01251"></a>01251         right = (off_right)? gl_shift + gl_width - 2 : <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a>;
<a name="l01252"></a>01252         new_right = (<a class="code" href="Getline_8c.html#7ebc25e8509b7b84cc07e10ced5eb694">gl_extent</a> &amp;&amp; (right &gt; left + <a class="code" href="Getline_8c.html#7ebc25e8509b7b84cc07e10ced5eb694">gl_extent</a>))?
<a name="l01253"></a>01253                      left + <a class="code" href="Getline_8c.html#7ebc25e8509b7b84cc07e10ced5eb694">gl_extent</a> : right;
<a name="l01254"></a>01254     }
<a name="l01255"></a>01255     padl -= (off_right)? gl_width - 1 : <a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> - gl_shift;
<a name="l01256"></a>01256     padl = (padl &lt; 0)? 0 : padl;
<a name="l01257"></a>01257     <span class="keywordflow">if</span> (left &lt;= right) {                <span class="comment">/* clean up screen */</span>
<a name="l01258"></a>01258         <span class="keywordflow">for</span> (i=0; i &lt; backup; i++)
<a name="l01259"></a>01259             <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\b'</span>);
<a name="l01260"></a>01260         <span class="keywordflow">if</span> (left == gl_shift &amp;&amp; off_left) {
<a name="l01261"></a>01261             <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'$'</span>);
<a name="l01262"></a>01262             left++;
<a name="l01263"></a>01263         }
<a name="l01264"></a>01264         <span class="keywordflow">for</span> (i=left; i &lt; new_right; i++)
<a name="l01265"></a>01265             <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[i]);
<a name="l01266"></a>01266         <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> = new_right;
<a name="l01267"></a>01267         <span class="keywordflow">if</span> (off_right &amp;&amp; new_right == right) {
<a name="l01268"></a>01268             <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'$'</span>);
<a name="l01269"></a>01269             <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>++;
<a name="l01270"></a>01270         } <span class="keywordflow">else</span> {
<a name="l01271"></a>01271             <span class="keywordflow">for</span> (i=0; i &lt; padl; i++)     <span class="comment">/* erase remains of prev line */</span>
<a name="l01272"></a>01272                 <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">' '</span>);
<a name="l01273"></a>01273             <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> += padl;
<a name="l01274"></a>01274         }
<a name="l01275"></a>01275     }
<a name="l01276"></a>01276     i = <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> - cursor;                <span class="comment">/* move to final cursor location */</span>
<a name="l01277"></a>01277     <span class="keywordflow">if</span> (i &gt; 0) {
<a name="l01278"></a>01278         <span class="keywordflow">while</span> (i--)
<a name="l01279"></a>01279            <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\b'</span>);
<a name="l01280"></a>01280     } <span class="keywordflow">else</span> {
<a name="l01281"></a>01281         <span class="keywordflow">for</span> (i=<a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>; i &lt; cursor; i++)
<a name="l01282"></a>01282             <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[i]);
<a name="l01283"></a>01283     }
<a name="l01284"></a>01284     <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> = cursor;
<a name="l01285"></a>01285 }
<a name="l01286"></a>01286 
<a name="l01287"></a>01287 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01288"></a><a class="code" href="Getline_8c.html#4a8ec09a3528876aa0d3f6532e2180cc">01288</a> <a class="code" href="Getline_8c.html#4a8ec09a3528876aa0d3f6532e2180cc">gl_tab</a>(<span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> offset, <span class="keywordtype">int</span> *loc)
<a name="l01289"></a>01289 <span class="comment">/* default tab handler, acts like tabstops every 8 cols */</span>
<a name="l01290"></a>01290 {
<a name="l01291"></a>01291     <span class="keywordtype">int</span> i, count, len;
<a name="l01292"></a>01292 
<a name="l01293"></a>01293     len = strlen(buf);
<a name="l01294"></a>01294     count = 8 - (offset + *loc) % 8;
<a name="l01295"></a>01295     <span class="keywordflow">for</span> (i=len; i &gt;= *loc; i--)
<a name="l01296"></a>01296         buf[i+count] = buf[i];
<a name="l01297"></a>01297     <span class="keywordflow">for</span> (i=0; i &lt; count; i++)
<a name="l01298"></a>01298         buf[*loc+i] = <span class="charliteral">' '</span>;
<a name="l01299"></a>01299     i = *loc;
<a name="l01300"></a>01300     *loc = i + count;
<a name="l01301"></a>01301     <span class="keywordflow">return</span> i;
<a name="l01302"></a>01302 }
<a name="l01303"></a>01303 
<a name="l01304"></a>01304 <span class="comment">/******************* History stuff **************************************/</span>
<a name="l01305"></a>01305 
<a name="l01306"></a>01306 <span class="preprocessor">#ifndef HIST_SIZE</span>
<a name="l01307"></a><a class="code" href="Getline_8c.html#7f5fc8a70667ca4c9fc598a30f7e8602">01307</a> <span class="preprocessor"></span><span class="preprocessor">#define HIST_SIZE 100</span>
<a name="l01308"></a>01308 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l01309"></a>01309 <span class="preprocessor"></span>
<a name="l01310"></a><a class="code" href="Getline_8c.html#538589ed0904801d52cc530d17f7e11d">01310</a> <span class="keyword">static</span> <span class="keywordtype">int</span>      <a class="code" href="Getline_8c.html#538589ed0904801d52cc530d17f7e11d">hist_pos</a> = 0, <a class="code" href="Getline_8c.html#d423cb43eed8acd80db4934961572503">hist_last</a> = 0;
<a name="l01311"></a><a class="code" href="Getline_8c.html#9c38739947d87672dcff17eea472ff15">01311</a> <span class="keyword">static</span> <span class="keywordtype">char</span>    *<a class="code" href="Getline_8c.html#9c38739947d87672dcff17eea472ff15">hist_buf</a>[<a class="code" href="Getline_8c.html#7f5fc8a70667ca4c9fc598a30f7e8602">HIST_SIZE</a>];
<a name="l01312"></a>01312 
<a name="l01313"></a>01313 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01314"></a><a class="code" href="Getline_8c.html#7aeb84b1bf3e118eab18a7e523d3a14e">01314</a> <a class="code" href="Getline_8c.html#7aeb84b1bf3e118eab18a7e523d3a14e">hist_init</a>()
<a name="l01315"></a>01315 {
<a name="l01316"></a>01316     <span class="keywordtype">int</span> i;
<a name="l01317"></a>01317 
<a name="l01318"></a>01318     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#17c85c52fc2ba8b95cd30777835f076b">gl_savehist</a>) <span class="keywordflow">return</span>;
<a name="l01319"></a>01319 
<a name="l01320"></a>01320     hist_buf[0] = <span class="stringliteral">""</span>;
<a name="l01321"></a>01321     <span class="keywordflow">for</span> (i=1; i &lt; <a class="code" href="Getline_8c.html#7f5fc8a70667ca4c9fc598a30f7e8602">HIST_SIZE</a>; i++)
<a name="l01322"></a>01322         hist_buf[i] = (<span class="keywordtype">char</span> *)0;
<a name="l01323"></a>01323 }
<a name="l01324"></a>01324 
<a name="l01325"></a>01325 <span class="keywordtype">void</span>
<a name="l01326"></a><a class="code" href="Getline_8c.html#3d83e69b1227d6eb301637ec4977c76b">01326</a> <a class="code" href="Getline_8c.html#3d83e69b1227d6eb301637ec4977c76b">Gl_histinit</a>(<span class="keywordtype">char</span> *file)
<a name="l01327"></a>01327 {
<a name="l01328"></a>01328    <span class="keywordtype">char</span> line[256];
<a name="l01329"></a>01329    FILE *fp;
<a name="l01330"></a>01330    <span class="keywordtype">int</span>   nline = 1;   <span class="comment">/* prevent from becoming 0 */</span>
<a name="l01331"></a>01331 
<a name="l01332"></a>01332    <a class="code" href="Getline_8c.html#17c85c52fc2ba8b95cd30777835f076b">gl_savehist</a> = 0;
<a name="l01333"></a>01333 
<a name="l01334"></a>01334    <a class="code" href="Getline_8c.html#7aeb84b1bf3e118eab18a7e523d3a14e">hist_init</a>();
<a name="l01335"></a>01335 
<a name="l01336"></a>01336    <span class="keywordflow">if</span> (!strcmp(file, <span class="stringliteral">"-"</span>)) <span class="keywordflow">return</span>;
<a name="l01337"></a>01337 
<a name="l01338"></a>01338    sprintf(<a class="code" href="Getline_8c.html#c7655631f248a9c980d1b7974639d9e6">gl_histfile</a>, <span class="stringliteral">"%s"</span>, file);
<a name="l01339"></a>01339 
<a name="l01340"></a>01340    fp = fopen(<a class="code" href="Getline_8c.html#c7655631f248a9c980d1b7974639d9e6">gl_histfile</a>, <span class="stringliteral">"r"</span>);
<a name="l01341"></a>01341    <span class="keywordflow">if</span> (fp)
<a name="l01342"></a>01342       <span class="keywordflow">while</span> (fgets(line, 256, fp)) {
<a name="l01343"></a>01343          nline++;
<a name="l01344"></a>01344          <a class="code" href="Getline_8c.html#5bc9732aae5850cd5a7b8c7886f3384f">Gl_histadd</a>(line);
<a name="l01345"></a>01345       }
<a name="l01346"></a>01346    <span class="keywordflow">else</span>
<a name="l01347"></a>01347       fp = fopen(<a class="code" href="Getline_8c.html#c7655631f248a9c980d1b7974639d9e6">gl_histfile</a>, <span class="stringliteral">"w"</span>);
<a name="l01348"></a>01348 
<a name="l01349"></a>01349    <span class="keywordflow">if</span> (fp) fclose(fp);
<a name="l01350"></a>01350 
<a name="l01351"></a>01351    <a class="code" href="Getline_8c.html#17c85c52fc2ba8b95cd30777835f076b">gl_savehist</a> = nline;
<a name="l01352"></a>01352 }
<a name="l01353"></a>01353 
<a name="l01354"></a>01354 <span class="keywordtype">void</span>
<a name="l01355"></a><a class="code" href="Getline_8c.html#5bc9732aae5850cd5a7b8c7886f3384f">01355</a> <a class="code" href="Getline_8c.html#5bc9732aae5850cd5a7b8c7886f3384f">Gl_histadd</a>(<span class="keywordtype">char</span> *buf)
<a name="l01356"></a>01356 {
<a name="l01357"></a>01357     <span class="keyword">static</span> <span class="keywordtype">char</span> *prev = 0;
<a name="l01358"></a>01358     <span class="keywordtype">char</span> *p = buf;
<a name="l01359"></a>01359     <span class="keywordtype">int</span> len;
<a name="l01360"></a>01360 
<a name="l01361"></a>01361     <span class="keywordflow">while</span> (*p == <span class="charliteral">' '</span> || *p == <span class="charliteral">'\t'</span> || *p == <span class="charliteral">'\n'</span>)
<a name="l01362"></a>01362         p++;
<a name="l01363"></a>01363     <span class="keywordflow">if</span> (*p) {
<a name="l01364"></a>01364         len = strlen(buf);
<a name="l01365"></a>01365         <span class="keywordflow">if</span> (strchr(p, <span class="charliteral">'\n'</span>))    <span class="comment">/* previously line already has NL stripped */</span>
<a name="l01366"></a>01366             len--;
<a name="l01367"></a>01367         <span class="keywordflow">if</span> (prev == 0 || (<span class="keywordtype">int</span>)strlen(prev) != len ||
<a name="l01368"></a>01368             strncmp(prev, buf, len) != 0) {
<a name="l01369"></a>01369             hist_buf[<a class="code" href="Getline_8c.html#d423cb43eed8acd80db4934961572503">hist_last</a>] = <a class="code" href="Getline_8c.html#dd824ad58eca56693b14aa0598113678">hist_save</a>(buf);
<a name="l01370"></a>01370             prev = hist_buf[<a class="code" href="Getline_8c.html#d423cb43eed8acd80db4934961572503">hist_last</a>];
<a name="l01371"></a>01371             <a class="code" href="Getline_8c.html#d423cb43eed8acd80db4934961572503">hist_last</a> = (<a class="code" href="Getline_8c.html#d423cb43eed8acd80db4934961572503">hist_last</a> + 1) % <a class="code" href="Getline_8c.html#7f5fc8a70667ca4c9fc598a30f7e8602">HIST_SIZE</a>;
<a name="l01372"></a>01372             <span class="keywordflow">if</span> (hist_buf[<a class="code" href="Getline_8c.html#d423cb43eed8acd80db4934961572503">hist_last</a>] &amp;&amp; *hist_buf[<a class="code" href="Getline_8c.html#d423cb43eed8acd80db4934961572503">hist_last</a>]) {
<a name="l01373"></a>01373                 free(hist_buf[hist_last]);
<a name="l01374"></a>01374             }
<a name="l01375"></a>01375             hist_buf[hist_last] = <span class="stringliteral">""</span>;
<a name="l01376"></a>01376 
<a name="l01377"></a>01377             <span class="comment">/* append command to history file */</span>
<a name="l01378"></a>01378             <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#17c85c52fc2ba8b95cd30777835f076b">gl_savehist</a>) {
<a name="l01379"></a>01379                FILE *fp;
<a name="l01380"></a>01380                fp = fopen(<a class="code" href="Getline_8c.html#c7655631f248a9c980d1b7974639d9e6">gl_histfile</a>, <span class="stringliteral">"a+"</span>);
<a name="l01381"></a>01381                <span class="keywordflow">if</span> (fp) {
<a name="l01382"></a>01382                    fprintf(fp, <span class="stringliteral">"%s\n"</span>, prev);
<a name="l01383"></a>01383                    <a class="code" href="Getline_8c.html#17c85c52fc2ba8b95cd30777835f076b">gl_savehist</a>++;
<a name="l01384"></a>01384                    fclose(fp);
<a name="l01385"></a>01385                }
<a name="l01386"></a>01386 
<a name="l01387"></a>01387                <span class="comment">/* if more than HIST_SIZE lines, safe last 60 command and delete rest */</span>
<a name="l01388"></a>01388                <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#17c85c52fc2ba8b95cd30777835f076b">gl_savehist</a> &gt; <a class="code" href="Getline_8c.html#7f5fc8a70667ca4c9fc598a30f7e8602">HIST_SIZE</a>) {
<a name="l01389"></a>01389                   FILE *ftmp;
<a name="l01390"></a>01390                   <span class="keywordtype">char</span> tname[L_tmpnam];
<a name="l01391"></a>01391                   <span class="keywordtype">char</span> line[BUFSIZ];
<a name="l01392"></a>01392 
<a name="l01393"></a>01393                   fp = fopen(<a class="code" href="Getline_8c.html#c7655631f248a9c980d1b7974639d9e6">gl_histfile</a>, <span class="stringliteral">"r"</span>);
<a name="l01394"></a>01394                   tmpnam(tname);
<a name="l01395"></a>01395                   ftmp = fopen(tname, <span class="stringliteral">"w"</span>);
<a name="l01396"></a>01396                   <span class="keywordflow">if</span> (fp &amp;&amp; ftmp) {
<a name="l01397"></a>01397                      <span class="keywordtype">int</span> nline = 0;
<a name="l01398"></a>01398                      <span class="keywordflow">while</span> (fgets(line, BUFSIZ, fp)) {
<a name="l01399"></a>01399                         nline++;
<a name="l01400"></a>01400                         <a class="code" href="Getline_8c.html#17c85c52fc2ba8b95cd30777835f076b">gl_savehist</a> = 1;  <span class="comment">/* prevent from becoming 0 */</span>
<a name="l01401"></a>01401                         <span class="keywordflow">if</span> (nline &gt; <a class="code" href="Getline_8c.html#7f5fc8a70667ca4c9fc598a30f7e8602">HIST_SIZE</a>-60) {
<a name="l01402"></a>01402                            <a class="code" href="Getline_8c.html#17c85c52fc2ba8b95cd30777835f076b">gl_savehist</a>++;
<a name="l01403"></a>01403                            fprintf(ftmp, <span class="stringliteral">"%s"</span>, line);
<a name="l01404"></a>01404                         }
<a name="l01405"></a>01405                      }
<a name="l01406"></a>01406                   }
<a name="l01407"></a>01407                   <span class="keywordflow">if</span> (fp)   fclose(fp);
<a name="l01408"></a>01408                   <span class="keywordflow">if</span> (ftmp) fclose(ftmp);
<a name="l01409"></a>01409 
<a name="l01410"></a>01410                   <span class="comment">/* copy back to history file */</span>
<a name="l01411"></a>01411                   fp   = fopen(<a class="code" href="Getline_8c.html#c7655631f248a9c980d1b7974639d9e6">gl_histfile</a>, <span class="stringliteral">"w"</span>);
<a name="l01412"></a>01412                   ftmp = fopen(tname, <span class="stringliteral">"r"</span>);
<a name="l01413"></a>01413                   <span class="keywordflow">if</span> (fp &amp;&amp; ftmp)
<a name="l01414"></a>01414                      <span class="keywordflow">while</span> (fgets(line, BUFSIZ, ftmp))
<a name="l01415"></a>01415                         fprintf(fp, <span class="stringliteral">"%s"</span>, line);
<a name="l01416"></a>01416 
<a name="l01417"></a>01417                   <span class="keywordflow">if</span> (fp)   fclose(fp);
<a name="l01418"></a>01418                   <span class="keywordflow">if</span> (ftmp) fclose(ftmp);
<a name="l01419"></a>01419                   remove(tname);
<a name="l01420"></a>01420                }
<a name="l01421"></a>01421             }
<a name="l01422"></a>01422         }
<a name="l01423"></a>01423     }
<a name="l01424"></a>01424     hist_pos = <a class="code" href="Getline_8c.html#d423cb43eed8acd80db4934961572503">hist_last</a>;
<a name="l01425"></a>01425 }
<a name="l01426"></a>01426 
<a name="l01427"></a>01427 <span class="keyword">static</span> <span class="keywordtype">char</span> *
<a name="l01428"></a><a class="code" href="Getline_8c.html#a0ff91ed11b5c20ac307a4b2c020ce92">01428</a> <a class="code" href="Getline_8c.html#a0ff91ed11b5c20ac307a4b2c020ce92">hist_prev</a>()
<a name="l01429"></a>01429 <span class="comment">/* loads previous hist entry into input buffer, sticks on first */</span>
<a name="l01430"></a>01430 {
<a name="l01431"></a>01431     <span class="keywordtype">char</span> *p = 0;
<a name="l01432"></a>01432     <span class="keywordtype">int</span>   next = (hist_pos - 1 + <a class="code" href="Getline_8c.html#7f5fc8a70667ca4c9fc598a30f7e8602">HIST_SIZE</a>) % <a class="code" href="Getline_8c.html#7f5fc8a70667ca4c9fc598a30f7e8602">HIST_SIZE</a>;
<a name="l01433"></a>01433 
<a name="l01434"></a>01434     <span class="keywordflow">if</span> (hist_buf[hist_pos] != 0 &amp;&amp; next != <a class="code" href="Getline_8c.html#d423cb43eed8acd80db4934961572503">hist_last</a>) {
<a name="l01435"></a>01435         hist_pos = next;
<a name="l01436"></a>01436         p = hist_buf[hist_pos];
<a name="l01437"></a>01437     }
<a name="l01438"></a>01438     <span class="keywordflow">if</span> (p == 0) {
<a name="l01439"></a>01439         p = <span class="stringliteral">""</span>;
<a name="l01440"></a>01440         <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\007'</span>);
<a name="l01441"></a>01441     }
<a name="l01442"></a>01442     <span class="keywordflow">return</span> p;
<a name="l01443"></a>01443 }
<a name="l01444"></a>01444 
<a name="l01445"></a>01445 <span class="keyword">static</span> <span class="keywordtype">char</span> *
<a name="l01446"></a><a class="code" href="Getline_8c.html#55da523ba030c0c07019af7d536b48b1">01446</a> <a class="code" href="Getline_8c.html#55da523ba030c0c07019af7d536b48b1">hist_next</a>()
<a name="l01447"></a>01447 <span class="comment">/* loads next hist entry into input buffer, clears on last */</span>
<a name="l01448"></a>01448 {
<a name="l01449"></a>01449     <span class="keywordtype">char</span> *p = 0;
<a name="l01450"></a>01450 
<a name="l01451"></a>01451     <span class="keywordflow">if</span> (hist_pos != <a class="code" href="Getline_8c.html#d423cb43eed8acd80db4934961572503">hist_last</a>) {
<a name="l01452"></a>01452         hist_pos = (hist_pos+1) % <a class="code" href="Getline_8c.html#7f5fc8a70667ca4c9fc598a30f7e8602">HIST_SIZE</a>;
<a name="l01453"></a>01453         p = hist_buf[hist_pos];
<a name="l01454"></a>01454     }
<a name="l01455"></a>01455     <span class="keywordflow">if</span> (p == 0) {
<a name="l01456"></a>01456         p = <span class="stringliteral">""</span>;
<a name="l01457"></a>01457         <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\007'</span>);
<a name="l01458"></a>01458     }
<a name="l01459"></a>01459     <span class="keywordflow">return</span> p;
<a name="l01460"></a>01460 }
<a name="l01461"></a>01461 
<a name="l01462"></a>01462 <span class="keyword">static</span> <span class="keywordtype">char</span> *
<a name="l01463"></a><a class="code" href="Getline_8c.html#dd824ad58eca56693b14aa0598113678">01463</a> <a class="code" href="Getline_8c.html#dd824ad58eca56693b14aa0598113678">hist_save</a>(<span class="keywordtype">char</span> *p)
<a name="l01464"></a>01464 <span class="comment">/* makes a copy of the string */</span>
<a name="l01465"></a>01465 {
<a name="l01466"></a>01466     <span class="keywordtype">char</span> *s = 0;
<a name="l01467"></a>01467     <span class="keywordtype">int</span>   len = strlen(p);
<a name="l01468"></a>01468     <span class="keywordtype">char</span> *nl = strchr(p, <span class="charliteral">'\n'</span>);
<a name="l01469"></a>01469 
<a name="l01470"></a>01470     <span class="keywordflow">if</span> (nl) {
<a name="l01471"></a>01471         <span class="keywordflow">if</span> ((s = (<span class="keywordtype">char</span> *)malloc(len)) != 0) {
<a name="l01472"></a>01472             strncpy(s, p, len-1);
<a name="l01473"></a>01473             s[len-1] = 0;
<a name="l01474"></a>01474         }
<a name="l01475"></a>01475     } <span class="keywordflow">else</span> {
<a name="l01476"></a>01476         <span class="keywordflow">if</span> ((s = (<span class="keywordtype">char</span> *)malloc(len+1)) != 0) {
<a name="l01477"></a>01477             strcpy(s, p);
<a name="l01478"></a>01478         }
<a name="l01479"></a>01479     }
<a name="l01480"></a>01480     <span class="keywordflow">if</span> (s == 0)
<a name="l01481"></a>01481         <a class="code" href="Getline_8c.html#4770103b7ab977b0c878790929860a8a">gl_error</a>(<span class="stringliteral">"\n*** Error: hist_save() failed on malloc\n"</span>);
<a name="l01482"></a>01482     <span class="keywordflow">return</span> s;
<a name="l01483"></a>01483 }
<a name="l01484"></a>01484 
<a name="l01485"></a>01485 <span class="comment">/******************* Search stuff **************************************/</span>
<a name="l01486"></a>01486 
<a name="l01487"></a><a class="code" href="Getline_8c.html#b809b2dfbde0bd1565948dea9ed344ae">01487</a> <span class="keyword">static</span> <span class="keywordtype">char</span>  <a class="code" href="Getline_8c.html#b809b2dfbde0bd1565948dea9ed344ae">search_prompt</a>[101];  <span class="comment">/* prompt includes search string */</span>
<a name="l01488"></a><a class="code" href="Getline_8c.html#0516d576e0d5a1ee409ccb8bc84ef886">01488</a> <span class="keyword">static</span> <span class="keywordtype">char</span>  <a class="code" href="Getline_8c.html#0516d576e0d5a1ee409ccb8bc84ef886">search_string</a>[100];
<a name="l01489"></a><a class="code" href="Getline_8c.html#5eae76c34824a5898c448ab1bba1635c">01489</a> <span class="keyword">static</span> <span class="keywordtype">int</span>   <a class="code" href="Getline_8c.html#5eae76c34824a5898c448ab1bba1635c">search_pos</a> = 0;      <span class="comment">/* current location in search_string */</span>
<a name="l01490"></a><a class="code" href="Getline_8c.html#7ce7e9ca8c99bcaf60aa84a9a80e8da9">01490</a> <span class="keyword">static</span> <span class="keywordtype">int</span>   <a class="code" href="Getline_8c.html#7ce7e9ca8c99bcaf60aa84a9a80e8da9">search_forw_flg</a> = 0; <span class="comment">/* search direction flag */</span>
<a name="l01491"></a><a class="code" href="Getline_8c.html#1fe5136e5469e4c2203602fe7707a816">01491</a> <span class="keyword">static</span> <span class="keywordtype">int</span>   <a class="code" href="Getline_8c.html#1fe5136e5469e4c2203602fe7707a816">search_last</a> = 0;     <span class="comment">/* last match found */</span>
<a name="l01492"></a>01492 
<a name="l01493"></a>01493 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01494"></a><a class="code" href="Getline_8c.html#cd9aee6e0807f83d5c23b7bc2ff16231">01494</a> <a class="code" href="Getline_8c.html#cd9aee6e0807f83d5c23b7bc2ff16231">search_update</a>(<span class="keywordtype">int</span> c)
<a name="l01495"></a>01495 {
<a name="l01496"></a>01496     <span class="keywordflow">if</span> (c == 0) {
<a name="l01497"></a>01497         search_pos = 0;
<a name="l01498"></a>01498         search_string[0] = 0;
<a name="l01499"></a>01499         search_prompt[0] = <span class="charliteral">'?'</span>;
<a name="l01500"></a>01500         search_prompt[1] = <span class="charliteral">' '</span>;
<a name="l01501"></a>01501         search_prompt[2] = 0;
<a name="l01502"></a>01502     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c &gt; 0) {
<a name="l01503"></a>01503         search_string[search_pos] = c;
<a name="l01504"></a>01504         search_string[search_pos+1] = 0;
<a name="l01505"></a>01505         search_prompt[search_pos] = c;
<a name="l01506"></a>01506         search_prompt[search_pos+1] = <span class="charliteral">'?'</span>;
<a name="l01507"></a>01507         search_prompt[search_pos+2] = <span class="charliteral">' '</span>;
<a name="l01508"></a>01508         search_prompt[search_pos+3] = 0;
<a name="l01509"></a>01509         search_pos++;
<a name="l01510"></a>01510     } <span class="keywordflow">else</span> {
<a name="l01511"></a>01511         <span class="keywordflow">if</span> (search_pos &gt; 0) {
<a name="l01512"></a>01512             search_pos--;
<a name="l01513"></a>01513             search_string[search_pos] = 0;
<a name="l01514"></a>01514             search_prompt[search_pos] = <span class="charliteral">'?'</span>;
<a name="l01515"></a>01515             search_prompt[search_pos+1] = <span class="charliteral">' '</span>;
<a name="l01516"></a>01516             search_prompt[search_pos+2] = 0;
<a name="l01517"></a>01517         } <span class="keywordflow">else</span> {
<a name="l01518"></a>01518             <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\007'</span>);
<a name="l01519"></a>01519             hist_pos = <a class="code" href="Getline_8c.html#d423cb43eed8acd80db4934961572503">hist_last</a>;
<a name="l01520"></a>01520         }
<a name="l01521"></a>01521     }
<a name="l01522"></a>01522 }
<a name="l01523"></a>01523 
<a name="l01524"></a>01524 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01525"></a><a class="code" href="Getline_8c.html#a1d090c3a4e5647f8ec95f0bdd59b2ee">01525</a> <a class="code" href="Getline_8c.html#a1d090c3a4e5647f8ec95f0bdd59b2ee">search_addchar</a>(<span class="keywordtype">int</span> c)
<a name="l01526"></a>01526 {
<a name="l01527"></a>01527     <span class="keywordtype">char</span> *loc;
<a name="l01528"></a>01528 
<a name="l01529"></a>01529     <a class="code" href="Getline_8c.html#cd9aee6e0807f83d5c23b7bc2ff16231">search_update</a>(c);
<a name="l01530"></a>01530     <span class="keywordflow">if</span> (c &lt; 0) {
<a name="l01531"></a>01531         <span class="keywordflow">if</span> (search_pos &gt; 0) {
<a name="l01532"></a>01532             hist_pos = search_last;
<a name="l01533"></a>01533         } <span class="keywordflow">else</span> {
<a name="l01534"></a>01534             <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[0] = 0;
<a name="l01535"></a>01535             hist_pos = <a class="code" href="Getline_8c.html#d423cb43eed8acd80db4934961572503">hist_last</a>;
<a name="l01536"></a>01536         }
<a name="l01537"></a>01537         strcpy(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>, hist_buf[hist_pos]);
<a name="l01538"></a>01538     }
<a name="l01539"></a>01539     <span class="keywordflow">if</span> ((loc = strstr(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>, search_string)) != 0) {
<a name="l01540"></a>01540         <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(search_prompt, 0, loc - <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>);
<a name="l01541"></a>01541     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (search_pos &gt; 0) {
<a name="l01542"></a>01542         <span class="keywordflow">if</span> (search_forw_flg) {
<a name="l01543"></a>01543             <a class="code" href="Getline_8c.html#2a70d511cb480dcd1aeb46d63396f950">search_forw</a>(0);
<a name="l01544"></a>01544         } <span class="keywordflow">else</span> {
<a name="l01545"></a>01545             <a class="code" href="Getline_8c.html#19a8833a6643d6d93b023b33f9344c49">search_back</a>(0);
<a name="l01546"></a>01546         }
<a name="l01547"></a>01547     } <span class="keywordflow">else</span> {
<a name="l01548"></a>01548         <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(search_prompt, 0, 0);
<a name="l01549"></a>01549     }
<a name="l01550"></a>01550 }
<a name="l01551"></a>01551 
<a name="l01552"></a>01552 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01553"></a><a class="code" href="Getline_8c.html#423e523cc4e5c6ce59fc0fc35a9697ea">01553</a> <a class="code" href="Getline_8c.html#423e523cc4e5c6ce59fc0fc35a9697ea">search_term</a>()
<a name="l01554"></a>01554 {
<a name="l01555"></a>01555     <a class="code" href="Getline_8c.html#3063e9d42fe363bf22e21c5e77c4400b">gl_search_mode</a> = 0;
<a name="l01556"></a>01556     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[0] == 0)         <span class="comment">/* not found, reset hist list */</span>
<a name="l01557"></a>01557         hist_pos = <a class="code" href="Getline_8c.html#d423cb43eed8acd80db4934961572503">hist_last</a>;
<a name="l01558"></a>01558     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#f3a7308de9b610f1230c5f54befd2b9a">Gl_in_hook</a>)
<a name="l01559"></a>01559         <a class="code" href="Getline_8c.html#f3a7308de9b610f1230c5f54befd2b9a">Gl_in_hook</a>(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>);
<a name="l01560"></a>01560     <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, 0, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>);
<a name="l01561"></a>01561 }
<a name="l01562"></a>01562 
<a name="l01563"></a>01563 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01564"></a><a class="code" href="Getline_8c.html#19a8833a6643d6d93b023b33f9344c49">01564</a> <a class="code" href="Getline_8c.html#19a8833a6643d6d93b023b33f9344c49">search_back</a>(<span class="keywordtype">int</span> new_search)
<a name="l01565"></a>01565 {
<a name="l01566"></a>01566     <span class="keywordtype">int</span>    found = 0;
<a name="l01567"></a>01567     <span class="keywordtype">char</span>  *p, *loc;
<a name="l01568"></a>01568 
<a name="l01569"></a>01569     search_forw_flg = 0;
<a name="l01570"></a>01570     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#3063e9d42fe363bf22e21c5e77c4400b">gl_search_mode</a> == 0) {
<a name="l01571"></a>01571         search_last = hist_pos = <a class="code" href="Getline_8c.html#d423cb43eed8acd80db4934961572503">hist_last</a>;
<a name="l01572"></a>01572         <a class="code" href="Getline_8c.html#cd9aee6e0807f83d5c23b7bc2ff16231">search_update</a>(0);
<a name="l01573"></a>01573         <a class="code" href="Getline_8c.html#3063e9d42fe363bf22e21c5e77c4400b">gl_search_mode</a> = 1;
<a name="l01574"></a>01574         <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[0] = 0;
<a name="l01575"></a>01575         <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(search_prompt, 0, 0);
<a name="l01576"></a>01576     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (search_pos &gt; 0) {
<a name="l01577"></a>01577         <span class="keywordflow">while</span> (!found) {
<a name="l01578"></a>01578             p = <a class="code" href="Getline_8c.html#a0ff91ed11b5c20ac307a4b2c020ce92">hist_prev</a>();
<a name="l01579"></a>01579             <span class="keywordflow">if</span> (*p == 0) {              <span class="comment">/* not found, done looking */</span>
<a name="l01580"></a>01580                <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[0] = 0;
<a name="l01581"></a>01581                <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(search_prompt, 0, 0);
<a name="l01582"></a>01582                found = 1;
<a name="l01583"></a>01583             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((loc = strstr(p, search_string)) != 0) {
<a name="l01584"></a>01584                strcpy(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>, p);
<a name="l01585"></a>01585                <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(search_prompt, 0, loc - p);
<a name="l01586"></a>01586                <span class="keywordflow">if</span> (new_search)
<a name="l01587"></a>01587                    search_last = hist_pos;
<a name="l01588"></a>01588                found = 1;
<a name="l01589"></a>01589             }
<a name="l01590"></a>01590         }
<a name="l01591"></a>01591     } <span class="keywordflow">else</span> {
<a name="l01592"></a>01592         <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\007'</span>);
<a name="l01593"></a>01593     }
<a name="l01594"></a>01594 }
<a name="l01595"></a>01595 
<a name="l01596"></a>01596 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01597"></a><a class="code" href="Getline_8c.html#2a70d511cb480dcd1aeb46d63396f950">01597</a> <a class="code" href="Getline_8c.html#2a70d511cb480dcd1aeb46d63396f950">search_forw</a>(<span class="keywordtype">int</span> new_search)
<a name="l01598"></a>01598 {
<a name="l01599"></a>01599     <span class="keywordtype">int</span>    found = 0;
<a name="l01600"></a>01600     <span class="keywordtype">char</span>  *p, *loc;
<a name="l01601"></a>01601 
<a name="l01602"></a>01602     search_forw_flg = 1;
<a name="l01603"></a>01603     <span class="keywordflow">if</span> (<a class="code" href="Getline_8c.html#3063e9d42fe363bf22e21c5e77c4400b">gl_search_mode</a> == 0) {
<a name="l01604"></a>01604         search_last = hist_pos = <a class="code" href="Getline_8c.html#d423cb43eed8acd80db4934961572503">hist_last</a>;
<a name="l01605"></a>01605         <a class="code" href="Getline_8c.html#cd9aee6e0807f83d5c23b7bc2ff16231">search_update</a>(0);
<a name="l01606"></a>01606         <a class="code" href="Getline_8c.html#3063e9d42fe363bf22e21c5e77c4400b">gl_search_mode</a> = 1;
<a name="l01607"></a>01607         <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[0] = 0;
<a name="l01608"></a>01608         <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(search_prompt, 0, 0);
<a name="l01609"></a>01609     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (search_pos &gt; 0) {
<a name="l01610"></a>01610         <span class="keywordflow">while</span> (!found) {
<a name="l01611"></a>01611             p = <a class="code" href="Getline_8c.html#55da523ba030c0c07019af7d536b48b1">hist_next</a>();
<a name="l01612"></a>01612             <span class="keywordflow">if</span> (*p == 0) {              <span class="comment">/* not found, done looking */</span>
<a name="l01613"></a>01613                <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[0] = 0;
<a name="l01614"></a>01614                <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(search_prompt, 0, 0);
<a name="l01615"></a>01615                found = 1;
<a name="l01616"></a>01616             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((loc = strstr(p, search_string)) != 0) {
<a name="l01617"></a>01617                strcpy(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>, p);
<a name="l01618"></a>01618                <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(search_prompt, 0, loc - p);
<a name="l01619"></a>01619                <span class="keywordflow">if</span> (new_search)
<a name="l01620"></a>01620                    search_last = hist_pos;
<a name="l01621"></a>01621                found = 1;
<a name="l01622"></a>01622             }
<a name="l01623"></a>01623         }
<a name="l01624"></a>01624     } <span class="keywordflow">else</span> {
<a name="l01625"></a>01625         <a class="code" href="Getline_8c.html#ff64b1710cbbb4568c7699490fe0c74e">gl_putc</a>(<span class="charliteral">'\007'</span>);
<a name="l01626"></a>01626     }
<a name="l01627"></a>01627 }
<a name="l01628"></a>01628 
<a name="l01629"></a>01629 <span class="preprocessor">#if 0</span>
<a name="l01630"></a>01630 <span class="preprocessor"></span><span class="comment">/***********************************************************************</span>
<a name="l01631"></a>01631 <span class="comment"> *                                                                     *</span>
<a name="l01632"></a>01632 <span class="comment"> *   Strip blanks from both sides of a string. Space for the new       *</span>
<a name="l01633"></a>01633 <span class="comment"> *   string is allocated and a pointer to it is returned.              *</span>
<a name="l01634"></a>01634 <span class="comment"> *                                                                     *</span>
<a name="l01635"></a>01635 <span class="comment"> ***********************************************************************/</span>
<a name="l01636"></a>01636 <span class="keyword">static</span> <span class="keywordtype">char</span> *strip(<span class="keywordtype">char</span> *s)
<a name="l01637"></a>01637 {
<a name="l01638"></a>01638    <span class="keywordtype">char</span> *r, *t1, *t2;
<a name="l01639"></a>01639    <span class="keywordtype">int</span>   l;
<a name="l01640"></a>01640 
<a name="l01641"></a>01641    l = strlen(s);
<a name="l01642"></a>01642    r = (<span class="keywordtype">char</span> *)calloc(l+1, 1);
<a name="l01643"></a>01643 
<a name="l01644"></a>01644    <span class="keywordflow">if</span> (l == 0) {
<a name="l01645"></a>01645       *r = <span class="charliteral">'\0'</span>;
<a name="l01646"></a>01646       <span class="keywordflow">return</span> r;
<a name="l01647"></a>01647    }
<a name="l01648"></a>01648 
<a name="l01649"></a>01649    <span class="comment">/* get rid of leading blanks */</span>
<a name="l01650"></a>01650    t1 = s;
<a name="l01651"></a>01651    <span class="keywordflow">while</span> (*t1 == <span class="charliteral">' '</span>)
<a name="l01652"></a>01652       t1++;
<a name="l01653"></a>01653 
<a name="l01654"></a>01654    t2 = s + l - 1;
<a name="l01655"></a>01655    <span class="keywordflow">while</span> (*t2 == <span class="charliteral">' '</span> &amp;&amp; t2 &gt; s)
<a name="l01656"></a>01656       t2--;
<a name="l01657"></a>01657 
<a name="l01658"></a>01658    <span class="keywordflow">if</span> (t1 &gt; t2) {
<a name="l01659"></a>01659       *r = <span class="charliteral">'\0'</span>;
<a name="l01660"></a>01660       <span class="keywordflow">return</span> r;
<a name="l01661"></a>01661    }
<a name="l01662"></a>01662    strncpy(r, t1, (size_t) (t2-t1+1));
<a name="l01663"></a>01663 
<a name="l01664"></a>01664    <span class="keywordflow">return</span> r;
<a name="l01665"></a>01665 }
<a name="l01666"></a>01666 <span class="preprocessor">#endif</span>
<a name="l01667"></a>01667 <span class="preprocessor"></span>
<a name="l01668"></a>01668 <span class="comment">/*****************************************************************************/</span>
<a name="l01669"></a>01669 <span class="comment">/* Extra routine provided by Christian Lacunza &lt;lacunza@cdfsg5.lbl.gov&gt;      */</span>
<a name="l01670"></a>01670 <span class="comment">/*****************************************************************************/</span>
<a name="l01671"></a>01671 
<a name="l01672"></a>01672 <span class="comment">/* move cursor back to beginning of _current_ word */</span>
<a name="l01673"></a>01673 <span class="comment">/* unless it's already at the beginning,           */</span>
<a name="l01674"></a>01674 <span class="comment">/* in which case it moves back to the beginning    */</span>
<a name="l01675"></a>01675 <span class="comment">/* of the _previous_ word.                         */</span>
<a name="l01676"></a><a class="code" href="Getline_8c.html#821ee3fc2397e5abec67375f3129fff9">01676</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Getline_8c.html#821ee3fc2397e5abec67375f3129fff9">gl_back_1_word</a>( <span class="keywordtype">void</span> )
<a name="l01677"></a>01677 {
<a name="l01678"></a>01678      <span class="keywordtype">int</span> i = <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>;
<a name="l01679"></a>01679 
<a name="l01680"></a>01680      <span class="comment">/* if we're at the beginning of a word,     */</span>
<a name="l01681"></a>01681      <span class="comment">/* slip back into the preceeding whitespace */</span>
<a name="l01682"></a>01682      <span class="keywordflow">if</span>( i&gt;0 &amp;&amp; <a class="code" href="Getline_8c.html#cc7f63289d0484554fd5f4b1debb4450">is_whitespace</a>(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[i-1]) ) {
<a name="l01683"></a>01683           i-=1;
<a name="l01684"></a>01684      }
<a name="l01685"></a>01685 
<a name="l01686"></a>01686      <span class="comment">/* now move back over all consecutive whitespace */</span>
<a name="l01687"></a>01687      <span class="keywordflow">while</span>( i&gt;0 &amp;&amp; <a class="code" href="Getline_8c.html#cc7f63289d0484554fd5f4b1debb4450">is_whitespace</a>(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[i]) ) {
<a name="l01688"></a>01688           i-=1;
<a name="l01689"></a>01689      }
<a name="l01690"></a>01690 
<a name="l01691"></a>01691      <span class="comment">/* now keep moving back over all consecutive non-whitespace */</span>
<a name="l01692"></a>01692      <span class="comment">/* until we find the beginning of this word.                */</span>
<a name="l01693"></a>01693      <span class="comment">/* ie. stop just before more whitespace shows up.           */</span>
<a name="l01694"></a>01694      <span class="keywordflow">while</span>( i&gt;0 &amp;&amp; !<a class="code" href="Getline_8c.html#cc7f63289d0484554fd5f4b1debb4450">is_whitespace</a>(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[i-1]) ) {
<a name="l01695"></a>01695           i-=1;
<a name="l01696"></a>01696      }
<a name="l01697"></a>01697 
<a name="l01698"></a>01698      <span class="comment">/* move the cursor here */</span>
<a name="l01699"></a>01699      <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, -1, i);
<a name="l01700"></a>01700 }
<a name="l01701"></a>01701 
<a name="l01702"></a>01702 <span class="comment">/* kills from current position to begin of word */</span>
<a name="l01703"></a><a class="code" href="Getline_8c.html#959275de9f5e497fa3be7c729521dd8f">01703</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Getline_8c.html#959275de9f5e497fa3be7c729521dd8f">gl_kill_back_1_word</a>( <span class="keywordtype">void</span> )
<a name="l01704"></a>01704 {
<a name="l01705"></a>01705      <span class="keywordtype">int</span> i = <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>;
<a name="l01706"></a>01706 
<a name="l01707"></a>01707      <span class="comment">/* first find a word */</span>
<a name="l01708"></a>01708      <span class="keywordflow">while</span>( i&gt;0 &amp;&amp; <a class="code" href="Getline_8c.html#cc7f63289d0484554fd5f4b1debb4450">is_whitespace</a>(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[i-1]) ) {
<a name="l01709"></a>01709           i--;
<a name="l01710"></a>01710      }
<a name="l01711"></a>01711 
<a name="l01712"></a>01712      <span class="comment">/* next, find the begin of this word. */</span>
<a name="l01713"></a>01713      <span class="keywordflow">while</span>( i&gt;0 &amp;&amp; !<a class="code" href="Getline_8c.html#cc7f63289d0484554fd5f4b1debb4450">is_whitespace</a>(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[i-1]) ) {
<a name="l01714"></a>01714           i--;
<a name="l01715"></a>01715      }
<a name="l01716"></a>01716 
<a name="l01717"></a>01717      <span class="comment">/* kill */</span>
<a name="l01718"></a>01718      <a class="code" href="Getline_8c.html#9e39f121e80f71b767a8c22e16a0a226">gl_mark</a> = i;
<a name="l01719"></a>01719      <a class="code" href="Getline_8c.html#922cd7283fa8eef047b969d96bbef302">gl_wipe</a>();
<a name="l01720"></a>01720 }
<a name="l01721"></a>01721 
<a name="l01722"></a>01722 <span class="comment">/* kills from current position to end of word */</span>
<a name="l01723"></a><a class="code" href="Getline_8c.html#56af07ae473ac2bc5281ba45bdf165c1">01723</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Getline_8c.html#56af07ae473ac2bc5281ba45bdf165c1">gl_kill_1_word</a>( <span class="keywordtype">void</span> )
<a name="l01724"></a>01724 {
<a name="l01725"></a>01725      <span class="keywordtype">int</span> i = <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>;
<a name="l01726"></a>01726      <span class="keywordtype">int</span> j = <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>;
<a name="l01727"></a>01727 
<a name="l01728"></a>01728 <span class="comment">/* delete this: */</span>
<a name="l01729"></a>01729 <span class="preprocessor">#if 0</span>
<a name="l01730"></a>01730 <span class="preprocessor"></span>     <span class="comment">/* not sure what to do with "punctuation" */</span>
<a name="l01731"></a>01731      <span class="keywordflow">if</span>( <a class="code" href="Getline_8c.html#cc7f63289d0484554fd5f4b1debb4450">is_whitespace</a>(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[j]) &amp;&amp; <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[j]!=<span class="charliteral">' '</span> ) {
<a name="l01732"></a>01732           <span class="keywordflow">return</span>;
<a name="l01733"></a>01733      }
<a name="l01734"></a>01734      <span class="comment">/* first find a word */</span>
<a name="l01735"></a>01735      <span class="keywordflow">while</span>( j&lt;<a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> &amp;&amp; <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[j]==<span class="charliteral">' '</span> ) {
<a name="l01736"></a>01736           j+=1;
<a name="l01737"></a>01737      }
<a name="l01738"></a>01738 <span class="preprocessor">#endif</span>
<a name="l01739"></a>01739 <span class="preprocessor"></span>
<a name="l01740"></a>01740      <span class="comment">/* first find a word */</span>
<a name="l01741"></a>01741      <span class="keywordflow">while</span>( j&lt;<a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> &amp;&amp; <a class="code" href="Getline_8c.html#cc7f63289d0484554fd5f4b1debb4450">is_whitespace</a>(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[j]) ) {
<a name="l01742"></a>01742           j+=1;
<a name="l01743"></a>01743      }
<a name="l01744"></a>01744 
<a name="l01745"></a>01745      <span class="comment">/* next, find the end of this word. */</span>
<a name="l01746"></a>01746      <span class="keywordflow">while</span>( j&lt;<a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> &amp;&amp; !<a class="code" href="Getline_8c.html#cc7f63289d0484554fd5f4b1debb4450">is_whitespace</a>(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[j+1]) ) {
<a name="l01747"></a>01747           j+=1;
<a name="l01748"></a>01748      }
<a name="l01749"></a>01749 
<a name="l01750"></a>01750      <span class="comment">/* kill */</span>
<a name="l01751"></a>01751      <a class="code" href="Getline_8c.html#9550cb1b8a1f9bdb21b55052abf39de6">gl_kill_region</a>( i, j );
<a name="l01752"></a>01752 
<a name="l01753"></a>01753      <span class="comment">/* fixup */</span>
<a name="l01754"></a>01754      <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>, <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>);
<a name="l01755"></a>01755 }
<a name="l01756"></a>01756 
<a name="l01757"></a><a class="code" href="Getline_8c.html#9550cb1b8a1f9bdb21b55052abf39de6">01757</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Getline_8c.html#9550cb1b8a1f9bdb21b55052abf39de6">gl_kill_region</a>( <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j )
<a name="l01758"></a>01758 {
<a name="l01759"></a>01759      <span class="comment">/* copy to kill buffer */</span>
<a name="l01760"></a>01760      strncpy( <a class="code" href="Getline_8c.html#c589fb8abd0b14513bd0c4593ab5cadb">gl_killbuf</a>, <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>+i, j-i+1 );
<a name="l01761"></a>01761      <a class="code" href="Getline_8c.html#c589fb8abd0b14513bd0c4593ab5cadb">gl_killbuf</a>[j-i+1]=<span class="charliteral">'\0'</span>;
<a name="l01762"></a>01762 
<a name="l01763"></a>01763      <span class="comment">/* remove from gl_buf */</span>
<a name="l01764"></a>01764      <span class="keywordflow">while</span>( j&lt;<a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> ) {
<a name="l01765"></a>01765           <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[i]=<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[j+1];
<a name="l01766"></a>01766           i+=1;
<a name="l01767"></a>01767           j+=1;
<a name="l01768"></a>01768      }
<a name="l01769"></a>01769      <a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[i]=<span class="charliteral">'\0'</span>;
<a name="l01770"></a>01770 }
<a name="l01771"></a>01771 
<a name="l01772"></a>01772 <span class="comment">/* move cursor forward to the beginning of the next word. */</span>
<a name="l01773"></a><a class="code" href="Getline_8c.html#d64a9a053cf1e79f45cfe508476636f8">01773</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Getline_8c.html#d64a9a053cf1e79f45cfe508476636f8">gl_fwd_1_word</a>( <span class="keywordtype">void</span> )
<a name="l01774"></a>01774 {
<a name="l01775"></a>01775      <span class="keywordtype">int</span> i = <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>;
<a name="l01776"></a>01776 
<a name="l01777"></a>01777      <span class="comment">/* move past all non-whitespace into the whitespace between words. */</span>
<a name="l01778"></a>01778      <span class="keywordflow">while</span>( i&lt;<a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> &amp;&amp; !<a class="code" href="Getline_8c.html#cc7f63289d0484554fd5f4b1debb4450">is_whitespace</a>(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[i]) ) {
<a name="l01779"></a>01779           i+=1;
<a name="l01780"></a>01780      }
<a name="l01781"></a>01781 
<a name="l01782"></a>01782      <span class="comment">/* move past this whitespace to the beginning of the next word. */</span>
<a name="l01783"></a>01783      <span class="keywordflow">while</span>( i&lt;<a class="code" href="Getline_8c.html#bb203f62e351273f83732d223cf7c31f">gl_cnt</a> &amp;&amp; <a class="code" href="Getline_8c.html#cc7f63289d0484554fd5f4b1debb4450">is_whitespace</a>(<a class="code" href="Getline_8c.html#55d3ac30e4850f299a4d79a2683806cb">gl_buf</a>[i]) ) {
<a name="l01784"></a>01784           i+=1;
<a name="l01785"></a>01785      }
<a name="l01786"></a>01786 
<a name="l01787"></a>01787      <span class="comment">/* move the cursor here. */</span>
<a name="l01788"></a>01788      <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>(<a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, -1, i);
<a name="l01789"></a>01789 }
<a name="l01790"></a>01790 
<a name="l01791"></a>01791 <span class="comment">/* NOTE: "whitespace" is very loosely defined. */</span>
<a name="l01792"></a><a class="code" href="Getline_8c.html#cc7f63289d0484554fd5f4b1debb4450">01792</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="Getline_8c.html#cc7f63289d0484554fd5f4b1debb4450">is_whitespace</a>( <span class="keywordtype">char</span> c )
<a name="l01793"></a>01793 {
<a name="l01794"></a>01794      <span class="keywordtype">int</span> decent_character;
<a name="l01795"></a>01795 
<a name="l01796"></a>01796      decent_character = isalpha(c) || isdigit(c) || c==<span class="charliteral">'_'</span>;
<a name="l01797"></a>01797 
<a name="l01798"></a>01798      <span class="keywordflow">return</span> !decent_character;
<a name="l01799"></a>01799 }
<a name="l01800"></a>01800 
<a name="l01801"></a>01801 <span class="comment">/* sets mark to be at point */</span>
<a name="l01802"></a><a class="code" href="Getline_8c.html#e99f301c318e367b7b409b2cbb6c2607">01802</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Getline_8c.html#e99f301c318e367b7b409b2cbb6c2607">gl_set_mark</a>( <span class="keywordtype">void</span> )
<a name="l01803"></a>01803 {
<a name="l01804"></a>01804      <a class="code" href="Getline_8c.html#9e39f121e80f71b767a8c22e16a0a226">gl_mark</a> = <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>;
<a name="l01805"></a>01805 }
<a name="l01806"></a>01806 
<a name="l01807"></a>01807 <span class="comment">/* kills from mark to point */</span>
<a name="l01808"></a><a class="code" href="Getline_8c.html#922cd7283fa8eef047b969d96bbef302">01808</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Getline_8c.html#922cd7283fa8eef047b969d96bbef302">gl_wipe</a>( <span class="keywordtype">void</span> )
<a name="l01809"></a>01809 {
<a name="l01810"></a>01810      <span class="keywordtype">int</span> left, right;
<a name="l01811"></a>01811 
<a name="l01812"></a>01812      <span class="keywordflow">if</span>( <a class="code" href="Getline_8c.html#9e39f121e80f71b767a8c22e16a0a226">gl_mark</a>  &lt;   0    ) <span class="keywordflow">return</span>;
<a name="l01813"></a>01813      <span class="keywordflow">if</span>( <a class="code" href="Getline_8c.html#9e39f121e80f71b767a8c22e16a0a226">gl_mark</a> == <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> ) <span class="keywordflow">return</span>;
<a name="l01814"></a>01814 
<a name="l01815"></a>01815      <span class="keywordflow">if</span>( <a class="code" href="Getline_8c.html#9e39f121e80f71b767a8c22e16a0a226">gl_mark</a> &lt; <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a> ) {
<a name="l01816"></a>01816           left  = <a class="code" href="Getline_8c.html#9e39f121e80f71b767a8c22e16a0a226">gl_mark</a>;
<a name="l01817"></a>01817           right = <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>;
<a name="l01818"></a>01818      }
<a name="l01819"></a>01819      <span class="keywordflow">else</span> {
<a name="l01820"></a>01820           left  = <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>;
<a name="l01821"></a>01821           right = <a class="code" href="Getline_8c.html#9e39f121e80f71b767a8c22e16a0a226">gl_mark</a>;
<a name="l01822"></a>01822      }
<a name="l01823"></a>01823 
<a name="l01824"></a>01824      <a class="code" href="Getline_8c.html#9550cb1b8a1f9bdb21b55052abf39de6">gl_kill_region</a>( left, right-1 );
<a name="l01825"></a>01825      <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>( <a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, left, left );
<a name="l01826"></a>01826 }
<a name="l01827"></a>01827 
<a name="l01828"></a>01828 <span class="comment">/* echanges point and mark */</span>
<a name="l01829"></a><a class="code" href="Getline_8c.html#afe258d2fe04a339bcba29dba4c27653">01829</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Getline_8c.html#afe258d2fe04a339bcba29dba4c27653">gl_exch</a>( <span class="keywordtype">void</span> )
<a name="l01830"></a>01830 {
<a name="l01831"></a>01831      <span class="keywordtype">int</span> tmp;
<a name="l01832"></a>01832 
<a name="l01833"></a>01833      <span class="comment">/* make sure mark is set */</span>
<a name="l01834"></a>01834      <span class="keywordflow">if</span>( <a class="code" href="Getline_8c.html#9e39f121e80f71b767a8c22e16a0a226">gl_mark</a> &lt; 0 ) <span class="keywordflow">return</span>;
<a name="l01835"></a>01835 
<a name="l01836"></a>01836      tmp = <a class="code" href="Getline_8c.html#040281afbe3857e88c8928746984aa15">gl_pos</a>;
<a name="l01837"></a>01837      <a class="code" href="Getline_8c.html#c493203051ec830e14e176222bdea305">gl_fixup</a>( <a class="code" href="Getline_8c.html#ab670c13ac5378e3c439beebc0fdbe6c">gl_prompt</a>, -1, <a class="code" href="Getline_8c.html#9e39f121e80f71b767a8c22e16a0a226">gl_mark</a> );
<a name="l01838"></a>01838      <a class="code" href="Getline_8c.html#9e39f121e80f71b767a8c22e16a0a226">gl_mark</a> = tmp;
<a name="l01839"></a>01839 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on 12 Nov 2013 for RCU linux tools and drivers for the DCS board  by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
